<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>스케쥴 및 연차 관리</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #f5f5f5;
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 24px;
            color: #333;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logout-btn {
            padding: 8px 16px;
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .logout-btn:hover {
            background: #cc0000;
        }

        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .login-container h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #666;
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .btn-primary {
            width: 100%;
            padding: 12px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }

        .btn-primary:hover {
            background: #45a049;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 24px;
            background: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .tab.active {
            background: #4CAF50;
            color: white;
        }

        .tab:hover {
            background: #e8e8e8;
        }

        .tab.active:hover {
            background: #45a049;
        }

        .content-card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .calendar-header h2 {
            font-size: 24px;
            color: #333;
        }

        .calendar-nav {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .nav-btn {
            padding: 8px 16px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .nav-btn:hover {
            background: #45a049;
        }

        .calendar {
            width: 100%;
            border-collapse: collapse;
        }

        .calendar th {
            padding: 15px;
            background: #f5f5f5;
            border: 1px solid #ddd;
            font-weight: 600;
            color: #666;
        }

        .calendar td {
            padding: 10px;
            border: 1px solid #ddd;
            vertical-align: top;
            height: 120px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .calendar td:hover {
            background: #f9f9f9;
        }

        .calendar td.other-month {
            background: #fafafa;
            color: #ccc;
        }

        .calendar td.today {
            background: #e8f5e9;
        }

        .calendar td.holiday {
            background: #ffebee;
        }

        .calendar td.holiday .date-number {
            color: #d32f2f;
            font-weight: 700;
        }

        .holiday-name {
            font-size: 10px;
            color: #d32f2f;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .date-number {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .calendar td.sunday .date-number {
            color: #d32f2f;
        }

        .calendar td.saturday .date-number {
            color: #1976d2;
        }

        .schedule-item {
            font-size: 11px;
            padding: 3px 6px;
            margin: 2px 0;
            border-radius: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .schedule-item .delete-schedule-btn {
            background: rgba(255, 255, 255, 0.8);
            border: none;
            border-radius: 3px;
            cursor: pointer;
            padding: 2px 5px;
            font-size: 10px;
            color: #ff4444;
            font-weight: bold;
            margin-left: 5px;
            flex-shrink: 0;
        }

        .schedule-item .delete-schedule-btn:hover {
            background: rgba(255, 255, 255, 1);
        }

        .schedule-출근 { background: #e3f2fd; color: #1976d2; }
        .schedule-재택 { background: #fff3e0; color: #f57c00; }
        .schedule-연차 { background: #fce4ec; color: #c2185b; }
        .schedule-반차오전 { background: #f3e5f5; color: #7b1fa2; }
        .schedule-반차오후 { background: #e1f5fe; color: #0277bd; }
        .schedule-여름휴가 { background: #e0f2f1; color: #00796b; }
        .schedule-겨울휴가 { background: #e8eaf6; color: #3f51b5; }

        .daily-schedules {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #eee;
        }

        .daily-schedules h3 {
            margin-bottom: 20px;
            color: #333;
        }

        .daily-schedule-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .daily-schedule-card {
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid;
        }

        .daily-schedule-card.출근 { background: #e3f2fd; border-color: #1976d2; }
        .daily-schedule-card.재택 { background: #fff3e0; border-color: #f57c00; }
        .daily-schedule-card.연차 { background: #fce4ec; border-color: #c2185b; }
        .daily-schedule-card.반차오전 { background: #f3e5f5; border-color: #7b1fa2; }
        .daily-schedule-card.반차오후 { background: #e1f5fe; border-color: #0277bd; }
        .daily-schedule-card.여름휴가 { background: #e0f2f1; border-color: #00796b; }
        .daily-schedule-card.겨울휴가 { background: #e8eaf6; border-color: #3f51b5; }

        .daily-schedule-card .name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .daily-schedule-card .type {
            font-size: 14px;
            color: #666;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
        }

        .modal-content h3 {
            margin-bottom: 20px;
            color: #333;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-secondary {
            flex: 0 0 auto;
            min-width: 80px;
            padding: 0 20px;
            background: #666;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
        }

        .btn-secondary:hover {
            background: #555;
        }

        .modal-buttons .btn-primary {
            flex: 1;
            padding: 0 30px;
            font-size: 15px;
            font-weight: 600;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
            margin: 0;
        }

        .annual-leave-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .info-card {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
        }

        .info-card h4 {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .info-card .value {
            font-size: 24px;
            font-weight: 600;
            color: #333;
        }

        .register-btn {
            padding: 12px 24px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 30px;
        }

        .register-btn:hover {
            background: #45a049;
        }

        .leave-history {
            margin-top: 20px;
        }

        .leave-history table {
            width: 100%;
            border-collapse: collapse;
        }

        .leave-history th,
        .leave-history td {
            padding: 12px;
            border: 1px solid #ddd;
            text-align: left;
        }

        .leave-history th {
            background: #f5f5f5;
            font-weight: 600;
        }

        .admin-section {
            margin-bottom: 40px;
        }

        .admin-section h3 {
            margin-bottom: 20px;
            color: #333;
        }

        .employee-list {
            margin-top: 20px;
        }

        .employee-list table {
            width: 100%;
            border-collapse: collapse;
        }

        .employee-list th,
        .employee-list td {
            padding: 12px;
            border: 1px solid #ddd;
            text-align: left;
        }

        .employee-list th {
            background: #f5f5f5;
            font-weight: 600;
        }

        .delete-btn {
            padding: 6px 12px;
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .delete-btn:hover {
            background: #cc0000;
        }

        .error-message {
            color: #ff4444;
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Firebase 설정
        const firebaseConfig = {
            apiKey: "AIzaSyC_hwBHgdLWmI6z920PNgmWTKYSl_TZ4I0",
            authDomain: "work-calendar-839f2.firebaseapp.com",
            projectId: "work-calendar-839f2",
            storageBucket: "work-calendar-839f2.firebasestorage.app",
            messagingSenderId: "823701886482",
            appId: "1:823701886482:web:4a368e517a6d158ea12acb"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        const { useState, useEffect } = React;

        // 대한민국 공휴일 데이터
        // 고정 공휴일 + 2024-2030년 음력 공휴일
        const holidays = {
            // 2024년
            '2024-01-01': '신정',
            '2024-02-09': '설날 연휴',
            '2024-02-10': '설날',
            '2024-02-11': '설날 연휴',
            '2024-02-12': '대체공휴일',
            '2024-03-01': '삼일절',
            '2024-04-10': '제22대 국회의원 선거',
            '2024-05-05': '어린이날',
            '2024-05-06': '대체공휴일',
            '2024-05-15': '석가탄신일',
            '2024-06-06': '현충일',
            '2024-08-15': '광복절',
            '2024-09-16': '추석 연휴',
            '2024-09-17': '추석',
            '2024-09-18': '추석 연휴',
            '2024-10-03': '개천절',
            '2024-10-09': '한글날',
            '2024-12-25': '성탄절',
            
            // 2025년
            '2025-01-01': '신정',
            '2025-01-28': '설날 연휴',
            '2025-01-29': '설날',
            '2025-01-30': '설날 연휴',
            '2025-03-01': '삼일절',
            '2025-03-03': '대체공휴일',
            '2025-05-05': '어린이날',
            '2025-05-06': '석가탄신일',
            '2025-06-06': '현충일',
            '2025-08-15': '광복절',
            '2025-10-03': '개천절',
            '2025-10-05': '추석 연휴',
            '2025-10-06': '추석',
            '2025-10-07': '추석 연휴',
            '2025-10-08': '대체공휴일',
            '2025-10-09': '한글날',
            '2025-12-25': '성탄절',
            
            // 2026년
            '2026-01-01': '신정',
            '2026-02-16': '설날 연휴',
            '2026-02-17': '설날',
            '2026-02-18': '설날 연휴',
            '2026-03-01': '삼일절',
            '2026-03-02': '대체공휴일',
            '2026-05-05': '어린이날',
            '2026-05-24': '석가탄신일',
            '2026-05-25': '대체공휴일',
            '2026-06-06': '현충일',
            '2026-08-15': '광복절',
            '2026-09-24': '추석 연휴',
            '2026-09-25': '추석',
            '2026-09-26': '추석 연휴',
            '2026-10-03': '개천절',
            '2026-10-05': '대체공휴일',
            '2026-10-09': '한글날',
            '2026-12-25': '성탄절',
            
            // 2027년
            '2027-01-01': '신정',
            '2027-02-06': '설날 연휴',
            '2027-02-07': '설날',
            '2027-02-08': '설날 연휴',
            '2027-03-01': '삼일절',
            '2027-05-05': '어린이날',
            '2027-05-13': '석가탄신일',
            '2027-06-06': '현충일',
            '2027-06-07': '대체공휴일',
            '2027-08-15': '광복절',
            '2027-08-16': '대체공휴일',
            '2027-09-14': '추석 연휴',
            '2027-09-15': '추석',
            '2027-09-16': '추석 연휴',
            '2027-10-03': '개천절',
            '2027-10-04': '대체공휴일',
            '2027-10-09': '한글날',
            '2027-10-11': '대체공휴일',
            '2027-12-25': '성탄절',
            
            // 2028년
            '2028-01-01': '신정',
            '2028-01-26': '설날 연휴',
            '2028-01-27': '설날',
            '2028-01-28': '설날 연휴',
            '2028-03-01': '삼일절',
            '2028-05-02': '석가탄신일',
            '2028-05-05': '어린이날',
            '2028-06-06': '현충일',
            '2028-08-15': '광복절',
            '2028-10-02': '추석 연휴',
            '2028-10-03': '추석',
            '2028-10-04': '추석 연휴',
            '2028-10-09': '한글날',
            '2028-12-25': '성탄절',
            
            // 2029년
            '2029-01-01': '신정',
            '2029-02-12': '설날 연휴',
            '2029-02-13': '설날',
            '2029-02-14': '설날 연휴',
            '2029-03-01': '삼일절',
            '2029-05-05': '어린이날',
            '2029-05-20': '석가탄신일',
            '2029-05-21': '대체공휴일',
            '2029-06-06': '현충일',
            '2029-08-15': '광복절',
            '2029-09-21': '추석 연휴',
            '2029-09-22': '추석',
            '2029-09-23': '추석 연휴',
            '2029-09-24': '대체공휴일',
            '2029-10-03': '개천절',
            '2029-10-09': '한글날',
            '2029-12-25': '성탄절',
            
            // 2030년
            '2030-01-01': '신정',
            '2030-02-02': '설날 연휴',
            '2030-02-03': '설날',
            '2030-02-04': '설날 연휴',
            '2030-03-01': '삼일절',
            '2030-05-05': '어린이날',
            '2030-05-06': '대체공휴일',
            '2030-05-09': '석가탄신일',
            '2030-06-06': '현충일',
            '2030-08-15': '광복절',
            '2030-09-11': '추석 연휴',
            '2030-09-12': '추석',
            '2030-09-13': '추석 연휴',
            '2030-10-03': '개천절',
            '2030-10-09': '한글날',
            '2030-12-25': '성탄절'
        };

        // 날짜 유틸리티 함수
        const getDaysInMonth = (year, month) => {
            return new Date(year, month + 1, 0).getDate();
        };

        const getFirstDayOfMonth = (year, month) => {
            return new Date(year, month, 1).getDay();
        };

        const formatDate = (year, month, day) => {
            const m = String(month + 1).padStart(2, '0');
            const d = String(day).padStart(2, '0');
            return `${year}-${m}-${d}`;
        };

        // 로그인 컴포넌트
        function Login({ onLogin }) {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [success, setSuccess] = useState('');
            const [showResetPassword, setShowResetPassword] = useState(false);
            const [resetEmail, setResetEmail] = useState('');
            const [rememberEmail, setRememberEmail] = useState(false);

            // 컴포넌트 마운트 시 저장된 이메일 불러오기
            useEffect(() => {
                const savedEmail = localStorage.getItem('savedEmail');
                if (savedEmail) {
                    setEmail(savedEmail);
                    setRememberEmail(true);
                }
            }, []);

            const handleLogin = async (e) => {
                e.preventDefault();
                setError('');
                try {
                    // 아이디 저장 체크 시 localStorage에 저장
                    if (rememberEmail) {
                        localStorage.setItem('savedEmail', email);
                    } else {
                        localStorage.removeItem('savedEmail');
                    }
                    
                    await auth.signInWithEmailAndPassword(email, password);
                } catch (err) {
                    setError('로그인 실패: ' + err.message);
                }
            };

            const handleResetPassword = async (e) => {
                e.preventDefault();
                setError('');
                setSuccess('');
                
                if (!resetEmail) {
                    setError('이메일을 입력해주세요.');
                    return;
                }

                try {
                    await auth.sendPasswordResetEmail(resetEmail);
                    setSuccess('비밀번호 재설정 이메일이 발송되었습니다. 이메일을 확인해주세요.');
                    setResetEmail('');
                    setTimeout(() => {
                        setShowResetPassword(false);
                        setSuccess('');
                    }, 3000);
                } catch (err) {
                    if (err.code === 'auth/user-not-found') {
                        setError('등록되지 않은 이메일입니다.');
                    } else if (err.code === 'auth/invalid-email') {
                        setError('유효하지 않은 이메일 형식입니다.');
                    } else {
                        setError('비밀번호 재설정 실패: ' + err.message);
                    }
                }
            };

            if (showResetPassword) {
                return (
                    <div className="login-container">
                        <h2>비밀번호 재설정</h2>
                        <form onSubmit={handleResetPassword}>
                            <div className="form-group">
                                <label>이메일</label>
                                <input
                                    type="email"
                                    value={resetEmail}
                                    onChange={(e) => setResetEmail(e.target.value)}
                                    placeholder="가입한 이메일을 입력하세요"
                                    required
                                />
                            </div>
                            <button type="submit" className="btn-primary">재설정 이메일 보내기</button>
                            <button 
                                type="button" 
                                className="btn-primary" 
                                onClick={() => {
                                    setShowResetPassword(false);
                                    setError('');
                                    setSuccess('');
                                }}
                                style={{
                                    background: '#666',
                                    marginTop: '10px'
                                }}
                            >
                                로그인으로 돌아가기
                            </button>
                            {error && <div className="error-message">{error}</div>}
                            {success && <div style={{color: '#4CAF50', fontSize: '14px', marginTop: '10px', textAlign: 'center'}}>{success}</div>}
                        </form>
                    </div>
                );
            }

            return (
                <div className="login-container">
                    <h2>스케쥴 및 연차 관리</h2>
                    <form onSubmit={handleLogin}>
                        <div className="form-group">
                            <label>이메일</label>
                            <input
                                type="email"
                                value={email}
                                onChange={(e) => setEmail(e.target.value)}
                                required
                            />
                        </div>
                        <div className="form-group">
                            <label>비밀번호</label>
                            <input
                                type="password"
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                                required
                            />
                        </div>
                        <div className="form-group" style={{marginBottom: '10px'}}>
                            <label style={{
                                display: 'flex',
                                alignItems: 'center',
                                cursor: 'pointer',
                                fontSize: '14px',
                                fontWeight: 'normal'
                            }}>
                                <input
                                    type="checkbox"
                                    checked={rememberEmail}
                                    onChange={(e) => setRememberEmail(e.target.checked)}
                                    style={{
                                        marginRight: '8px',
                                        cursor: 'pointer',
                                        width: '16px',
                                        height: '16px'
                                    }}
                                />
                                아이디 저장
                            </label>
                        </div>
                        <button type="submit" className="btn-primary">로그인</button>
                        {error && <div className="error-message">{error}</div>}
                        <div style={{
                            textAlign: 'center',
                            marginTop: '15px'
                        }}>
                            <button
                                type="button"
                                onClick={() => {
                                    setShowResetPassword(true);
                                    setError('');
                                }}
                                style={{
                                    background: 'none',
                                    border: 'none',
                                    color: '#4CAF50',
                                    cursor: 'pointer',
                                    fontSize: '14px',
                                    textDecoration: 'underline'
                                }}
                            >
                                비밀번호를 잊으셨나요?
                            </button>
                        </div>
                    </form>
                </div>
            );
        }

        // 스케줄 선택 모달
        function ScheduleModal({ date, currentSchedule, onSave, onClose, userName }) {
            const [scheduleType, setScheduleType] = useState(currentSchedule || '출근');

            const handleSave = () => {
                onSave(date, scheduleType);
            };

            return (
                <div className="modal" onClick={onClose}>
                    <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                        <h3>{date} 일정 등록</h3>
                        <div className="form-group">
                            <label>일정 유형</label>
                            <select
                                value={scheduleType}
                                onChange={(e) => setScheduleType(e.target.value)}
                                style={{
                                    width: '100%',
                                    padding: '12px',
                                    border: '1px solid #ddd',
                                    borderRadius: '6px',
                                    fontSize: '14px'
                                }}
                            >
                                <option value="출근">출근</option>
                                <option value="재택">재택</option>
                                <option value="연차">연차</option>
                                <option value="반차(오전)">반차(오전)</option>
                                <option value="반차(오후)">반차(오후)</option>
                                <option value="여름휴가">여름휴가</option>
                                <option value="겨울휴가">겨울휴가</option>
                            </select>
                        </div>
                        <div className="modal-buttons">
                            <button className="btn-secondary" onClick={onClose}>취소</button>
                            <button className="btn-primary" onClick={handleSave}>저장</button>
                        </div>
                    </div>
                </div>
            );
        }

        // 캘린더 컴포넌트
        function Calendar({ user, employees }) {
            const [currentDate, setCurrentDate] = useState(new Date());
            const [schedules, setSchedules] = useState({});
            const [selectedDate, setSelectedDate] = useState(null);
            const [selectedDaySchedules, setSelectedDaySchedules] = useState([]);
            const [showScheduleModal, setShowScheduleModal] = useState(false);

            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();

            useEffect(() => {
                loadSchedules();
            }, [year, month]);

            useEffect(() => {
                // 오늘 날짜의 일정을 자동으로 표시
                const today = new Date();
                const todayStr = formatDate(today.getFullYear(), today.getMonth(), today.getDate());
                setSelectedDate(todayStr);
            }, [schedules]);

            useEffect(() => {
                // selectedDate가 변경될 때마다 해당 날짜의 일정 표시
                if (selectedDate && schedules[selectedDate]) {
                    setSelectedDaySchedules(schedules[selectedDate]);
                } else if (selectedDate) {
                    setSelectedDaySchedules([]);
                }
            }, [selectedDate, schedules]);

            const loadSchedules = async () => {
                const startDate = formatDate(year, month, 1);
                const endDate = formatDate(year, month, getDaysInMonth(year, month));

                const snapshot = await db.collection('schedules')
                    .where('date', '>=', startDate)
                    .where('date', '<=', endDate)
                    .get();

                const scheduleData = {};
                snapshot.forEach(doc => {
                    const data = doc.data();
                    if (!scheduleData[data.date]) {
                        scheduleData[data.date] = [];
                    }
                    scheduleData[data.date].push({
                        id: doc.id,
                        ...data
                    });
                });

                setSchedules(scheduleData);
            };

            const handlePrevMonth = () => {
                setCurrentDate(new Date(year, month - 1));
            };

            const handleNextMonth = () => {
                setCurrentDate(new Date(year, month + 1));
            };

            const handleDateClick = (day) => {
                const dateStr = formatDate(year, month, day);
                setSelectedDate(dateStr);
                setShowScheduleModal(true);
            };

                        const handleSaveSchedule = async (date, type) => {
                const scheduleRef = db.collection('schedules');
                
                // 기존 스케줄 확인
                const existingSchedule = await scheduleRef
                    .where('userId', '==', user.uid)
                    .where('date', '==', date)
                    .get();

                // 연차 관련 타입인지 확인
                const isLeaveType = ['연차', '반차(오전)', '반차(오후)', '여름휴가', '겨울휴가'].includes(type);
                const approvalStatus = isLeaveType ? 'pending' : null;

                let oldType = null;
                if (!existingSchedule.empty) {
                    oldType = existingSchedule.docs[0].data().type;
                    // 업데이트
                    const docId = existingSchedule.docs[0].id;
                    const updateData = {
                        type: type,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    if (isLeaveType) {
                        updateData.approvalStatus = 'pending';
                    }
                    await scheduleRef.doc(docId).update(updateData);
                } else {
                    // 새로 생성
                    const newScheduleData = {
                        userId: user.uid,
                        userName: user.displayName || user.email,
                        date: date,
                        type: type,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    if (isLeaveType) {
                        newScheduleData.approvalStatus = 'pending';
                    }
                    await scheduleRef.add(newScheduleData);
                }

                // 기존 연차 내역이 있었다면 삭제
                if (oldType && (oldType === '연차' || oldType === '반차(오전)' || oldType === '반차(오후)' || oldType === '여름휴가' || oldType === '겨울휴가')) {
                    const oldLeaveUsage = await db.collection('leaveUsage')
                        .where('userId', '==', user.uid)
                        .where('date', '==', date)
                        .where('type', '==', oldType)
                        .get();
                    
                    oldLeaveUsage.forEach(async (doc) => {
                        await doc.ref.delete();
                    });
                }

                // 새로운 타입이 연차인 경우 연차 사용 기록 추가 (승인대기 상태)
                if (type === '연차' || type === '반차(오전)' || type === '반차(오후)' || type === '여름휴가' || type === '겨울휴가') {
                    let leaveAmount = 0;
                    if (type === '연차') {
                        leaveAmount = 1;
                    } else if (type === '반차(오전)' || type === '반차(오후)') {
                        leaveAmount = 0.5;
                    } else if (type === '여름휴가' || type === '겨울휴가') {
                        leaveAmount = 0;
                    }
                    
                    await db.collection('leaveUsage').add({
                        userId: user.uid,
                        date: date,
                        type: type,
                        amount: leaveAmount,
                        approvalStatus: 'pending',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }

                setShowScheduleModal(false);
                loadSchedules();
            };

            const handleDeleteSchedule = async (scheduleId, scheduleDate, scheduleType) => {
                if (!confirm('이 일정을 삭제하시겠습니까?')) return;

                try {
                    // 스케줄 삭제
                    await db.collection('schedules').doc(scheduleId).delete();

                    // 연차인 경우 연차 사용 기록도 삭제
                    if (scheduleType === '연차' || scheduleType === '반차(오전)' || scheduleType === '반차(오후)' || scheduleType === '여름휴가' || scheduleType === '겨울휴가') {
                        const leaveUsageSnapshot = await db.collection('leaveUsage')
                            .where('userId', '==', user.uid)
                            .where('date', '==', scheduleDate)
                            .where('type', '==', scheduleType)
                            .get();

                        leaveUsageSnapshot.forEach(async (doc) => {
                            await doc.ref.delete();
                        });
                    }

                    loadSchedules();
                } catch (error) {
                    alert('삭제 실패: ' + error.message);
                }
            };

            const renderCalendar = () => {
                const daysInMonth = getDaysInMonth(year, month);
                const firstDay = getFirstDayOfMonth(year, month);
                const weeks = [];
                let days = [];

                // 이전 달의 빈 칸
                for (let i = 0; i < firstDay; i++) {
                    days.push(<td key={`empty-${i}`} className="other-month"></td>);
                }

                // 현재 달의 날짜
                const today = new Date();
                const isCurrentMonth = today.getFullYear() === year && today.getMonth() === month;

                for (let day = 1; day <= daysInMonth; day++) {
                    const dateStr = formatDate(year, month, day);
                    const daySchedules = schedules[dateStr] || [];
                    const isToday = isCurrentMonth && today.getDate() === day;
                    const isHoliday = holidays[dateStr];
                    
                    // 요일 계산 (0: 일요일, 6: 토요일)
                    const dayOfWeek = new Date(year, month, day).getDay();
                    const isSunday = dayOfWeek === 0;
                    const isSaturday = dayOfWeek === 6;

                    days.push(
                        <td
                            key={day}
                            className={`${isToday ? 'today' : ''} ${isHoliday ? 'holiday' : ''} ${isSunday ? 'sunday' : ''} ${isSaturday ? 'saturday' : ''}`}
                            onClick={() => handleDateClick(day)}
                        >
                            <div className="date-number">{day}</div>
                            {isHoliday && <div className="holiday-name">{isHoliday}</div>}
                            {daySchedules.map((schedule, idx) => {
                                // 연차 관련 일정인지 확인
                                const isLeaveType = ['연차', '반차(오전)', '반차(오후)', '여름휴가', '겨울휴가'].includes(schedule.type);
                                const statusText = schedule.approvalStatus === 'approved' ? ' (승인완료)' : 
                                                  schedule.approvalStatus === 'rejected' ? ' (반려)' :
                                                  schedule.approvalStatus === 'pending' ? ' (승인대기)' : '';
                                
                                return (
                                    <div
                                        key={idx}
                                        className={`schedule-item schedule-${schedule.type.replace(/[()]/g, '')}`}
                                        onClick={(e) => e.stopPropagation()}
                                    >
                                        <span>{schedule.userName.split('@')[0]} - {schedule.type}{isLeaveType ? statusText : ''}</span>
                                        {schedule.userId === user.uid && (
                                            <button
                                                className="delete-schedule-btn"
                                                onClick={(e) => {
                                                    e.stopPropagation();
                                                    handleDeleteSchedule(schedule.id, schedule.date, schedule.type);
                                                }}
                                            >
                                                ✕
                                            </button>
                                        )}
                                    </div>
                                );
                            })}
                        </td>
                    );

                    if (days.length === 7) {
                        weeks.push(<tr key={weeks.length}>{days}</tr>);
                        days = [];
                    }
                }

                // 남은 빈 칸
                if (days.length > 0) {
                    while (days.length < 7) {
                        days.push(<td key={`empty-end-${days.length}`} className="other-month"></td>);
                    }
                    weeks.push(<tr key={weeks.length}>{days}</tr>);
                }

                return weeks;
            };

            const monthNames = ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'];

            return (
                <div className="content-card">
                    <div className="calendar-header">
                        <h2>{year}년 {monthNames[month]}</h2>
                        <div className="calendar-nav">
                            <button className="nav-btn" onClick={handlePrevMonth}>이전</button>
                            <button className="nav-btn" onClick={handleNextMonth}>다음</button>
                        </div>
                    </div>

                    <table className="calendar">
                        <thead>
                            <tr>
                                <th>일</th>
                                <th>월</th>
                                <th>화</th>
                                <th>수</th>
                                <th>목</th>
                                <th>금</th>
                                <th>토</th>
                            </tr>
                        </thead>
                        <tbody>
                            {renderCalendar()}
                        </tbody>
                    </table>

                    {selectedDate && selectedDaySchedules.length > 0 && (
                        <div className="daily-schedules">
                            <h3>{selectedDate} 일정</h3>
                            <div className="daily-schedule-list">
                                {selectedDaySchedules.map((schedule, idx) => (
                                    <div key={idx} className={`daily-schedule-card ${schedule.type.replace(/[()]/g, '')}`}>
                                        <div className="name">{schedule.userName.split('@')[0]}</div>
                                        <div className="type">{schedule.type}</div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {showScheduleModal && selectedDate && (
                        <ScheduleModal
                            date={selectedDate}
                            currentSchedule={
                                selectedDaySchedules.find(s => s.userId === user.uid)?.type
                            }
                            onSave={handleSaveSchedule}
                            onClose={() => setShowScheduleModal(false)}
                            userName={user.displayName || user.email}
                        />
                    )}
                </div>
            );
        }

        // 연차 관리 컴포넌트
        function AnnualLeave({ user }) {
            const [employeeInfo, setEmployeeInfo] = useState(null);
            const [leaveUsage, setLeaveUsage] = useState([]);
            const [showRegisterModal, setShowRegisterModal] = useState(false);
            const [leaveStartDate, setLeaveStartDate] = useState('');
            const [leaveEndDate, setLeaveEndDate] = useState('');
            const [leaveType, setLeaveType] = useState('연차');

            useEffect(() => {
                loadEmployeeInfo();
                loadLeaveUsage();
            }, []);

            const loadEmployeeInfo = async () => {
                const doc = await db.collection('employees').doc(user.uid).get();
                if (doc.exists) {
                    setEmployeeInfo(doc.data());
                }
            };

            const loadLeaveUsage = async () => {
                try {
                    const snapshot = await db.collection('leaveUsage')
                        .where('userId', '==', user.uid)
                        .get();

                    const usage = [];
                    snapshot.forEach(doc => {
                        usage.push({ id: doc.id, ...doc.data() });
                    });
                    
                    // 날짜 기준으로 내림차순 정렬
                    usage.sort((a, b) => b.date.localeCompare(a.date));
                    
                    setLeaveUsage(usage);
                } catch (error) {
                    console.error('연차 내역 로드 실패:', error);
                }
            };

            const calculateTotalLeave = (joinDate) => {
                if (!joinDate) return 0;
                const join = new Date(joinDate);
                const now = new Date();
                const years = now.getFullYear() - join.getFullYear();
                
                // 1년 미만
                if (years < 1) {
                    const months = (now.getFullYear() - join.getFullYear()) * 12 + (now.getMonth() - join.getMonth());
                    return Math.floor(months);
                }
                
                // 1년 이상: 기본 15일 + 근속연수당 1일
                return 15 + Math.min(years - 1, 10);
            };

            const calculateUsedLeave = () => {
                // 승인된 연차만 카운트
                return leaveUsage
                    .filter(usage => usage.approvalStatus === 'approved')
                    .reduce((sum, usage) => sum + usage.amount, 0);
            };

            const handleRegisterLeave = async () => {
                if (!leaveStartDate || !leaveEndDate) {
                    alert('시작일과 종료일을 모두 선택해주세요.');
                    return;
                }

                const startDate = new Date(leaveStartDate);
                const endDate = new Date(leaveEndDate);

                if (startDate > endDate) {
                    alert('종료일은 시작일보다 늦어야 합니다.');
                    return;
                }

                // 휴가 유형에 따른 연차 수량 계산
                let leaveAmount = 0;
                if (leaveType === '연차') {
                    leaveAmount = 1;
                } else if (leaveType === '반차(오전)' || leaveType === '반차(오후)') {
                    leaveAmount = 0.5;
                } else if (leaveType === '여름휴가' || leaveType === '겨울휴가') {
                    leaveAmount = 0; // 연차 수량에 카운트하지 않음
                }
                
                // 시작일부터 종료일까지 순회
                const currentDate = new Date(startDate);
                while (currentDate <= endDate) {
                    const dateStr = currentDate.toISOString().split('T')[0];
                    
                    // 주말 제외 (토요일=6, 일요일=0)
                    const dayOfWeek = currentDate.getDay();
                    if (dayOfWeek !== 0 && dayOfWeek !== 6) {
                        // 연차 사용 기록 (승인대기 상태)
                        await db.collection('leaveUsage').add({
                            userId: user.uid,
                            date: dateStr,
                            type: leaveType,
                            amount: leaveAmount,
                            approvalStatus: 'pending',
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });

                        // 스케줄에 등록 (승인대기 상태)
                        const scheduleRef = db.collection('schedules');
                        const existingSchedule = await scheduleRef
                            .where('userId', '==', user.uid)
                            .where('date', '==', dateStr)
                            .get();

                        if (!existingSchedule.empty) {
                            const docId = existingSchedule.docs[0].id;
                            await scheduleRef.doc(docId).update({
                                type: leaveType,
                                approvalStatus: 'pending',
                                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        } else {
                            await scheduleRef.add({
                                userId: user.uid,
                                userName: user.displayName || user.email,
                                date: dateStr,
                                type: leaveType,
                                approvalStatus: 'pending',
                                createdAt: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        }
                    }
                    
                    // 다음 날로 이동
                    currentDate.setDate(currentDate.getDate() + 1);
                }

                alert('연차 신청이 완료되었습니다. 승인을 기다려주세요.');
                setShowRegisterModal(false);
                setLeaveStartDate('');
                setLeaveEndDate('');
                loadLeaveUsage();
            };

            if (!employeeInfo) {
                return <div className="content-card">직원 정보를 불러오는 중...</div>;
            }

            const totalLeave = employeeInfo.customTotalLeave || calculateTotalLeave(employeeInfo.joinDate);
            const usedLeave = calculateUsedLeave();
            const remainingLeave = totalLeave - usedLeave;

            return (
                <div className="content-card">
                    <button className="register-btn" onClick={() => setShowRegisterModal(true)}>
                        연차 등록
                    </button>

                    <div className="annual-leave-info">
                        <div className="info-card">
                            <h4>입사일</h4>
                            <div className="value">{employeeInfo.joinDate}</div>
                        </div>
                        <div className="info-card">
                            <h4>총 연차</h4>
                            <div className="value">{totalLeave}일</div>
                        </div>
                        <div className="info-card">
                            <h4>사용 연차</h4>
                            <div className="value">{usedLeave}일</div>
                        </div>
                        <div className="info-card">
                            <h4>남은 연차</h4>
                            <div className="value" style={{color: '#4CAF50'}}>{remainingLeave}일</div>
                        </div>
                    </div>

                    <div className="leave-history">
                        <h3>연차 사용 내역</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>날짜</th>
                                    <th>유형</th>
                                    <th>사용일수</th>
                                    <th>승인 상태</th>
                                </tr>
                            </thead>
                            <tbody>
                                {leaveUsage.map(usage => (
                                    <tr key={usage.id}>
                                        <td>{usage.date}</td>
                                        <td>{usage.type}</td>
                                        <td>{usage.amount > 0 ? `${usage.amount}일` : '-'}</td>
                                        <td>
                                            <span style={{
                                                padding: '4px 8px',
                                                borderRadius: '4px',
                                                fontSize: '12px',
                                                background: usage.approvalStatus === 'approved' ? '#4CAF50' : 
                                                           usage.approvalStatus === 'rejected' ? '#ff4444' : '#ff9800',
                                                color: 'white'
                                            }}>
                                                {usage.approvalStatus === 'approved' ? '승인완료' : 
                                                 usage.approvalStatus === 'rejected' ? '반려' : '승인대기'}
                                            </span>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>

                    {showRegisterModal && (
                        <div className="modal" onClick={() => setShowRegisterModal(false)}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                                <h3>연차 등록</h3>
                                <div className="form-group">
                                    <label>시작일</label>
                                    <input
                                        type="date"
                                        value={leaveStartDate}
                                        onChange={(e) => setLeaveStartDate(e.target.value)}
                                    />
                                </div>
                                <div className="form-group">
                                    <label>종료일</label>
                                    <input
                                        type="date"
                                        value={leaveEndDate}
                                        onChange={(e) => setLeaveEndDate(e.target.value)}
                                    />
                                </div>
                                <div className="form-group">
                                    <label>유형</label>
                                    <select
                                        value={leaveType}
                                        onChange={(e) => setLeaveType(e.target.value)}
                                        style={{
                                            width: '100%',
                                            padding: '12px',
                                            border: '1px solid #ddd',
                                            borderRadius: '6px',
                                            fontSize: '14px'
                                        }}
                                    >
                                        <option value="연차">연차</option>
                                        <option value="반차(오전)">반차(오전)</option>
                                        <option value="반차(오후)">반차(오후)</option>
                                        <option value="여름휴가">여름휴가</option>
                                        <option value="겨울휴가">겨울휴가</option>
                                    </select>
                                </div>
                                <div style={{fontSize: '12px', color: '#666', marginTop: '10px'}}>
                                    * 주말(토,일)은 자동으로 제외됩니다.
                                </div>
                                <div className="modal-buttons">
                                    <button className="btn-secondary" onClick={() => setShowRegisterModal(false)}>
                                        취소
                                    </button>
                                    <button className="btn-primary" onClick={handleRegisterLeave}>
                                        등록
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // 관리자 페이지
        function AdminPage() {
            const [employees, setEmployees] = useState([]);
            const [showAddModal, setShowAddModal] = useState(false);
            const [newEmployee, setNewEmployee] = useState({
                email: '',
                name: '',
                joinDate: '',
                password: ''
            });

            useEffect(() => {
                loadEmployees();
            }, []);

            const loadEmployees = async () => {
                const snapshot = await db.collection('employees').get();
                const employeeList = [];
                snapshot.forEach(doc => {
                    employeeList.push({ id: doc.id, ...doc.data() });
                });
                setEmployees(employeeList);
            };

            const handleAddEmployee = async () => {
                if (!newEmployee.email || !newEmployee.name || !newEmployee.joinDate || !newEmployee.password) {
                    alert('모든 필드를 입력해주세요.');
                    return;
                }

                try {
                    // Firebase Auth에 사용자 생성
                    const userCredential = await auth.createUserWithEmailAndPassword(
                        newEmployee.email,
                        newEmployee.password
                    );

                    // Firestore에 직원 정보 저장
                    await db.collection('employees').doc(userCredential.user.uid).set({
                        email: newEmployee.email,
                        name: newEmployee.name,
                        joinDate: newEmployee.joinDate,
                        isApprover: false,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    // 사용자 이름 설정
                    await userCredential.user.updateProfile({
                        displayName: newEmployee.name
                    });

                    alert('직원이 추가되었습니다.');
                    setShowAddModal(false);
                    setNewEmployee({ email: '', name: '', joinDate: '', password: '' });
                    loadEmployees();
                } catch (error) {
                    alert('직원 추가 실패: ' + error.message);
                }
            };

            const handleToggleApprover = async (employeeId, currentStatus) => {
                try {
                    await db.collection('employees').doc(employeeId).update({
                        isApprover: !currentStatus
                    });
                    alert('승인자 권한이 ' + (!currentStatus ? '부여' : '해제') + '되었습니다.');
                    loadEmployees();
                } catch (error) {
                    alert('권한 변경 실패: ' + error.message);
                }
            };

            const handleDeleteEmployee = async (employeeId) => {
                if (!confirm('정말 삭제하시겠습니까?')) return;

                try {
                    await db.collection('employees').doc(employeeId).delete();
                    // Note: Firebase Auth의 사용자 삭제는 Admin SDK가 필요합니다
                    alert('직원이 삭제되었습니다.');
                    loadEmployees();
                } catch (error) {
                    alert('삭제 실패: ' + error.message);
                }
            };

            const handleAssignApprover = async (employeeId, approverId) => {
                try {
                    await db.collection('employees').doc(employeeId).update({
                        approver: approverId || null
                    });
                    alert('담당 승인자가 할당되었습니다.');
                    loadEmployees();
                } catch (error) {
                    alert('할당 실패: ' + error.message);
                }
            };

            const approvers = employees.filter(emp => emp.isApprover);

            return (
                <div className="content-card">
                    <div className="admin-section">
                        <h3>직원 관리</h3>
                        <button className="register-btn" onClick={() => setShowAddModal(true)}>
                            직원 추가
                        </button>

                        <div className="employee-list">
                            <table>
                                <thead>
                                    <tr>
                                        <th>이름</th>
                                        <th>이메일</th>
                                        <th>입사일</th>
                                        <th>승인자 권한</th>
                                        <th>담당 승인자</th>
                                        <th>관리</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {employees.map(emp => (
                                        <tr key={emp.id}>
                                            <td>{emp.name}</td>
                                            <td>{emp.email}</td>
                                            <td>{emp.joinDate}</td>
                                            <td>
                                                <label style={{
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    justifyContent: 'center',
                                                    cursor: 'pointer'
                                                }}>
                                                    <input
                                                        type="checkbox"
                                                        checked={emp.isApprover || false}
                                                        onChange={() => handleToggleApprover(emp.id, emp.isApprover)}
                                                        style={{
                                                            cursor: 'pointer',
                                                            width: '18px',
                                                            height: '18px'
                                                        }}
                                                    />
                                                </label>
                                            </td>
                                            <td>
                                                {!emp.isApprover ? (
                                                    <select
                                                        value={emp.approver || ''}
                                                        onChange={(e) => handleAssignApprover(emp.id, e.target.value)}
                                                        style={{
                                                            width: '100%',
                                                            padding: '6px',
                                                            border: '1px solid #ddd',
                                                            borderRadius: '4px',
                                                            fontSize: '13px'
                                                        }}
                                                    >
                                                        <option value="">선택 안함</option>
                                                        {approvers.map(approver => (
                                                            <option key={approver.id} value={approver.id}>
                                                                {approver.name}
                                                            </option>
                                                        ))}
                                                    </select>
                                                ) : (
                                                    <span style={{color: '#999', fontSize: '13px'}}>-</span>
                                                )}
                                            </td>
                                            <td>
                                                <button
                                                    className="delete-btn"
                                                    onClick={() => handleDeleteEmployee(emp.id)}
                                                >
                                                    삭제
                                                </button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    {showAddModal && (
                        <div className="modal" onClick={() => setShowAddModal(false)}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                                <h3>직원 추가</h3>
                                <div className="form-group">
                                    <label>이름</label>
                                    <input
                                        type="text"
                                        value={newEmployee.name}
                                        onChange={(e) => setNewEmployee({...newEmployee, name: e.target.value})}
                                    />
                                </div>
                                <div className="form-group">
                                    <label>이메일</label>
                                    <input
                                        type="email"
                                        value={newEmployee.email}
                                        onChange={(e) => setNewEmployee({...newEmployee, email: e.target.value})}
                                    />
                                </div>
                                <div className="form-group">
                                    <label>비밀번호</label>
                                    <input
                                        type="password"
                                        value={newEmployee.password}
                                        onChange={(e) => setNewEmployee({...newEmployee, password: e.target.value})}
                                    />
                                </div>
                                <div className="form-group">
                                    <label>입사일</label>
                                    <input
                                        type="date"
                                        value={newEmployee.joinDate}
                                        onChange={(e) => setNewEmployee({...newEmployee, joinDate: e.target.value})}
                                    />
                                </div>
                                <div className="modal-buttons">
                                    <button className="btn-secondary" onClick={() => setShowAddModal(false)}>
                                        취소
                                    </button>
                                    <button className="btn-primary" onClick={handleAddEmployee}>
                                        추가
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // 연차 승인 관리 컴포넌트
        function ApprovalManagement({ user }) {
            const [pendingRequests, setPendingRequests] = useState([]);
            const [myEmployees, setMyEmployees] = useState([]);

            useEffect(() => {
                loadMyEmployees();
            }, []);

            const loadMyEmployees = async () => {
                try {
                    const snapshot = await db.collection('employees')
                        .where('approver', '==', user.uid)
                        .get();

                    const employees = [];
                    snapshot.forEach(doc => {
                        employees.push({ id: doc.id, ...doc.data() });
                    });
                    
                    setMyEmployees(employees);
                    
                    if (employees.length > 0) {
                        loadPendingRequests(employees.map(emp => emp.id));
                    }
                } catch (error) {
                    console.error('담당 직원 목록 로드 실패:', error);
                }
            };

            const loadPendingRequests = async (employeeIds) => {
                try {
                    const snapshot = await db.collection('leaveUsage')
                        .where('approvalStatus', '==', 'pending')
                        .get();

                    const requests = [];
                    for (const doc of snapshot.docs) {
                        const data = doc.data();
                        
                        if (employeeIds.includes(data.userId)) {
                            const userDoc = await db.collection('employees').doc(data.userId).get();
                            requests.push({
                                id: doc.id,
                                ...data,
                                userName: userDoc.exists ? userDoc.data().name : data.userId
                            });
                        }
                    }
                    
                    requests.sort((a, b) => b.date.localeCompare(a.date));
                    setPendingRequests(requests);
                } catch (error) {
                    console.error('승인 대기 목록 로드 실패:', error);
                }
            };

            const handleApproval = async (requestId, userId, date, status) => {
                try {
                    await db.collection('leaveUsage').doc(requestId).update({
                        approvalStatus: status,
                        approvedBy: user.uid,
                        approvedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    const scheduleSnapshot = await db.collection('schedules')
                        .where('userId', '==', userId)
                        .where('date', '==', date)
                        .get();

                    scheduleSnapshot.forEach(async (doc) => {
                        await doc.ref.update({
                            approvalStatus: status,
                            approvedBy: user.uid,
                            approvedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    });

                    alert(status === 'approved' ? '승인되었습니다.' : '반려되었습니다.');
                    loadMyEmployees();
                } catch (error) {
                    alert('처리 실패: ' + error.message);
                }
            };

            return (
                <div className="content-card">
                    <h2 style={{marginBottom: '20px'}}>연차 승인 관리</h2>
                    
                    <div style={{
                        background: '#f5f5f5',
                        padding: '15px',
                        borderRadius: '8px',
                        marginBottom: '20px'
                    }}>
                        <h3 style={{fontSize: '16px', marginBottom: '10px'}}>담당 직원 목록</h3>
                        {myEmployees.length > 0 ? (
                            <div style={{display: 'flex', gap: '10px', flexWrap: 'wrap'}}>
                                {myEmployees.map(emp => (
                                    <span key={emp.id} style={{
                                        background: 'white',
                                        padding: '6px 12px',
                                        borderRadius: '4px',
                                        fontSize: '14px',
                                        border: '1px solid #ddd'
                                    }}>
                                        {emp.name}
                                    </span>
                                ))}
                            </div>
                        ) : (
                            <p style={{color: '#666', fontSize: '14px'}}>담당 직원이 없습니다. 관리자에게 문의하세요.</p>
                        )}
                    </div>
                    
                    <h3 style={{fontSize: '16px', marginBottom: '15px'}}>승인 대기 목록</h3>
                    {pendingRequests.length > 0 ? (
                        <div style={{display: 'grid', gap: '15px'}}>
                            {pendingRequests.map(request => (
                                <div key={request.id} style={{
                                    background: 'white',
                                    border: '1px solid #e0e0e0',
                                    borderRadius: '12px',
                                    padding: '20px',
                                    boxShadow: '0 2px 4px rgba(0,0,0,0.05)',
                                    transition: 'all 0.2s',
                                    ':hover': {
                                        boxShadow: '0 4px 8px rgba(0,0,0,0.1)'
                                    }
                                }}>
                                    <div style={{
                                        display: 'grid',
                                        gridTemplateColumns: '1fr 1fr 1fr auto',
                                        gap: '20px',
                                        alignItems: 'center'
                                    }}>
                                        {/* 직원 정보 */}
                                        <div>
                                            <div style={{
                                                fontSize: '12px',
                                                color: '#999',
                                                marginBottom: '4px'
                                            }}>직원명</div>
                                            <div style={{
                                                fontSize: '18px',
                                                fontWeight: '600',
                                                color: '#333'
                                            }}>{request.userName}</div>
                                        </div>

                                        {/* 연차 정보 */}
                                        <div>
                                            <div style={{
                                                fontSize: '12px',
                                                color: '#999',
                                                marginBottom: '4px'
                                            }}>연차 내용</div>
                                            <div style={{
                                                fontSize: '16px',
                                                fontWeight: '500',
                                                color: '#333'
                                            }}>
                                                {request.type}
                                                <span style={{
                                                    marginLeft: '8px',
                                                    color: '#666',
                                                    fontSize: '14px'
                                                }}>
                                                    ({request.amount > 0 ? `${request.amount}일` : '무급'})
                                                </span>
                                            </div>
                                            <div style={{
                                                fontSize: '14px',
                                                color: '#666',
                                                marginTop: '4px'
                                            }}>
                                                📅 {request.date}
                                            </div>
                                        </div>

                                        {/* 신청일 */}
                                        <div>
                                            <div style={{
                                                fontSize: '12px',
                                                color: '#999',
                                                marginBottom: '4px'
                                            }}>신청일</div>
                                            <div style={{
                                                fontSize: '14px',
                                                color: '#666'
                                            }}>
                                                {request.createdAt ? new Date(request.createdAt.toDate()).toLocaleDateString('ko-KR', {
                                                    year: 'numeric',
                                                    month: 'long',
                                                    day: 'numeric'
                                                }) : '-'}
                                            </div>
                                        </div>

                                        {/* 승인/반려 버튼 */}
                                        <div style={{display: 'flex', gap: '8px'}}>
                                            <button
                                                onClick={() => handleApproval(request.id, request.userId, request.date, 'approved')}
                                                style={{
                                                    padding: '10px 20px',
                                                    background: '#4CAF50',
                                                    color: 'white',
                                                    border: 'none',
                                                    borderRadius: '8px',
                                                    cursor: 'pointer',
                                                    fontSize: '14px',
                                                    fontWeight: '600',
                                                    transition: 'all 0.2s',
                                                    minWidth: '80px'
                                                }}
                                                onMouseOver={(e) => e.target.style.background = '#45a049'}
                                                onMouseOut={(e) => e.target.style.background = '#4CAF50'}
                                            >
                                                ✓ 승인
                                            </button>
                                            <button
                                                onClick={() => handleApproval(request.id, request.userId, request.date, 'rejected')}
                                                style={{
                                                    padding: '10px 20px',
                                                    background: '#ff4444',
                                                    color: 'white',
                                                    border: 'none',
                                                    borderRadius: '8px',
                                                    cursor: 'pointer',
                                                    fontSize: '14px',
                                                    fontWeight: '600',
                                                    transition: 'all 0.2s',
                                                    minWidth: '80px'
                                                }}
                                                onMouseOver={(e) => e.target.style.background = '#cc0000'}
                                                onMouseOut={(e) => e.target.style.background = '#ff4444'}
                                            >
                                                ✕ 반려
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    ) : (
                        <div style={{
                            padding: '80px 20px',
                            textAlign: 'center',
                            background: 'white',
                            borderRadius: '12px',
                            border: '2px dashed #e0e0e0'
                        }}>
                            <div style={{
                                fontSize: '48px',
                                marginBottom: '16px'
                            }}>📋</div>
                            <div style={{
                                color: '#999',
                                fontSize: '16px',
                                fontWeight: '500'
                            }}>
                                승인 대기중인 연차 신청이 없습니다.
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // 관리자용 직원 연차 관리 컴포넌트
        function AdminLeaveManagement() {
            const [employees, setEmployees] = useState([]);
            const [selectedEmployee, setSelectedEmployee] = useState(null);
            const [leaveUsage, setLeaveUsage] = useState([]);
            const [showEditModal, setShowEditModal] = useState(false);
            const [editLeaveData, setEditLeaveData] = useState({ totalLeave: 0 });

            useEffect(() => {
                loadEmployees();
            }, []);

            const loadEmployees = async () => {
                const snapshot = await db.collection('employees').get();
                const employeeList = [];
                snapshot.forEach(doc => {
                    employeeList.push({ id: doc.id, ...doc.data() });
                });
                setEmployees(employeeList);
            };

            const loadEmployeeLeaveUsage = async (employeeId) => {
                try {
                    const snapshot = await db.collection('leaveUsage')
                        .where('userId', '==', employeeId)
                        .get();

                    const usage = [];
                    snapshot.forEach(doc => {
                        usage.push({ id: doc.id, ...doc.data() });
                    });
                    
                    usage.sort((a, b) => b.date.localeCompare(a.date));
                    setLeaveUsage(usage);
                } catch (error) {
                    console.error('연차 내역 로드 실패:', error);
                }
            };

            const handleSelectEmployee = (employee) => {
                setSelectedEmployee(employee);
                loadEmployeeLeaveUsage(employee.id);
            };

            const calculateTotalLeave = (joinDate) => {
                if (!joinDate) return 0;
                const join = new Date(joinDate);
                const now = new Date();
                const years = now.getFullYear() - join.getFullYear();
                
                if (years < 1) {
                    const months = (now.getFullYear() - join.getFullYear()) * 12 + (now.getMonth() - join.getMonth());
                    return Math.floor(months);
                }
                
                return 15 + Math.min(years - 1, 10);
            };

            const calculateUsedLeave = () => {
                // 승인된 연차만 카운트
                return leaveUsage
                    .filter(usage => usage.approvalStatus === 'approved')
                    .reduce((sum, usage) => sum + usage.amount, 0);
            };

            const handleEditLeave = async () => {
                if (!selectedEmployee) return;

                try {
                    await db.collection('employees').doc(selectedEmployee.id).update({
                        customTotalLeave: parseFloat(editLeaveData.totalLeave)
                    });

                    alert('연차 수량이 수정되었습니다.');
                    setShowEditModal(false);
                    loadEmployees();
                    handleSelectEmployee({ ...selectedEmployee, customTotalLeave: parseFloat(editLeaveData.totalLeave) });
                } catch (error) {
                    alert('수정 실패: ' + error.message);
                }
            };

            return (
                <div className="content-card">
                    <h2 style={{marginBottom: '20px'}}>직원 연차 관리</h2>
                    
                    <div style={{display: 'grid', gridTemplateColumns: '300px 1fr', gap: '30px'}}>
                        {/* 직원 목록 */}
                        <div>
                            <h3 style={{marginBottom: '15px', fontSize: '16px'}}>직원 목록</h3>
                            <div style={{
                                border: '1px solid #ddd',
                                borderRadius: '8px',
                                maxHeight: '600px',
                                overflowY: 'auto'
                            }}>
                                {employees.map(emp => (
                                    <div
                                        key={emp.id}
                                        onClick={() => handleSelectEmployee(emp)}
                                        style={{
                                            padding: '15px',
                                            borderBottom: '1px solid #eee',
                                            cursor: 'pointer',
                                            background: selectedEmployee?.id === emp.id ? '#e8f5e9' : 'white',
                                            transition: 'background 0.2s'
                                        }}
                                        onMouseEnter={(e) => {
                                            if (selectedEmployee?.id !== emp.id) {
                                                e.target.style.background = '#f5f5f5';
                                            }
                                        }}
                                        onMouseLeave={(e) => {
                                            if (selectedEmployee?.id !== emp.id) {
                                                e.target.style.background = 'white';
                                            }
                                        }}
                                    >
                                        <div style={{fontWeight: '600', marginBottom: '5px'}}>{emp.name}</div>
                                        <div style={{fontSize: '13px', color: '#666'}}>{emp.email}</div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* 선택된 직원의 연차 정보 */}
                        <div>
                            {selectedEmployee ? (
                                <>
                                    <div style={{
                                        display: 'flex',
                                        justifyContent: 'space-between',
                                        alignItems: 'center',
                                        marginBottom: '20px'
                                    }}>
                                        <h3 style={{fontSize: '18px'}}>{selectedEmployee.name}님의 연차 현황</h3>
                                        <button
                                            className="register-btn"
                                            onClick={() => {
                                                setEditLeaveData({
                                                    totalLeave: selectedEmployee.customTotalLeave || calculateTotalLeave(selectedEmployee.joinDate)
                                                });
                                                setShowEditModal(true);
                                            }}
                                        >
                                            연차 수량 수정
                                        </button>
                                    </div>

                                    <div className="annual-leave-info">
                                        <div className="info-card">
                                            <h4>입사일</h4>
                                            <div className="value">{selectedEmployee.joinDate}</div>
                                        </div>
                                        <div className="info-card">
                                            <h4>총 연차</h4>
                                            <div className="value">
                                                {selectedEmployee.customTotalLeave || calculateTotalLeave(selectedEmployee.joinDate)}일
                                            </div>
                                        </div>
                                        <div className="info-card">
                                            <h4>사용 연차</h4>
                                            <div className="value">{calculateUsedLeave()}일</div>
                                        </div>
                                        <div className="info-card">
                                            <h4>남은 연차</h4>
                                            <div className="value" style={{color: '#4CAF50'}}>
                                                {(selectedEmployee.customTotalLeave || calculateTotalLeave(selectedEmployee.joinDate)) - calculateUsedLeave()}일
                                            </div>
                                        </div>
                                    </div>

                                    <div className="leave-history" style={{marginTop: '30px'}}>
                                        <h3>연차 사용 내역</h3>
                                        {leaveUsage.length > 0 ? (
                                            <table>
                                                <thead>
                                                    <tr>
                                                        <th>날짜</th>
                                                        <th>유형</th>
                                                        <th>사용일수</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {leaveUsage.map(usage => (
                                                        <tr key={usage.id}>
                                                            <td>{usage.date}</td>
                                                            <td>{usage.type}</td>
                                                            <td>{usage.amount > 0 ? `${usage.amount}일` : '-'}</td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        ) : (
                                            <div style={{padding: '20px', textAlign: 'center', color: '#666'}}>
                                                연차 사용 내역이 없습니다.
                                            </div>
                                        )}
                                    </div>
                                </>
                            ) : (
                                <div style={{
                                    padding: '60px',
                                    textAlign: 'center',
                                    color: '#999',
                                    fontSize: '16px'
                                }}>
                                    직원을 선택해주세요
                                </div>
                            )}
                        </div>
                    </div>

                    {/* 연차 수량 수정 모달 */}
                    {showEditModal && (
                        <div className="modal" onClick={() => setShowEditModal(false)}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                                <h3>{selectedEmployee.name}님 연차 수량 수정</h3>
                                <div className="form-group">
                                    <label>총 연차 수량</label>
                                    <input
                                        type="number"
                                        step="0.5"
                                        value={editLeaveData.totalLeave}
                                        onChange={(e) => setEditLeaveData({
                                            ...editLeaveData,
                                            totalLeave: e.target.value
                                        })}
                                        style={{
                                            width: '100%',
                                            padding: '12px',
                                            border: '1px solid #ddd',
                                            borderRadius: '6px',
                                            fontSize: '14px'
                                        }}
                                    />
                                </div>
                                <div style={{fontSize: '12px', color: '#666', marginTop: '10px'}}>
                                    * 자동 계산된 연차: {calculateTotalLeave(selectedEmployee.joinDate)}일
                                </div>
                                <div className="modal-buttons">
                                    <button className="btn-secondary" onClick={() => setShowEditModal(false)}>
                                        취소
                                    </button>
                                    <button className="btn-primary" onClick={handleEditLeave}>
                                        저장
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // 메인 앱 컴포넌트
        function App() {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [activeTab, setActiveTab] = useState('calendar');
            const [employees, setEmployees] = useState([]);
            const [isAdmin, setIsAdmin] = useState(false);
            const [isApprover, setIsApprover] = useState(false);

            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged(async (user) => {
                    setUser(user);
                    if (user) {
                        // 관리자 및 승인자 권한 확인
                        const employeeDoc = await db.collection('employees').doc(user.uid).get();
                        if (employeeDoc.exists) {
                            setIsAdmin(employeeDoc.data().isAdmin || false);
                            setIsApprover(employeeDoc.data().isApprover || false);
                        }
                        loadEmployees();
                    }
                    setLoading(false);
                });

                return () => unsubscribe();
            }, []);

            const loadEmployees = async () => {
                const snapshot = await db.collection('employees').get();
                const employeeList = [];
                snapshot.forEach(doc => {
                    employeeList.push({ id: doc.id, ...doc.data() });
                });
                setEmployees(employeeList);
            };

            const handleLogout = async () => {
                await auth.signOut();
                setActiveTab('calendar');
            };

            if (loading) {
                return <div style={{textAlign: 'center', padding: '50px'}}>로딩중...</div>;
            }

            if (!user) {
                return <Login onLogin={setUser} />;
            }

            return (
                <div className="app-container">
                    <div className="header">
                        <h1>스케쥴 및 연차 관리</h1>
                        <div className="user-info">
                            <span>{user.email}</span>
                            {isAdmin && <span style={{
                                background: '#4CAF50',
                                color: 'white',
                                padding: '4px 8px',
                                borderRadius: '4px',
                                fontSize: '12px',
                                marginLeft: '10px'
                            }}>관리자</span>}
                            {isApprover && <span style={{
                                background: '#2196F3',
                                color: 'white',
                                padding: '4px 8px',
                                borderRadius: '4px',
                                fontSize: '12px',
                                marginLeft: '10px'
                            }}>승인자</span>}
                            <button className="logout-btn" onClick={handleLogout}>로그아웃</button>
                        </div>
                    </div>

                    <div className="tabs">
                        <button
                            className={`tab ${activeTab === 'calendar' ? 'active' : ''}`}
                            onClick={() => setActiveTab('calendar')}
                        >
                            일정 캘린더
                        </button>
                        <button
                            className={`tab ${activeTab === 'leave' ? 'active' : ''}`}
                            onClick={() => setActiveTab('leave')}
                        >
                            연차 관리
                        </button>
                        {isApprover && (
                            <button
                                className={`tab ${activeTab === 'approval' ? 'active' : ''}`}
                                onClick={() => setActiveTab('approval')}
                            >
                                연차 승인
                            </button>
                        )}
                        {isAdmin && (
                            <>
                                <button
                                    className={`tab ${activeTab === 'admin-leave' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('admin-leave')}
                                >
                                    직원연차 관리
                                </button>
                                <button
                                    className={`tab ${activeTab === 'admin' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('admin')}
                                >
                                    직원 관리
                                </button>
                            </>
                        )}
                    </div>

                    {activeTab === 'calendar' && <Calendar user={user} employees={employees} />}
                    {activeTab === 'leave' && <AnnualLeave user={user} />}
                    {activeTab === 'approval' && isApprover && <ApprovalManagement user={user} />}
                    {activeTab === 'admin-leave' && isAdmin && <AdminLeaveManagement />}
                    {activeTab === 'admin' && isAdmin && <AdminPage />}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>

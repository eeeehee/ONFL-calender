<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>스케쥴 및 연차 관리</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #f5f5f5;
        }

        /* 모바일 최적화 */
        @media (max-width: 768px) {
            .app-container {
                padding: 10px !important;
            }
            
            .header {
                flex-direction: column;
                gap: 10px;
                padding: 15px !important;
            }
            
            .header h1 {
                font-size: 20px !important;
            }
            
            .notification-bell {
                font-size: 20px !important;
                padding: 8px !important;
                display: flex;
                align-items: center;
                justify-content: center;
                width: 40px;
                height: 40px;
            }
            
            .notification-badge {
                top: 2px !important;
                right: 2px !important;
            }
            
            .tabs {
                overflow-x: auto;
                flex-wrap: nowrap !important;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
            }
            
            .tabs::-webkit-scrollbar {
                display: none;
            }
            
            .tab {
                white-space: nowrap;
                flex-shrink: 0;
                font-size: 13px !important;
                padding: 10px 16px !important;
            }
            
            .content-card {
                padding: 15px !important;
            }
            
            table {
                font-size: 12px;
            }
            
            th, td {
                padding: 8px 4px !important;
            }
            
            .modal-content {
                width: 95% !important;
                max-width: none !important;
                margin: 20px auto !important;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr !important;
            }
            
            .stats-grid {
                grid-template-columns: 1fr !important;
            }
            
            .search-filter-bar {
                flex-wrap: wrap;
                gap: 8px !important;
            }
            
            .filter-select {
                flex: 1;
                min-width: 120px;
            }
            
            .search-input {
                width: 100% !important;
            }
            
            .employee-list {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .calendar-header {
                flex-direction: column;
                align-items: flex-start !important;
                gap: 10px;
            }
            
            .calendar-header h2 {
                font-size: 18px !important;
                margin: 0;
            }
            
            .calendar-nav {
                width: 100%;
                justify-content: space-between;
            }
            
            .nav-btn {
                padding: 8px 12px !important;
                font-size: 12px !important;
                flex: 1;
                white-space: nowrap;
            }
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 24px;
            color: #333;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logout-btn {
            padding: 8px 16px;
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .logout-btn:hover {
            background: #cc0000;
        }

        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .login-container h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #666;
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .btn-primary {
            width: 100%;
            padding: 12px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }

        .btn-primary:hover {
            background: #45a049;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 24px;
            background: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .tab.active {
            background: #4CAF50;
            color: white;
        }

        .tab:hover {
            background: #e8e8e8;
        }

        .tab.active:hover {
            background: #45a049;
        }

        .content-card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* 대시보드 스타일 */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            transition: all 0.3s;
        }

        .dashboard-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .dashboard-card.green {
            border-left: 4px solid #4CAF50;
        }

        .dashboard-card.blue {
            border-left: 4px solid #2196F3;
        }

        .dashboard-card.orange {
            border-left: 4px solid #FF9800;
        }

        .dashboard-card.red {
            border-left: 4px solid #f44336;
        }

        .dashboard-card.purple {
            border-left: 4px solid #9C27B0;
        }

        .dashboard-card h3 {
            font-size: 14px;
            margin-bottom: 10px;
            color: #666;
            font-weight: 500;
        }

        .dashboard-card .number {
            font-size: 36px;
            font-weight: bold;
            margin: 10px 0;
            color: #333;
        }

        .dashboard-card.green .number {
            color: #4CAF50;
        }

        .dashboard-card.blue .number {
            color: #2196F3;
        }

        .dashboard-card.orange .number {
            color: #FF9800;
        }

        .dashboard-card.red .number {
            color: #f44336;
        }

        .dashboard-card.purple .number {
            color: #9C27B0;
        }

        .dashboard-card .subtitle {
            font-size: 13px;
            color: #999;
        }

        /* 검색 및 필터 */
        .search-filter-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-input {
            flex: 1;
            min-width: 200px;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .filter-select {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            cursor: pointer;
            min-width: 150px;
        }

        .export-btn {
            padding: 10px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
            white-space: nowrap;
        }

        .export-btn:hover {
            background: #45a049;
        }

        .export-btn:active {
            transform: scale(0.98);
        }

        /* 통계 카드 */
        .stats-section {
            margin-top: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .stat-card.blue {
            border-left-color: #2196F3;
        }

        .stat-card.orange {
            border-left-color: #FF9800;
        }

        .stat-card.red {
            border-left-color: #f44336;
        }

        .stat-card.purple {
            border-left-color: #9C27B0;
        }

        .stat-card h4 {
            font-size: 13px;
            color: #666;
            margin-bottom: 8px;
        }

        .stat-card .value {
            font-size: 28px;
            font-weight: bold;
            color: #333;
        }

        .stat-card .change {
            font-size: 12px;
            color: #4CAF50;
            margin-top: 5px;
        }

        .stat-card .change.negative {
            color: #f44336;
        }

        /* 알림 센터 스타일 */
        .notification-bell {
            position: relative;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            transition: background 0.3s;
            background: white;
            border: none;
            font-size: 20px;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .notification-bell:hover {
            background: #f0f0f0;
        }

        .notification-bell svg {
            color: #333;
        }

        .notification-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #ff4444;
            border-radius: 50%;
            width: 8px;
            height: 8px;
            border: 2px solid white;
        }

        .notification-panel {
            position: fixed;
            right: -400px;
            top: 0;
            width: 400px;
            height: 100vh;
            background: white;
            box-shadow: -2px 0 10px rgba(0,0,0,0.2);
            transition: right 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
        }

        .notification-panel.open {
            right: 0;
        }

        .notification-header {
            padding: 20px;
            border-bottom: 2px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #4CAF50;
            color: white;
        }

        .notification-header h3 {
            margin: 0;
            font-size: 18px;
        }

        .notification-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .notification-close:hover {
            background: rgba(255,255,255,0.2);
        }

        .notification-list {
            padding: 0;
        }

        .notification-item {
            padding: 15px 20px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background 0.2s;
        }

        .notification-item:hover {
            background: #f9f9f9;
        }

        .notification-item.unread {
            background: #e3f2fd;
        }

        .notification-item.unread:hover {
            background: #bbdefb;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }

        .notification-message {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .notification-time {
            font-size: 12px;
            color: #999;
        }

        .notification-empty {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .notification-empty-icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.3;
        }

        .notification-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }

        .notification-overlay.open {
            display: block;
        }

        .mark-all-read-btn {
            background: none;
            border: none;
            color: white;
            font-size: 12px;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 4px;
        }

        .mark-all-read-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        /* 부서 관리 스타일 */
        .department-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #2196F3;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .department-card h4 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 16px;
        }

        .department-card .members-count {
            color: #666;
            font-size: 14px;
        }

        .department-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        /* 휴가 타입 뱃지 */
        .leave-type-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .leave-type-badge.annual {
            background: #e8f5e9;
            color: #4CAF50;
        }

        .leave-type-badge.half-morning {
            background: #fff3e0;
            color: #FF9800;
        }

        .leave-type-badge.half-afternoon {
            background: #ffe0b2;
            color: #F57C00;
        }

        .leave-type-badge.sick {
            background: #ffebee;
            color: #f44336;
        }

        .leave-type-badge.event {
            background: #f3e5f5;
            color: #9C27B0;
        }

        .leave-type-badge.special {
            background: #e3f2fd;
            color: #2196F3;
        }

        /* 파일 첨부 스타일 */
        .file-upload-area {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #fafafa;
        }

        .file-upload-area:hover {
            border-color: #4CAF50;
            background: #f1f8f4;
        }

        .file-upload-area.dragover {
            border-color: #4CAF50;
            background: #e8f5e9;
        }

        .file-list {
            margin-top: 15px;
        }

        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 4px;
            margin-bottom: 8px;
        }

        .file-item-name {
            flex: 1;
            font-size: 14px;
            color: #333;
        }

        .file-item-size {
            font-size: 12px;
            color: #999;
            margin-right: 10px;
        }

        .file-remove-btn {
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 12px;
        }

        .file-download-btn {
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 12px;
            cursor: pointer;
            font-size: 12px;
            text-decoration: none;
            display: inline-block;
        }

        @media (max-width: 768px) {
            .notification-panel {
                width: 100%;
                right: -100%;
            }

            .department-grid {
                grid-template-columns: 1fr;
            }

            .calendar-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .calendar-header h2 {
                font-size: 18px;
                margin: 0;
            }

            .calendar-nav {
                width: 100%;
                flex-wrap: wrap;
                gap: 8px;
            }

            .nav-btn {
                font-size: 12px;
                padding: 8px 12px;
                flex: 1;
                min-width: 70px;
            }
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .calendar-header h2 {
            font-size: 24px;
            color: #333;
        }

        .calendar-nav {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .nav-btn {
            padding: 8px 16px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .nav-btn:hover {
            background: #45a049;
        }

        .calendar table {
            width: 100%;
            border-collapse: collapse;
        }

        .calendar th {
            padding: 15px;
            background: #f5f5f5;
            border: 1px solid #ddd;
            font-weight: 600;
            color: #666;
        }

        .calendar td {
            padding: 10px;
            width: 170px;
            border: 1px solid #ddd;
            vertical-align: top;
            height: 120px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .calendar td:hover {
            background: #f9f9f9;
        }

        .calendar td.other-month {
            background: #fafafa;
            color: #ccc;
        }

        .calendar td.today {
            background: #e8f5e9;
        }

        .calendar td.holiday {
            background: #ffebee;
        }

        .calendar td.holiday .date-number {
            color: #d32f2f;
            font-weight: 700;
        }

        .holiday-name {
            font-size: 10px;
            color: #d32f2f;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .date-number {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .calendar td.sunday .date-number {
            color: #d32f2f;
        }

        .calendar td.saturday .date-number {
            color: #1976d2;
        }

        .schedule-item {
            font-size: 11px;
            padding: 3px 6px;
            margin: 2px 0;
            max-width: 170px;
            border-radius: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .schedule-item .delete-schedule-btn {
            background: rgba(255, 255, 255, 0.8);
            border: none;
            border-radius: 3px;
            cursor: pointer;
            padding: 2px 5px;
            font-size: 10px;
            color: #ff4444;
            font-weight: bold;
            margin-left: 5px;
            flex-shrink: 0;
        }

        .schedule-item .delete-schedule-btn:hover {
            background: rgba(255, 255, 255, 1);
        }

        .schedule-출근 { background: #e3f2fd; color: #1976d2; }
        .schedule-재택 { background: #fff3e0; color: #f57c00; }
        .schedule-연차 { background: #fce4ec; color: #c2185b; }
        .schedule-반차오전 { background: #f3e5f5; color: #7b1fa2; }
        .schedule-반차오후 { background: #e1f5fe; color: #0277bd; }
        .schedule-여름휴가 { background: #e0f2f1; color: #00796b; }
        .schedule-겨울휴가 { background: #e8eaf6; color: #3f51b5; }
        .schedule-shared { 
            background: #9C27B0 !important; 
            color: white !important; 
            font-weight: bold;
        }

        .daily-schedules {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #eee;
        }

        .daily-schedules h3 {
            margin-bottom: 20px;
            color: #333;
        }

        .daily-schedule-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .daily-schedule-card {
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid;
        }

        .daily-schedule-card.출근 { background: #e3f2fd; border-color: #1976d2; }
        .daily-schedule-card.재택 { background: #fff3e0; border-color: #f57c00; }
        .daily-schedule-card.연차 { background: #fce4ec; border-color: #c2185b; }
        .daily-schedule-card.반차오전 { background: #f3e5f5; border-color: #7b1fa2; }
        .daily-schedule-card.반차오후 { background: #e1f5fe; border-color: #0277bd; }
        .daily-schedule-card.여름휴가 { background: #e0f2f1; border-color: #00796b; }
        .daily-schedule-card.겨울휴가 { background: #e8eaf6; border-color: #3f51b5; }

        .daily-schedule-card .name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .daily-schedule-card .type {
            font-size: 14px;
            color: #666;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
        }

        .modal-content h3 {
            margin-bottom: 20px;
            color: #333;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-secondary {
            flex: 0 0 auto;
            min-width: 80px;
            padding: 0 20px;
            background: #666;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
        }

        .btn-secondary:hover {
            background: #555;
        }

        .modal-buttons .btn-primary {
            flex: 1;
            padding: 0 30px;
            font-size: 15px;
            font-weight: 600;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
            margin: 0;
        }

        .annual-leave-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .info-card {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
        }

        .info-card h4 {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .info-card .value {
            font-size: 24px;
            font-weight: 600;
            color: #333;
        }

        .register-btn {
            padding: 8px 16px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            margin-bottom: 20px;
        }

        .register-btn:hover {
            background: #45a049;
        }

        .leave-history {
            margin-top: 20px;
        }

        .leave-history table {
            width: 100%;
            border-collapse: collapse;
        }

        .leave-history th,
        .leave-history td {
            padding: 12px;
            border: 1px solid #ddd;
            text-align: left;
        }

        .leave-history th {
            background: #f5f5f5;
            font-weight: 600;
        }

        .admin-section {
            margin-bottom: 40px;
        }

        .admin-section h3 {
            margin-bottom: 20px;
            color: #333;
        }

        .employee-list {
            margin-top: 20px;
        }

        .employee-list table {
            width: 100%;
            border-collapse: collapse;
        }

        .employee-list th,
        .employee-list td {
            padding: 8px 6px;
            border: 1px solid #ddd;
            text-align: center;
            font-size: 12px;
            white-space: nowrap;
            vertical-align: middle;
        }

        .employee-list td:nth-child(1),
        .employee-list td:nth-child(2) {
            text-align: left;
        }

        .employee-list th {
            background: #f5f5f5;
            font-weight: 600;
            font-size: 11px;
            text-align: center;
        }

        .employee-list input[type="text"],
        .employee-list input[type="email"],
        .employee-list input[type="date"] {
            font-size: 11px !important;
            padding: 3px !important;
        }

        .employee-list select {
            font-size: 11px !important;
            padding: 4px !important;
        }

        .employee-list button {
            padding: 4px 8px !important;
            font-size: 11px !important;
            white-space: nowrap;
        }

        .employee-list input[type="checkbox"] {
            width: 16px !important;
            height: 16px !important;
        }

        .delete-btn {
            padding: 4px 8px;
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            white-space: nowrap;
        }

        .delete-btn:hover {
            background: #cc0000;
        }

        .error-message {
            color: #ff4444;
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
        }

        /* 모바일 반응형 스타일 */
        @media (max-width: 768px) {
            /* 모든 요소에 box-sizing 적용 */
            * {
                box-sizing: border-box;
            }

            body {
                padding: 10px;
                font-size: 14px;
                box-sizing: border-box;
            }

            .container {
                padding: 10px;
                max-width: 100%;
                box-sizing: border-box;
            }

            .header {
                flex-direction: column;
                gap: 8px;
                padding: 12px;
                align-items: stretch;
                max-width: 100%;
                overflow: hidden;
            }

            .header h1 {
                font-size: 18px;
                text-align: center;
                margin-bottom: 8px;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }

            /* user-info를 flexbox로 재구성 - 한 줄로 */
            .user-info {
                display: flex;
                flex-wrap: nowrap;
                gap: 4px;
                width: 100%;
                justify-content: flex-end;
                align-items: center;
            }

            /* 이메일을 좌측에 */
            .user-info > span:first-child {
                flex: 0 0 auto;
                text-align: left;
                font-size: 10px;
                color: #666;
                order: 1;
                padding: 4px 6px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                max-width: 35%;
                margin-right: auto;
            }

            /* 배지들을 우측에 작게 */
            .user-info > span:not(:first-child) {
                display: inline-block;
                min-width: 0;
                text-align: center;
                padding: 4px 6px !important;
                margin: 0 !important;
                font-size: 9px !important;
                height: auto;
                min-height: auto;
                line-height: 1.2;
                box-sizing: border-box;
                order: 2;
                white-space: nowrap;
            }

            /* 로그아웃 버튼 우측에 */
            .logout-btn {
                display: inline-block;
                margin: 0;
                padding: 4px 6px;
                font-size: 9px;
                height: auto;
                min-height: auto;
                order: 3;
                line-height: 1.2;
                flex: 0 0 auto;
            }

            /* 탭 메뉴 */
            .tabs {
                flex-wrap: nowrap;
                overflow-x: auto;
                gap: 5px;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                padding-bottom: 5px;
            }

            .tabs::-webkit-scrollbar {
                display: none;
            }

            .tab {
                font-size: 12px;
                padding: 8px 10px;
                white-space: nowrap;
                min-width: fit-content;
            }

            /* 콘텐츠 카드 */
            .content-card {
                padding: 12px;
                margin-bottom: 12px;
                max-width: 100%;
                overflow-x: hidden;
            }

            .content-card h2 {
                font-size: 16px;
                margin-bottom: 12px;
            }

            .content-card h3 {
                font-size: 14px;
                margin-bottom: 10px;
            }

            /* 콘텐츠 카드 내부 모든 테이블을 스크롤 가능하게 */
            .content-card > table,
            .content-card > div > table,
            .content-card .employee-list,
            .content-card .leave-usage-table {
                display: block;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                max-width: 100%;
            }

            /* 테이블 최소 너비 설정 */
            .content-card table {
                min-width: 600px;
                width: 100%;
            }

            /* 사원 관리 테이블 */
            .content-card .employee-list table {
                min-width: 800px;
            }

            /* PT 스케줄, 연차 내역 등 특수 테이블 */
            .content-card > div > div table {
                min-width: 700px;
            }

            /* 캘린더 네비게이션 */
            .calendar-nav {
                flex-wrap: nowrap;
                gap: 4px;
                justify-content: center;
            }

            .nav-btn {
                font-size: 10px;
                padding: 5px 8px;
                white-space: nowrap;
                flex: 0 0 auto;
                min-height: 32px;
            }

            /* PT 스케줄 타이틀 모바일에서 숨기기 */
            .pt-schedule-title {
                display: none !important;
            }

            /* PT 스케줄 h2 헤더 모바일에서 숨기기 */
            .pt-schedule-h2 {
                display: none !important;
            }

            /* PT 스케줄 헤더 가운데 정렬 */
            .pt-schedule-header {
                justify-content: center !important;
            }

            /* PT 스케줄 주차 정보와 버튼을 세로로 배치 */
            .content-card > div > div > div[style*="display: flex"][style*="space-between"] {
                flex-direction: column !important;
                align-items: flex-start !important;
                gap: 10px !important;
            }

            /* PT 스케줄 수정 버튼 가로 정렬 */
            .pt-schedule-buttons {
                flex-wrap: wrap !important;
                gap: 4px !important;
                justify-content: flex-start !important;
                width: 100% !important;
            }

            .pt-schedule-buttons button {
                padding: 6px 10px !important;
                font-size: 11px !important;
                white-space: nowrap !important;
                min-height: 32px !important;
            }

            /* PT 스케줄 수정 시 X 버튼 크기 */
            .content-card td button[style*="background: #ff4444"],
            .content-card .slot-cancel-btn {
                width: 30px !important;
                height: 30px !important;
                min-width: 30px !important;
                padding: 0 !important;
                font-size: 20px !important;
                font-weight: bold !important;
                display: inline-flex !important;
                align-items: center !important;
                justify-content: center !important;
                line-height: 1 !important;
                border-radius: 0 !important;
                background: transparent !important;
                color: #ff0000 !important;
                border: none !important;
            }

            .content-card td button[style*="background: #ff4444"]:active,
            .content-card .slot-cancel-btn:active {
                transform: scale(1.2) !important;
                color: #cc0000 !important;
            }

            /* PT 스케줄 시간 슬롯 삭제 버튼 크기 */
            .content-card .time-slot-delete-btn {
                width: 30px !important;
                height: 30px !important;
                min-width: 30px !important;
                padding: 0 !important;
                font-size: 20px !important;
                font-weight: bold !important;
                display: inline-flex !important;
                align-items: center !important;
                justify-content: center !important;
                line-height: 1 !important;
                border-radius: 0 !important;
                background: transparent !important;
                color: #ff0000 !important;
                border: none !important;
            }

            .content-card .time-slot-delete-btn:active {
                transform: scale(1.2) !important;
                color: #cc0000 !important;
            }

            /* 캘린더 */
            .calendar {
                overflow-x: auto !important;
                -webkit-overflow-scrolling: touch;
                max-width: 100%;
                display: block;
                margin: 0;
                padding: 0;
                width: 100%;
                border: 1px solid #ddd;
                border-radius: 8px;
                background: white;
            }

            .calendar table {
                min-width: 750px;
                font-size: 11px;
                width: 750px;
                table-layout: fixed;
                margin: 0;
            }

            .calendar th,
            .calendar td {
                padding: 6px 3px;
                min-height: 60px;
                width: 107px;
                white-space: normal;
                font-size: 11px;
            }

            .day-number {
                font-size: 12px;
                margin-bottom: 2px;
            }

            .schedule-item {
                font-size: 10px;
                padding: 2px 4px;
                margin-bottom: 2px;
                display: flex;
                align-items: center;
                justify-content: space-between;
                gap: 3px;
                min-height: 22px;
            }

            .schedule-item > span:first-child {
                flex: 1;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }

            /* 캘린더 X 버튼 */
            .calendar .schedule-item button {
                min-height: 20px;
                height: 20px;
                width: 20px;
                min-width: 20px;
                padding: 0;
                font-size: 16px;
                font-weight: bold;
                line-height: 1;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                border-radius: 0;
                vertical-align: middle;
                background: transparent;
                color: #ff0000;
                border: none;
                flex-shrink: 0;
            }

            .calendar .schedule-item button:active {
                background: transparent;
                transform: scale(1.2);
                color: #cc0000;
            }

            /* 테이블 */
            table {
                font-size: 13px;
                max-width: 100%;
            }

            table th,
            table td {
                padding: 8px 5px;
                white-space: nowrap;
            }

            /* 버튼 */
            button {
                min-height: 40px; /* 터치 영역 확보 */
                touch-action: manipulation;
            }

            .btn {
                font-size: 13px;
                padding: 10px 14px;
            }

            /* 입력 필드 */
            input[type="text"],
            input[type="email"],
            input[type="password"],
            input[type="date"],
            input[type="number"],
            select,
            textarea {
                font-size: 14px; /* iOS 줌 방지를 위해 14px 유지 */
                padding: 10px;
                min-height: 40px;
                max-width: 100%;
                box-sizing: border-box;
            }

            /* 날짜 입력 필드 특별 처리 */
            input[type="date"] {
                width: 100% !important;
                max-width: 100% !important;
            }

            /* 모달 */
            .modal-content {
                width: 95%;
                max-width: 95%;
                padding: 15px;
                max-height: 90vh;
                overflow-y: auto;
            }

            .modal-content h2 {
                font-size: 16px;
                margin-bottom: 12px;
            }

            .modal-content h3 {
                font-size: 14px;
            }

            .modal-content p {
                font-size: 13px;
            }

            /* 모달 내 입력 필드 가로 사이즈 조정 */
            .modal-content input[type="text"],
            .modal-content input[type="email"],
            .modal-content input[type="password"],
            .modal-content input[type="date"],
            .modal-content input[type="number"],
            .modal-content select,
            .modal-content textarea {
                width: 100% !important;
                max-width: 100% !important;
                box-sizing: border-box;
            }

            /* 날짜 입력 필드 특별 처리 */
            .modal-content input[type="date"] {
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
            }

            /* 모달 내 체크박스 리스트 정렬 */
            .modal-content label {
                display: flex !important;
                align-items: center !important;
                width: 100%;
                padding: 5px 0 !important;
                margin: 0 !important;
            }

            .modal-content input[type="checkbox"] {
                flex-shrink: 0 !important;
                margin: 0 2px 0 0 !important;
                padding: 0 !important;
                width: 14px !important;
                height: 14px !important;
            }

            .modal-content .form-group label {
                padding: 0 !important;
            }

            /* 폼 그룹 */
            .form-group {
                margin-bottom: 12px;
            }

            .form-group label {
                font-size: 13px;
                margin-bottom: 5px;
                display: block;
            }

            /* 체크박스가 있는 label만 flex 유지 */
            .form-group label:has(input[type="checkbox"]) {
                display: flex !important;
                flex-direction: row !important;
                align-items: center !important;
            }

            .form-group input,
            .form-group select,
            .form-group textarea {
                width: 100% !important;
                max-width: 100% !important;
            }

            /* PT 스케줄 테이블 - 주차 박스 내에서 스크롤 */
            .content-card > div > div {
                padding: 15px;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                max-width: 100%;
            }

            .content-card table {
                width: 100%;
                min-width: 700px;
            }

            .content-card table th,
            .content-card table td {
                min-width: 80px;
            }

            /* 모든 div 래퍼에 스크롤 적용 */
            .content-card > div {
                max-width: 100%;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            /* 특별히 overflow를 visible로 해야 하는 경우 제외 */
            .content-card > div[style*="display: grid"],
            .content-card > div[style*="gap"] {
                overflow-x: visible;
            }

            /* 연차 정보 카드 */
            .leave-info {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .leave-info-item {
                padding: 10px;
            }

            .leave-info-item h3 {
                font-size: 12px;
            }

            .leave-info-item p {
                font-size: 18px;
            }

            /* annual-leave-info 모바일 최적화 */
            .annual-leave-info {
                gap: 10px !important;
                margin-bottom: 15px !important;
                grid-template-columns: 1fr !important;
            }

            .info-card {
                padding: 12px !important;
            }

            .info-card h4 {
                font-size: 12px !important;
                margin-bottom: 5px !important;
            }

            .info-card .value {
                font-size: 18px !important;
            }

            /* 연차 관리 버튼들 */
            .register-btn,
            .content-card button {
                padding: 8px 16px !important;
                font-size: 13px !important;
            }

            /* 사원 관리 테이블 */
            .employee-list {
                display: block;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                max-width: 100%;
            }

            .employee-list table {
                min-width: 900px;
                white-space: nowrap;
                table-layout: auto;
            }

            .employee-list th,
            .employee-list td {
                white-space: nowrap;
                min-width: auto;
                padding: 6px 4px !important;
                font-size: 10px !important;
            }

            /* 사원 관리 마지막 열 (관리 버튼) */
            .employee-list td:last-child {
                white-space: nowrap !important;
            }

            /* 사원 관리 버튼 컨테이너 */
            .employee-list td > div,
            .employee-list td > button {
                display: inline-block !important;
                white-space: nowrap !important;
            }

            /* 사원 관리 액션 버튼들 */
            .employee-list button {
                padding: 4px 6px !important;
                font-size: 9px !important;
                margin: 1px !important;
                white-space: nowrap !important;
                min-height: auto !important;
                display: inline-block !important;
            }

            .employee-list input[type="text"],
            .employee-list input[type="email"],
            .employee-list input[type="date"] {
                font-size: 10px !important;
                padding: 2px !important;
            }

            .employee-list select {
                font-size: 10px !important;
                padding: 3px !important;
            }

            .employee-list input[type="checkbox"] {
                width: 14px !important;
                height: 14px !important;
            }

            /* 페이지네이션 */
            .pagination {
                flex-wrap: wrap;
                gap: 4px;
            }

            .pagination button {
                min-width: 32px;
                min-height: 32px;
                padding: 6px;
                font-size: 12px;
            }

            /* 연차 승인 카드 */
            .approval-request {
                padding: 10px;
            }

            .approval-request h4 {
                font-size: 14px;
            }

            .approval-request p {
                font-size: 12px;
            }

            .approval-request button {
                padding: 8px 14px !important;
                font-size: 12px !important;
            }

            /* 연차 승인 관리 모바일 최적화 */
            
            /* 담당 사원 목록 */
            .employee-section {
                padding: 12px !important;
            }

            .employee-section h3 {
                font-size: 14px !important;
                margin-bottom: 8px !important;
            }

            .employee-section span {
                font-size: 12px !important;
                padding: 4px 8px !important;
            }

            .employee-section p {
                font-size: 12px !important;
            }

            /* 승인 대기 목록 */
            .approval-list {
                gap: 12px !important;
            }

            .approval-card {
                padding: 15px !important;
            }

            .approval-card-content {
                grid-template-columns: 1fr !important;
                gap: 0 !important;
                align-items: stretch !important;
            }

            /* 승인 대기 카드 내 각 항목 */
            .approval-card-content > div {
                padding: 10px 0 !important;
                border-bottom: 1px solid #f0f0f0 !important;
            }

            .approval-card-content > div:first-child {
                padding-top: 0 !important;
            }

            .approval-card-content > div:last-child {
                border-bottom: none !important;
                padding-bottom: 0 !important;
                padding-top: 15px !important;
            }

            /* 텍스트 크기 조정 */
            .approval-card-content div[style*="fontSize: '12px'"] {
                font-size: 11px !important;
            }

            .approval-card-content div[style*="fontSize: '18px'"] {
                font-size: 16px !important;
            }

            .approval-card-content div[style*="fontSize: '16px'"] {
                font-size: 14px !important;
            }

            .approval-card-content div[style*="fontSize: '14px'"] {
                font-size: 13px !important;
            }

            /* 승인/반려 버튼 */
            .approval-buttons {
                flex-direction: row !important;
                gap: 6px !important;
                width: 100% !important;
            }

            .approval-buttons button {
                flex: 1 !important;
                padding: 12px 8px !important;
                font-size: 13px !important;
                min-width: 0 !important;
                white-space: nowrap !important;
            }

            /* 로그인 화면 */
            .login-container {
                padding: 20px;
                max-width: 100%;
            }

            .login-container h2 {
                font-size: 22px;
            }

            /* 로그인 화면 체크박스 정렬 */
            .login-container .form-group label {
                display: block;
            }
            
            /* 체크박스를 포함한 label만 flex로 */
            .login-container .form-group:last-of-type label,
            .login-container label:has(input[type="checkbox"]) {
                display: flex !important;
                align-items: center !important;
                justify-content: flex-start !important;
                flex-direction: row !important;
                white-space: nowrap !important;
            }

            .login-container input[type="checkbox"] {
                margin: 0 6px 0 0 !important;
                flex-shrink: 0 !important;
                width: 16px !important;
                height: 16px !important;
            }
            
            /* 아이디 저장 텍스트 */
            .login-container input[type="checkbox"] + * {
                display: inline !important;
                white-space: nowrap !important;
            }

            /* 스크롤바 숨기기 (모바일) */
            ::-webkit-scrollbar {
                width: 0;
                height: 0;
            }

            /* 터치 최적화 */
            * {
                -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
            }

            /* 캘린더 날짜 셀 */
            .calendar td.other-month {
                opacity: 0.3;
            }

            /* 드롭다운 메뉴 */
            select {
                background-position: right 8px center;
                padding-right: 30px;
            }

            /* 체크박스와 라디오 버튼 크기 */
            input[type="checkbox"],
            input[type="radio"] {
                width: 20px;
                height: 20px;
                min-height: 20px;
            }

            /* Flex 레이아웃 조정 */
            .flex-container {
                flex-direction: column;
                gap: 10px;
            }

            /* 통계 카드 */
            .stats-grid {
                grid-template-columns: 1fr;
            }

            /* 사원 선택 드롭다운 */
            .employee-select {
                width: 100%;
                margin-bottom: 15px;
            }

            /* 사원 연차 관리 - 모바일에서 모달로 표시 */
            .content-card > div[style*="gridTemplateColumns"] {
                display: block !important;
                gap: 0 !important;
            }

            /* 사원 목록은 항상 표시 */
            .content-card > div[style*="gridTemplateColumns"] > div:first-child {
                margin-bottom: 0;
            }

            /* 선택된 사원 정보는 모달로 표시 */
            .content-card > div[style*="gridTemplateColumns"] > div:last-child {
                display: none;
            }

            /* 모달이 열릴 때 표시 */
            .employee-modal-open {
                display: block !important;
                position: fixed !important;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: white;
                z-index: 10000;
                overflow-y: auto;
                padding: 20px;
                -webkit-overflow-scrolling: touch;
            }

            /* 모달 닫기 버튼 */
            .employee-modal-close {
                position: sticky;
                top: 0;
                background: white;
                padding: 10px 0;
                margin-bottom: 15px;
                border-bottom: 1px solid #ddd;
                z-index: 1;
            }

            .employee-modal-close button {
                width: 100%;
                padding: 12px;
                background: #666;
                color: white;
                border: none;
                border-radius: 6px;
                font-size: 14px;
                cursor: pointer;
            }

            /* 연차 내역 테이블 모바일 최적화 */
            .leave-usage-table {
                display: block;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                max-width: 100%;
            }

            .leave-usage-table table {
                min-width: 600px;
                font-size: 12px;
            }

            .leave-usage-table th,
            .leave-usage-table td {
                white-space: nowrap;
                padding: 6px 4px;
                font-size: 12px;
            }

            /* 연차 내역 테이블의 취소 버튼을 승인완료 박스와 동일한 크기로 */
            .leave-history table button {
                min-height: auto !important;
                height: auto !important;
                padding: 4px 8px !important;
                font-size: 12px !important;
                line-height: 1.2 !important;
                display: inline-block !important;
            }

            /* PT 스케줄 주차 카드 */
            .content-card > div > div {
                padding: 12px;
                border: 1px solid #ddd;
                border-radius: 8px;
                background: white;
                margin-bottom: 15px;
                max-width: 100%;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            /* PT 통계 표 모바일 최적화 */
            .content-card > div[style*="marginTop: '40px'"] {
                margin-top: 20px !important;
                padding: 15px !important;
            }

            .content-card > div[style*="marginTop: '40px'"] h3 {
                font-size: 16px !important;
                margin-bottom: 12px !important;
            }

            .content-card > div[style*="marginTop: '40px'"] table {
                font-size: 12px !important;
                display: block;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .content-card > div[style*="marginTop: '40px'"] th,
            .content-card > div[style*="marginTop: '40px'"] td {
                padding: 8px 6px !important;
                font-size: 12px !important;
            }

            .content-card > div[style*="marginTop: '40px'"] th {
                white-space: nowrap;
            }

            .content-card > div[style*="marginTop: '40px'"] td[style*="fontSize: '13px'"] {
                font-size: 11px !important;
            }

            /* PT 스케줄 테이블 래퍼 - 카드 내에서 스크롤 */
            .content-card > div > div > div:last-child {
                overflow-x: auto !important;
                -webkit-overflow-scrolling: touch;
            }

            /* PT 스케줄 테이블 자체 */
            .content-card > div > div table {
                min-width: 700px;
                width: 100%;
                font-size: 12px;
            }

            .content-card > div > div table th,
            .content-card > div > div table td {
                white-space: nowrap;
                padding: 6px 4px;
                font-size: 12px;
            }

            /* 시간 입력 필드 */
            input[type="time"] {
                min-width: 100px;
            }

            /* 취소선 텍스트 가독성 */
            span[style*="line-through"] {
                font-size: 13px !important;
            }
        }

        /* 아주 작은 화면 (iPhone SE 등) */
        @media (max-width: 375px) {
            .header h1 {
                font-size: 18px;
            }

            .tab {
                font-size: 12px;
                padding: 8px 10px;
            }

            .content-card {
                padding: 10px;
            }

            .content-card h2 {
                font-size: 16px;
            }

            .modal-content {
                padding: 15px;
            }

            button {
                font-size: 13px;
                padding: 10px 12px;
            }
        }

        /* 가로 모드 최적화 */
        @media (max-width: 768px) and (orientation: landscape) {
            .header {
                padding: 10px;
            }

            .content-card {
                padding: 10px;
            }

            .modal-content {
                max-height: 85vh;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Firebase 설정
        const firebaseConfig = {
            apiKey: "AIzaSyC_hwBHgdLWmI6z920PNgmWTKYSl_TZ4I0",
            authDomain: "work-calendar-839f2.firebaseapp.com",
            projectId: "work-calendar-839f2",
            storageBucket: "work-calendar-839f2.firebasestorage.app",
            messagingSenderId: "823701886482",
            appId: "1:823701886482:web:4a368e517a6d158ea12acb"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        const { useState, useEffect } = React;

        // 대한민국 공휴일 데이터
        // 고정 공휴일 + 2024-2030년 음력 공휴일
        const holidays = {
            // 2024년
            '2024-01-01': '신정',
            '2024-02-09': '설날 연휴',
            '2024-02-10': '설날',
            '2024-02-11': '설날 연휴',
            '2024-02-12': '대체공휴일',
            '2024-03-01': '삼일절',
            '2024-04-10': '제22대 국회의원 선거',
            '2024-05-05': '어린이날',
            '2024-05-06': '대체공휴일',
            '2024-05-15': '석가탄신일',
            '2024-06-06': '현충일',
            '2024-08-15': '광복절',
            '2024-09-16': '추석 연휴',
            '2024-09-17': '추석',
            '2024-09-18': '추석 연휴',
            '2024-10-03': '개천절',
            '2024-10-09': '한글날',
            '2024-12-25': '성탄절',

            // 2025년
            '2025-01-01': '신정',
            '2025-01-28': '설날 연휴',
            '2025-01-29': '설날',
            '2025-01-30': '설날 연휴',
            '2025-03-01': '삼일절',
            '2025-03-03': '대체공휴일',
            '2025-05-05': '어린이날',
            '2025-05-06': '석가탄신일',
            '2025-06-06': '현충일',
            '2025-08-15': '광복절',
            '2025-10-03': '개천절',
            '2025-10-05': '추석 연휴',
            '2025-10-06': '추석',
            '2025-10-07': '추석 연휴',
            '2025-10-08': '대체공휴일',
            '2025-10-09': '한글날',
            '2025-12-25': '성탄절',

            // 2026년
            '2026-01-01': '신정',
            '2026-02-16': '설날 연휴',
            '2026-02-17': '설날',
            '2026-02-18': '설날 연휴',
            '2026-03-01': '삼일절',
            '2026-03-02': '대체공휴일',
            '2026-05-05': '어린이날',
            '2026-05-24': '석가탄신일',
            '2026-05-25': '대체공휴일',
            '2026-06-06': '현충일',
            '2026-08-15': '광복절',
            '2026-09-24': '추석 연휴',
            '2026-09-25': '추석',
            '2026-09-26': '추석 연휴',
            '2026-10-03': '개천절',
            '2026-10-05': '대체공휴일',
            '2026-10-09': '한글날',
            '2026-12-25': '성탄절',

            // 2027년
            '2027-01-01': '신정',
            '2027-02-06': '설날 연휴',
            '2027-02-07': '설날',
            '2027-02-08': '설날 연휴',
            '2027-03-01': '삼일절',
            '2027-05-05': '어린이날',
            '2027-05-13': '석가탄신일',
            '2027-06-06': '현충일',
            '2027-06-07': '대체공휴일',
            '2027-08-15': '광복절',
            '2027-08-16': '대체공휴일',
            '2027-09-14': '추석 연휴',
            '2027-09-15': '추석',
            '2027-09-16': '추석 연휴',
            '2027-10-03': '개천절',
            '2027-10-04': '대체공휴일',
            '2027-10-09': '한글날',
            '2027-10-11': '대체공휴일',
            '2027-12-25': '성탄절',

            // 2028년
            '2028-01-01': '신정',
            '2028-01-26': '설날 연휴',
            '2028-01-27': '설날',
            '2028-01-28': '설날 연휴',
            '2028-03-01': '삼일절',
            '2028-05-02': '석가탄신일',
            '2028-05-05': '어린이날',
            '2028-06-06': '현충일',
            '2028-08-15': '광복절',
            '2028-10-02': '추석 연휴',
            '2028-10-03': '추석',
            '2028-10-04': '추석 연휴',
            '2028-10-09': '한글날',
            '2028-12-25': '성탄절',

            // 2029년
            '2029-01-01': '신정',
            '2029-02-12': '설날 연휴',
            '2029-02-13': '설날',
            '2029-02-14': '설날 연휴',
            '2029-03-01': '삼일절',
            '2029-05-05': '어린이날',
            '2029-05-20': '석가탄신일',
            '2029-05-21': '대체공휴일',
            '2029-06-06': '현충일',
            '2029-08-15': '광복절',
            '2029-09-21': '추석 연휴',
            '2029-09-22': '추석',
            '2029-09-23': '추석 연휴',
            '2029-09-24': '대체공휴일',
            '2029-10-03': '개천절',
            '2029-10-09': '한글날',
            '2029-12-25': '성탄절',

            // 2030년
            '2030-01-01': '신정',
            '2030-02-02': '설날 연휴',
            '2030-02-03': '설날',
            '2030-02-04': '설날 연휴',
            '2030-03-01': '삼일절',
            '2030-05-05': '어린이날',
            '2030-05-06': '대체공휴일',
            '2030-05-09': '석가탄신일',
            '2030-06-06': '현충일',
            '2030-08-15': '광복절',
            '2030-09-11': '추석 연휴',
            '2030-09-12': '추석',
            '2030-09-13': '추석 연휴',
            '2030-10-03': '개천절',
            '2030-10-09': '한글날',
            '2030-12-25': '성탄절'
        };

        // 날짜 유틸리티 함수
        const getDaysInMonth = (year, month) => {
            return new Date(year, month + 1, 0).getDate();
        };

        const getFirstDayOfMonth = (year, month) => {
            return new Date(year, month, 1).getDay();
        };

        const formatDate = (year, month, day) => {
            const m = String(month + 1).padStart(2, '0');
            const d = String(day).padStart(2, '0');
            return `${year}-${m}-${d}`;
        };

        // Slack 알림 전송 함수
        const sendSlackNotification = async (approverUserId, message, type = 'approval') => {
            try {
                // Firestore에서 Slack Webhook URL 가져오기
                const settingsDoc = await db.collection('settings').doc('slack').get();
                if (!settingsDoc.exists || !settingsDoc.data().webhookUrl) {
                    console.log('Slack Webhook URL이 설정되지 않았습니다.');
                    return;
                }

                const webhookUrl = settingsDoc.data().webhookUrl;

                // 승인자 정보 가져오기
                const approverDoc = await db.collection('employees').doc(approverUserId).get();
                if (!approverDoc.exists) {
                    console.log('승인자 정보를 찾을 수 없습니다.');
                    return;
                }

                const approverData = approverDoc.data();
                const slackUserId = approverData.slackUserId;

                // 메시지 구성
                let slackMessage = '';
                if (slackUserId) {
                    slackMessage = `<@${slackUserId}> ${message}`;
                } else {
                    slackMessage = `${approverData.name}님, ${message}`;
                }

                // Slack에 메시지 전송
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        text: slackMessage,
                        username: '연차관리시스템',
                        icon_emoji: type === 'approval' ? ':memo:' : ':x:'
                    })
                });

                if (!response.ok) {
                    console.error('Slack 알림 전송 실패:', response.statusText);
                }
            } catch (error) {
                console.error('Slack 알림 전송 중 오류:', error);
            }
        };

        // PT 스케줄 관리 컴포넌트
        function PTSchedule({ user, isPTScheduleEditor }) {
            const [currentDate, setCurrentDate] = useState(new Date());
            const [weekSchedules, setWeekSchedules] = useState([]);
            const [loading, setLoading] = useState(false);
            const [editingWeek, setEditingWeek] = useState(null);
            const [tempSlots, setTempSlots] = useState({});
            const [tempTimeSlots, setTempTimeSlots] = useState([]);
            const [employees, setEmployees] = useState([]);

            const defaultTimeSlots = ['12:00', '13:00', '14:00', '15:00', '16:00'];
            const weekDays = ['월', '화', '수', '목', '금'];

            useEffect(() => {
                loadEmployees();
                loadMonthSchedules();
            }, [currentDate]);

            const loadEmployees = async () => {
                try {
                    const snapshot = await db.collection('employees').get();
                    const employeeList = [];
                    snapshot.forEach(doc => {
                        employeeList.push({ id: doc.id, ...doc.data() });
                    });
                    setEmployees(employeeList);
                } catch (error) {
                    console.error('사원 목록 로드 실패:', error);
                }
            };

            // 해당 월의 주차별 날짜 계산 (월초/월말 날짜 모두 포함)
            const getWeeksInMonth = (year, month) => {
                const weeks = [];
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);

                // 월의 첫 날이 속한 주의 월요일 찾기 (이전 월일 수 있음)
                let weekStart = new Date(firstDay);
                const firstDayOfWeek = firstDay.getDay(); // 0(일) ~ 6(토)

                // 월요일(1)로 조정
                if (firstDayOfWeek === 0) {
                    // 일요일이면 전주 월요일
                    weekStart.setDate(weekStart.getDate() - 6);
                } else if (firstDayOfWeek !== 1) {
                    // 월요일이 아니면 그 주의 월요일로
                    weekStart.setDate(weekStart.getDate() - (firstDayOfWeek - 1));
                }

                let weekNumber = 1;
                let currentWeekStart = new Date(weekStart);

                // 마지막 날이 속한 주까지 반복
                while (currentWeekStart <= lastDay) {
                    const dates = [];

                    // 월~금 5일간의 날짜 수집
                    for (let i = 0; i < 5; i++) {
                        const date = new Date(currentWeekStart);
                        date.setDate(currentWeekStart.getDate() + i);
                        dates.push({
                            date: new Date(date),
                            isCurrentMonth: date.getMonth() === month
                        });
                    }

                    // 해당 주에 현재 월의 날짜가 하나라도 있으면 주차 추가
                    const hasCurrentMonthDate = dates.some(d => d.isCurrentMonth);

                    if (hasCurrentMonthDate) {
                        // 실제 시작일과 종료일 계산 (현재 월 기준)
                        const currentMonthDates = dates.filter(d => d.isCurrentMonth).map(d => d.date);
                        const weekStartDate = currentMonthDates[0];
                        const weekEndDate = currentMonthDates[currentMonthDates.length - 1];

                        weeks.push({
                            weekNumber: weekNumber,
                            startDate: new Date(weekStartDate),
                            endDate: new Date(weekEndDate),
                            dates: dates
                        });
                        weekNumber++;
                    }

                    // 다음 주 월요일로 이동
                    currentWeekStart.setDate(currentWeekStart.getDate() + 7);
                }

                return weeks;
            };

            const formatDate = (date) => {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            };

            const loadMonthSchedules = async () => {
                setLoading(true);
                try {
                    const year = currentDate.getFullYear();
                    const month = currentDate.getMonth();
                    const weeks = getWeeksInMonth(year, month);

                    const yearMonth = `${year}-${String(month + 1).padStart(2, '0')}`;

                    // 해당 월의 모든 스케줄 로드
                    const snapshot = await db.collection('ptSchedules').doc(yearMonth).get();
                    const scheduleData = snapshot.exists ? snapshot.data() : {};

                    const schedulesWithData = weeks.map(week => {
                        const weekKey = `week${week.weekNumber}`;
                        const weekData = scheduleData[weekKey] || {};

                        // 해당 주차의 시간 슬롯 추출
                        const timeSlots = weekData.timeSlots || defaultTimeSlots;
                        const slots = weekData.slots || {};

                        return {
                            ...week,
                            timeSlots: timeSlots,
                            slots: slots
                        };
                    });

                    setWeekSchedules(schedulesWithData);
                } catch (error) {
                    console.error('스케줄 로드 실패:', error);
                }
                setLoading(false);
            };

            const handleStartEdit = (weekNumber) => {
                const week = weekSchedules.find(w => w.weekNumber === weekNumber);
                if (week) {
                    setEditingWeek(weekNumber);
                    // 슬롯 데이터를 객체 형태로 변환 (기존 이름만 있으면 { name: 이름, cancelled: false })
                    const slotsWithStatus = {};
                    Object.keys(week.slots).forEach(key => {
                        const value = week.slots[key];
                        if (typeof value === 'string') {
                            slotsWithStatus[key] = { name: value, cancelled: false };
                        } else {
                            slotsWithStatus[key] = value;
                        }
                    });
                    setTempSlots(slotsWithStatus);
                    setTempTimeSlots([...week.timeSlots]);
                }
            };

            const handleCancelEdit = () => {
                setEditingWeek(null);
                setTempSlots({});
                setTempTimeSlots([]);
            };

            const handleSaveEdit = async (weekNumber) => {
                try {
                    const year = currentDate.getFullYear();
                    const month = currentDate.getMonth();
                    const yearMonth = `${year}-${String(month + 1).padStart(2, '0')}`;
                    const weekKey = `week${weekNumber}`;

                    // 저장 시에는 객체 형태 그대로 유지 (취소 정보 포함)
                    const slotsToSave = {};

                    // tempSlots에 있는 키들 중 name이 비어있지 않은 것만 저장
                    Object.keys(tempSlots).forEach(key => {
                        const slot = tempSlots[key];
                        const name = slot.name || '';
                        // name이 있고 빈 문자열이나 하이픈이 아닌 경우만 저장
                        if (name && name !== '' && name !== '-') {
                            slotsToSave[key] = {
                                name: name,
                                cancelled: slot.cancelled || false
                            };
                        }
                    });

                    // 전체 문서를 가져와서 해당 주차만 업데이트 (slots 완전 교체를 위함)
                    const docRef = db.collection('ptSchedules').doc(yearMonth);
                    const doc = await docRef.get();
                    const data = doc.exists ? doc.data() : {};

                    // 해당 주차 데이터 완전 교체
                    data[weekKey] = {
                        timeSlots: tempTimeSlots,
                        slots: slotsToSave
                    };

                    // 전체 문서 저장 (merge 없이)
                    await docRef.set(data);

                    alert('저장되었습니다.');
                    setEditingWeek(null);
                    setTempSlots({});
                    setTempTimeSlots([]);
                    loadMonthSchedules();
                } catch (error) {
                    console.error('저장 실패:', error);
                    alert('저장 실패: ' + error.message);
                }
            };

            const handleSlotChange = (slotKey, value) => {
                setTempSlots(prev => ({
                    ...prev,
                    [slotKey]: { name: value, cancelled: false }
                }));
            };

            const handleCancelSlot = (slotKey) => {
                setTempSlots(prev => {
                    const current = prev[slotKey] || { name: '', cancelled: false };
                    return {
                        ...prev,
                        [slotKey]: { ...current, cancelled: true }
                    };
                });
            };

            const handleReactivateSlot = (slotKey, value) => {
                if (value === '오기입') {
                    // 오기입 선택 시 슬롯을 빈 값으로 설정 (저장 시 제외됨)
                    setTempSlots(prev => {
                        const newSlots = { ...prev };
                        delete newSlots[slotKey];
                        return newSlots;
                    });
                } else if (value) {
                    // 취소선 상태에서 새 인원 선택 시 취소 해제하고 새 인원으로 교체
                    setTempSlots(prev => ({
                        ...prev,
                        [slotKey]: { name: value, cancelled: false }
                    }));
                }
            };

            const handleAddTimeSlot = () => {
                const newTime = prompt('추가할 시간을 입력하세요 (예: 17:00, 09:30)');
                if (!newTime) return;

                // 시간 형식 검증
                if (!/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(newTime)) {
                    alert('올바른 시간 형식이 아닙니다.\n예시: 17:00, 09:30, 14:15');
                    return;
                }

                // 중복 체크
                if (tempTimeSlots.includes(newTime)) {
                    alert('이미 존재하는 시간입니다.');
                    return;
                }

                setTempTimeSlots(prev => [...prev, newTime].sort());
            };

            const handleRemoveTimeSlot = (timeToRemove) => {
                if (!confirm(`${timeToRemove} 시간대를 삭제하시겠습니까?\n해당 시간의 모든 데이터가 삭제됩니다.`)) return;

                // 시간 슬롯에서 제거
                setTempTimeSlots(prev => prev.filter(t => t !== timeToRemove));

                // 해당 시간의 모든 슬롯 데이터 제거
                const newSlots = { ...tempSlots };
                weekDays.forEach(day => {
                    delete newSlots[`${day}-${timeToRemove}`];
                });
                setTempSlots(newSlots);
            };

            const handleTimeSlotChange = (oldTime, newTime) => {
                if (!newTime) {
                    return;
                }

                if (!/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(newTime)) {
                    alert('올바른 시간 형식이 아닙니다 (예: 17:00)');
                    return;
                }

                // 시간 슬롯 업데이트
                setTempTimeSlots(prev => prev.map(t => t === oldTime ? newTime : t));

                // 슬롯 데이터의 키 업데이트
                const newSlots = { ...tempSlots };
                weekDays.forEach(day => {
                    const oldKey = `${day}-${oldTime}`;
                    const newKey = `${day}-${newTime}`;
                    if (newSlots[oldKey]) {
                        newSlots[newKey] = newSlots[oldKey];
                        delete newSlots[oldKey];
                    }
                });
                setTempSlots(newSlots);
            };

            const handlePrevMonth = () => {
                setCurrentDate(prev => {
                    const newDate = new Date(prev);
                    newDate.setMonth(prev.getMonth() - 1);
                    return newDate;
                });
                setEditingWeek(null);
                setTempSlots({});
                setTempTimeSlots([]);
            };

            const handleNextMonth = () => {
                setCurrentDate(prev => {
                    const newDate = new Date(prev);
                    newDate.setMonth(prev.getMonth() + 1);
                    return newDate;
                });
                setEditingWeek(null);
                setTempSlots({});
                setTempTimeSlots([]);
            };

            const handleToday = () => {
                setCurrentDate(new Date());
                setEditingWeek(null);
                setTempSlots({});
                setTempTimeSlots([]);
            };

            return (
                <div className="content-card">
                    <div className="pt-schedule-header" style={{
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center',
                        marginBottom: '20px'
                    }}>
                        <h2>PT 스케줄</h2>
                        <div className="calendar-nav">
                            <button className="nav-btn" onClick={handlePrevMonth}>◀ 이전달</button>
                            <button className="nav-btn" onClick={handleToday}>오늘</button>
                            <button className="nav-btn" onClick={handleNextMonth}>다음달 ▶</button>
                        </div>
                    </div>

                    <div style={{
                        textAlign: 'center',
                        fontSize: '24px',
                        fontWeight: 'bold',
                        marginBottom: '30px',
                        color: '#333'
                    }} className="pt-schedule-title">
                        {currentDate.getFullYear()}년 {currentDate.getMonth() + 1}월 PT 스케줄
                    </div>

                    {loading ? (
                        <div style={{ textAlign: 'center', padding: '60px', color: '#999' }}>
                            로딩중...
                        </div>
                    ) : weekSchedules.length === 0 ? (
                        <div style={{
                            padding: '60px',
                            textAlign: 'center',
                            color: '#999',
                            background: '#f9f9f9',
                            borderRadius: '8px'
                        }}>
                            이번 달은 표시할 주차가 없습니다.
                        </div>
                    ) : (
                        <div style={{ display: 'grid', gap: '30px' }}>
                            {weekSchedules.map(week => {
                                const isEditing = editingWeek === week.weekNumber;
                                const displaySlots = isEditing ? tempSlots : week.slots;
                                const displayTimeSlots = isEditing ? tempTimeSlots : week.timeSlots;

                                return (
                                    <div key={week.weekNumber} style={{
                                        border: '1px solid #ddd',
                                        borderRadius: '8px',
                                        padding: '20px',
                                        background: 'white'
                                    }}>
                                        <div style={{
                                            display: 'flex',
                                            justifyContent: 'space-between',
                                            alignItems: 'center',
                                            marginBottom: '15px'
                                        }}>
                                            <div>
                                                <h3 style={{ fontSize: '18px', marginBottom: '5px' }}>
                                                    💪 {week.weekNumber}주차
                                                </h3>
                                                <p style={{ fontSize: '14px', color: '#666' }}>
                                                    {formatDate(week.startDate)} ~ {formatDate(week.endDate)}
                                                </p>
                                            </div>
                                            {isPTScheduleEditor && (
                                                <div className="pt-schedule-buttons" style={{ display: 'flex', gap: '8px' }}>
                                                    {isEditing ? (
                                                        <>
                                                            <button
                                                                onClick={handleAddTimeSlot}
                                                                style={{
                                                                    padding: '8px 16px',
                                                                    background: '#FF9800',
                                                                    color: 'white',
                                                                    border: 'none',
                                                                    borderRadius: '6px',
                                                                    cursor: 'pointer',
                                                                    fontSize: '14px'
                                                                }}
                                                            >
                                                                + 시간 추가
                                                            </button>
                                                            <button
                                                                onClick={() => handleSaveEdit(week.weekNumber)}
                                                                style={{
                                                                    padding: '8px 16px',
                                                                    background: '#4CAF50',
                                                                    color: 'white',
                                                                    border: 'none',
                                                                    borderRadius: '6px',
                                                                    cursor: 'pointer',
                                                                    fontSize: '14px'
                                                                }}
                                                            >
                                                                저장
                                                            </button>
                                                            <button
                                                                onClick={handleCancelEdit}
                                                                style={{
                                                                    padding: '8px 16px',
                                                                    background: '#999',
                                                                    color: 'white',
                                                                    border: 'none',
                                                                    borderRadius: '6px',
                                                                    cursor: 'pointer',
                                                                    fontSize: '14px'
                                                                }}
                                                            >
                                                                취소
                                                            </button>
                                                        </>
                                                    ) : (
                                                        <button
                                                            onClick={() => handleStartEdit(week.weekNumber)}
                                                            style={{
                                                                padding: '8px 16px',
                                                                background: '#2196F3',
                                                                color: 'white',
                                                                border: 'none',
                                                                borderRadius: '6px',
                                                                cursor: 'pointer',
                                                                fontSize: '14px'
                                                            }}
                                                        >
                                                            수정
                                                        </button>
                                                    )}
                                                </div>
                                            )}
                                        </div>

                                        <div style={{ overflowX: 'auto' }}>
                                            <table style={{
                                                width: '100%',
                                                borderCollapse: 'collapse',
                                                minWidth: '700px'
                                            }}>
                                                <thead>
                                                    <tr>
                                                        <th style={{
                                                            padding: '12px',
                                                            background: '#f5f5f5',
                                                            border: '1px solid #ddd',
                                                            fontWeight: '600',
                                                            width: '100px'
                                                        }}>Time</th>
                                                        {weekDays.map((day, idx) => {
                                                            const dateInfo = week.dates[idx];
                                                            return (
                                                                <th key={day} style={{
                                                                    padding: '12px',
                                                                    background: '#f5f5f5',
                                                                    border: '1px solid #ddd',
                                                                    fontWeight: '600'
                                                                }}>
                                                                    <div>{day}</div>
                                                                    {dateInfo && (
                                                                        <div style={{
                                                                            fontSize: '12px',
                                                                            color: dateInfo.isCurrentMonth ? '#999' : '#ccc',
                                                                            fontWeight: 'normal'
                                                                        }}>
                                                                            {dateInfo.date.getDate()}일
                                                                        </div>
                                                                    )}
                                                                </th>
                                                            );
                                                        })}
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {displayTimeSlots.map(time => (
                                                        <tr key={time}>
                                                            <td style={{
                                                                padding: '10px',
                                                                border: '1px solid #ddd',
                                                                fontWeight: '500',
                                                                background: '#fafafa',
                                                                textAlign: 'center'
                                                            }}>
                                                                {isEditing ? (
                                                                    <div style={{ display: 'flex', alignItems: 'center', gap: '5px', justifyContent: 'center' }}>
                                                                        <input
                                                                            type="text"
                                                                            defaultValue={time}
                                                                            onBlur={(e) => {
                                                                                if (e.target.value && e.target.value !== time) {
                                                                                    handleTimeSlotChange(time, e.target.value);
                                                                                }
                                                                            }}
                                                                            placeholder="HH:MM"
                                                                            style={{
                                                                                width: '70px',
                                                                                padding: '4px',
                                                                                border: '1px solid #ddd',
                                                                                borderRadius: '4px',
                                                                                fontSize: '13px',
                                                                                textAlign: 'center'
                                                                            }}
                                                                        />
                                                                        <button
                                                                            onClick={() => handleRemoveTimeSlot(time)}
                                                                            className="time-slot-delete-btn"
                                                                            style={{
                                                                                padding: '2px 6px',
                                                                                background: '#ff4444',
                                                                                color: 'white',
                                                                                border: 'none',
                                                                                borderRadius: '4px',
                                                                                cursor: 'pointer',
                                                                                fontSize: '11px'
                                                                            }}
                                                                        >
                                                                            ✕
                                                                        </button>
                                                                    </div>
                                                                ) : time}
                                                            </td>
                                                            {weekDays.map((day, idx) => {
                                                                const slotKey = `${day}-${time}`;
                                                                const slotData = displaySlots?.[slotKey];
                                                                const slotValue = typeof slotData === 'string' ? slotData : (slotData?.name || '');
                                                                const isCancelled = slotData?.cancelled || false;
                                                                const dateInfo = week.dates[idx];
                                                                const isCurrentMonth = dateInfo && dateInfo.isCurrentMonth;

                                                                return (
                                                                    <td key={slotKey} style={{
                                                                        padding: '8px',
                                                                        border: '1px solid #ddd',
                                                                        textAlign: 'center',
                                                                        minHeight: '50px',
                                                                        background: !isCurrentMonth ? '#f5f5f5' : 'white'
                                                                    }}>
                                                                        {!isCurrentMonth ? (
                                                                            <span style={{ color: '#ccc' }}>-</span>
                                                                        ) : isEditing ? (
                                                                            isCancelled ? (
                                                                                // 취소된 상태: 취소선 + 드롭다운
                                                                                <div style={{ display: 'flex', flexDirection: 'column', gap: '4px' }}>
                                                                                    <span style={{
                                                                                        fontSize: '14px',
                                                                                        textDecoration: 'line-through',
                                                                                        color: '#999'
                                                                                    }}>
                                                                                        {slotValue}
                                                                                    </span>
                                                                                    <select
                                                                                        value=""
                                                                                        onChange={(e) => handleReactivateSlot(slotKey, e.target.value)}
                                                                                        style={{
                                                                                            width: '100%',
                                                                                            padding: '4px',
                                                                                            border: '1px solid #ddd',
                                                                                            borderRadius: '4px',
                                                                                            fontSize: '12px',
                                                                                            textAlign: 'center'
                                                                                        }}
                                                                                    >
                                                                                        <option value="">변경</option>
                                                                                        <option value="오기입" style={{color: '#ff4444', fontWeight: 'bold'}}>🗑️ 오기입</option>
                                                                                        {employees.map(emp => (
                                                                                            <option key={emp.id} value={emp.name}>
                                                                                                {emp.name}
                                                                                            </option>
                                                                                        ))}
                                                                                    </select>
                                                                                </div>
                                                                            ) : slotValue ? (
                                                                                // 등록된 상태: 이름 + X 버튼
                                                                                <div style={{
                                                                                    display: 'flex',
                                                                                    alignItems: 'center',
                                                                                    justifyContent: 'center',
                                                                                    gap: '5px'
                                                                                }}>
                                                                                    <span style={{ fontSize: '14px' }}>{slotValue}</span>
                                                                                    <button
                                                                                        onClick={() => handleCancelSlot(slotKey)}
                                                                                        className="slot-cancel-btn"
                                                                                        style={{
                                                                                            width: '18px',
                                                                                            height: '18px',
                                                                                            padding: '0',
                                                                                            background: '#ff4444',
                                                                                            color: 'white',
                                                                                            border: 'none',
                                                                                            borderRadius: '3px',
                                                                                            cursor: 'pointer',
                                                                                            fontSize: '11px',
                                                                                            display: 'inline-flex',
                                                                                            alignItems: 'center',
                                                                                            justifyContent: 'center',
                                                                                            lineHeight: '1'
                                                                                        }}
                                                                                    >
                                                                                        ✕
                                                                                    </button>
                                                                                </div>
                                                                            ) : (
                                                                                // 빈 상태: 드롭다운
                                                                                <select
                                                                                    value=""
                                                                                    onChange={(e) => handleSlotChange(slotKey, e.target.value)}
                                                                                    style={{
                                                                                        width: '100%',
                                                                                        padding: '6px',
                                                                                        border: '1px solid #ddd',
                                                                                        borderRadius: '4px',
                                                                                        fontSize: '14px',
                                                                                        textAlign: 'center'
                                                                                    }}
                                                                                >
                                                                                    <option value="">선택</option>
                                                                                    {employees.map(emp => (
                                                                                        <option key={emp.id} value={emp.name}>
                                                                                            {emp.name}
                                                                                        </option>
                                                                                    ))}
                                                                                </select>
                                                                            )
                                                                        ) : (
                                                                            <span style={{
                                                                                fontSize: '14px',
                                                                                color: slotValue ? (isCancelled ? '#999' : '#333') : '#999',
                                                                                textDecoration: isCancelled ? 'line-through' : 'none'
                                                                            }}>
                                                                                {slotValue || '-'}
                                                                            </span>
                                                                        )}
                                                                    </td>
                                                                );
                                                            })}
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    )}

                    {/* 월별 통계 표 */}
                    {!loading && weekSchedules.length > 0 && (
                        <div style={{
                            marginTop: '40px',
                            border: '1px solid #ddd',
                            borderRadius: '8px',
                            padding: '20px',
                            background: 'white'
                        }}>
                            <h3 style={{
                                fontSize: '18px',
                                marginBottom: '15px',
                                color: '#333',
                                fontWeight: 'bold'
                            }}>
                                {currentDate.getFullYear()}년 {currentDate.getMonth() + 1}월 PT 이용 통계
                            </h3>
                            <table style={{
                                width: '100%',
                                borderCollapse: 'collapse'
                            }}>
                                <thead>
                                    <tr>
                                        <th style={{
                                            padding: '12px',
                                            background: '#f5f5f5',
                                            border: '1px solid #ddd',
                                            fontWeight: '600',
                                            textAlign: 'center'
                                        }}>주차</th>
                                        <th style={{
                                            padding: '12px',
                                            background: '#f5f5f5',
                                            border: '1px solid #ddd',
                                            fontWeight: '600',
                                            textAlign: 'center'
                                        }}>기간</th>
                                        <th style={{
                                            padding: '12px',
                                            background: '#f5f5f5',
                                            border: '1px solid #ddd',
                                            fontWeight: '600',
                                            textAlign: 'center'
                                        }}>PT 횟수</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {weekSchedules.map(week => {
                                        // 해당 주차의 PT 횟수 계산 (취소된 것도 포함)
                                        const ptCount = Object.values(week.slots).filter(slotData => {
                                            // 문자열인 경우: 값이 있고 비어있지 않은 경우
                                            if (typeof slotData === 'string') {
                                                return slotData && slotData !== '' && slotData !== '-';
                                            }
                                            // 객체인 경우: name이 있고 비어있지 않은 경우 (취소 여부 무관)
                                            if (typeof slotData === 'object' && slotData !== null) {
                                                const name = slotData.name || '';
                                                return name && name !== '' && name !== '-';
                                            }
                                            return false;
                                        }).length;

                                        return (
                                            <tr key={week.weekNumber}>
                                                <td style={{
                                                    padding: '10px',
                                                    border: '1px solid #ddd',
                                                    textAlign: 'center'
                                                }}>
                                                    {week.weekNumber}주차
                                                </td>
                                                <td style={{
                                                    padding: '10px',
                                                    border: '1px solid #ddd',
                                                    textAlign: 'center',
                                                    fontSize: '13px'
                                                }}>
                                                    {formatDate(week.startDate)} ~ {formatDate(week.endDate)}
                                                </td>
                                                <td style={{
                                                    padding: '10px',
                                                    border: '1px solid #ddd',
                                                    textAlign: 'center',
                                                    fontWeight: '600',
                                                    color: '#2196F3'
                                                }}>
                                                    {ptCount}회
                                                </td>
                                            </tr>
                                        );
                                    })}
                                    {/* 월 총계 */}
                                    <tr style={{ background: '#f9f9f9' }}>
                                        <td colSpan="2" style={{
                                            padding: '12px',
                                            border: '1px solid #ddd',
                                            textAlign: 'center',
                                            fontWeight: 'bold',
                                            fontSize: '15px'
                                        }}>
                                            월 총계
                                        </td>
                                        <td style={{
                                            padding: '12px',
                                            border: '1px solid #ddd',
                                            textAlign: 'center',
                                            fontWeight: 'bold',
                                            fontSize: '16px',
                                            color: '#4CAF50'
                                        }}>
                                            {weekSchedules.reduce((total, week) => {
                                                const ptCount = Object.values(week.slots).filter(slotData => {
                                                    // 문자열인 경우: 값이 있고 비어있지 않은 경우
                                                    if (typeof slotData === 'string') {
                                                        return slotData && slotData !== '' && slotData !== '-';
                                                    }
                                                    // 객체인 경우: name이 있고 비어있지 않은 경우 (취소 여부 무관)
                                                    if (typeof slotData === 'object' && slotData !== null) {
                                                        const name = slotData.name || '';
                                                        return name && name !== '' && name !== '-';
                                                    }
                                                    return false;
                                                }).length;
                                                return total + ptCount;
                                            }, 0)}회
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    )}
                </div>
            );
        }

        // Slack 설정 컴포넌트
        function SlackSettings() {
            const [webhookUrl, setWebhookUrl] = useState('');
            const [loading, setLoading] = useState(true);
            const [saving, setSaving] = useState(false);

            useEffect(() => {
                loadSettings();
            }, []);

            const loadSettings = async () => {
                try {
                    const settingsDoc = await db.collection('settings').doc('slack').get();
                    if (settingsDoc.exists) {
                        setWebhookUrl(settingsDoc.data().webhookUrl || '');
                    }
                    setLoading(false);
                } catch (error) {
                    console.error('설정 로드 실패:', error);
                    setLoading(false);
                }
            };

            const handleSaveSettings = async () => {
                if (!webhookUrl) {
                    alert('Webhook URL을 입력해주세요.');
                    return;
                }

                setSaving(true);
                try {
                    await db.collection('settings').doc('slack').set({
                        webhookUrl: webhookUrl,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    alert('Slack 설정이 저장되었습니다.');
                } catch (error) {
                    alert('저장 실패: ' + error.message);
                } finally {
                    setSaving(false);
                }
            };

            const handleTestNotification = async () => {
                if (!webhookUrl) {
                    alert('먼저 Webhook URL을 저장해주세요.');
                    return;
                }

                try {
                    const response = await fetch(webhookUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            text: '✅ 테스트 메시지입니다. Slack 연동이 정상적으로 작동합니다!',
                            username: '연차관리시스템',
                            icon_emoji: ':white_check_mark:'
                        })
                    });

                    if (response.ok) {
                        alert('테스트 메시지가 전송되었습니다. Slack을 확인해주세요.');
                    } else {
                        alert('테스트 메시지 전송 실패. Webhook URL을 확인해주세요.');
                    }
                } catch (error) {
                    alert('전송 실패: ' + error.message);
                }
            };

            if (loading) {
                return <div className="content-card">로딩중...</div>;
            }

            return (
                <div className="content-card">
                    <h2 style={{marginBottom: '20px'}}>Slack 연동 설정</h2>

                    <div style={{maxWidth: '800px'}}>
                        <div style={{
                            background: '#e8f5e9',
                            padding: '20px',
                            borderRadius: '8px',
                            marginBottom: '30px',
                            border: '1px solid #4CAF50'
                        }}>
                            <h3 style={{fontSize: '16px', marginBottom: '15px', color: '#2e7d32'}}>Slack 설정 가이드</h3>
                            <ol style={{fontSize: '14px', lineHeight: '1.8', color: '#333', paddingLeft: '20px'}}>
                                <li><a href="https://api.slack.com/apps" target="_blank" style={{color: '#1976d2'}}>https://api.slack.com/apps</a> 접속</li>
                                <li>"Create New App" → "From scratch" 선택</li>
                                <li>App 이름 입력 (예: 연차관리시스템)</li>
                                <li>좌측 "Incoming Webhooks" 클릭 → "Activate Incoming Webhooks" ON</li>
                                <li>"Add New Webhook to Workspace" 클릭</li>
                                <li>알림을 받을 채널 선택 (예: #연차-알림)</li>
                                <li>생성된 Webhook URL을 아래에 입력</li>
                            </ol>
                        </div>

                        <div className="form-group">
                            <label style={{fontSize: '16px', fontWeight: '600', marginBottom: '10px', display: 'block'}}>
                                Slack Webhook URL
                            </label>
                            <input
                                type="text"
                                value={webhookUrl}
                                onChange={(e) => setWebhookUrl(e.target.value)}
                                placeholder="https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXX"
                                style={{
                                    width: '100%',
                                    padding: '12px',
                                    fontSize: '14px',
                                    border: '1px solid #ddd',
                                    borderRadius: '6px',
                                    fontFamily: 'monospace'
                                }}
                            />
                        </div>

                        <div style={{display: 'flex', gap: '10px', marginTop: '20px'}}>
                            <button
                                onClick={handleSaveSettings}
                                disabled={saving}
                                style={{
                                    padding: '12px 24px',
                                    background: '#4CAF50',
                                    color: 'white',
                                    border: 'none',
                                    borderRadius: '6px',
                                    cursor: saving ? 'not-allowed' : 'pointer',
                                    fontSize: '14px',
                                    fontWeight: '600',
                                    opacity: saving ? 0.6 : 1
                                }}
                            >
                                {saving ? '저장중...' : '저장'}
                            </button>
                            <button
                                onClick={handleTestNotification}
                                style={{
                                    padding: '12px 24px',
                                    background: '#2196F3',
                                    color: 'white',
                                    border: 'none',
                                    borderRadius: '6px',
                                    cursor: 'pointer',
                                    fontSize: '14px',
                                    fontWeight: '600'
                                }}
                            >
                                테스트 메시지 보내기
                            </button>
                        </div>

                        <div style={{
                            marginTop: '30px',
                            padding: '15px',
                            background: '#fff3e0',
                            borderRadius: '8px',
                            border: '1px solid #ff9800'
                        }}>
                            <h4 style={{fontSize: '14px', marginBottom: '10px', color: '#e65100'}}>💡 멘션 기능 사용하기</h4>
                            <p style={{fontSize: '13px', color: '#666', lineHeight: '1.6', margin: 0}}>
                                사원 관리에서 각 사원의 Slack 사용자 ID를 등록하면, 알림 시 해당 사원에게 멘션(@)이 포함됩니다.
                                <br />
                                Slack 사용자 ID는 Slack에서 사용자 프로필 → ⋯ (더보기) → "Copy member ID"로 확인할 수 있습니다.
                            </p>
                        </div>
                    </div>
                </div>
            );
        }

        // 대시보드 컴포넌트
        function Dashboard({ user, isAdmin, isSubAdmin }) {
            const [stats, setStats] = useState({
                totalEmployees: 0,
                todayLeaves: 0,
                pendingApprovals: 0,
                thisMonthLeaves: 0,
                availableLeave: 0,
                usedLeave: 0,
                todayWorkSchedules: 0,
                monthWorkRate: 0,
                monthRemoteRate: 0,
                monthLeaveRate: 0,
                employeeStats: []
            });
            const [recentActivities, setRecentActivities] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                loadDashboardData();
            }, []);

            const loadDashboardData = async () => {
                try {
                    // 전체 사원 수
                    const employeesSnapshot = await db.collection('employees').get();
                    const totalEmployees = employeesSnapshot.size;
                    const employeesList = [];
                    employeesSnapshot.forEach(doc => {
                        employeesList.push({ id: doc.id, ...doc.data() });
                    });

                    // 오늘 날짜
                    const today = new Date().toISOString().split('T')[0];
                    const currentMonth = new Date().toISOString().slice(0, 7);

                    // 이번 달 평일 수 계산
                    const getWeekdaysInMonth = (yearMonth) => {
                        const [year, month] = yearMonth.split('-').map(Number);
                        const firstDay = new Date(year, month - 1, 1);
                        const lastDay = new Date(year, month, 0);
                        let weekdays = 0;
                        
                        for (let date = new Date(firstDay); date <= lastDay; date.setDate(date.getDate() + 1)) {
                            const dayOfWeek = date.getDay();
                            // 토요일(6), 일요일(0) 제외
                            if (dayOfWeek !== 0 && dayOfWeek !== 6) {
                                weekdays++;
                            }
                        }
                        return weekdays;
                    };
                    
                    const weekdaysInMonth = getWeekdaysInMonth(currentMonth);
                    const totalExpectedRecords = weekdaysInMonth * totalEmployees; // 평일수 × 총인원

                    // 오늘 일정 캘린더에서 출근으로 등록된 인원 수 계산
                    const calendarSnapshot = await db.collection('schedules').get();
                    let todayWorkSchedules = 0;
                    calendarSnapshot.forEach(doc => {
                        const data = doc.data();
                        if (data.date === today && (data.approvalStatus !== 'cancelled' && data.approvalStatus !== 'deletion-pending')) {
                            const type = data.type || '';
                            if (type === '출근' || type === '정상출근') {
                                todayWorkSchedules++;
                            }
                        }
                    });

                    // 오늘 연차 사용자
                    const leaveSnapshot = await db.collection('leaveUsage')
                        .where('approvalStatus', '==', 'approved')
                        .get();

                    let todayLeaves = 0;
                    let thisMonthLeaves = 0;

                    leaveSnapshot.forEach(doc => {
                        const data = doc.data();
                        const leaveDate = data.startDate || data.date;
                        if (leaveDate === today) {
                            todayLeaves++;
                        }
                        if (leaveDate && leaveDate.startsWith(currentMonth)) {
                            thisMonthLeaves++;
                        }
                    });

                    // 이번 달 일정 통계 계산
                    let monthWorkCount = 0;
                    let monthRemoteCount = 0;
                    let monthLeaveCount = 0;
                    
                    // 인원별 통계 계산 - 전체 사원 포함
                    const employeeStatsMap = {};
                    employeesList.forEach(emp => {
                        employeeStatsMap[emp.id] = {
                            name: emp.name,
                            work: 0,
                            remote: 0,
                            leave: 0,
                            total: 0
                        };
                    });

                    calendarSnapshot.forEach(doc => {
                        const data = doc.data();
                        // 취소되거나 삭제 대기 중인 일정 제외
                        if (data.approvalStatus === 'cancelled' || data.approvalStatus === 'deletion-pending') {
                            return;
                        }
                        
                        if (data.date && data.date.startsWith(currentMonth)) {
                            const type = data.type || '';
                            if (type === '출근' || type === '정상출근') {
                                monthWorkCount++;
                                if (employeeStatsMap[data.userId]) {
                                    employeeStatsMap[data.userId].work++;
                                    employeeStatsMap[data.userId].total++;
                                }
                            } else if (type === '재택' || type === '재택근무') {
                                monthRemoteCount++;
                                if (employeeStatsMap[data.userId]) {
                                    employeeStatsMap[data.userId].remote++;
                                    employeeStatsMap[data.userId].total++;
                                }
                            }
                        }
                    });

                    leaveSnapshot.forEach(doc => {
                        const data = doc.data();
                        const leaveDate = data.startDate || data.date;
                        if (leaveDate && leaveDate.startsWith(currentMonth)) {
                            monthLeaveCount++;
                            if (employeeStatsMap[data.userId]) {
                                employeeStatsMap[data.userId].leave++;
                                employeeStatsMap[data.userId].total++;
                            }
                        }
                    });

                    // 평일 × 총인원을 기준으로 비율 계산
                    const monthWorkRate = totalExpectedRecords > 0 ? Math.round((monthWorkCount / totalExpectedRecords) * 100) : 0;
                    const monthRemoteRate = totalExpectedRecords > 0 ? Math.round((monthRemoteCount / totalExpectedRecords) * 100) : 0;
                    const monthLeaveRate = totalExpectedRecords > 0 ? Math.round((monthLeaveCount / totalExpectedRecords) * 100) : 0;

                    // 인원별 통계 배열로 변환 - 전체 사원 표시 (기록 없어도) - 단, 관리자와 이병윤 제외
                    const employeeStats = Object.values(employeeStatsMap)
                        .filter(stat => stat.name !== '관리자' && stat.name !== '이병윤')
                        .map(stat => ({
                            ...stat,
                            workRate: stat.total > 0 ? Math.round((stat.work / stat.total) * 100) : 0,
                            remoteRate: stat.total > 0 ? Math.round((stat.remote / stat.total) * 100) : 0,
                            leaveRate: stat.total > 0 ? Math.round((stat.leave / stat.total) * 100) : 0
                        }))
                        .sort((a, b) => a.name.localeCompare(b.name));

                    // 승인 대기 건수
                    let pendingApprovals = 0;
                    if (isAdmin || isSubAdmin) {
                        const pendingSnapshot = await db.collection('leaveUsage')
                            .where('approvalStatus', 'in', ['pending', 'deletion-pending'])
                            .get();
                        pendingApprovals = pendingSnapshot.size;
                    }

                    // 내 연차 정보 (일반 사용자)
                    let availableLeave = 0;
                    let usedLeave = 0;
                    if (!isAdmin) {
                        const empDoc = await db.collection('employees').doc(user.uid).get();
                        if (empDoc.exists) {
                            const empData = empDoc.data();
                            availableLeave = calculateTotalLeave(empData.joinDate);

                            const myLeaveSnapshot = await db.collection('leaveUsage')
                                .where('userId', '==', user.uid)
                                .where('approvalStatus', 'in', ['approved', 'pending'])
                                .get();

                            myLeaveSnapshot.forEach(doc => {
                                usedLeave += doc.data().amount || 0;
                            });
                        }
                    }

                    setStats({
                        totalEmployees,
                        todayLeaves,
                        pendingApprovals,
                        thisMonthLeaves,
                        availableLeave,
                        usedLeave,
                        todayWorkSchedules,
                        monthWorkRate,
                        monthRemoteRate,
                        monthLeaveRate,
                        employeeStats
                    });
                    setLoading(false);
                } catch (error) {
                    console.error('대시보드 데이터 로드 실패:', error);
                    setLoading(false);
                }
            };

            const calculateTotalLeave = (joinDate) => {
                if (!joinDate) return 0;
                const join = new Date(joinDate);
                const now = new Date();
                const years = now.getFullYear() - join.getFullYear();

                if (years < 1) {
                    const months = (now.getFullYear() - join.getFullYear()) * 12 + (now.getMonth() - join.getMonth());
                    return Math.floor(months);
                }

                return 15 + Math.min(years - 1, 10);
            };

            if (loading) {
                return (
                    <div className="content-card">
                        <div className="loading">대시보드 로딩 중...</div>
                    </div>
                );
            }

            return (
                <div className="content-card">
                    <h2 style={{marginBottom: '25px', fontSize: '24px', color: '#333'}}>
                        📊 대시보드
                    </h2>

                    <div className="dashboard-grid">
                        {(isAdmin || isSubAdmin) ? (
                            <>
                                <div className="dashboard-card green">
                                    <h3>전체 사원</h3>
                                    <div className="number">{stats.totalEmployees}</div>
                                    <div className="subtitle">명</div>
                                </div>
                                <div className="dashboard-card blue">
                                    <h3>오늘 연차 사용</h3>
                                    <div className="number">{stats.todayLeaves}</div>
                                    <div className="subtitle">명</div>
                                </div>
                                <div className="dashboard-card orange">
                                    <h3>이번 달 연차</h3>
                                    <div className="number">{stats.thisMonthLeaves}</div>
                                    <div className="subtitle">건</div>
                                </div>
                                <div className="dashboard-card red">
                                    <h3>승인 대기</h3>
                                    <div className="number">{stats.pendingApprovals}</div>
                                    <div className="subtitle">건</div>
                                </div>
                            </>
                        ) : (
                            <>
                                <div className="dashboard-card green">
                                    <h3>연차 잔여</h3>
                                    <div className="number">{stats.availableLeave - stats.usedLeave}</div>
                                    <div className="subtitle">일</div>
                                </div>
                                <div className="dashboard-card blue">
                                    <h3>연차 사용</h3>
                                    <div className="number">{stats.usedLeave}</div>
                                    <div className="subtitle">일</div>
                                </div>
                                <div className="dashboard-card orange">
                                    <h3>총 연차</h3>
                                    <div className="number">{stats.availableLeave}</div>
                                    <div className="subtitle">일</div>
                                </div>
                                <div className="dashboard-card purple">
                                    <h3>사용률</h3>
                                    <div className="number">
                                        {stats.availableLeave > 0
                                            ? Math.round((stats.usedLeave / stats.availableLeave) * 100)
                                            : 0}%
                                    </div>
                                    <div className="subtitle">연차 사용률</div>
                                </div>
                            </>
                        )}
                    </div>

                    {(isAdmin || isSubAdmin) && (
                        <>
                            <div className="stats-section" style={{marginTop: '30px'}}>
                                <h3 style={{marginBottom: '15px', color: '#666'}}>📈 이번달 통계</h3>
                                <div className="stats-grid">
                                    <div className="stat-card green">
                                        <h4>오늘 출근 인원</h4>
                                        <div className="value">{stats.todayWorkSchedules}</div>
                                    </div>
                                    <div className="stat-card blue">
                                        <h4>이번달 출근 비율</h4>
                                        <div className="value">{stats.monthWorkRate}%</div>
                                    </div>
                                    <div className="stat-card orange">
                                        <h4>이번달 재택 비율</h4>
                                        <div className="value">{stats.monthRemoteRate}%</div>
                                    </div>
                                    <div className="stat-card red">
                                        <h4>이번달 휴가 비율</h4>
                                        <div className="value">{stats.monthLeaveRate}%</div>
                                    </div>
                                </div>
                            </div>

                            {stats.employeeStats.length > 0 && (
                                <div style={{marginTop: '30px'}}>
                                    <h3 style={{marginBottom: '15px', color: '#666'}}>👥 인원별 월 통계</h3>
                                    <div style={{
                                        overflowX: 'auto',
                                        background: 'white',
                                        borderRadius: '8px',
                                        border: '1px solid #e0e0e0'
                                    }}>
                                        <table style={{
                                            width: '100%',
                                            borderCollapse: 'collapse',
                                            fontSize: '14px'
                                        }}>
                                            <thead>
                                                <tr style={{background: '#f5f5f5'}}>
                                                    <th style={{
                                                        padding: '12px',
                                                        textAlign: 'left',
                                                        borderBottom: '2px solid #e0e0e0',
                                                        fontWeight: '600'
                                                    }}>이름</th>
                                                    <th style={{
                                                        padding: '12px',
                                                        textAlign: 'center',
                                                        borderBottom: '2px solid #e0e0e0',
                                                        fontWeight: '600'
                                                    }}>총 기록</th>
                                                    <th style={{
                                                        padding: '12px',
                                                        textAlign: 'center',
                                                        borderBottom: '2px solid #e0e0e0',
                                                        fontWeight: '600',
                                                        color: '#4CAF50'
                                                    }}>출근</th>
                                                    <th style={{
                                                        padding: '12px',
                                                        textAlign: 'center',
                                                        borderBottom: '2px solid #e0e0e0',
                                                        fontWeight: '600',
                                                        color: '#2196F3'
                                                    }}>재택</th>
                                                    <th style={{
                                                        padding: '12px',
                                                        textAlign: 'center',
                                                        borderBottom: '2px solid #e0e0e0',
                                                        fontWeight: '600',
                                                        color: '#FF9800'
                                                    }}>휴가</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {stats.employeeStats.map((stat, index) => (
                                                    <tr key={index} style={{
                                                        borderBottom: '1px solid #f0f0f0'
                                                    }}>
                                                        <td style={{
                                                            padding: '12px',
                                                            fontWeight: '500'
                                                        }}>{stat.name}</td>
                                                        <td style={{
                                                            padding: '12px',
                                                            textAlign: 'center'
                                                        }}>{stat.total}일</td>
                                                        <td style={{
                                                            padding: '12px',
                                                            textAlign: 'center',
                                                            color: '#4CAF50'
                                                        }}>
                                                            {stat.work}일 ({stat.workRate}%)
                                                        </td>
                                                        <td style={{
                                                            padding: '12px',
                                                            textAlign: 'center',
                                                            color: '#2196F3'
                                                        }}>
                                                            {stat.remote}일 ({stat.remoteRate}%)
                                                        </td>
                                                        <td style={{
                                                            padding: '12px',
                                                            textAlign: 'center',
                                                            color: '#FF9800'
                                                        }}>
                                                            {stat.leave}일 ({stat.leaveRate}%)
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            )}
                        </>
                    )}

                    <div style={{marginTop: '30px', padding: '20px', background: '#f9f9f9', borderRadius: '8px'}}>
                        <p style={{color: '#666', fontSize: '14px', textAlign: 'center'}}>
                            💡 대시보드는 실시간으로 업데이트됩니다
                        </p>
                    </div>
                </div>
            );
        }

        // 알림 센터 컴포넌트
        function NotificationCenter({ user, isOpen, onClose }) {
            const [notifications, setNotifications] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                if (isOpen) {
                    loadNotifications();
                }
            }, [isOpen]);

            const loadNotifications = async () => {
                try {
                    const snapshot = await db.collection('notifications')
                        .where('userId', '==', user.uid)
                        .limit(50)
                        .get();

                    const notificationList = [];
                    snapshot.forEach(doc => {
                        notificationList.push({ id: doc.id, ...doc.data() });
                    });
                    
                    // 클라이언트 측에서 createdAt으로 정렬
                    notificationList.sort((a, b) => {
                        if (!a.createdAt) return 1;
                        if (!b.createdAt) return -1;
                        const aTime = a.createdAt.toDate ? a.createdAt.toDate() : new Date(a.createdAt);
                        const bTime = b.createdAt.toDate ? b.createdAt.toDate() : new Date(b.createdAt);
                        return bTime - aTime; // 최신순 정렬
                    });
                    
                    setNotifications(notificationList);
                    setLoading(false);
                } catch (error) {
                    console.error('알림 로드 실패:', error);
                    setLoading(false);
                }
            };

            const markAsRead = async (notificationId) => {
                try {
                    await db.collection('notifications').doc(notificationId).update({
                        read: true
                    });
                    loadNotifications();
                } catch (error) {
                    console.error('알림 읽음 처리 실패:', error);
                }
            };

            const markAllAsRead = async () => {
                try {
                    const batch = db.batch();
                    notifications.filter(n => !n.read).forEach(notif => {
                        const notifRef = db.collection('notifications').doc(notif.id);
                        batch.update(notifRef, { read: true });
                    });
                    await batch.commit();
                    loadNotifications();
                } catch (error) {
                    console.error('전체 읽음 처리 실패:', error);
                }
            };

            const formatTime = (timestamp) => {
                if (!timestamp) return '';
                const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
                const now = new Date();
                const diff = now - date;
                const minutes = Math.floor(diff / 60000);
                const hours = Math.floor(diff / 3600000);
                const days = Math.floor(diff / 86400000);

                if (minutes < 1) return '방금 전';
                if (minutes < 60) return `${minutes}분 전`;
                if (hours < 24) return `${hours}시간 전`;
                if (days < 7) return `${days}일 전`;
                return date.toLocaleDateString();
            };

            const unreadCount = notifications.filter(n => !n.read).length;

            return (
                <>
                    <div className={`notification-overlay ${isOpen ? 'open' : ''}`} onClick={onClose}></div>
                    <div className={`notification-panel ${isOpen ? 'open' : ''}`}>
                        <div className="notification-header">
                            <div>
                                <h3>🔔 알림</h3>
                                {unreadCount > 0 && (
                                    <button className="mark-all-read-btn" onClick={markAllAsRead}>
                                        모두 읽음
                                    </button>
                                )}
                            </div>
                            <button className="notification-close" onClick={onClose}>×</button>
                        </div>
                        <div className="notification-list">
                            {loading ? (
                                <div style={{padding: '20px', textAlign: 'center', color: '#999'}}>
                                    로딩중...
                                </div>
                            ) : notifications.length === 0 ? (
                                <div className="notification-empty">
                                    <div className="notification-empty-icon">🔔</div>
                                    <div>알림이 없습니다</div>
                                </div>
                            ) : (
                                notifications.map(notif => (
                                    <div
                                        key={notif.id}
                                        className={`notification-item ${!notif.read ? 'unread' : ''}`}
                                        onClick={() => markAsRead(notif.id)}
                                    >
                                        <div className="notification-title">{notif.title}</div>
                                        <div className="notification-message">{notif.message}</div>
                                        <div className="notification-time">{formatTime(notif.createdAt)}</div>
                                    </div>
                                ))
                            )}
                        </div>
                    </div>
                </>
            );
        }

        // 조직 구성 컴포넌트
        function DepartmentManagement({ isAdmin, isSubAdmin }) {
            const canEdit = isAdmin || isSubAdmin;
            const [departments, setDepartments] = useState([]);
            const [employees, setEmployees] = useState([]);
            const [showAddModal, setShowAddModal] = useState(false);
            const [editingDept, setEditingDept] = useState(null);
            const [newDepartment, setNewDepartment] = useState({
                name: '',
                description: '',
                headId: '',
                memberIds: []
            });

            useEffect(() => {
                loadDepartments();
                loadEmployees();
            }, []);

            const loadDepartments = async () => {
                const snapshot = await db.collection('departments').get();
                const deptList = [];
                snapshot.forEach(doc => {
                    deptList.push({ id: doc.id, ...doc.data() });
                });
                setDepartments(deptList);
            };

            const loadEmployees = async () => {
                const snapshot = await db.collection('employees').get();
                const empList = [];
                snapshot.forEach(doc => {
                    empList.push({ id: doc.id, ...doc.data() });
                });
                setEmployees(empList);
            };

            const handleAddDepartment = async () => {
                if (!newDepartment.name) {
                    alert('부서 이름을 입력해주세요.');
                    return;
                }

                try {
                    let deptId;
                    const deptData = {
                        name: newDepartment.name,
                        description: newDepartment.description,
                        headId: newDepartment.headId || null,
                        memberIds: newDepartment.memberIds || []
                    };

                    if (editingDept) {
                        // 부서 수정
                        await db.collection('departments').doc(editingDept.id).update({
                            ...deptData,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        deptId = editingDept.id;

                        // 기존 부서원들의 departmentId 제거
                        const oldMembers = await db.collection('employees')
                            .where('departmentId', '==', deptId)
                            .get();

                        const batch1 = db.batch();
                        oldMembers.forEach(doc => {
                            batch1.update(doc.ref, { departmentId: null });
                        });
                        await batch1.commit();

                        alert('부서가 수정되었습니다.');
                    } else {
                        // 부서 추가
                        const docRef = await db.collection('departments').add({
                            ...deptData,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        deptId = docRef.id;
                        alert('부서가 추가되었습니다.');
                    }

                    // 선택된 사원들과 팀장의 departmentId 업데이트
                    const allMemberIds = [...(newDepartment.memberIds || [])];
                    // 팀장이 있고 memberIds에 없으면 추가
                    if (newDepartment.headId && !allMemberIds.includes(newDepartment.headId)) {
                        allMemberIds.push(newDepartment.headId);
                    }

                    if (allMemberIds.length > 0) {
                        const batch2 = db.batch();
                        allMemberIds.forEach(empId => {
                            const empRef = db.collection('employees').doc(empId);
                            batch2.update(empRef, { departmentId: deptId });
                        });
                        await batch2.commit();
                    }

                    setShowAddModal(false);
                    setEditingDept(null);
                    setNewDepartment({ name: '', description: '', headId: '', memberIds: [] });
                    loadDepartments();
                    loadEmployees();
                } catch (error) {
                    alert('작업 실패: ' + error.message);
                }
            };

            const handleDeleteDepartment = async (deptId) => {
                if (!confirm('이 부서를 삭제하시겠습니까?\n소속 사원들의 부서 정보도 제거됩니다.')) return;

                try {
                    // 해당 부서 소속 사원들의 부서 정보 제거
                    const empSnapshot = await db.collection('employees')
                        .where('departmentId', '==', deptId)
                        .get();

                    const batch = db.batch();
                    empSnapshot.forEach(doc => {
                        batch.update(doc.ref, { departmentId: null });
                    });
                    await batch.commit();

                    // 부서 삭제
                    await db.collection('departments').doc(deptId).delete();
                    alert('부서가 삭제되었습니다.');
                    loadDepartments();
                    loadEmployees();
                } catch (error) {
                    alert('삭제 실패: ' + error.message);
                }
            };

            const handleEditDepartment = (dept) => {
                const members = getDepartmentMembers(dept.id);
                setEditingDept(dept);
                setNewDepartment({
                    name: dept.name,
                    description: dept.description || '',
                    headId: dept.headId || '',
                    memberIds: members.map(m => m.id)
                });
                setShowAddModal(true);
            };

            const getDepartmentMembers = (deptId) => {
                return employees.filter(emp => emp.departmentId === deptId);
            };

            const getEmployeeName = (empId) => {
                const emp = employees.find(e => e.id === empId);
                return emp ? emp.name : '-';
            };

            const exportToExcel = () => {
                const data = departments.map((dept, index) => {
                    const members = getDepartmentMembers(dept.id);
                    return {
                        '번호': index + 1,
                        '부서명': dept.name,
                        '설명': dept.description || '-',
                        '팀장': getEmployeeName(dept.headId),
                        '인원': members.length,
                        '구성원': members.map(m => m.name).join(', ') || '-'
                    };
                });

                const ws = XLSX.utils.json_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "부서 목록");

                const today = new Date().toISOString().split('T')[0];
                XLSX.writeFile(wb, `부서목록_${today}.xlsx`);
            };

            return (
                <div className="content-card">
                    <div className="flex-between mb-20">
                        <h2>조직 구성도</h2>
                        {canEdit && (
                            <div style={{display: 'flex', gap: '10px'}}>
                                <button className="register-btn" onClick={exportToExcel}>
                                    엑셀 다운로드
                                </button>
                                <button className="register-btn" onClick={() => {
                                    setEditingDept(null);
                                    setNewDepartment({ name: '', description: '', headId: '' });
                                    setShowAddModal(true);
                                }}>
                                    부서 추가
                                </button>
                            </div>
                        )}
                    </div>

                    <div className="department-grid">
                        {departments.map(dept => {
                            const members = getDepartmentMembers(dept.id);
                            return (
                                <div key={dept.id} className="department-card">
                                    <div className="flex-between">
                                        <h4>{dept.name}</h4>
                                        {canEdit && (
                                            <div style={{display: 'flex', gap: '5px'}}>
                                                <button
                                                    onClick={() => handleEditDepartment(dept)}
                                                    style={{
                                                        padding: '4px 8px',
                                                        background: '#2196F3',
                                                        color: 'white',
                                                        border: 'none',
                                                        borderRadius: '4px',
                                                        cursor: 'pointer',
                                                        fontSize: '12px'
                                                    }}
                                                >
                                                    수정
                                                </button>
                                                <button
                                                    onClick={() => handleDeleteDepartment(dept.id)}
                                                    style={{
                                                        padding: '4px 8px',
                                                        background: '#ff4444',
                                                        color: 'white',
                                                        border: 'none',
                                                        borderRadius: '4px',
                                                        cursor: 'pointer',
                                                        fontSize: '12px'
                                                    }}
                                                >
                                                    삭제
                                                </button>
                                            </div>
                                        )}
                                    </div>
                                    {dept.description && (
                                        <div style={{color: '#666', fontSize: '13px', marginBottom: '10px'}}>
                                            {dept.description}
                                        </div>
                                    )}
                                    <div style={{marginTop: '10px', paddingTop: '10px', borderTop: '1px solid #eee'}}>
                                        <div style={{fontSize: '13px', color: '#666', marginBottom: '5px'}}>
                                            👤 팀장: {getEmployeeName(dept.headId)}
                                        </div>
                                        <div className="members-count">
                                            👥 인원: {members.length}명
                                        </div>
                                        {members.length > 0 && (
                                            <div style={{fontSize: '12px', color: '#999', marginTop: '5px'}}>
                                                {members.slice(0, 3).map(m => m.name).join(', ')}
                                                {members.length > 3 && ` 외 ${members.length - 3}명`}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            );
                        })}
                    </div>

                    {departments.length === 0 && (
                        <div className="empty-state">
                            <div className="empty-state-icon">🏢</div>
                            <div>등록된 부서가 없습니다</div>
                        </div>
                    )}

                    {showAddModal && (
                        <div className="modal" onClick={() => setShowAddModal(false)}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                                <h3>{editingDept ? '부서 수정' : '부서 추가'}</h3>
                                <div className="form-group">
                                    <label>부서명 *</label>
                                    <input
                                        type="text"
                                        value={newDepartment.name}
                                        onChange={(e) => setNewDepartment({...newDepartment, name: e.target.value})}
                                        placeholder="예: 개발팀"
                                    />
                                </div>
                                <div className="form-group">
                                    <label>설명</label>
                                    <textarea
                                        value={newDepartment.description}
                                        onChange={(e) => setNewDepartment({...newDepartment, description: e.target.value})}
                                        placeholder="부서 설명을 입력하세요"
                                    />
                                </div>
                                <div className="form-group">
                                    <label>팀장</label>
                                    <select
                                        value={newDepartment.headId}
                                        onChange={(e) => setNewDepartment({...newDepartment, headId: e.target.value})}
                                    >
                                        <option value="">선택 안함</option>
                                        {employees.map(emp => (
                                            <option key={emp.id} value={emp.id}>{emp.name}</option>
                                        ))}
                                    </select>
                                </div>
                                <div className="form-group">
                                    <label>팀 인원</label>
                                    <div style={{
                                        border: '1px solid #ddd',
                                        borderRadius: '6px',
                                        padding: '10px',
                                        maxHeight: '200px',
                                        overflowY: 'auto'
                                    }}>
                                        {employees
                                            .filter(emp => {
                                                // 현재 부서의 팀장 제외
                                                if (emp.id === newDepartment.headId) return false;
                                                // 다른 부서의 팀장인 경우 제외
                                                const isHeadOfOtherDept = departments.some(dept =>
                                                    dept.id !== editingDept?.id && dept.headId === emp.id
                                                );
                                                return !isHeadOfOtherDept;
                                            })
                                            .map(emp => (
                                            <label key={emp.id} style={{
                                                display: 'flex',
                                                alignItems: 'center',
                                                padding: '8px',
                                                cursor: 'pointer',
                                                borderRadius: '4px',
                                                transition: 'background 0.2s'
                                            }}
                                            onMouseEnter={(e) => e.currentTarget.style.background = '#f5f5f5'}
                                            onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}
                                            >
                                                <input
                                                    type="checkbox"
                                                    checked={(newDepartment.memberIds || []).includes(emp.id)}
                                                    onChange={(e) => {
                                                        const memberIds = e.target.checked
                                                            ? [...(newDepartment.memberIds || []), emp.id]
                                                            : (newDepartment.memberIds || []).filter(id => id !== emp.id);
                                                        setNewDepartment({...newDepartment, memberIds});
                                                    }}
                                                    style={{width: '30px', display: 'inline-flex', justifyContent: 'center',  flexShrink: 0}}
                                                />
                                                <span>{emp.name}</span>
                                            </label>
                                        ))}
                                    </div>
                                    <div style={{fontSize: '12px', color: '#666', marginTop: '5px'}}>
                                        {(newDepartment.memberIds || []).length}명 선택됨
                                    </div>
                                </div>
                                <div className="modal-buttons">
                                    <button
                                        className="btn-secondary"
                                        onClick={() => {
                                            setShowAddModal(false);
                                            setEditingDept(null);
                                        }}
                                    >
                                        취소
                                    </button>
                                    <button className="btn-primary" onClick={handleAddDepartment}>
                                        {editingDept ? '수정' : '추가'}
                                    </button>
                            </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // 로그인 컴포넌트
        function Login({ onLogin }) {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [success, setSuccess] = useState('');
            const [showResetPassword, setShowResetPassword] = useState(false);
            const [resetEmail, setResetEmail] = useState('');
            const [rememberEmail, setRememberEmail] = useState(false);

            // 컴포넌트 마운트 시 저장된 이메일 불러오기
            useEffect(() => {
                const savedEmail = localStorage.getItem('savedEmail');
                if (savedEmail) {
                    setEmail(savedEmail);
                    setRememberEmail(true);
                }
            }, []);

            const handleLogin = async (e) => {
                e.preventDefault();
                setError('');
                try {
                    // 아이디 저장 체크 시 localStorage에 저장
                    if (rememberEmail) {
                        localStorage.setItem('savedEmail', email);
                    } else {
                        localStorage.removeItem('savedEmail');
                    }

                    await auth.signInWithEmailAndPassword(email, password);
                } catch (err) {
                    setError('로그인 실패: ' + err.message);
                }
            };

            const handleResetPassword = async (e) => {
                e.preventDefault();
                setError('');
                setSuccess('');

                if (!resetEmail) {
                    setError('이메일을 입력해주세요.');
                    return;
                }

                try {
                    await auth.sendPasswordResetEmail(resetEmail);
                    setSuccess('비밀번호 재설정 이메일이 발송되었습니다. 이메일을 확인해주세요.');
                    setResetEmail('');
                    setTimeout(() => {
                        setShowResetPassword(false);
                        setSuccess('');
                    }, 3000);
                } catch (err) {
                    if (err.code === 'auth/user-not-found') {
                        setError('등록되지 않은 이메일입니다.');
                    } else if (err.code === 'auth/invalid-email') {
                        setError('유효하지 않은 이메일 형식입니다.');
                    } else {
                        setError('비밀번호 재설정 실패: ' + err.message);
                    }
                }
            };

            if (showResetPassword) {
                return (
                    <div className="login-container">
                        <h2>비밀번호 재설정</h2>
                        <form onSubmit={handleResetPassword}>
                            <div className="form-group">
                                <label>이메일</label>
                                <input
                                    type="email"
                                    value={resetEmail}
                                    onChange={(e) => setResetEmail(e.target.value)}
                                    placeholder="가입한 이메일을 입력하세요"
                                    required
                                />
                            </div>
                            <button type="submit" className="btn-primary">재설정 이메일 보내기</button>
                            <button
                                type="button"
                                className="btn-primary"
                                onClick={() => {
                                    setShowResetPassword(false);
                                    setError('');
                                    setSuccess('');
                                }}
                                style={{
                                    background: '#666',
                                    marginTop: '10px'
                                }}
                            >
                                로그인으로 돌아가기
                            </button>
                            {error && <div className="error-message">{error}</div>}
                            {success && <div style={{color: '#4CAF50', fontSize: '14px', marginTop: '10px', textAlign: 'center'}}>{success}</div>}
                        </form>
                    </div>
                );
            }

            return (
                <div className="login-container">
                    <h2>스케쥴 및 연차 관리</h2>
                    <form onSubmit={handleLogin}>
                        <div className="form-group">
                            <label>이메일</label>
                            <input
                                type="email"
                                value={email}
                                onChange={(e) => setEmail(e.target.value)}
                                required
                            />
                        </div>
                        <div className="form-group">
                            <label>비밀번호</label>
                            <input
                                type="password"
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                                required
                            />
                        </div>
                        <div className="form-group" style={{marginBottom: '10px'}}>
                            <label style={{
                                display: 'flex',
                                alignItems: 'center',
                                cursor: 'pointer',
                                fontSize: '14px',
                                fontWeight: 'normal'
                            }}>
                                <input
                                    type="checkbox"
                                    checked={rememberEmail}
                                    onChange={(e) => setRememberEmail(e.target.checked)}
                                    style={{
                                        margin: '0 6px 0 0',
                                        cursor: 'pointer',
                                        width: '16px',
                                        height: '16px'
                                    }}
                                />
                                아이디 저장
                            </label>
                        </div>
                        <button type="submit" className="btn-primary">로그인</button>
                        {error && <div className="error-message">{error}</div>}
                        <div style={{
                            textAlign: 'center',
                            marginTop: '15px'
                        }}>
                            <button
                                type="button"
                                onClick={() => {
                                    setShowResetPassword(true);
                                    setError('');
                                }}
                                style={{
                                    background: 'none',
                                    border: 'none',
                                    color: '#4CAF50',
                                    cursor: 'pointer',
                                    fontSize: '14px',
                                    textDecoration: 'underline'
                                }}
                            >
                                비밀번호를 잊으셨나요?
                            </button>
                        </div>
                    </form>
                </div>
            );
        }

        // 스케줄 선택 모달
        function ScheduleModal({ date, currentSchedule, onSave, onClose, userName }) {
            const [scheduleType, setScheduleType] = useState(currentSchedule || '출근');

            const handleSave = () => {
                onSave(date, scheduleType);
            };

            return (
                <div className="modal" onClick={onClose}>
                    <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                        <h3>{date} 일정 등록</h3>
                        <div className="form-group">
                            <label>일정 유형</label>
                            <select
                                value={scheduleType}
                                onChange={(e) => setScheduleType(e.target.value)}
                                style={{
                                    width: '100%',
                                    padding: '12px',
                                    border: '1px solid #ddd',
                                    borderRadius: '6px',
                                    fontSize: '14px'
                                }}
                            >
                                <option value="출근">출근</option>
                                <option value="재택">재택</option>
                                <option value="연차">연차</option>
                                <option value="반차(오전)">반차(오전)</option>
                                <option value="반차(오후)">반차(오후)</option>
                                <option value="여름휴가">여름휴가</option>
                                <option value="겨울휴가">겨울휴가</option>
                            </select>
                        </div>
                        <div className="modal-buttons">
                            <button className="btn-secondary" onClick={onClose}>취소</button>
                            <button className="btn-primary" onClick={handleSave}>저장</button>
                        </div>
                    </div>
                </div>
            );
        }

        // 캘린더 컴포넌트
        function Calendar({ user, employees }) {
            const [currentDate, setCurrentDate] = useState(new Date());
            const [schedules, setSchedules] = useState({});
            const [selectedDate, setSelectedDate] = useState(null);
            const [selectedDaySchedules, setSelectedDaySchedules] = useState([]);
            const [showScheduleModal, setShowScheduleModal] = useState(false);
            const [employeeInfo, setEmployeeInfo] = useState(null);
            const [filterEmployee, setFilterEmployee] = useState('all');
            const [filterLeaveType, setFilterLeaveType] = useState('all');
            const [sharedEvents, setSharedEvents] = useState({});
            const [showSharedEventModal, setShowSharedEventModal] = useState(false);

            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();

            useEffect(() => {
                loadEmployeeInfo();
                loadSchedules();
                loadSharedEvents();
            }, [year, month]);

            const loadEmployeeInfo = async () => {
                const doc = await db.collection('employees').doc(user.uid).get();
                if (doc.exists) {
                    setEmployeeInfo(doc.data());
                }
            };

            useEffect(() => {
                // 오늘 날짜의 일정을 자동으로 표시
                const today = new Date();
                const todayStr = formatDate(today.getFullYear(), today.getMonth(), today.getDate());
                setSelectedDate(todayStr);
            }, [schedules]);

            useEffect(() => {
                // selectedDate가 변경될 때마다 해당 날짜의 일정 표시
                if (selectedDate && schedules[selectedDate]) {
                    const rawDaySchedules = schedules[selectedDate];
                    const filteredDaySchedules = rawDaySchedules.filter(s => s.approvalStatus !== 'cancelled' && s.approvalStatus !== 'deletion-pending');
                    setSelectedDaySchedules(filteredDaySchedules);
                } else if (selectedDate) {
                    setSelectedDaySchedules([]);
                }
            }, [selectedDate, schedules]);

            const loadSchedules = async () => {
                const startDate = formatDate(year, month, 1);
                const endDate = formatDate(year, month, getDaysInMonth(year, month));

                const snapshot = await db.collection('schedules')
                    .where('date', '>=', startDate)
                    .where('date', '<=', endDate)
                    .get();

                const scheduleData = {};
                snapshot.forEach(doc => {
                    const data = doc.data();
                    if (!scheduleData[data.date]) {
                        scheduleData[data.date] = [];
                    }
                    scheduleData[data.date].push({
                        id: doc.id,
                        ...data
                    });
                });

                setSchedules(scheduleData);
            };

            const loadSharedEvents = async () => {
                const startDate = formatDate(year, month, 1);
                const endDate = formatDate(year, month, getDaysInMonth(year, month));

                const snapshot = await db.collection('sharedEvents')
                    .where('date', '>=', startDate)
                    .where('date', '<=', endDate)
                    .get();

                const eventData = {};
                snapshot.forEach(doc => {
                    const data = doc.data();
                    if (!eventData[data.date]) {
                        eventData[data.date] = [];
                    }
                    eventData[data.date].push({
                        id: doc.id,
                        ...data
                    });
                });

                setSharedEvents(eventData);
            };

            const handlePrevMonth = () => {
                setCurrentDate(new Date(year, month - 1));
            };

            const handleNextMonth = () => {
                setCurrentDate(new Date(year, month + 1));
            };

            const handleDateClick = (day) => {
                const dateStr = formatDate(year, month, day);
                setSelectedDate(dateStr);
                setShowScheduleModal(true);
            };

                        const handleSaveSchedule = async (date, type) => {
                const scheduleRef = db.collection('schedules');

                // 기존 스케줄 확인
                const existingSchedule = await scheduleRef
                    .where('userId', '==', user.uid)
                    .where('date', '==', date)
                    .get();

                // 연차 관련 타입인지 확인
                const isLeaveType = ['연차', '반차(오전)', '반차(오후)', '여름휴가', '겨울휴가'].includes(type);
                // 승인자는 자동 승인, 일반 사원은 승인 대기
                const approvalStatus = isLeaveType ? (employeeInfo?.isApprover ? 'approved' : 'pending') : null;

                let oldType = null;
                if (!existingSchedule.empty) {
                    oldType = existingSchedule.docs[0].data().type;
                    // 업데이트
                    const docId = existingSchedule.docs[0].id;
                    const updateData = {
                        type: type,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    if (isLeaveType) {
                        // 연차/반차/휴가 타입인 경우 승인 상태 설정
                        updateData.approvalStatus = approvalStatus;
                    } else {
                        // 일반 스케줄(출근/재택 등)로 다시 등록하는 경우
                        // 이전에 남아있던 cancelled / deletion-pending 상태를 초기화
                        updateData.approvalStatus = null;
                    }
                    await scheduleRef.doc(docId).update(updateData);
                } else {
                    // 새로 생성
                    const newScheduleData = {
                        userId: user.uid,
                        userName: user.displayName || user.email,
                        date: date,
                        type: type,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    if (isLeaveType) {
                        newScheduleData.approvalStatus = approvalStatus;
                    }
                    await scheduleRef.add(newScheduleData);
                }

                // 기존 연차 내역이 있었다면 삭제
                if (oldType && (oldType === '연차' || oldType === '반차(오전)' || oldType === '반차(오후)' || oldType === '여름휴가' || oldType === '겨울휴가')) {
                    const oldLeaveUsage = await db.collection('leaveUsage')
                        .where('userId', '==', user.uid)
                        .where('date', '==', date)
                        .where('type', '==', oldType)
                        .get();

                    oldLeaveUsage.forEach(async (doc) => {
                        await doc.ref.update({
                            approvalStatus: 'cancelled',
                            cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    });
                }

                // 새로운 타입이 연차인 경우 연차 사용 기록 추가
                if (type === '연차' || type === '반차(오전)' || type === '반차(오후)' || type === '여름휴가' || type === '겨울휴가') {
                    let leaveAmount = 0;
                    if (type === '연차') {
                        leaveAmount = 1;
                    } else if (type === '반차(오전)' || type === '반차(오후)') {
                        leaveAmount = 0.5;
                    } else if (type === '여름휴가' || type === '겨울휴가') {
                        leaveAmount = 0;
                    }

                    await db.collection('leaveUsage').add({
                        userId: user.uid,
                        date: date,
                        type: type,
                        amount: leaveAmount,
                        approvalStatus: approvalStatus,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }

                setShowScheduleModal(false);
                loadSchedules();
            };

            const handleDeleteSchedule = async (scheduleId, scheduleDate, scheduleType) => {
                try {
                    // 스케줄 정보 가져오기
                    const scheduleDoc = await db.collection('schedules').doc(scheduleId).get();
                    const scheduleData = scheduleDoc.data();
                    const groupId = scheduleData.groupId;

                    // groupId가 있으면 연결된 모든 일정 정보 가져오기
                    let groupInfo = null;
                    if (groupId) {
                        const leaveUsageSnapshot = await db.collection('leaveUsage')
                            .where('userId', '==', user.uid)
                            .where('groupId', '==', groupId)
                            .get();

                        if (!leaveUsageSnapshot.empty) {
                            const firstDoc = leaveUsageSnapshot.docs[0].data();
                            groupInfo = {
                                startDate: firstDoc.startDate,
                                endDate: firstDoc.endDate,
                                totalDays: firstDoc.totalDays
                            };
                        }
                    }

                    // 연차 관련 일정인지 확인
                    const isLeaveType = ['연차', '반차(오전)', '반차(오후)', '여름휴가', '겨울휴가'].includes(scheduleType);

                    if (isLeaveType) {
                        const isApprover = employeeInfo?.isApprover;

                        if (scheduleData.approvalStatus === 'approved') {
                            if (isApprover) {
                                // 승인자는 즉시 취소
                                const confirmMsg = groupInfo
                                    ? `${groupInfo.startDate} ~ ${groupInfo.endDate} (${groupInfo.totalDays}일) 연차를 모두 취소하시겠습니까?`
                                    : '이 연차를 취소하시겠습니까?';
                                if (!confirm(confirmMsg)) return;

                                // groupId가 있으면 그룹 전체 취소, 없으면 단일 일정만 취소
                                if (groupId) {
                                    // 같은 그룹의 모든 스케줄 취소
                                    const groupSchedulesSnapshot = await db.collection('schedules')
                                        .where('userId', '==', user.uid)
                                        .where('groupId', '==', groupId)
                                        .get();

                                    groupSchedulesSnapshot.forEach(async (doc) => {
                                        await doc.ref.update({
                                            approvalStatus: 'cancelled',
                                            cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                        });
                                    });

                                    // 같은 그룹의 모든 leaveUsage 취소
                                    const leaveUsageSnapshot = await db.collection('leaveUsage')
                                        .where('userId', '==', user.uid)
                                        .where('groupId', '==', groupId)
                                        .get();

                                    leaveUsageSnapshot.forEach(async (doc) => {
                                        await doc.ref.update({
                                            approvalStatus: 'cancelled',
                                            cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                        });
                                    });
                                } else {
                                    // 단일 일정만 취소
                                    await db.collection('schedules').doc(scheduleId).update({
                                        approvalStatus: 'cancelled',
                                        cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                    });

                                    const leaveUsageSnapshot = await db.collection('leaveUsage')
                                        .where('userId', '==', user.uid)
                                        .where('date', '==', scheduleDate)
                                        .where('type', '==', scheduleType)
                                        .get();

                                    leaveUsageSnapshot.forEach(async (doc) => {
                                        await doc.ref.update({
                                            approvalStatus: 'cancelled',
                                            cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                        });
                                    });
                                }

                                alert('연차가 취소되었습니다.');
                            } else {
                                // 일반 사원은 취소 승인 요청
                                const confirmMsg = groupInfo
                                    ? `승인 완료된 연차입니다. ${groupInfo.startDate} ~ ${groupInfo.endDate} (${groupInfo.totalDays}일) 연차의 취소 승인을 요청하시겠습니까?`
                                    : '승인 완료된 연차입니다. 취소 승인을 요청하시겠습니까?';
                                if (!confirm(confirmMsg)) return;

                                if (groupId) {
                                    // 같은 그룹의 모든 스케줄 취소 대기
                                    const groupSchedulesSnapshot = await db.collection('schedules')
                                        .where('userId', '==', user.uid)
                                        .where('groupId', '==', groupId)
                                        .get();

                                    groupSchedulesSnapshot.forEach(async (doc) => {
                                        await doc.ref.update({
                                            approvalStatus: 'deletion-pending',
                                            deletionRequestedAt: firebase.firestore.FieldValue.serverTimestamp()
                                        });
                                    });

                                    // 같은 그룹의 모든 leaveUsage 취소 대기
                                    const leaveUsageSnapshot = await db.collection('leaveUsage')
                                        .where('userId', '==', user.uid)
                                        .where('groupId', '==', groupId)
                                        .get();

                                    leaveUsageSnapshot.forEach(async (doc) => {
                                        await doc.ref.update({
                                            approvalStatus: 'deletion-pending',
                                            deletionRequestedAt: firebase.firestore.FieldValue.serverTimestamp()
                                        });
                                    });

                                    // 승인자에게 Slack 알림
                                    if (employeeInfo?.approver) {
                                        const slackMessage = `${employeeInfo.name}님이 연차 취소 승인 요청을 보냈습니다.\n날짜: ${groupInfo.startDate} ~ ${groupInfo.endDate} (${groupInfo.totalDays}일)\n유형: ${scheduleType}`;
                                        await sendSlackNotification(employeeInfo.approver, slackMessage, 'cancellation');
                                    }
                                } else {
                                    // 단일 일정만 취소 대기
                                    await db.collection('schedules').doc(scheduleId).update({
                                        approvalStatus: 'deletion-pending',
                                        deletionRequestedAt: firebase.firestore.FieldValue.serverTimestamp()
                                    });

                                    const leaveUsageSnapshot = await db.collection('leaveUsage')
                                        .where('userId', '==', user.uid)
                                        .where('date', '==', scheduleDate)
                                        .where('type', '==', scheduleType)
                                        .get();

                                    leaveUsageSnapshot.forEach(async (doc) => {
                                        await doc.ref.update({
                                            approvalStatus: 'deletion-pending',
                                            deletionRequestedAt: firebase.firestore.FieldValue.serverTimestamp()
                                        });
                                    });

                                    // 승인자에게 Slack 알림
                                    if (employeeInfo?.approver) {
                                        const slackMessage = `${employeeInfo.name}님이 연차 취소 승인 요청을 보냈습니다.\n날짜: ${scheduleDate}\n유형: ${scheduleType}`;
                                        await sendSlackNotification(employeeInfo.approver, slackMessage, 'cancellation');
                                    }
                                }

                                alert('취소 승인 요청이 완료되었습니다.');
                            }
                        } else {
                            // 승인대기 또는 기타 상태는 즉시 취소
                            const confirmMsg = groupInfo
                                ? `${groupInfo.startDate} ~ ${groupInfo.endDate} (${groupInfo.totalDays}일) 일정을 모두 취소하시겠습니까?`
                                : '이 일정을 취소하시겠습니까?';
                            if (!confirm(confirmMsg)) return;

                            if (groupId) {
                                // 같은 그룹의 모든 스케줄 취소
                                const groupSchedulesSnapshot = await db.collection('schedules')
                                    .where('userId', '==', user.uid)
                                    .where('groupId', '==', groupId)
                                    .get();

                                groupSchedulesSnapshot.forEach(async (doc) => {
                                    await doc.ref.update({
                                        approvalStatus: 'cancelled',
                                        cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                    });
                                });

                                // 같은 그룹의 모든 leaveUsage 취소
                                const leaveUsageSnapshot = await db.collection('leaveUsage')
                                    .where('userId', '==', user.uid)
                                    .where('groupId', '==', groupId)
                                    .get();

                                leaveUsageSnapshot.forEach(async (doc) => {
                                    await doc.ref.update({
                                        approvalStatus: 'cancelled',
                                        cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                    });
                                });
                            } else {
                                // 단일 일정만 취소
                                await db.collection('schedules').doc(scheduleId).update({
                                    approvalStatus: 'cancelled',
                                    cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                });

                                const leaveUsageSnapshot = await db.collection('leaveUsage')
                                    .where('userId', '==', user.uid)
                                    .where('date', '==', scheduleDate)
                                    .where('type', '==', scheduleType)
                                    .get();

                                leaveUsageSnapshot.forEach(async (doc) => {
                                    await doc.ref.update({
                                        approvalStatus: 'cancelled',
                                        cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                    });
                                });
                            }

                            alert('일정이 취소되었습니다.');
                        }
                    } else {
                        // 일반 일정은 바로 취소
                        if (!confirm('이 일정을 취소하시겠습니까?')) return;

                        await db.collection('schedules').doc(scheduleId).update({
                            approvalStatus: 'cancelled',
                            cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }

                    loadSchedules();
                } catch (error) {
                    alert('취소 실패: ' + error.message);
                }
            };

            const handleSaveSharedEvent = async (date, title) => {
                try {
                    await db.collection('sharedEvents').add({
                        date: date,
                        title: title,
                        createdBy: user.uid,
                        createdByName: user.displayName || user.email,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    alert('공유일정이 등록되었습니다.');
                    setShowSharedEventModal(false);
                    loadSharedEvents();
                } catch (error) {
                    alert('등록 실패: ' + error.message);
                }
            };

            const handleDeleteSharedEvent = async (eventId) => {
                if (!confirm('이 공유일정을 삭제하시겠습니까?')) return;

                try {
                    await db.collection('sharedEvents').doc(eventId).delete();
                    alert('공유일정이 삭제되었습니다.');
                    loadSharedEvents();
                } catch (error) {
                    alert('삭제 실패: ' + error.message);
                }
            };

            const renderCalendar = () => {
                const daysInMonth = getDaysInMonth(year, month);
                const firstDay = getFirstDayOfMonth(year, month);
                const weeks = [];
                let days = [];

                // 이전 달의 빈 칸
                for (let i = 0; i < firstDay; i++) {
                    days.push(<td key={`empty-${i}`} className="other-month"></td>);
                }

                // 현재 달의 날짜
                const today = new Date();
                const isCurrentMonth = today.getFullYear() === year && today.getMonth() === month;

                for (let day = 1; day <= daysInMonth; day++) {
                    const dateStr = formatDate(year, month, day);
                    const rawDaySchedules = schedules[dateStr] || [];
                    let daySchedules = rawDaySchedules.filter(s => s.approvalStatus !== 'cancelled' && s.approvalStatus !== 'deletion-pending');

                    // 필터 적용
                    if (filterEmployee !== 'all') {
                        daySchedules = daySchedules.filter(s => s.userId === filterEmployee);
                    }
                    if (filterLeaveType !== 'all') {
                        daySchedules = daySchedules.filter(s => s.type === filterLeaveType);
                    }

                    const isToday = isCurrentMonth && today.getDate() === day;
                    const isHoliday = holidays[dateStr];

                    // 요일 계산 (0: 일요일, 6: 토요일)
                    const dayOfWeek = new Date(year, month, day).getDay();
                    const isSunday = dayOfWeek === 0;
                    const isSaturday = dayOfWeek === 6;

                    days.push(
                        <td
                            key={day}
                            className={`${isToday ? 'today' : ''} ${isHoliday ? 'holiday' : ''} ${isSunday ? 'sunday' : ''} ${isSaturday ? 'saturday' : ''}`}
                            onClick={() => handleDateClick(day)}
                        >
                            <div className="date-number">{day}</div>
                            {isHoliday && <div className="holiday-name">{isHoliday}</div>}
                            
                            {/* 공유일정 최상단 표시 */}
                            {sharedEvents[dateStr] && sharedEvents[dateStr].map((event, idx) => (
                                <div
                                    key={`shared-${idx}`}
                                    className="schedule-item schedule-shared"
                                    onClick={(e) => e.stopPropagation()}
                                    style={{
                                        background: '#9C27B0',
                                        color: 'white',
                                        fontWeight: 'bold'
                                    }}
                                >
                                    <span>📌 {event.title}</span>
                                    {(employeeInfo?.isSubAdmin || employeeInfo?.isApprover) && (
                                        <button
                                            className="delete-schedule-btn"
                                            onClick={(e) => {
                                                e.stopPropagation();
                                                handleDeleteSharedEvent(event.id);
                                            }}
                                        >
                                            ✕
                                        </button>
                                    )}
                                </div>
                            ))}
                            
                            {/* 개인 일정 표시 */}
                            {daySchedules.map((schedule, idx) => {
                                // 연차 관련 일정인지 확인
                                const isLeaveType = ['연차', '반차(오전)', '반차(오후)', '여름휴가', '겨울휴가'].includes(schedule.type);
                                const statusText = schedule.approvalStatus === 'approved' ? ' (승인완료)' :
                                                  schedule.approvalStatus === 'rejected' ? ' (반려)' :
                                                  schedule.approvalStatus === 'pending' ? ' (승인대기)' :
                                                  schedule.approvalStatus === 'deletion-pending' ? ' (취소대기)' :
                                                  schedule.approvalStatus === 'cancelled' ? ' (취소됨)' : '';

                                return (
                                    <div
                                        key={idx}
                                        className={`schedule-item schedule-${schedule.type.replace(/[()]/g, '')}`}
                                        onClick={(e) => e.stopPropagation()}
                                    >
                                        <span>{schedule.userName.split('@')[0]} - {schedule.type}{isLeaveType ? statusText : ''}</span>
                                        {schedule.userId === user.uid && (() => {
                                            // 일정의 월과 현재 보고있는 캘린더의 월 비교
                                            const scheduleMonth = schedule.date.slice(0, 7); // YYYY-MM
                                            const currentCalendarMonth = `${year}-${String(month + 1).padStart(2, '0')}`; // YYYY-MM
                                            const todayMonth = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}`;
                                            
                                            // 현재 보고있는 캘린더가 이번 달이거나 미래 달인 경우에만 취소 버튼 표시
                                            if (currentCalendarMonth >= todayMonth) {
                                                return (
                                                    <button
                                                        className="delete-schedule-btn"
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            handleDeleteSchedule(schedule.id, schedule.date, schedule.type);
                                                        }}
                                                    >
                                                        ✕
                                                    </button>
                                                );
                                            }
                                            return null;
                                        })()}
                                    </div>
                                );
                            })}
                        </td>
                    );

                    if (days.length === 7) {
                        weeks.push(<tr key={weeks.length}>{days}</tr>);
                        days = [];
                    }
                }

                // 남은 빈 칸
                if (days.length > 0) {
                    while (days.length < 7) {
                        days.push(<td key={`empty-end-${days.length}`} className="other-month"></td>);
                    }
                    weeks.push(<tr key={weeks.length}>{days}</tr>);
                }

                return weeks;
            };

            const monthNames = ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'];

            return (
                <div className="content-card">
                    <div className="calendar-header">
                        <h2>{year}년 {monthNames[month]}</h2>
                        <div className="calendar-nav">
                            <button 
                                className="nav-btn" 
                                onClick={() => setShowSharedEventModal(true)}
                                style={{
                                    background: '#9C27B0',
                                    marginRight: '10px'
                                }}
                            >
                                공유일정등록
                            </button>
                            <button className="nav-btn" onClick={handlePrevMonth}>이전</button>
                            <button className="nav-btn" onClick={handleNextMonth}>다음</button>
                        </div>
                    </div>

                    <div className="search-filter-bar" style={{marginBottom: '20px'}}>
                        <select
                            className="filter-select"
                            value={filterEmployee}
                            onChange={(e) => setFilterEmployee(e.target.value)}
                        >
                            <option value="all">전체 사원</option>
                            {employees.map(emp => (
                                <option key={emp.id} value={emp.id}>{emp.name}</option>
                            ))}
                        </select>
                        <select
                            className="filter-select"
                            value={filterLeaveType}
                            onChange={(e) => setFilterLeaveType(e.target.value)}
                        >
                            <option value="all">전체 유형</option>
                            <option value="출근">출근</option>
                            <option value="재택">재택</option>
                            <option value="연차">연차</option>
                            <option value="반차(오전)">반차(오전)</option>
                            <option value="반차(오후)">반차(오후)</option>
                            <option value="병가">병가</option>
                            <option value="경조사">경조사</option>
                            <option value="공가">공가</option>
                            <option value="여름휴가">여름휴가</option>
                            <option value="겨울휴가">겨울휴가</option>
                        </select>
                    </div>

                    <div className="calendar">
                        <table>
                            <thead>
                                <tr>
                                    <th>일</th>
                                    <th>월</th>
                                    <th>화</th>
                                    <th>수</th>
                                <th>목</th>
                                <th>금</th>
                                <th>토</th>
                            </tr>
                        </thead>
                        <tbody>
                            {renderCalendar()}
                        </tbody>
                    </table>
                    </div>

                    {selectedDate && selectedDaySchedules.length > 0 && (
                        <div className="daily-schedules">
                            <h3>{selectedDate} 일정</h3>
                            <div className="daily-schedule-list">
                                {selectedDaySchedules.map((schedule, idx) => (
                                    <div key={idx} className={`daily-schedule-card ${schedule.type.replace(/[()]/g, '')}`}>
                                        <div className="name">{schedule.userName.split('@')[0]}</div>
                                        <div className="type">{schedule.type}</div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {showScheduleModal && selectedDate && (
                        <ScheduleModal
                            date={selectedDate}
                            currentSchedule={
                                selectedDaySchedules.find(s => s.userId === user.uid)?.type
                            }
                            onSave={handleSaveSchedule}
                            onClose={() => setShowScheduleModal(false)}
                            userName={user.displayName || user.email}
                        />
                    )}

                    {showSharedEventModal && (
                        <SharedEventModal
                            year={year}
                            month={month}
                            onSave={handleSaveSharedEvent}
                            onClose={() => setShowSharedEventModal(false)}
                        />
                    )}
                </div>
            );
        }

        // 공유일정 등록 모달 컴포넌트
        function SharedEventModal({ year, month, onSave, onClose }) {
            const [selectedDate, setSelectedDate] = useState('');
            const [title, setTitle] = useState('');

            const handleSave = () => {
                if (!selectedDate) {
                    alert('날짜를 선택해주세요.');
                    return;
                }
                if (!title.trim()) {
                    alert('일정 내용을 입력해주세요.');
                    return;
                }
                onSave(selectedDate, title);
            };

            // 해당 월의 일자 목록 생성
            const getDaysInMonth = (year, month) => {
                return new Date(year, month + 1, 0).getDate();
            };

            const daysInMonth = getDaysInMonth(year, month);
            const days = [];
            for (let i = 1; i <= daysInMonth; i++) {
                days.push(i);
            }

            return (
                <div className="modal" onClick={onClose}>
                    <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                        <h3>공유일정 등록</h3>
                        <div className="form-group">
                            <label>날짜 선택</label>
                            <select
                                value={selectedDate}
                                onChange={(e) => setSelectedDate(e.target.value)}
                                style={{
                                    width: '100%',
                                    padding: '10px',
                                    border: '1px solid #ddd',
                                    borderRadius: '4px',
                                    fontSize: '14px'
                                }}
                            >
                                <option value="">날짜를 선택하세요</option>
                                {days.map(day => {
                                    const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                                    return (
                                        <option key={day} value={dateStr}>
                                            {year}년 {month + 1}월 {day}일
                                        </option>
                                    );
                                })}
                            </select>
                        </div>
                        <div className="form-group">
                            <label>일정 내용</label>
                            <input
                                type="text"
                                value={title}
                                onChange={(e) => setTitle(e.target.value)}
                                placeholder="예: 전사 회식, 휴무일, 행사 등"
                                style={{
                                    width: '100%',
                                    padding: '10px',
                                    border: '1px solid #ddd',
                                    borderRadius: '4px',
                                    fontSize: '14px'
                                }}
                            />
                        </div>
                        <div className="modal-buttons">
                            <button className="btn-secondary" onClick={onClose}>
                                취소
                            </button>
                            <button 
                                className="btn-primary" 
                                onClick={handleSave}
                                style={{
                                    background: '#9C27B0'
                                }}
                            >
                                등록
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // 페이지네이션 컴포넌트
        function Pagination({ currentPage, totalPages, onPageChange }) {
            const pages = [];
            const maxVisible = 5;

            let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
            let endPage = Math.min(totalPages, startPage + maxVisible - 1);

            if (endPage - startPage < maxVisible - 1) {
                startPage = Math.max(1, endPage - maxVisible + 1);
            }

            for (let i = startPage; i <= endPage; i++) {
                pages.push(i);
            }

            return (
                <div style={{
                    display: 'flex',
                    justifyContent: 'center',
                    alignItems: 'center',
                    gap: '8px',
                    marginTop: '20px'
                }}>
                    <button
                        onClick={() => onPageChange(currentPage - 1)}
                        disabled={currentPage === 1}
                        style={{
                            padding: '8px 12px',
                            border: '1px solid #ddd',
                            borderRadius: '4px',
                            background: currentPage === 1 ? '#f5f5f5' : 'white',
                            cursor: currentPage === 1 ? 'not-allowed' : 'pointer'
                        }}
                    >
                        이전
                    </button>

                    {startPage > 1 && (
                        <>
                            <button
                                onClick={() => onPageChange(1)}
                                style={{
                                    padding: '8px 12px',
                                    border: '1px solid #ddd',
                                    borderRadius: '4px',
                                    background: 'white',
                                    cursor: 'pointer'
                                }}
                            >
                                1
                            </button>
                            {startPage > 2 && <span>...</span>}
                        </>
                    )}

                    {pages.map(page => (
                        <button
                            key={page}
                            onClick={() => onPageChange(page)}
                            style={{
                                padding: '8px 12px',
                                border: '1px solid #ddd',
                                borderRadius: '4px',
                                background: currentPage === page ? '#4CAF50' : 'white',
                                color: currentPage === page ? 'white' : 'black',
                                cursor: 'pointer',
                                fontWeight: currentPage === page ? '600' : 'normal'
                            }}
                        >
                            {page}
                        </button>
                    ))}

                    {endPage < totalPages && (
                        <>
                            {endPage < totalPages - 1 && <span>...</span>}
                            <button
                                onClick={() => onPageChange(totalPages)}
                                style={{
                                    padding: '8px 12px',
                                    border: '1px solid #ddd',
                                    borderRadius: '4px',
                                    background: 'white',
                                    cursor: 'pointer'
                                }}
                            >
                                {totalPages}
                            </button>
                        </>
                    )}

                    <button
                        onClick={() => onPageChange(currentPage + 1)}
                        disabled={currentPage === totalPages}
                        style={{
                            padding: '8px 12px',
                            border: '1px solid #ddd',
                            borderRadius: '4px',
                            background: currentPage === totalPages ? '#f5f5f5' : 'white',
                            cursor: currentPage === totalPages ? 'not-allowed' : 'pointer'
                        }}
                    >
                        다음
                    </button>
                </div>
            );
        }

        // 연차 관리 컴포넌트
        function AnnualLeave({ user }) {
            const [employeeInfo, setEmployeeInfo] = useState(null);
            const [leaveUsage, setLeaveUsage] = useState([]);
            const [showRegisterModal, setShowRegisterModal] = useState(false);
            const [leaveStartDate, setLeaveStartDate] = useState('');
            const [leaveEndDate, setLeaveEndDate] = useState('');
            const [leaveType, setLeaveType] = useState('연차');
            const [leaveNote, setLeaveNote] = useState('');
            const [attachedFiles, setAttachedFiles] = useState([]);
            const [uploading, setUploading] = useState(false);
            const [currentPage, setCurrentPage] = useState(1);
            const itemsPerPage = 10;

            useEffect(() => {
                loadEmployeeInfo();
                loadLeaveUsage();
            }, []);

            const loadEmployeeInfo = async () => {
                const doc = await db.collection('employees').doc(user.uid).get();
                if (doc.exists) {
                    setEmployeeInfo(doc.data());
                }
            };

            const loadLeaveUsage = async () => {
                try {
                    const snapshot = await db.collection('leaveUsage')
                        .where('userId', '==', user.uid)
                        .get();

                    const allUsage = [];
                    snapshot.forEach(doc => {
                        allUsage.push({ id: doc.id, ...doc.data() });
                    });

                    // groupId로 그룹핑
                    const groupedUsage = {};
                    const ungroupedUsage = [];

                    allUsage.forEach(item => {
                        if (item.groupId) {
                            if (!groupedUsage[item.groupId]) {
                                groupedUsage[item.groupId] = {
                                    id: item.groupId,
                                    ids: [item.id],
                                    userId: item.userId,
                                    startDate: item.startDate || item.date,
                                    endDate: item.endDate || item.date,
                                    date: item.startDate || item.date,
                                    type: item.type,
                                    amount: item.amount,
                                    totalDays: item.totalDays || 1,
                                    note: item.note,
                                    approvalStatus: item.approvalStatus,
                                    createdAt: item.createdAt,
                                    groupId: item.groupId,
                                    isGrouped: true
                                };
                            } else {
                                groupedUsage[item.groupId].ids.push(item.id);
                            }
                        } else {
                            // groupId가 없는 경우 (이전 데이터)
                            ungroupedUsage.push(item);
                        }
                    });

                    // 그룹화된 데이터와 그룹화되지 않은 데이터 합치기
                    const usage = [...Object.values(groupedUsage), ...ungroupedUsage];

                    // 날짜 기준으로 내림차순 정렬
                    usage.sort((a, b) => (b.startDate || b.date).localeCompare(a.startDate || a.date));

                    setLeaveUsage(usage);
                } catch (error) {
                    console.error('연차 내역 로드 실패:', error);
                }
            };

            const calculateTotalLeave = (joinDate) => {
                if (!joinDate) return 0;
                const join = new Date(joinDate);
                const now = new Date();
                const years = now.getFullYear() - join.getFullYear();

                // 1년 미만
                if (years < 1) {
                    const months = (now.getFullYear() - join.getFullYear()) * 12 + (now.getMonth() - join.getMonth());
                    return Math.floor(months);
                }

                // 1년 이상: 기본 15일 + 근속연수당 1일
                return 15 + Math.min(years - 1, 10);
            };

            const calculateUsedLeave = () => {
                // 승인완료와 승인대기(pending) 모두 카운트
                return leaveUsage
                    .filter(usage => usage.approvalStatus === 'approved' || usage.approvalStatus === 'pending')
                    .reduce((sum, usage) => sum + usage.amount, 0);
            };

            // 파일 선택 핸들러
            const handleFileSelect = (event) => {
                const files = Array.from(event.target.files);
                const validFiles = files.filter(file => {
                    const maxSize = 5 * 1024 * 1024; // 5MB
                    if (file.size > maxSize) {
                        alert(`${file.name}은(는) 5MB를 초과합니다.`);
                        return false;
                    }
                    return true;
                });
                setAttachedFiles([...attachedFiles, ...validFiles]);
            };

            // 파일 제거
            const removeFile = (index) => {
                setAttachedFiles(attachedFiles.filter((_, i) => i !== index));
            };

            // 파일 업로드 (Firebase Storage)
            const uploadFiles = async (leaveId) => {
                if (attachedFiles.length === 0) return [];

                setUploading(true);
                const uploadedUrls = [];

                try {
                    for (const file of attachedFiles) {
                        const storageRef = storage.ref();
                        const fileRef = storageRef.child(`leave-attachments/${user.uid}/${leaveId}/${file.name}`);
                        await fileRef.put(file);
                        const url = await fileRef.getDownloadURL();
                        uploadedUrls.push({
                            name: file.name,
                            url: url,
                            size: file.size
                        });
                    }
                    setUploading(false);
                    return uploadedUrls;
                } catch (error) {
                    console.error('파일 업로드 실패:', error);
                    setUploading(false);
                    alert('파일 업로드 중 오류가 발생했습니다.');
                    return [];
                }
            };

            // 휴가 일수 계산 (휴가 타입에 따라)
            const calculateLeaveDays = (startDate, endDate, leaveType) => {
                if (leaveType === '반차(오전)' || leaveType === '반차(오후)') {
                    return 0.5;
                }

                const start = new Date(startDate);
                const end = new Date(endDate);
                let days = 0;

                for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
                    const dayOfWeek = d.getDay();
                    // 주말 제외
                    if (dayOfWeek !== 0 && dayOfWeek !== 6) {
                        days++;
                    }
                }

                return days;
            };

            const handleDeleteLeave = async (usageIdOrGroup, usageDate, usageType, approvalStatus, groupId) => {
                try {
                    const isApprover = employeeInfo?.isApprover;

                    // groupId가 있으면 그룹 전체 삭제, 없으면 단일 항목 삭제
                    const usageIds = groupId ? usageIdOrGroup.ids : [usageIdOrGroup];
                    const isGrouped = !!groupId;

                    if (approvalStatus === 'approved') {
                        // 승인완료된 연차 취소
                        if (isApprover) {
                            // 승인자는 즉시 취소 처리
                            const confirmMsg = isGrouped
                                ? `${usageIdOrGroup.startDate} ~ ${usageIdOrGroup.endDate} (${usageIdOrGroup.totalDays}일) 연차를 모두 취소하시겠습니까?`
                                : '이 연차를 취소하시겠습니까?';
                            if (!confirm(confirmMsg)) return;

                            // 모든 연차 기록 취소
                            for (const id of usageIds) {
                                await db.collection('leaveUsage').doc(id).update({
                                    approvalStatus: 'cancelled',
                                    cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                });
                            }

                            // 스케줄도 취소 상태로 변경
                            if (groupId) {
                                const scheduleSnapshot = await db.collection('schedules')
                                    .where('userId', '==', user.uid)
                                    .where('groupId', '==', groupId)
                                    .get();

                                scheduleSnapshot.forEach(async (doc) => {
                                    await doc.ref.update({
                                        approvalStatus: 'cancelled',
                                        cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                    });
                                });
                            } else {
                                const scheduleSnapshot = await db.collection('schedules')
                                    .where('userId', '==', user.uid)
                                    .where('date', '==', usageDate)
                                    .where('type', '==', usageType)
                                    .get();

                                scheduleSnapshot.forEach(async (doc) => {
                                    await doc.ref.update({
                                        approvalStatus: 'cancelled',
                                        cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                    });
                                });
                            }

                            alert('연차가 취소되었습니다.');
                        } else {
                            // 일반 사원은 취소 승인 요청
                            const confirmMsg = isGrouped
                                ? `승인 완료된 연차입니다. ${usageIdOrGroup.startDate} ~ ${usageIdOrGroup.endDate} (${usageIdOrGroup.totalDays}일) 연차의 취소 승인을 요청하시겠습니까?`
                                : '승인 완료된 연차입니다. 취소 승인을 요청하시겠습니까?';
                            if (!confirm(confirmMsg)) return;

                            for (const id of usageIds) {
                                await db.collection('leaveUsage').doc(id).update({
                                    approvalStatus: 'deletion-pending',
                                    deletionRequestedAt: firebase.firestore.FieldValue.serverTimestamp()
                                });
                            }

                            // 스케줄도 취소 대기로 변경
                            if (groupId) {
                                const scheduleSnapshot = await db.collection('schedules')
                                    .where('userId', '==', user.uid)
                                    .where('groupId', '==', groupId)
                                    .get();

                                scheduleSnapshot.forEach(async (doc) => {
                                    await doc.ref.update({
                                        approvalStatus: 'deletion-pending',
                                        deletionRequestedAt: firebase.firestore.FieldValue.serverTimestamp()
                                    });
                                });
                            } else {
                                const scheduleSnapshot = await db.collection('schedules')
                                    .where('userId', '==', user.uid)
                                    .where('date', '==', usageDate)
                                    .where('type', '==', usageType)
                                    .get();

                                scheduleSnapshot.forEach(async (doc) => {
                                    await doc.ref.update({
                                        approvalStatus: 'deletion-pending',
                                        deletionRequestedAt: firebase.firestore.FieldValue.serverTimestamp()
                                    });
                                });
                            }

                            // 승인자에게 Slack 알림
                            if (employeeInfo?.approver) {
                                const dateStr = isGrouped
                                    ? `${usageIdOrGroup.startDate} ~ ${usageIdOrGroup.endDate} (${usageIdOrGroup.totalDays}일)`
                                    : usageDate;
                                const slackMessage = `${employeeInfo.name}님이 연차 취소 승인 요청을 보냈습니다.\n날짜: ${dateStr}\n유형: ${usageType}`;
                                await sendSlackNotification(employeeInfo.approver, slackMessage, 'cancellation');
                            }

                            alert('취소 승인 요청이 완료되었습니다.');
                        }
                    } else if (approvalStatus === 'pending') {
                        // 승인대기 연차는 즉시 취소
                        const confirmMsg = isGrouped
                            ? `${usageIdOrGroup.startDate} ~ ${usageIdOrGroup.endDate} (${usageIdOrGroup.totalDays}일) 연차 신청을 모두 취소하시겠습니까?`
                            : '이 연차 신청을 취소하시겠습니까?';
                        if (!confirm(confirmMsg)) return;

                        for (const id of usageIds) {
                            await db.collection('leaveUsage').doc(id).update({
                                approvalStatus: 'cancelled',
                                cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        }

                        // 스케줄도 취소 상태로 변경
                        if (groupId) {
                            const scheduleSnapshot = await db.collection('schedules')
                                .where('userId', '==', user.uid)
                                .where('groupId', '==', groupId)
                                .get();

                            scheduleSnapshot.forEach(async (doc) => {
                                await doc.ref.update({
                                    approvalStatus: 'cancelled',
                                    cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                });
                            });
                        } else {
                            const scheduleSnapshot = await db.collection('schedules')
                                .where('userId', '==', user.uid)
                                .where('date', '==', usageDate)
                                .where('type', '==', usageType)
                                .get();

                            scheduleSnapshot.forEach(async (doc) => {
                                await doc.ref.update({
                                    approvalStatus: 'cancelled',
                                    cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                });
                            });
                        }

                        alert('연차 신청이 취소되었습니다.');
                    } else {
                        // 반려되거나 취소대기 상태는 즉시 취소
                        const confirmMsg = isGrouped
                            ? `${usageIdOrGroup.startDate} ~ ${usageIdOrGroup.endDate} (${usageIdOrGroup.totalDays}일) 연차 내역을 취소하시겠습니까?`
                            : '이 연차 내역을 취소하시겠습니까?';
                        if (!confirm(confirmMsg)) return;

                        for (const id of usageIds) {
                            await db.collection('leaveUsage').doc(id).update({
                                approvalStatus: 'cancelled',
                                cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        }

                        if (groupId) {
                            const scheduleSnapshot = await db.collection('schedules')
                                .where('userId', '==', user.uid)
                                .where('groupId', '==', groupId)
                                .get();

                            scheduleSnapshot.forEach(async (doc) => {
                                await doc.ref.update({
                                    approvalStatus: 'cancelled',
                                    cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                });
                            });
                        } else {
                            const scheduleSnapshot = await db.collection('schedules')
                                .where('userId', '==', user.uid)
                                .where('date', '==', usageDate)
                                .where('type', '==', usageType)
                                .get();

                            scheduleSnapshot.forEach(async (doc) => {
                                await doc.ref.update({
                                    approvalStatus: 'cancelled',
                                    cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                });
                            });
                        }

                        alert('취소되었습니다.');
                    }

                    loadLeaveUsage();
                    loadEmployeeInfo();
                } catch (error) {
                    alert('처리 실패: ' + error.message);
                }
            };

            const handleRegisterLeave = async () => {
                if (!leaveStartDate || !leaveEndDate) {
                    alert('시작일과 종료일을 모두 선택해주세요.');
                    return;
                }

                const startDate = new Date(leaveStartDate);
                const endDate = new Date(leaveEndDate);

                if (startDate > endDate) {
                    alert('종료일은 시작일보다 늦어야 합니다.');
                    return;
                }

                // 승인자는 자동 승인, 일반 사원은 승인 대기
                const approvalStatus = employeeInfo?.isApprover ? 'approved' : 'pending';

                // 휴가 유형에 따른 연차 수량 계산
                let leaveAmount = 0;
                if (leaveType === '연차') {
                    leaveAmount = 1;
                } else if (leaveType === '반차(오전)' || leaveType === '반차(오후)') {
                    leaveAmount = 0.5;
                } else if (leaveType === '여름휴가' || leaveType === '겨울휴가') {
                    leaveAmount = 0; // 연차 수량에 카운트하지 않음
                }

                // 여름휴가, 겨울휴가가 아닌 경우에만 연차 수량 체크
                if (leaveType !== '여름휴가' && leaveType !== '겨울휴가') {
                    // 등록하려는 실제 근무일 수 계산 (주말 제외)
                    let requestedDays = 0;
                    const tempDate = new Date(startDate);
                    while (tempDate <= endDate) {
                        const dayOfWeek = tempDate.getDay();
                        if (dayOfWeek !== 0 && dayOfWeek !== 6) {
                            requestedDays += leaveAmount;
                        }
                        tempDate.setDate(tempDate.getDate() + 1);
                    }

                    // 현재 사용 가능한 연차 수량 계산
                    const totalLeave = calculateTotalLeave(employeeInfo?.joinDate);
                    const usedLeave = calculateUsedLeave();
                    const remainingLeave = totalLeave - usedLeave;

                    // 사용 가능한 연차 수량 체크
                    if (remainingLeave <= 0) {
                        alert(`사용 가능한 연차가 없습니다.\n\n총 연차: ${totalLeave}일\n사용한 연차: ${usedLeave}일\n남은 연차: ${remainingLeave}일`);
                        return;
                    }

                    if (requestedDays > remainingLeave) {
                        alert(`사용 가능한 연차를 초과했습니다.\n\n요청한 연차: ${requestedDays}일\n사용 가능한 연차: ${remainingLeave}일\n\n${remainingLeave}일 이하로 신청해주세요.`);
                        return;
                    }
                }

                // 연속된 연차를 묶기 위한 groupId 생성
                const groupId = `${user.uid}_${Date.now()}`;

                // 실제 근무일 수 계산 (주말 제외)
                let workDayCount = 0;
                const tempDate = new Date(startDate);
                while (tempDate <= endDate) {
                    const dayOfWeek = tempDate.getDay();
                    if (dayOfWeek !== 0 && dayOfWeek !== 6) {
                        workDayCount++;
                    }
                    tempDate.setDate(tempDate.getDate() + 1);
                }

                // 시작일부터 종료일까지 순회
                const currentDate = new Date(startDate);
                while (currentDate <= endDate) {
                    const dateStr = currentDate.toISOString().split('T')[0];

                    // 주말 제외 (토요일=6, 일요일=0)
                    const dayOfWeek = currentDate.getDay();
                    if (dayOfWeek !== 0 && dayOfWeek !== 6) {
                        // 연차 사용 기록
                        await db.collection('leaveUsage').add({
                            userId: user.uid,
                            date: dateStr,
                            startDate: leaveStartDate,
                            endDate: leaveEndDate,
                            type: leaveType,
                            amount: leaveAmount,
                            totalDays: workDayCount,
                            groupId: groupId,
                            approvalStatus: approvalStatus,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });

                        // 스케줄에 등록
                        const scheduleRef = db.collection('schedules');
                        const existingSchedule = await scheduleRef
                            .where('userId', '==', user.uid)
                            .where('date', '==', dateStr)
                            .get();

                        if (!existingSchedule.empty) {
                            const docId = existingSchedule.docs[0].id;
                            await scheduleRef.doc(docId).update({
                                type: leaveType,
                                groupId: groupId,
                                approvalStatus: approvalStatus,
                                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        } else {
                            await scheduleRef.add({
                                userId: user.uid,
                                userName: user.displayName || user.email,
                                date: dateStr,
                                type: leaveType,
                                groupId: groupId,
                                approvalStatus: approvalStatus,
                                createdAt: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        }
                    }

                    // 다음 날로 이동
                    currentDate.setDate(currentDate.getDate() + 1);
                }

                // 파일 업로드
                let uploadedFiles = [];
                if (attachedFiles.length > 0) {
                    uploadedFiles = await uploadFiles(groupId);

                    // 파일 정보를 첫 번째 leaveUsage에 저장
                    const firstLeaveDoc = await db.collection('leaveUsage')
                        .where('groupId', '==', groupId)
                        .limit(1)
                        .get();

                    if (!firstLeaveDoc.empty) {
                        await db.collection('leaveUsage').doc(firstLeaveDoc.docs[0].id).update({
                            attachments: uploadedFiles,
                            note: leaveNote || ''
                        });
                    }
                }

                const message = employeeInfo?.isApprover
                    ? '연차 등록이 완료되었습니다.'
                    : '연차 신청이 완료되었습니다. 승인을 기다려주세요.';
                alert(message);

                // 일반 사원이 연차 신청한 경우 승인자에게 알림 생성
                if (!employeeInfo?.isApprover && employeeInfo?.approver) {
                    const days = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;

                    // Firebase 알림 생성
                    await db.collection('notifications').add({
                        userId: employeeInfo.approver,
                        title: '연차 승인 요청',
                        message: `${employeeInfo.name}님이 ${leaveStartDate} ~ ${leaveEndDate} (${days}일) 연차 승인을 요청했습니다.`,
                        type: 'leave-approval',
                        read: false,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    // Slack 알림
                    const slackMessage = `${employeeInfo.name}님이 연차 승인 요청을 보냈습니다.\n기간: ${leaveStartDate} ~ ${leaveEndDate} (${days}일)\n유형: ${leaveType}`;
                    await sendSlackNotification(employeeInfo.approver, slackMessage, 'approval');
                }

                setShowRegisterModal(false);
                setLeaveStartDate('');
                setLeaveEndDate('');
                setLeaveNote('');
                setAttachedFiles([]);
                loadLeaveUsage();
            };

            if (!employeeInfo) {
                return <div className="content-card">사원 정보를 불러오는 중...</div>;
            }

            const totalLeave = employeeInfo.customTotalLeave || calculateTotalLeave(employeeInfo.joinDate);
            const usedLeave = calculateUsedLeave();
            const remainingLeave = totalLeave - usedLeave;

            return (
                <div className="content-card">
                    <h2 style={{marginBottom: '20px'}}>연차 관리</h2>
                    <button className="register-btn" onClick={() => setShowRegisterModal(true)}>
                        연차 등록
                    </button>

                    <div className="annual-leave-info">
                        <div className="info-card">
                            <h4>입사일</h4>
                            <div className="value">{employeeInfo.joinDate}</div>
                        </div>
                        <div className="info-card">
                            <h4>총 연차</h4>
                            <div className="value">{totalLeave}일</div>
                        </div>
                        <div className="info-card">
                            <h4>사용 연차</h4>
                            <div className="value">{usedLeave}일</div>
                        </div>
                        <div className="info-card">
                            <h4>남은 연차</h4>
                            <div className="value" style={{color: '#4CAF50'}}>{remainingLeave}일</div>
                        </div>
                    </div>

                    <div className="leave-history">
                        <h3>연차 사용 내역</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>날짜</th>
                                    <th>유형</th>
                                    <th>사용일수</th>
                                    <th>승인 상태</th>
                                    <th>관리</th>
                                </tr>
                            </thead>
                            <tbody>
                                {(() => {
                                    const startIndex = (currentPage - 1) * itemsPerPage;
                                    const endIndex = startIndex + itemsPerPage;
                                    const currentItems = leaveUsage.slice(startIndex, endIndex);
                                    return currentItems.map(usage => (
                                        <tr key={usage.id}>
                                            <td>
                                                {usage.isGrouped && usage.startDate !== usage.endDate
                                                    ? `${usage.startDate} ~ ${usage.endDate}`
                                                    : (usage.startDate || usage.date)}
                                            </td>
                                            <td>{usage.type}</td>
                                            <td>
                                                {usage.isGrouped && usage.totalDays > 1
                                                    ? `${usage.totalDays}일`
                                                    : (usage.amount > 0 ? `${usage.amount}일` : '-')}
                                            </td>
                                            <td>
                                                <span style={{
                                                    padding: '4px 8px',
                                                    borderRadius: '4px',
                                                    fontSize: '12px',
                                                    background: usage.approvalStatus === 'approved' ? '#4CAF50' :
                                                               usage.approvalStatus === 'rejected' ? '#ff4444' :
                                                               usage.approvalStatus === 'deletion-pending' ? '#9c27b0' :
                                                               usage.approvalStatus === 'cancelled' ? '#999' : '#ff9800',
                                                    color: 'white'
                                                }}>
                                                    {usage.approvalStatus === 'approved' ? '승인완료' :
                                                     usage.approvalStatus === 'rejected' ? '반려' :
                                                     usage.approvalStatus === 'deletion-pending' ? '취소대기' :
                                                     usage.approvalStatus === 'cancelled' ? '취소됨' : '승인대기'}
                                                </span>
                                            </td>
                                            <td>
                                                {(usage.approvalStatus !== 'deletion-pending' && usage.approvalStatus !== 'cancelled') && (
                                                    <button
                                                        onClick={() => handleDeleteLeave(
                                                            usage.isGrouped ? usage : usage.id,
                                                            usage.date,
                                                            usage.type,
                                                            usage.approvalStatus,
                                                            usage.groupId
                                                        )}
                                                        style={{
                                                            padding: '4px 8px',
                                                            background: '#ff4444',
                                                            color: 'white',
                                                            border: 'none',
                                                            borderRadius: '4px',
                                                            cursor: 'pointer',
                                                            fontSize: '12px'
                                                        }}
                                                    >
                                                        취소
                                                    </button>
                                                )}
                                            </td>
                                        </tr>
                                    ));
                                })()}
                            </tbody>
                        </table>
                        {leaveUsage.length > itemsPerPage && (
                            <Pagination
                                currentPage={currentPage}
                                totalPages={Math.ceil(leaveUsage.length / itemsPerPage)}
                                onPageChange={setCurrentPage}
                            />
                        )}
                    </div>

                    {showRegisterModal && (
                        <div className="modal" onClick={() => setShowRegisterModal(false)}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                                <h3>연차 등록</h3>
                                <div className="form-group">
                                    <label>시작일</label>
                                    <input
                                        type="date"
                                        value={leaveStartDate}
                                        onChange={(e) => setLeaveStartDate(e.target.value)}
                                    />
                                </div>
                                <div className="form-group">
                                    <label>종료일</label>
                                    <input
                                        type="date"
                                        value={leaveEndDate}
                                        onChange={(e) => setLeaveEndDate(e.target.value)}
                                    />
                                </div>
                                <div className="form-group">
                                    <label>유형</label>
                                    <select
                                        value={leaveType}
                                        onChange={(e) => setLeaveType(e.target.value)}
                                        style={{
                                            width: '100%',
                                            padding: '12px',
                                            border: '1px solid #ddd',
                                            borderRadius: '6px',
                                            fontSize: '14px'
                                        }}
                                    >
                                        <option value="연차">연차</option>
                                        <option value="반차(오전)">반차(오전) - 0.5일</option>
                                        <option value="반차(오후)">반차(오후) - 0.5일</option>
                                        <option value="병가">병가</option>
                                        <option value="경조사">경조사 휴가</option>
                                        <option value="공가">공가</option>
                                        <option value="여름휴가">여름휴가</option>
                                        <option value="겨울휴가">겨울휴가</option>
                                    </select>
                                </div>
                                <div className="form-group">
                                    <label>사유 (선택)</label>
                                    <textarea
                                        value={leaveNote}
                                        onChange={(e) => setLeaveNote(e.target.value)}
                                        placeholder="휴가 사유를 입력하세요"
                                        rows="3"
                                    />
                                </div>
                                <div className="form-group">
                                    <label>첨부 파일 (선택) - 병가 진단서 등</label>
                                    <div
                                        className="file-upload-area"
                                        onClick={() => document.getElementById('file-input').click()}
                                    >
                                        <input
                                            id="file-input"
                                            type="file"
                                            multiple
                                            onChange={handleFileSelect}
                                            style={{display: 'none'}}
                                            accept="image/*,.pdf,.doc,.docx"
                                        />
                                        <div style={{fontSize: '32px', marginBottom: '10px'}}>📎</div>
                                        <div style={{fontSize: '14px', color: '#666'}}>
                                            클릭하여 파일 선택 (최대 5MB)
                                        </div>
                                    </div>
                                    {attachedFiles.length > 0 && (
                                        <div className="file-list">
                                            {attachedFiles.map((file, index) => (
                                                <div key={index} className="file-item">
                                                    <span className="file-item-name">📄 {file.name}</span>
                                                    <span className="file-item-size">
                                                        {(file.size / 1024).toFixed(1)}KB
                                                    </span>
                                                    <button
                                                        className="file-remove-btn"
                                                        onClick={() => removeFile(index)}
                                                    >
                                                        삭제
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                                <div style={{fontSize: '12px', color: '#666', marginTop: '10px'}}>
                                    * 주말(토,일)은 자동으로 제외됩니다.<br/>
                                    * 반차는 0.5일로 계산됩니다.
                                </div>
                                {uploading && (
                                    <div style={{color: '#4CAF50', marginTop: '10px', textAlign: 'center'}}>
                                        파일 업로드 중...
                                    </div>
                                )}
                                <div className="modal-buttons">
                                    <button className="btn-secondary" onClick={() => {
                                        setShowRegisterModal(false);
                                        setAttachedFiles([]);
                                        setLeaveNote('');
                                    }}>
                                        취소
                                    </button>
                                    <button className="btn-primary" onClick={handleRegisterLeave} disabled={uploading}>
                                        등록
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // 관리자 페이지
        function AdminPage() {
            const [employees, setEmployees] = useState([]);
            const [approvalLines, setApprovalLines] = useState([]);
            const [departments, setDepartments] = useState([]);
            const [showAddModal, setShowAddModal] = useState(false);
            const [editingEmployeeId, setEditingEmployeeId] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [filterRole, setFilterRole] = useState('all');
            const [filterDepartment, setFilterDepartment] = useState('all');
            const [newEmployee, setNewEmployee] = useState({
                email: '',
                name: '',
                phone: '',
                joinDate: '',
                password: '',
                slackUserId: '',
                departmentId: ''
            });

            useEffect(() => {
                loadEmployees();
                loadApprovalLines();
                loadDepartments();
            }, []);

            const loadDepartments = async () => {
                const snapshot = await db.collection('departments').get();
                const deptList = [];
                snapshot.forEach(doc => {
                    deptList.push({ id: doc.id, ...doc.data() });
                });
                setDepartments(deptList);
            };

            const loadApprovalLines = async () => {
                const snapshot = await db.collection('approvalLines').get();
                const lines = [];
                snapshot.forEach(doc => {
                    lines.push({ id: doc.id, ...doc.data() });
                });
                setApprovalLines(lines);
            };

            const formatPhoneNumber = (value) => {
                // 숫자만 추출
                const numbers = value.replace(/[^\d]/g, '');

                // 길이에 따라 포맷팅
                if (numbers.length <= 3) {
                    return numbers;
                } else if (numbers.length <= 7) {
                    return `${numbers.slice(0, 3)}-${numbers.slice(3)}`;
                } else if (numbers.length <= 11) {
                    return `${numbers.slice(0, 3)}-${numbers.slice(3, 7)}-${numbers.slice(7)}`;
                } else {
                    return `${numbers.slice(0, 3)}-${numbers.slice(3, 7)}-${numbers.slice(7, 11)}`;
                }
            };

            const loadEmployees = async () => {
                const snapshot = await db.collection('employees').get();
                const employeeList = [];
                snapshot.forEach(doc => {
                    employeeList.push({ id: doc.id, ...doc.data() });
                });
                setEmployees(employeeList);
            };

            // 엑셀 내보내기 함수
            const exportToExcel = () => {
                const filteredEmployees = getFilteredEmployees();

                const data = filteredEmployees.map((emp, index) => ({
                    '번호': index + 1,
                    '이름': emp.name,
                    '이메일': emp.email,
                    '연락처': emp.phone || '-',
                    '입사일': emp.joinDate,
                    '부관리자': emp.isSubAdmin ? 'O' : '',
                    '승인자': emp.isApprover ? 'O' : '',
                    'PT편집자': emp.isPTScheduleEditor ? 'O' : '',
                    'Slack ID': emp.slackUserId || '-'
                }));

                const ws = XLSX.utils.json_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "사원 목록");

                const today = new Date().toISOString().split('T')[0];
                XLSX.writeFile(wb, `사원목록_${today}.xlsx`);
            };

            // 필터링된 사원 목록 가져오기
            const getFilteredEmployees = () => {
                return employees
                    .filter(emp => {
                        // 검색어 필터
                        const matchesSearch =
                            emp.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                            emp.email.toLowerCase().includes(searchTerm.toLowerCase()) ||
                            (emp.phone && emp.phone.includes(searchTerm));

                        // 역할 필터
                        let matchesRole = true;
                        if (filterRole === 'admin') matchesRole = emp.isSubAdmin === true;
                        else if (filterRole === 'approver') matchesRole = emp.isApprover === true;
                        else if (filterRole === 'pt-editor') matchesRole = emp.isPTScheduleEditor === true;
                        else if (filterRole === 'regular') {
                            matchesRole = !emp.isSubAdmin && !emp.isApprover && !emp.isPTScheduleEditor;
                        }

                        // 부서 필터
                        let matchesDepartment = true;
                        if (filterDepartment !== 'all') {
                            if (filterDepartment === 'none') {
                                matchesDepartment = !emp.departmentId;
                            } else {
                                matchesDepartment = emp.departmentId === filterDepartment;
                            }
                        }

                        return matchesSearch && matchesRole && matchesDepartment;
                    })
                    .sort((a, b) => {
                        const dateA = new Date(a.joinDate || '9999-12-31');
                        const dateB = new Date(b.joinDate || '9999-12-31');
                        return dateA - dateB;
                    });
            };

            const getDepartmentName = (deptId) => {
                const dept = departments.find(d => d.id === deptId);
                return dept ? dept.name : '-';
            };

            const handleAddEmployee = async () => {
                if (!newEmployee.email || !newEmployee.name || !newEmployee.joinDate || !newEmployee.password) {
                    alert('필수 필드를 입력해주세요.');
                    return;
                }

                try {
                    // 현재 로그인된 관리자 정보 저장
                    const currentUser = auth.currentUser;
                    const currentEmail = currentUser.email;
                    const currentPassword = prompt('관리자 비밀번호를 입력하세요 (계정 유지를 위해 필요합니다):');

                    if (!currentPassword) {
                        alert('비밀번호가 필요합니다.');
                        return;
                    }

                    // Firebase Auth에 사용자 생성
                    const userCredential = await auth.createUserWithEmailAndPassword(
                        newEmployee.email,
                        newEmployee.password
                    );

                    // Firestore에 사원 정보 저장
                    await db.collection('employees').doc(userCredential.user.uid).set({
                        email: newEmployee.email,
                        name: newEmployee.name,
                        phone: newEmployee.phone,
                        joinDate: newEmployee.joinDate,
                        slackUserId: newEmployee.slackUserId || '',
                        departmentId: newEmployee.departmentId || null,
                        isApprover: false,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    // 사용자 이름 설정
                    await userCredential.user.updateProfile({
                        displayName: newEmployee.name
                    });

                    // 관리자 계정으로 다시 로그인
                    await auth.signInWithEmailAndPassword(currentEmail, currentPassword);

                    alert('사원이 추가되었습니다.');
                    setShowAddModal(false);
                    setNewEmployee({ email: '', name: '', phone: '', joinDate: '', password: '', slackUserId: '', departmentId: '' });
                    loadEmployees();
                } catch (error) {
                    alert('사원 추가 실패: ' + error.message);
                }
            };

            const handleToggleApprover = async (employeeId, currentStatus) => {
                try {
                    await db.collection('employees').doc(employeeId).update({
                        isApprover: !currentStatus
                    });
                    alert('승인자 권한이 ' + (!currentStatus ? '부여' : '해제') + '되었습니다.');
                    loadEmployees();
                } catch (error) {
                    alert('권한 변경 실패: ' + error.message);
                }
            };

            const handleTogglePTScheduleEditor = async (employeeId, currentStatus) => {
                try {
                    await db.collection('employees').doc(employeeId).update({
                        isPTScheduleEditor: !currentStatus
                    });
                    alert('PT 스케줄 편집 권한이 ' + (!currentStatus ? '부여' : '해제') + '되었습니다.');
                    loadEmployees();
                } catch (error) {
                    alert('권한 변경 실패: ' + error.message);
                }
            };

            const handleToggleSubAdmin = async (employeeId, currentStatus) => {
                try {
                    await db.collection('employees').doc(employeeId).update({
                        isSubAdmin: !currentStatus
                    });
                    alert('부관리자 권한이 ' + (!currentStatus ? '부여' : '해제') + '되었습니다.');
                    loadEmployees();
                } catch (error) {
                    alert('권한 변경 실패: ' + error.message);
                }
            };

            const handleDeleteEmployee = async (employeeId) => {
                if (!confirm('정말 삭제하시겠습니까?')) return;

                try {
                    // 1. 사원 삭제
                    await db.collection('employees').doc(employeeId).delete();

                    // 2. 해당 사원이 포함된 결재선들 찾기
                    const approvalLinesSnapshot = await db.collection('approvalLines')
                        .where('memberIds', 'array-contains', employeeId)
                        .get();

                    // 3. 결재선의 memberIds에서 해당 사원 제거
                    if (!approvalLinesSnapshot.empty) {
                        const batch = db.batch();
                        approvalLinesSnapshot.forEach(doc => {
                            const currentMemberIds = doc.data().memberIds || [];
                            const updatedMemberIds = currentMemberIds.filter(id => id !== employeeId);

                            const lineRef = db.collection('approvalLines').doc(doc.id);
                            batch.update(lineRef, {
                                memberIds: updatedMemberIds,
                                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        });
                        await batch.commit();
                    }

                    // Note: Firebase Auth의 사용자 삭제는 Admin SDK가 필요합니다
                    alert('사원이 삭제되었습니다. 관련 결재선도 업데이트되었습니다.');
                    loadEmployees();
                } catch (error) {
                    alert('삭제 실패: ' + error.message);
                }
            };

            const handleEditEmployee = (employeeId) => {
                setEditingEmployeeId(employeeId);
            };

            const handleSaveEmployee = async (employeeId, updatedData) => {
                try {
                    await db.collection('employees').doc(employeeId).update({
                        name: updatedData.name,
                        email: updatedData.email,
                        phone: updatedData.phone,
                        joinDate: updatedData.joinDate,
                        slackUserId: updatedData.slackUserId || ''
                    });
                    alert('사원 정보가 수정되었습니다.');
                    setEditingEmployeeId(null);
                    loadEmployees();
                } catch (error) {
                    alert('수정 실패: ' + error.message);
                }
            };

            const handleCancelEdit = () => {
                setEditingEmployeeId(null);
            };

            const handleResetPassword = async (employeeId, employeeEmail) => {
                if (!confirm('선택한 사원의 비밀번호를 초기화하시겠습니까?\n초기화 비밀번호: 1q2w3e4r%T')) return;

                try {
                    // 현재 로그인된 관리자 정보 저장
                    const currentUser = auth.currentUser;
                    const currentEmail = currentUser.email;
                    const currentPassword = prompt('관리자 비밀번호를 입력하세요 (계정 유지를 위해 필요합니다):');

                    if (!currentPassword) {
                        alert('비밀번호가 필요합니다.');
                        return;
                    }

                    // 해당 사원으로 로그인
                    const tempPassword = prompt('해당 사원의 현재 비밀번호를 입력하세요:');
                    if (!tempPassword) {
                        alert('현재 비밀번호가 필요합니다.');
                        return;
                    }

                    await auth.signInWithEmailAndPassword(employeeEmail, tempPassword);

                    // 비밀번호 변경
                    const user = auth.currentUser;
                    await user.updatePassword('1q2w3e4r%T');

                    // 관리자 계정으로 다시 로그인
                    await auth.signInWithEmailAndPassword(currentEmail, currentPassword);

                    alert('비밀번호가 초기화되었습니다.\n새 비밀번호: 1q2w3e4r%T');
                } catch (error) {
                    // 오류 발생 시 관리자로 재로그인 시도
                    try {
                        const currentEmail = auth.currentUser?.email;
                        if (!currentEmail) {
                            const adminEmail = prompt('관리자 이메일을 입력하세요:');
                            const adminPassword = prompt('관리자 비밀번호를 입력하세요:');
                            await auth.signInWithEmailAndPassword(adminEmail, adminPassword);
                        }
                    } catch (reLoginError) {
                        console.error('재로그인 실패:', reLoginError);
                    }
                    alert('비밀번호 초기화 실패: ' + error.message);
                }
            };

            const handleAssignApprovalLine = async (employeeId, approvalLineId) => {
                try {
                    // 결재선 정보 가져오기
                    let approverId = null;
                    if (approvalLineId) {
                        const lineDoc = await db.collection('approvalLines').doc(approvalLineId).get();
                        if (lineDoc.exists) {
                            approverId = lineDoc.data().approverId;
                        }
                    }

                    await db.collection('employees').doc(employeeId).update({
                        approvalLine: approvalLineId || null,
                        approver: approverId
                    });
                    alert('결재선이 할당되었습니다.');
                    loadEmployees();
                } catch (error) {
                    alert('할당 실패: ' + error.message);
                }
            };

            const approvers = employees.filter(emp => emp.isApprover);

            return (
                <div className="content-card">
                    <div className="admin-section">
                        <h2>사원 관리</h2>
                        <button className="register-btn" onClick={() => setShowAddModal(true)}>
                            사원 추가
                        </button>

                        {/* 검색 및 필터 바 */}
                        <div className="search-filter-bar">
                            <input
                                type="text"
                                className="search-input"
                                placeholder="🔍 이름, 이메일, 연락처로 검색..."
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                            />
                            <select
                                className="filter-select"
                                value={filterRole}
                                onChange={(e) => setFilterRole(e.target.value)}
                            >
                                <option value="all">전체 권한</option>
                                <option value="regular">일반 사원</option>
                                <option value="admin">부관리자</option>
                                <option value="approver">승인자</option>
                                <option value="pt-editor">PT 편집자</option>
                            </select>
                            <select
                                className="filter-select"
                                value={filterDepartment}
                                onChange={(e) => setFilterDepartment(e.target.value)}
                            >
                                <option value="all">전체 부서</option>
                                <option value="none">미배정</option>
                                {departments.map(dept => (
                                    <option key={dept.id} value={dept.id}>{dept.name}</option>
                                ))}
                            </select>
                            <button className="export-btn" onClick={exportToExcel}>
                                <span>엑셀 다운로드</span>
                            </button>
                        </div>

                        <div style={{marginBottom: '10px', color: '#666', fontSize: '14px'}}>
                            총 {getFilteredEmployees().length}명
                        </div>

                        <div className="employee-list">
                            <table>
                                <thead>
                                    <tr>
                                        <th>번호</th>
                                        <th>이름</th>
                                        <th>이메일</th>
                                        <th>연락처</th>
                                        <th>입사일</th>
                                        <th>부서</th>
                                        <th>Slack ID</th>
                                        <th>부관리자 권한</th>
                                        <th>승인자 권한</th>
                                        <th>PT 편집 권한</th>
                                        <th>결재선 선택</th>
                                        <th>관리</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {getFilteredEmployees().map((emp, index) => (
                                        <tr key={emp.id}>
                                            <td style={{textAlign: 'center', fontWeight: '500'}}>{index + 1}</td>
                                            <td>
                                                {editingEmployeeId === emp.id ? (
                                                    <input
                                                        type="text"
                                                        defaultValue={emp.name}
                                                        id={`name-${emp.id}`}
                                                        style={{width: '100%', padding: '4px'}}
                                                    />
                                                ) : emp.name}
                                            </td>
                                            <td>
                                                {editingEmployeeId === emp.id ? (
                                                    <input
                                                        type="email"
                                                        defaultValue={emp.email}
                                                        id={`email-${emp.id}`}
                                                        style={{width: '100%', padding: '4px'}}
                                                    />
                                                ) : emp.email}
                                            </td>
                                            <td>
                                                {editingEmployeeId === emp.id ? (
                                                    <input
                                                        type="text"
                                                        defaultValue={emp.phone}
                                                        id={`phone-${emp.id}`}
                                                        style={{width: '100%', padding: '4px'}}
                                                        maxLength="13"
                                                        onInput={(e) => {
                                                            e.target.value = formatPhoneNumber(e.target.value);
                                                        }}
                                                    />
                                                ) : (emp.phone || '-')}
                                            </td>
                                            <td>
                                                {editingEmployeeId === emp.id ? (
                                                    <input
                                                        type="date"
                                                        defaultValue={emp.joinDate}
                                                        id={`joinDate-${emp.id}`}
                                                        style={{width: '100%', padding: '4px'}}
                                                    />
                                                ) : emp.joinDate}
                                            </td>
                                            <td>{getDepartmentName(emp.departmentId)}</td>
                                            <td>
                                                {editingEmployeeId === emp.id ? (
                                                    <input
                                                        type="text"
                                                        defaultValue={emp.slackUserId || ''}
                                                        id={`slackUserId-${emp.id}`}
                                                        placeholder="U01234ABCDE"
                                                        style={{width: '100%', padding: '4px', fontSize: '12px'}}
                                                    />
                                                ) : (emp.slackUserId || '-')}
                                            </td>
                                            <td>
                                                <label style={{
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    justifyContent: 'center',
                                                    cursor: 'pointer'
                                                }}>
                                                    <input
                                                        type="checkbox"
                                                        checked={emp.isSubAdmin || false}
                                                        onChange={() => handleToggleSubAdmin(emp.id, emp.isSubAdmin)}
                                                        style={{
                                                            cursor: 'pointer',
                                                            width: '18px',
                                                            height: '18px'
                                                        }}
                                                    />
                                                </label>
                                            </td>
                                            <td>
                                                <label style={{
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    justifyContent: 'center',
                                                    cursor: 'pointer'
                                                }}>
                                                    <input
                                                        type="checkbox"
                                                        checked={emp.isApprover || false}
                                                        onChange={() => handleToggleApprover(emp.id, emp.isApprover)}
                                                        style={{
                                                            cursor: 'pointer',
                                                            width: '18px',
                                                            height: '18px'
                                                        }}
                                                    />
                                                </label>
                                            </td>
                                            <td>
                                                <label style={{
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    justifyContent: 'center',
                                                    cursor: 'pointer'
                                                }}>
                                                    <input
                                                        type="checkbox"
                                                        checked={emp.isPTScheduleEditor || false}
                                                        onChange={() => handleTogglePTScheduleEditor(emp.id, emp.isPTScheduleEditor)}
                                                        style={{
                                                            cursor: 'pointer',
                                                            width: '18px',
                                                            height: '18px'
                                                        }}
                                                    />
                                                </label>
                                            </td>
                                            <td>
                                                {!emp.isApprover ? (
                                                    <select
                                                        value={emp.approvalLine || ''}
                                                        onChange={(e) => handleAssignApprovalLine(emp.id, e.target.value)}
                                                        style={{
                                                            width: '100%',
                                                            padding: '6px',
                                                            border: '1px solid #ddd',
                                                            borderRadius: '4px',
                                                            fontSize: '13px'
                                                        }}
                                                    >
                                                        <option value="">선택 안함</option>
                                                        {approvalLines.map(line => (
                                                            <option key={line.id} value={line.id}>
                                                                {line.name}
                                                            </option>
                                                        ))}
                                                    </select>
                                                ) : (
                                                    <span style={{color: '#999', fontSize: '11px'}}>-</span>
                                                )}
                                            </td>
                                            <td>
                                                {editingEmployeeId === emp.id ? (
                                                    <div style={{display: 'flex', gap: '3px', flexWrap: 'nowrap'}}>
                                                        <button
                                                            onClick={() => {
                                                                const name = document.getElementById(`name-${emp.id}`).value;
                                                                const email = document.getElementById(`email-${emp.id}`).value;
                                                                const phone = document.getElementById(`phone-${emp.id}`).value;
                                                                const joinDate = document.getElementById(`joinDate-${emp.id}`).value;
                                                                const slackUserId = document.getElementById(`slackUserId-${emp.id}`).value;
                                                                handleSaveEmployee(emp.id, {name, email, phone, joinDate, slackUserId});
                                                            }}
                                                            style={{
                                                                padding: '6px 12px',
                                                                background: '#4CAF50',
                                                                color: 'white',
                                                                border: 'none',
                                                                borderRadius: '4px',
                                                                cursor: 'pointer',
                                                                fontSize: '12px'
                                                            }}
                                                        >
                                                            저장
                                                        </button>
                                                        <button
                                                            onClick={handleCancelEdit}
                                                            style={{
                                                                padding: '6px 12px',
                                                                background: '#999',
                                                                color: 'white',
                                                                border: 'none',
                                                                borderRadius: '4px',
                                                                cursor: 'pointer',
                                                                fontSize: '12px'
                                                            }}
                                                        >
                                                            취소
                                                        </button>
                                                    </div>
                                                ) : (
                                                    <div style={{display: 'flex', gap: '3px', flexWrap: 'nowrap'}}>
                                                        <button
                                                            onClick={() => handleEditEmployee(emp.id)}
                                                            style={{
                                                                padding: '6px 12px',
                                                                background: '#2196F3',
                                                                color: 'white',
                                                                border: 'none',
                                                                borderRadius: '4px',
                                                                cursor: 'pointer',
                                                                fontSize: '12px'
                                                            }}
                                                        >
                                                            수정
                                                        </button>
                                                        <button
                                                            onClick={() => handleResetPassword(emp.id, emp.email)}
                                                            style={{
                                                                padding: '6px 12px',
                                                                background: '#FF9800',
                                                                color: 'white',
                                                                border: 'none',
                                                                borderRadius: '4px',
                                                                cursor: 'pointer',
                                                                fontSize: '12px'
                                                            }}
                                                        >
                                                            PW초기화
                                                        </button>
                                                        <button
                                                            className="delete-btn"
                                                            onClick={() => handleDeleteEmployee(emp.id)}
                                                        >
                                                            삭제
                                                        </button>
                                                    </div>
                                                )}
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    {showAddModal && (
                        <div className="modal" onClick={() => setShowAddModal(false)}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                                <h3>사원 추가</h3>
                                <div className="form-group">
                                    <label>이름</label>
                                    <input
                                        type="text"
                                        value={newEmployee.name}
                                        onChange={(e) => setNewEmployee({...newEmployee, name: e.target.value})}
                                    />
                                </div>
                                <div className="form-group">
                                    <label>이메일</label>
                                    <input
                                        type="email"
                                        value={newEmployee.email}
                                        onChange={(e) => setNewEmployee({...newEmployee, email: e.target.value})}
                                    />
                                </div>
                                <div className="form-group">
                                    <label>연락처 (선택)</label>
                                    <input
                                        type="text"
                                        value={newEmployee.phone}
                                        onChange={(e) => setNewEmployee({...newEmployee, phone: formatPhoneNumber(e.target.value)})}
                                        placeholder="010-1234-5678"
                                        maxLength="13"
                                    />
                                </div>
                                <div className="form-group">
                                    <label>비밀번호</label>
                                    <input
                                        type="password"
                                        value={newEmployee.password}
                                        onChange={(e) => setNewEmployee({...newEmployee, password: e.target.value})}
                                    />
                                </div>
                                <div className="form-group">
                                    <label>입사일</label>
                                    <input
                                        type="date"
                                        value={newEmployee.joinDate}
                                        onChange={(e) => setNewEmployee({...newEmployee, joinDate: e.target.value})}
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Slack 사용자 ID (선택)</label>
                                    <input
                                        type="text"
                                        value={newEmployee.slackUserId}
                                        onChange={(e) => setNewEmployee({...newEmployee, slackUserId: e.target.value})}
                                        placeholder="예: U01234ABCDE"
                                    />
                                    <small style={{fontSize: '12px', color: '#666', display: 'block', marginTop: '5px'}}>
                                        Slack에서 사용자 프로필 → ⋯ → "Copy member ID"
                                    </small>
                                </div>
                                <div className="modal-buttons">
                                    <button className="btn-secondary" onClick={() => setShowAddModal(false)}>
                                        취소
                                    </button>
                                    <button className="btn-primary" onClick={handleAddEmployee}>
                                        추가
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // 결재선 관리 컴포넌트
        function ApprovalLineManagement() {
            const [approvalLines, setApprovalLines] = useState([]);
            const [employees, setEmployees] = useState([]);
            const [showAddModal, setShowAddModal] = useState(false);
            const [editingLineId, setEditingLineId] = useState(null);
            const [newLine, setNewLine] = useState({
                name: '',
                approverId: '',
                memberIds: []
            });

            useEffect(() => {
                loadApprovalLines();
                loadEmployees();
            }, []);

            const loadEmployees = async () => {
                const snapshot = await db.collection('employees').get();
                const employeeList = [];
                snapshot.forEach(doc => {
                    employeeList.push({ id: doc.id, ...doc.data() });
                });
                setEmployees(employeeList);
            };

            const loadApprovalLines = async () => {
                const snapshot = await db.collection('approvalLines').get();
                const lines = [];

                // 사원 목록 먼저 로드 (정리를 위해)
                const employeesSnapshot = await db.collection('employees').get();
                const validEmployeeIds = new Set();
                employeesSnapshot.forEach(doc => {
                    validEmployeeIds.add(doc.id);
                });

                // 정리가 필요한 결재선들을 위한 배치
                const batch = db.batch();
                let needsUpdate = false;

                snapshot.forEach(doc => {
                    const lineData = doc.data();
                    const originalMemberIds = lineData.memberIds || [];

                    // 존재하는 사원만 필터링
                    const validMemberIds = originalMemberIds.filter(id => validEmployeeIds.has(id));

                    // memberIds가 변경된 경우 DB 업데이트 준비
                    if (originalMemberIds.length !== validMemberIds.length) {
                        const lineRef = db.collection('approvalLines').doc(doc.id);
                        batch.update(lineRef, {
                            memberIds: validMemberIds,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        needsUpdate = true;

                        // 업데이트된 데이터로 추가
                        lines.push({ id: doc.id, ...lineData, memberIds: validMemberIds });
                    } else {
                        lines.push({ id: doc.id, ...lineData });
                    }
                });

                // DB 업데이트 실행
                if (needsUpdate) {
                    try {
                        await batch.commit();
                        console.log('삭제된 사원들이 결재선에서 제거되었습니다.');
                    } catch (error) {
                        console.error('결재선 정리 실패:', error);
                    }
                }

                setApprovalLines(lines);
            };

            const handleAddApprovalLine = async () => {
                if (!newLine.name || !newLine.approverId) {
                    alert('결재선 이름과 승인자를 선택해주세요.');
                    return;
                }

                try {
                    // 결재선 추가
                    const docRef = await db.collection('approvalLines').add({
                        name: newLine.name,
                        approverId: newLine.approverId,
                        memberIds: newLine.memberIds,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    // 포함된 사원들에게 결재선 자동 할당
                    const batch = db.batch();
                    newLine.memberIds.forEach(memberId => {
                        const memberRef = db.collection('employees').doc(memberId);
                        batch.update(memberRef, {
                            approvalLine: docRef.id,
                            approver: newLine.approverId
                        });
                    });
                    await batch.commit();

                    alert('결재선이 등록되었습니다.');
                    setShowAddModal(false);
                    setNewLine({ name: '', approverId: '', memberIds: [] });
                    loadApprovalLines();
                } catch (error) {
                    alert('결재선 등록 실패: ' + error.message);
                }
            };

            const handleDeleteApprovalLine = async (lineId) => {
                if (!confirm('이 결재선을 삭제하시겠습니까?')) return;

                try {
                    // 삭제할 결재선 정보 가져오기
                    const line = approvalLines.find(l => l.id === lineId);
                    const memberIds = line?.memberIds || [];

                    // 결재선 삭제
                    await db.collection('approvalLines').doc(lineId).delete();

                    // 포함된 사원들의 결재선 제거
                    if (memberIds.length > 0) {
                        const batch = db.batch();
                        memberIds.forEach(memberId => {
                            const memberRef = db.collection('employees').doc(memberId);
                            batch.update(memberRef, {
                                approvalLine: null,
                                approver: null
                            });
                        });
                        await batch.commit();
                    }

                    alert('결재선이 삭제되었습니다.');
                    loadApprovalLines();
                } catch (error) {
                    alert('삭제 실패: ' + error.message);
                }
            };

            const handleEditApprovalLine = (line) => {
                setEditingLineId(line.id);
                setNewLine({
                    name: line.name,
                    approverId: line.approverId,
                    memberIds: line.memberIds || []
                });
                setShowAddModal(true);
            };

            const handleUpdateApprovalLine = async () => {
                if (!newLine.name || !newLine.approverId) {
                    alert('결재선 이름과 승인자를 선택해주세요.');
                    return;
                }

                try {
                    // 기존 결재선 정보 가져오기
                    const oldLine = approvalLines.find(line => line.id === editingLineId);
                    const oldMemberIds = oldLine?.memberIds || [];
                    const newMemberIds = newLine.memberIds;

                    // 결재선 업데이트
                    await db.collection('approvalLines').doc(editingLineId).update({
                        name: newLine.name,
                        approverId: newLine.approverId,
                        memberIds: newLine.memberIds,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    // 추가된 사원: 새로운 memberIds에는 있지만 기존에는 없던 사원
                    const addedMemberIds = newMemberIds.filter(id => !oldMemberIds.includes(id));

                    // 제외된 사원: 기존에는 있었지만 새로운 memberIds에는 없는 사원
                    const removedMemberIds = oldMemberIds.filter(id => !newMemberIds.includes(id));

                    const batch = db.batch();

                    // 추가된 사원들에게 결재선 할당
                    addedMemberIds.forEach(memberId => {
                        const memberRef = db.collection('employees').doc(memberId);
                        batch.update(memberRef, {
                            approvalLine: editingLineId,
                            approver: newLine.approverId
                        });
                    });

                    // 제외된 사원들의 결재선 제거
                    removedMemberIds.forEach(memberId => {
                        const memberRef = db.collection('employees').doc(memberId);
                        batch.update(memberRef, {
                            approvalLine: null,
                            approver: null
                        });
                    });

                    // 기존에 포함되어 있던 사원들 중 승인자가 변경된 경우 업데이트
                    const unchangedMemberIds = newMemberIds.filter(id => oldMemberIds.includes(id));
                    if (oldLine.approverId !== newLine.approverId) {
                        unchangedMemberIds.forEach(memberId => {
                            const memberRef = db.collection('employees').doc(memberId);
                            batch.update(memberRef, {
                                approver: newLine.approverId
                            });
                        });
                    }

                    await batch.commit();

                    alert('결재선이 수정되었습니다.');
                    setShowAddModal(false);
                    setEditingLineId(null);
                    setNewLine({ name: '', approverId: '', memberIds: [] });
                    loadApprovalLines();
                } catch (error) {
                    alert('수정 실패: ' + error.message);
                }
            };

            const handleMemberToggle = (memberId) => {
                setNewLine(prev => {
                    const memberIds = [...prev.memberIds];
                    const index = memberIds.indexOf(memberId);
                    if (index > -1) {
                        memberIds.splice(index, 1);
                    } else {
                        memberIds.push(memberId);
                    }
                    return { ...prev, memberIds };
                });
            };

            const approvers = employees.filter(emp => emp.isApprover).sort((a, b) => a.name.localeCompare(b.name));

            // 다른 결재선에 포함된 사원 제외
            const getAvailableNonApprovers = () => {
                const allNonApprovers = employees.filter(emp => !emp.isApprover);

                // 수정 모드인 경우
                if (editingLineId) {
                    // 다른 결재선에 포함된 사원 ID 목록
                    const usedMemberIds = new Set();
                    approvalLines.forEach(line => {
                        // 현재 수정 중인 결재선이 아닌 경우만
                        if (line.id !== editingLineId && line.memberIds) {
                            line.memberIds.forEach(id => usedMemberIds.add(id));
                        }
                    });

                    // 다른 결재선에 없는 사원만 반환
                    return allNonApprovers.filter(emp => !usedMemberIds.has(emp.id))
                        .sort((a, b) => a.name.localeCompare(b.name));
                } else {
                    // 신규 등록인 경우
                    const usedMemberIds = new Set();
                    approvalLines.forEach(line => {
                        if (line.memberIds) {
                            line.memberIds.forEach(id => usedMemberIds.add(id));
                        }
                    });

                    return allNonApprovers.filter(emp => !usedMemberIds.has(emp.id))
                        .sort((a, b) => a.name.localeCompare(b.name));
                }
            };

            const nonApprovers = getAvailableNonApprovers();

            const getEmployeeName = (employeeId) => {
                const employee = employees.find(emp => emp.id === employeeId);
                return employee ? employee.name : '알 수 없음';
            };

            const getMembers = (memberIds) => {
                if (!memberIds || memberIds.length === 0) return '-';
                // 존재하는 사원만 필터링
                const validMembers = memberIds
                    .map(id => {
                        const employee = employees.find(emp => emp.id === id);
                        return employee ? employee.name : null;
                    })
                    .filter(name => name !== null);

                return validMembers.length > 0 ? validMembers.join(', ') : '-';
            };

            return (
                <div className="content-card">
                    <div className="admin-section">
                        <h2>결재선 관리</h2>
                        <button className="register-btn" onClick={() => {
                            setEditingLineId(null);
                            setNewLine({ name: '', approverId: '', memberIds: [] });
                            setShowAddModal(true);
                        }}>
                            결재선 등록
                        </button>

                        <div className="employee-list">
                            <table>
                                <thead>
                                    <tr>
                                        <th>결재선 이름</th>
                                        <th>승인자</th>
                                        <th>포함 인원</th>
                                        <th>관리</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {approvalLines.map(line => (
                                        <tr key={line.id}>
                                            <td>{line.name}</td>
                                            <td>{getEmployeeName(line.approverId)}</td>
                                            <td style={{fontSize: '13px'}}>{getMembers(line.memberIds)}</td>
                                            <td>
                                                <div style={{display: 'flex', gap: '5px'}}>
                                                    <button
                                                        onClick={() => handleEditApprovalLine(line)}
                                                        style={{
                                                            padding: '6px 12px',
                                                            background: '#2196F3',
                                                            color: 'white',
                                                            border: 'none',
                                                            borderRadius: '4px',
                                                            cursor: 'pointer',
                                                            fontSize: '12px'
                                                        }}
                                                    >
                                                        수정
                                                    </button>
                                                    <button
                                                        className="delete-btn"
                                                        onClick={() => handleDeleteApprovalLine(line.id)}
                                                    >
                                                        삭제
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    ))}
                                    {approvalLines.length === 0 && (
                                        <tr>
                                            <td colSpan="4" style={{textAlign: 'center', color: '#999', padding: '30px'}}>
                                                등록된 결재선이 없습니다.
                                            </td>
                                        </tr>
                                    )}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    {showAddModal && (
                        <div className="modal" onClick={() => setShowAddModal(false)}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()} style={{maxWidth: '500px'}}>
                                <h3>{editingLineId ? '결재선 수정' : '결재선 등록'}</h3>
                                <div className="form-group">
                                    <label>결재선 이름</label>
                                    <input
                                        type="text"
                                        value={newLine.name}
                                        onChange={(e) => setNewLine({...newLine, name: e.target.value})}
                                        placeholder="예: 개발팀 결재선"
                                    />
                                </div>
                                <div className="form-group">
                                    <label>승인자 선택</label>
                                    <select
                                        value={newLine.approverId}
                                        onChange={(e) => setNewLine({...newLine, approverId: e.target.value})}
                                        style={{
                                            width: '100%',
                                            padding: '12px',
                                            border: '1px solid #ddd',
                                            borderRadius: '6px',
                                            fontSize: '14px'
                                        }}
                                    >
                                        <option value="">승인자 선택</option>
                                        {approvers.map(approver => (
                                            <option key={approver.id} value={approver.id}>
                                                {approver.name}
                                            </option>
                                        ))}
                                    </select>
                                </div>
                                <div className="form-group">
                                    <label>포함 인원 선택 (다중 선택 가능)</label>
                                    <div style={{
                                        border: '1px solid #ddd',
                                        borderRadius: '6px',
                                        padding: '6px 8px 6px 2px',
                                        maxHeight: '200px',
                                        overflowY: 'auto',
                                        textAlign: 'left'
                                    }}>
                                        {nonApprovers.length === 0 ? (
                                            <div style={{color: '#999', padding: '10px', textAlign: 'center'}}>
                                                선택 가능한 사원이 없습니다.
                                            </div>
                                        ) : (
                                            nonApprovers.map(emp => (
                                                <label key={emp.id} style={{
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    justifyContent: 'flex-start',
                                                    padding: '4px 0',
                                                    cursor: 'pointer',
                                                    borderRadius: '4px',
                                                    transition: 'background 0.2s',
                                                    marginBottom: '2px'
                                                }}
                                                onMouseEnter={(e) => e.currentTarget.style.background = '#f5f5f5'}
                                                onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}
                                                >
                                                    <input
                                                        type="checkbox"
                                                        checked={newLine.memberIds.includes(emp.id)}
                                                        onChange={() => handleMemberToggle(emp.id)}
                                                        style={{
                                                            margin: '0 5px 0 0',
                                                            cursor: 'pointer',
                                                            width: '16px',
                                                            height: '16px',
                                                            flexShrink: 0
                                                        }}
                                                    />
                                                    <span style={{fontSize: '13px'}}>
                                                        {emp.name}
                                                        <span style={{color: '#666', fontSize: '11px', marginLeft: '4px'}}>
                                                            ({emp.email})
                                                        </span>
                                                    </span>
                                                </label>
                                            ))
                                        )}
                                    </div>
                                </div>
                                <div className="modal-buttons">
                                    <button className="btn-secondary" onClick={() => {
                                        setShowAddModal(false);
                                        setEditingLineId(null);
                                        setNewLine({ name: '', approverId: '', memberIds: [] });
                                    }}>
                                        취소
                                    </button>
                                    <button className="btn-primary" onClick={editingLineId ? handleUpdateApprovalLine : handleAddApprovalLine}>
                                        {editingLineId ? '수정' : '등록'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // 연차 승인 관리 컴포넌트
        function ApprovalManagement({ user, setPendingCount }) {
            const [pendingRequests, setPendingRequests] = useState([]);
            const [myEmployees, setMyEmployees] = useState([]);

            useEffect(() => {
                loadMyEmployees();
            }, []);

            const loadMyEmployees = async () => {
                try {
                    const snapshot = await db.collection('employees')
                        .where('approver', '==', user.uid)
                        .get();

                    const employees = [];
                    snapshot.forEach(doc => {
                        employees.push({ id: doc.id, ...doc.data() });
                    });

                    setMyEmployees(employees);

                    if (employees.length > 0) {
                        loadPendingRequests(employees.map(emp => emp.id));
                    }
                } catch (error) {
                    console.error('담당 사원 목록 로드 실패:', error);
                }
            };

            const loadPendingRequests = async (employeeIds) => {
                try {
                    // pending과 deletion-pending 모두 조회
                    const pendingSnapshot = await db.collection('leaveUsage')
                        .where('approvalStatus', '==', 'pending')
                        .get();

                    const deletionSnapshot = await db.collection('leaveUsage')
                        .where('approvalStatus', '==', 'deletion-pending')
                        .get();

                    const requests = [];

                    // pending 처리
                    for (const doc of pendingSnapshot.docs) {
                        const data = doc.data();
                        if (employeeIds.includes(data.userId)) {
                            const userDoc = await db.collection('employees').doc(data.userId).get();
                            requests.push({
                                id: doc.id,
                                ...data,
                                userName: userDoc.exists ? userDoc.data().name : data.userId,
                                requestType: 'approval'
                            });
                        }
                    }

                    // deletion-pending 처리
                    for (const doc of deletionSnapshot.docs) {
                        const data = doc.data();
                        if (employeeIds.includes(data.userId)) {
                            const userDoc = await db.collection('employees').doc(data.userId).get();
                            requests.push({
                                id: doc.id,
                                ...data,
                                userName: userDoc.exists ? userDoc.data().name : data.userId,
                                requestType: 'deletion'
                            });
                        }
                    }

                    requests.sort((a, b) => b.date.localeCompare(a.date));
                    setPendingRequests(requests);
                    if (setPendingCount) {
                        setPendingCount(requests.length);
                    }
                } catch (error) {
                    console.error('승인 대기 목록 로드 실패:', error);
                }
            };

            const handleApproval = async (requestId, userId, date, status) => {
                try {
                    await db.collection('leaveUsage').doc(requestId).update({
                        approvalStatus: status,
                        approvedBy: user.uid,
                        approvedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    const scheduleSnapshot = await db.collection('schedules')
                        .where('userId', '==', userId)
                        .where('date', '==', date)
                        .get();

                    scheduleSnapshot.forEach(async (doc) => {
                        await doc.ref.update({
                            approvalStatus: status,
                            approvedBy: user.uid,
                            approvedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    });

                    // 신청자에게 알림 생성
                    await db.collection('notifications').add({
                        userId: userId,
                        title: status === 'approved' ? '연차 승인' : '연차 반려',
                        message: `${date} 연차 신청이 ${status === 'approved' ? '승인' : '반려'}되었습니다.`,
                        type: 'leave-result',
                        read: false,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    alert(status === 'approved' ? '승인되었습니다.' : '반려되었습니다.');
                    loadMyEmployees();
                } catch (error) {
                    alert('처리 실패: ' + error.message);
                }
            };

            const handleDeletionApproval = async (requestId, userId, date) => {
                try {
                    // 취소 승인 - cancelled 상태로 변경
                    await db.collection('leaveUsage').doc(requestId).update({
                        approvalStatus: 'cancelled',
                        cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    const scheduleSnapshot = await db.collection('schedules')
                        .where('userId', '==', userId)
                        .where('date', '==', date)
                        .get();

                    scheduleSnapshot.forEach(async (doc) => {
                        await doc.ref.update({
                            approvalStatus: 'cancelled',
                            cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    });

                    // 신청자에게 알림 생성
                    await db.collection('notifications').add({
                        userId: userId,
                        title: '연차 취소 승인',
                        message: `${date} 연차 취소가 승인되었습니다.`,
                        type: 'leave-cancellation',
                        read: false,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    alert('취소가 승인되었습니다.');
                    loadMyEmployees();
                    loadPendingRequests();
                } catch (error) {
                    alert('처리 실패: ' + error.message);
                }
            };

            const handleDeletionRejection = async (requestId, userId, date) => {
                try {
                    // 취소 반려 - 원래 승인완료 상태로 복구
                    await db.collection('leaveUsage').doc(requestId).update({
                        approvalStatus: 'approved'
                    });

                    const scheduleSnapshot = await db.collection('schedules')
                        .where('userId', '==', userId)
                        .where('date', '==', date)
                        .get();

                    scheduleSnapshot.forEach(async (doc) => {
                        await doc.ref.update({
                            approvalStatus: 'approved'
                        });
                    });

                    // 신청자에게 알림 생성
                    await db.collection('notifications').add({
                        userId: userId,
                        title: '연차 취소 반려',
                        message: `${date} 연차 취소가 반려되었습니다.`,
                        type: 'leave-cancellation',
                        read: false,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    alert('취소가 반려되었습니다.');
                    loadMyEmployees();
                    loadPendingRequests();
                } catch (error) {
                    alert('처리 실패: ' + error.message);
                }
            };

            return (
                <div className="content-card">
                    <h2 style={{marginBottom: '20px'}}>연차 승인 관리</h2>

                    <div className="employee-section" style={{
                        background: '#f5f5f5',
                        padding: '15px',
                        borderRadius: '8px',
                        marginBottom: '20px'
                    }}>
                        <h3 style={{fontSize: '16px', marginBottom: '10px'}}>담당 사원 목록</h3>
                        {myEmployees.length > 0 ? (
                            <div style={{display: 'flex', gap: '10px', flexWrap: 'wrap'}}>
                                {myEmployees.map(emp => (
                                    <span key={emp.id} style={{
                                        background: 'white',
                                        padding: '6px 12px',
                                        borderRadius: '4px',
                                        fontSize: '14px',
                                        border: '1px solid #ddd'
                                    }}>
                                        {emp.name}
                                    </span>
                                ))}
                            </div>
                        ) : (
                            <p style={{color: '#666', fontSize: '14px'}}>담당 사원이 없습니다. 관리자에게 문의하세요.</p>
                        )}
                    </div>

                    <h3 style={{fontSize: '16px', marginBottom: '15px'}}>승인 대기 목록</h3>
                    {pendingRequests.length > 0 ? (
                        <div className="approval-list" style={{display: 'grid', gap: '15px'}}>
                            {pendingRequests.map(request => (
                                <div key={request.id} className="approval-card" style={{
                                    background: 'white',
                                    border: '1px solid #e0e0e0',
                                    borderRadius: '12px',
                                    padding: '20px',
                                    boxShadow: '0 2px 4px rgba(0,0,0,0.05)',
                                    transition: 'all 0.2s',
                                    ':hover': {
                                        boxShadow: '0 4px 8px rgba(0,0,0,0.1)'
                                    }
                                }}>
                                    <div className="approval-card-content" style={{
                                        display: 'grid',
                                        gridTemplateColumns: '1fr 1fr 1fr auto',
                                        gap: '20px',
                                        alignItems: 'center'
                                    }}>
                                        {/* 사원 정보 */}
                                        <div>
                                            <div style={{
                                                fontSize: '12px',
                                                color: '#999',
                                                marginBottom: '4px'
                                            }}>사원명</div>
                                            <div style={{
                                                fontSize: '18px',
                                                fontWeight: '600',
                                                color: '#333'
                                            }}>{request.userName}</div>
                                        </div>

                                        {/* 연차 정보 */}
                                        <div>
                                            <div style={{
                                                fontSize: '12px',
                                                color: '#999',
                                                marginBottom: '4px'
                                            }}>
                                                {request.requestType === 'deletion' ? '🗑️ 삭제 요청' : '연차 내용'}
                                            </div>
                                            <div style={{
                                                fontSize: '16px',
                                                fontWeight: '500',
                                                color: '#333'
                                            }}>
                                                {request.requestType === 'deletion' && (
                                                    <span style={{
                                                        background: '#ff4444',
                                                        color: 'white',
                                                        padding: '2px 8px',
                                                        borderRadius: '4px',
                                                        fontSize: '12px',
                                                        marginRight: '8px'
                                                    }}>취소 요청</span>
                                                )}
                                                {request.type}
                                                <span style={{
                                                    marginLeft: '8px',
                                                    color: '#666',
                                                    fontSize: '14px'
                                                }}>
                                                    ({request.amount > 0 ? `${request.amount}일` : '무급'})
                                                </span>
                                            </div>
                                            <div style={{
                                                fontSize: '14px',
                                                color: '#666',
                                                marginTop: '4px'
                                            }}>
                                                📅 {request.date}
                                            </div>
                                        </div>

                                        {/* 신청일 */}
                                        <div>
                                            <div style={{
                                                fontSize: '12px',
                                                color: '#999',
                                                marginBottom: '4px'
                                            }}>신청일</div>
                                            <div style={{
                                                fontSize: '14px',
                                                color: '#666'
                                            }}>
                                                {request.createdAt ? new Date(request.createdAt.toDate()).toLocaleDateString('ko-KR', {
                                                    year: 'numeric',
                                                    month: 'long',
                                                    day: 'numeric'
                                                }) : '-'}
                                            </div>
                                        </div>

                                        {/* 승인/반려 버튼 */}
                                        <div className="approval-buttons" style={{display: 'flex', gap: '8px'}}>
                                            {request.requestType === 'deletion' ? (
                                                <>
                                                    <button
                                                        onClick={() => handleDeletionApproval(request.id, request.userId, request.date)}
                                                        style={{
                                                            padding: '10px 20px',
                                                            background: '#4CAF50',
                                                            color: 'white',
                                                            border: 'none',
                                                            borderRadius: '8px',
                                                            cursor: 'pointer',
                                                            fontSize: '14px',
                                                            fontWeight: '600',
                                                            transition: 'all 0.2s',
                                                            minWidth: '100px'
                                                        }}
                                                        onMouseOver={(e) => e.target.style.background = '#45a049'}
                                                        onMouseOut={(e) => e.target.style.background = '#4CAF50'}
                                                    >
                                                        ✓ 삭제 승인
                                                    </button>
                                                    <button
                                                        onClick={() => handleDeletionRejection(request.id, request.userId, request.date)}
                                                        style={{
                                                            padding: '10px 20px',
                                                            background: '#ff4444',
                                                            color: 'white',
                                                            border: 'none',
                                                            borderRadius: '8px',
                                                            cursor: 'pointer',
                                                            fontSize: '14px',
                                                            fontWeight: '600',
                                                            transition: 'all 0.2s',
                                                            minWidth: '100px'
                                                        }}
                                                        onMouseOver={(e) => e.target.style.background = '#cc0000'}
                                                        onMouseOut={(e) => e.target.style.background = '#ff4444'}
                                                    >
                                                        ✕ 삭제 반려
                                                    </button>
                                                </>
                                            ) : (
                                                <>
                                                    <button
                                                        onClick={() => handleApproval(request.id, request.userId, request.date, 'approved')}
                                                        style={{
                                                            padding: '10px 20px',
                                                            background: '#4CAF50',
                                                            color: 'white',
                                                            border: 'none',
                                                            borderRadius: '8px',
                                                            cursor: 'pointer',
                                                            fontSize: '14px',
                                                            fontWeight: '600',
                                                            transition: 'all 0.2s',
                                                            minWidth: '80px'
                                                        }}
                                                        onMouseOver={(e) => e.target.style.background = '#45a049'}
                                                        onMouseOut={(e) => e.target.style.background = '#4CAF50'}
                                                    >
                                                        ✓ 승인
                                                    </button>
                                                    <button
                                                        onClick={() => handleApproval(request.id, request.userId, request.date, 'rejected')}
                                                        style={{
                                                            padding: '10px 20px',
                                                            background: '#ff4444',
                                                            color: 'white',
                                                            border: 'none',
                                                            borderRadius: '8px',
                                                            cursor: 'pointer',
                                                            fontSize: '14px',
                                                            fontWeight: '600',
                                                            transition: 'all 0.2s',
                                                            minWidth: '80px'
                                                        }}
                                                        onMouseOver={(e) => e.target.style.background = '#cc0000'}
                                                        onMouseOut={(e) => e.target.style.background = '#ff4444'}
                                                    >
                                                        ✕ 반려
                                                    </button>
                                                </>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    ) : (
                        <div style={{
                            padding: '80px 20px',
                            textAlign: 'center',
                            background: 'white',
                            borderRadius: '12px',
                            border: '2px dashed #e0e0e0'
                        }}>
                            <div style={{
                                fontSize: '48px',
                                marginBottom: '16px'
                            }}>📋</div>
                            <div style={{
                                color: '#999',
                                fontSize: '16px',
                                fontWeight: '500'
                            }}>
                                승인 대기중인 연차 신청이 없습니다.
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // 관리자용 사원 연차 관리 컴포넌트
        function AdminLeaveManagement() {
            const [employees, setEmployees] = useState([]);
            const [selectedEmployee, setSelectedEmployee] = useState(null);
            const [leaveUsage, setLeaveUsage] = useState([]);
            const [currentPage, setCurrentPage] = useState(1);
            const itemsPerPage = 10;
            const [editingTotalLeave, setEditingTotalLeave] = useState(false);
            const [tempTotalLeave, setTempTotalLeave] = useState(0);
            const [totalLeaveNote, setTotalLeaveNote] = useState('');
            const [editingUsedLeave, setEditingUsedLeave] = useState(false);
            const [tempUsedLeave, setTempUsedLeave] = useState(0);
            const [usedLeaveNote, setUsedLeaveNote] = useState('');
            const [isMobileModalOpen, setIsMobileModalOpen] = useState(false);
            const [searchTerm, setSearchTerm] = useState('');

            useEffect(() => {
                loadEmployees();
            }, []);

            const loadEmployees = async () => {
                const snapshot = await db.collection('employees').get();
                const employeeList = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    // 관리자와 이병윤 제외
                    if (data.name !== '관리자' && data.name !== '이병윤') {
                        employeeList.push({ id: doc.id, ...data });
                    }
                });
                setEmployees(employeeList);
            };

            // 검색된 사원 목록
            const getFilteredEmployees = () => {
                return employees.filter(emp =>
                    emp.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    emp.email.toLowerCase().includes(searchTerm.toLowerCase())
                );
            };

            // 전체 사원 연차 현황 엑셀 내보내기
            const exportAllToExcel = () => {
                const data = employees.map((emp, index) => {
                    const totalLeave = emp.totalLeave !== undefined
                        ? emp.totalLeave
                        : calculateTotalLeave(emp.joinDate);
                    const usedLeave = emp.usedLeave || 0;
                    const remainingLeave = totalLeave - usedLeave;

                    return {
                        '번호': index + 1,
                        '이름': emp.name,
                        '이메일': emp.email,
                        '입사일': emp.joinDate || '-',
                        '총 연차': totalLeave,
                        '사용 연차': usedLeave,
                        '잔여 연차': remainingLeave,
                        '사용률': totalLeave > 0 ? `${Math.round((usedLeave / totalLeave) * 100)}%` : '0%'
                    };
                });

                const ws = XLSX.utils.json_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "사원연차현황");

                const today = new Date().toISOString().split('T')[0];
                XLSX.writeFile(wb, `사원연차현황_${today}.xlsx`);
            };

            // 선택된 사원의 연차 내역 엑셀 내보내기
            const exportEmployeeLeaveToExcel = (emp) => {
                if (!emp) return;

                const data = leaveUsage.map((usage, index) => ({
                    '번호': index + 1,
                    '날짜': usage.startDate || usage.date,
                    '종료일': usage.endDate || usage.date,
                    '유형': usage.type,
                    '일수': usage.amount || usage.totalDays || 1,
                    '상태': usage.approvalStatus === 'approved' ? '승인' :
                           usage.approvalStatus === 'pending' ? '대기' :
                           usage.approvalStatus === 'rejected' ? '거절' :
                           usage.approvalStatus === 'cancelled' ? '취소' : '-',
                    '비고': usage.note || '-'
                }));

                const ws = XLSX.utils.json_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, `${emp.name}_연차내역`);

                const today = new Date().toISOString().split('T')[0];
                XLSX.writeFile(wb, `${emp.name}_연차내역_${today}.xlsx`);
            };

            const loadEmployeeLeaveUsage = async (employeeId) => {
                try {
                    const snapshot = await db.collection('leaveUsage')
                        .where('userId', '==', employeeId)
                        .get();

                    const allUsage = [];
                    snapshot.forEach(doc => {
                        allUsage.push({ id: doc.id, ...doc.data() });
                    });

                    // groupId로 그룹핑
                    const groupedUsage = {};
                    const ungroupedUsage = [];

                    allUsage.forEach(item => {
                        if (item.groupId) {
                            if (!groupedUsage[item.groupId]) {
                                groupedUsage[item.groupId] = {
                                    id: item.groupId,
                                    ids: [item.id],
                                    userId: item.userId,
                                    startDate: item.startDate || item.date,
                                    endDate: item.endDate || item.date,
                                    date: item.startDate || item.date,
                                    type: item.type,
                                    amount: item.amount,
                                    totalDays: item.totalDays || 1,
                                    note: item.note,
                                    approvalStatus: item.approvalStatus,
                                    createdAt: item.createdAt,
                                    groupId: item.groupId,
                                    isGrouped: true
                                };
                            } else {
                                groupedUsage[item.groupId].ids.push(item.id);
                            }
                        } else {
                            ungroupedUsage.push(item);
                        }
                    });

                    const usage = [...Object.values(groupedUsage), ...ungroupedUsage];
                    usage.sort((a, b) => (b.startDate || b.date).localeCompare(a.startDate || a.date));
                    setLeaveUsage(usage);
                } catch (error) {
                    console.error('연차 내역 로드 실패:', error);
                }
            };

            const handleSelectEmployee = (employee) => {
                setSelectedEmployee(employee);
                loadEmployeeLeaveUsage(employee.id);

                // 모바일 화면에서는 모달 열기
                if (window.innerWidth <= 768) {
                    setIsMobileModalOpen(true);
                    document.body.style.overflow = 'hidden';
                }
            };

            const handleCloseModal = () => {
                setIsMobileModalOpen(false);
                document.body.style.overflow = 'auto';
            };

            const calculateTotalLeave = (joinDate) => {
                if (!joinDate) return 0;
                const join = new Date(joinDate);
                const now = new Date();
                const years = now.getFullYear() - join.getFullYear();

                if (years < 1) {
                    const months = (now.getFullYear() - join.getFullYear()) * 12 + (now.getMonth() - join.getMonth());
                    return Math.floor(months);
                }

                return 15 + Math.min(years - 1, 10);
            };

            const calculateUsedLeave = () => {
                // customUsedLeave가 설정되어 있으면 그 값 사용
                if (selectedEmployee?.customUsedLeave !== undefined && selectedEmployee?.customUsedLeave !== null) {
                    return selectedEmployee.customUsedLeave;
                }
                // 승인된 연차만 카운트
                return leaveUsage
                    .filter(usage => usage.approvalStatus === 'approved')
                    .reduce((sum, usage) => sum + usage.amount, 0);
            };

            const handleDeleteUsedLeave = async (usageIdOrGroup, usageDate, usageType, groupId) => {
                // 수정 건인지 확인 (총연차 수정, 사용연차 수정)
                const isEditRecord = usageType === '총연차 수정' || usageType === '사용연차 수정';
                const isGrouped = !!groupId;
                const usageIds = isGrouped ? usageIdOrGroup.ids : [usageIdOrGroup];

                let confirmMsg;
                if (isEditRecord) {
                    confirmMsg = '이 수정 내역을 삭제하시겠습니까?';
                } else if (isGrouped) {
                    confirmMsg = `${usageIdOrGroup.startDate} ~ ${usageIdOrGroup.endDate} (${usageIdOrGroup.totalDays}일) 연차 내역을 모두 취소하시겠습니까?`;
                } else {
                    confirmMsg = '이 연차 내역을 취소하시겠습니까?';
                }

                if (!confirm(confirmMsg)) return;

                try {
                    if (isEditRecord) {
                        // 수정 건은 바로 삭제
                        await db.collection('leaveUsage').doc(usageIdOrGroup).delete();

                        // customUsedLeave 또는 customTotalLeave 초기화
                        if (usageType === '사용연차 수정') {
                            await db.collection('employees').doc(selectedEmployee.id).update({
                                customUsedLeave: firebase.firestore.FieldValue.delete()
                            });
                            // selectedEmployee 상태 업데이트
                            const updatedEmployee = { ...selectedEmployee };
                            delete updatedEmployee.customUsedLeave;
                            setSelectedEmployee(updatedEmployee);
                        } else if (usageType === '총연차 수정') {
                            await db.collection('employees').doc(selectedEmployee.id).update({
                                customTotalLeave: firebase.firestore.FieldValue.delete()
                            });
                            // selectedEmployee 상태 업데이트
                            const updatedEmployee = { ...selectedEmployee };
                            delete updatedEmployee.customTotalLeave;
                            setSelectedEmployee(updatedEmployee);
                        }

                        alert('삭제되었습니다.');
                        // 사원 목록도 새로고침
                        loadEmployees();
                    } else {
                        // 일반 연차는 취소 상태로 변경
                        for (const id of usageIds) {
                            await db.collection('leaveUsage').doc(id).update({
                                approvalStatus: 'cancelled',
                                cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        }

                        // 해당 날짜의 스케줄도 취소 상태로 변경
                        if (groupId) {
                            const scheduleSnapshot = await db.collection('schedules')
                                .where('userId', '==', selectedEmployee.id)
                                .where('groupId', '==', groupId)
                                .get();

                            scheduleSnapshot.forEach(async (doc) => {
                                await doc.ref.update({
                                    approvalStatus: 'cancelled',
                                    cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                });
                            });
                        } else {
                            const scheduleSnapshot = await db.collection('schedules')
                                .where('userId', '==', selectedEmployee.id)
                                .where('date', '==', usageDate)
                                .where('type', '==', usageType)
                                .get();

                            scheduleSnapshot.forEach(async (doc) => {
                                await doc.ref.update({
                                    approvalStatus: 'cancelled',
                                    cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                });
                            });
                        }

                        alert('취소되었습니다.');
                    }

                    loadEmployeeLeaveUsage(selectedEmployee.id);
                } catch (error) {
                    alert('처리 실패: ' + error.message);
                }
            };

            const handleStartEditTotalLeave = () => {
                setTempTotalLeave(selectedEmployee.customTotalLeave || calculateTotalLeave(selectedEmployee.joinDate));
                setTotalLeaveNote('');
                setEditingTotalLeave(true);
            };

            const handleSaveTotalLeave = async () => {
                if (!selectedEmployee) return;

                try {
                    const oldValue = selectedEmployee.customTotalLeave || calculateTotalLeave(selectedEmployee.joinDate);
                    const newValue = parseFloat(tempTotalLeave);

                    // employees 컬렉션 업데이트
                    await db.collection('employees').doc(selectedEmployee.id).update({
                        customTotalLeave: newValue
                    });

                    // leaveUsage에 수정 이력 추가
                    const today = new Date();
                    const dateStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;

                    await db.collection('leaveUsage').add({
                        userId: selectedEmployee.id,
                        date: dateStr,
                        type: '총연차 수정',
                        amount: newValue,
                        note: totalLeaveNote || `${oldValue}일 → ${newValue}일`,
                        approvalStatus: '-',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    alert('연차 수량이 수정되었습니다.');
                    setEditingTotalLeave(false);
                    setTotalLeaveNote('');
                    loadEmployees();

                    // 선택된 사원 정보 업데이트 및 연차 내역 새로고침
                    const updatedEmployee = { ...selectedEmployee, customTotalLeave: newValue };
                    setSelectedEmployee(updatedEmployee);
                    loadEmployeeLeaveUsage(selectedEmployee.id);
                } catch (error) {
                    alert('수정 실패: ' + error.message);
                }
            };

            const handleCancelEditTotalLeave = () => {
                setEditingTotalLeave(false);
                setTotalLeaveNote('');
            };

            const handleStartEditUsedLeave = () => {
                setTempUsedLeave(calculateUsedLeave());
                setUsedLeaveNote('');
                setEditingUsedLeave(true);
            };

            const handleSaveUsedLeave = async () => {
                if (!selectedEmployee) return;

                try {
                    const oldValue = calculateUsedLeave();
                    const newValue = parseFloat(tempUsedLeave);

                    // employees 컬렉션 업데이트
                    await db.collection('employees').doc(selectedEmployee.id).update({
                        customUsedLeave: newValue
                    });

                    // leaveUsage에 수정 이력 추가
                    const today = new Date();
                    const dateStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;

                    await db.collection('leaveUsage').add({
                        userId: selectedEmployee.id,
                        date: dateStr,
                        type: '사용연차 수정',
                        amount: newValue,
                        note: usedLeaveNote || `${oldValue}일 → ${newValue}일`,
                        approvalStatus: '-',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    alert('사용 연차가 수정되었습니다.');
                    setEditingUsedLeave(false);
                    setUsedLeaveNote('');
                    loadEmployees();

                    // 선택된 사원 정보 업데이트 및 연차 내역 새로고침
                    const updatedEmployee = { ...selectedEmployee, customUsedLeave: newValue };
                    setSelectedEmployee(updatedEmployee);
                    loadEmployeeLeaveUsage(selectedEmployee.id);
                } catch (error) {
                    alert('수정 실패: ' + error.message);
                }
            };

            const handleCancelEditUsedLeave = () => {
                setEditingUsedLeave(false);
                setUsedLeaveNote('');
            };

            return (
                <div className="content-card">
                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px'}}>
                        <h2 style={{margin: 0}}>사원 연차 관리</h2>
                        <button className="export-btn" onClick={exportAllToExcel}>
                            <span>전체 엑셀 다운로드</span>
                        </button>
                    </div>

                    <div style={{display: 'grid', gridTemplateColumns: '300px 1fr', gap: '30px'}}>
                        {/* 사원 목록 */}
                        <div>
                            <h3 style={{marginBottom: '15px', fontSize: '16px'}}>사원 목록</h3>

                            {/* 검색 바 */}
                            <input
                                type="text"
                                className="search-input"
                                placeholder="🔍 이름, 이메일 검색..."
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                                style={{marginBottom: '10px', width: '100%'}}
                            />

                            <div style={{
                                border: '1px solid #ddd',
                                borderRadius: '8px',
                                maxHeight: '600px',
                                overflowY: 'auto'
                            }}>
                                {getFilteredEmployees().map(emp => (
                                    <div
                                        key={emp.id}
                                        onClick={() => handleSelectEmployee(emp)}
                                        style={{
                                            padding: '15px',
                                            borderBottom: '1px solid #eee',
                                            cursor: 'pointer',
                                            background: selectedEmployee?.id === emp.id ? '#e8f5e9' : 'white',
                                            transition: 'background 0.2s'
                                        }}
                                        onMouseEnter={(e) => {
                                            if (selectedEmployee?.id !== emp.id) {
                                                e.target.style.background = '#f5f5f5';
                                            }
                                        }}
                                        onMouseLeave={(e) => {
                                            if (selectedEmployee?.id !== emp.id) {
                                                e.target.style.background = 'white';
                                            }
                                        }}
                                    >
                                        <div style={{fontWeight: '600', marginBottom: '5px'}}>{emp.name}</div>
                                        <div style={{fontSize: '13px', color: '#666'}}>{emp.email}</div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* 선택된 사원의 연차 정보 */}
                        <div className={isMobileModalOpen ? 'employee-modal-open' : ''}>
                            {selectedEmployee ? (
                                <>
                                    {/* 모바일 모달 닫기 버튼 */}
                                    {isMobileModalOpen && (
                                        <div className="employee-modal-close">
                                            <button onClick={handleCloseModal}>← 목록으로 돌아가기</button>
                                        </div>
                                    )}

                                    <div style={{
                                        display: 'flex',
                                        justifyContent: 'space-between',
                                        alignItems: 'center',
                                        marginBottom: '20px'
                                    }}>
                                        <h3 style={{fontSize: '18px'}}>{selectedEmployee.name}님의 연차 현황</h3>
                                        <button
                                            className="export-btn"
                                            onClick={() => exportEmployeeLeaveToExcel(selectedEmployee)}
                                            style={{fontSize: '13px', padding: '8px 15px'}}
                                        >
                                            <span>📄</span>
                                            <span>내역 다운로드</span>
                                        </button>
                                    </div>

                                    <div className="annual-leave-info">
                                        <div className="info-card">
                                            <h4>입사일</h4>
                                            <div className="value">{selectedEmployee.joinDate}</div>
                                        </div>
                                        <div className="info-card">
                                            <h4>총 연차</h4>
                                            <div className="value" style={{display: 'flex', alignItems: 'center', gap: '10px', flexWrap: 'wrap'}}>
                                                {editingTotalLeave ? (
                                                    <div style={{width: '100%'}}>
                                                        <div style={{display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '10px'}}>
                                                            <input
                                                                type="number"
                                                                value={tempTotalLeave}
                                                                onChange={(e) => setTempTotalLeave(e.target.value)}
                                                                style={{
                                                                    width: '80px',
                                                                    padding: '5px',
                                                                    fontSize: '16px',
                                                                    border: '2px solid #4CAF50',
                                                                    borderRadius: '4px'
                                                                }}
                                                                autoFocus
                                                            />
                                                            <button
                                                                onClick={handleSaveTotalLeave}
                                                                style={{
                                                                    padding: '5px 10px',
                                                                    background: '#4CAF50',
                                                                    color: 'white',
                                                                    border: 'none',
                                                                    borderRadius: '4px',
                                                                    cursor: 'pointer',
                                                                    fontSize: '12px'
                                                                }}
                                                            >
                                                                저장
                                                            </button>
                                                            <button
                                                                onClick={handleCancelEditTotalLeave}
                                                                style={{
                                                                    padding: '5px 10px',
                                                                    background: '#999',
                                                                    color: 'white',
                                                                    border: 'none',
                                                                    borderRadius: '4px',
                                                                    cursor: 'pointer',
                                                                    fontSize: '12px'
                                                                }}
                                                            >
                                                                취소
                                                            </button>
                                                        </div>
                                                        <input
                                                            type="text"
                                                            value={totalLeaveNote}
                                                            onChange={(e) => setTotalLeaveNote(e.target.value)}
                                                            placeholder="수정 사유를 입력하세요"
                                                            style={{
                                                                width: '100%',
                                                                padding: '8px',
                                                                fontSize: '13px',
                                                                border: '1px solid #ddd',
                                                                borderRadius: '4px'
                                                            }}
                                                        />
                                                    </div>
                                                ) : (
                                                    <>
                                                        {selectedEmployee.customTotalLeave || calculateTotalLeave(selectedEmployee.joinDate)}일
                                                        <button
                                                            onClick={handleStartEditTotalLeave}
                                                            style={{
                                                                padding: '4px 10px',
                                                                background: '#2196F3',
                                                                color: 'white',
                                                                border: 'none',
                                                                borderRadius: '4px',
                                                                cursor: 'pointer',
                                                                fontSize: '12px',
                                                                marginLeft: '10px'
                                                            }}
                                                        >
                                                            수정
                                                        </button>
                                                    </>
                                                )}
                                            </div>
                                        </div>
                                        <div className="info-card">
                                            <h4>사용 연차</h4>
                                            <div className="value" style={{display: 'flex', alignItems: 'center', gap: '10px', flexWrap: 'wrap'}}>
                                                {editingUsedLeave ? (
                                                    <div style={{width: '100%'}}>
                                                        <div style={{display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '10px'}}>
                                                            <input
                                                                type="number"
                                                                value={tempUsedLeave}
                                                                onChange={(e) => setTempUsedLeave(e.target.value)}
                                                                style={{
                                                                    width: '80px',
                                                                    padding: '5px',
                                                                    fontSize: '16px',
                                                                    border: '2px solid #FF9800',
                                                                    borderRadius: '4px'
                                                                }}
                                                                autoFocus
                                                            />
                                                            <button
                                                                onClick={handleSaveUsedLeave}
                                                                style={{
                                                                    padding: '5px 10px',
                                                                    background: '#4CAF50',
                                                                    color: 'white',
                                                                    border: 'none',
                                                                    borderRadius: '4px',
                                                                    cursor: 'pointer',
                                                                    fontSize: '12px'
                                                                }}
                                                            >
                                                                저장
                                                            </button>
                                                            <button
                                                                onClick={handleCancelEditUsedLeave}
                                                                style={{
                                                                    padding: '5px 10px',
                                                                    background: '#999',
                                                                    color: 'white',
                                                                    border: 'none',
                                                                    borderRadius: '4px',
                                                                    cursor: 'pointer',
                                                                    fontSize: '12px'
                                                                }}
                                                            >
                                                                취소
                                                            </button>
                                                        </div>
                                                        <input
                                                            type="text"
                                                            value={usedLeaveNote}
                                                            onChange={(e) => setUsedLeaveNote(e.target.value)}
                                                            placeholder="수정 사유를 입력하세요"
                                                            style={{
                                                                width: '100%',
                                                                padding: '8px',
                                                                fontSize: '13px',
                                                                border: '1px solid #ddd',
                                                                borderRadius: '4px'
                                                            }}
                                                        />
                                                    </div>
                                                ) : (
                                                    <>
                                                        {calculateUsedLeave()}일
                                                        <button
                                                            onClick={handleStartEditUsedLeave}
                                                            style={{
                                                                padding: '4px 10px',
                                                                background: '#FF9800',
                                                                color: 'white',
                                                                border: 'none',
                                                                borderRadius: '4px',
                                                                cursor: 'pointer',
                                                                fontSize: '12px',
                                                                marginLeft: '10px'
                                                            }}
                                                        >
                                                            수정
                                                        </button>
                                                    </>
                                                )}
                                            </div>
                                        </div>
                                        <div className="info-card">
                                            <h4>남은 연차</h4>
                                            <div className="value" style={{color: '#4CAF50'}}>
                                                {(selectedEmployee.customTotalLeave || calculateTotalLeave(selectedEmployee.joinDate)) - calculateUsedLeave()}일
                                            </div>
                                        </div>
                                    </div>

                                    <div className="leave-history" style={{marginTop: '30px'}}>
                                        <h3>연차 사용 내역</h3>
                                        {leaveUsage.length > 0 ? (
                                            <>
                                            <table>
                                                <thead>
                                                    <tr>
                                                        <th>날짜</th>
                                                        <th>유형</th>
                                                        <th>사용일수</th>
                                                        <th>비고</th>
                                                        <th>승인 상태</th>
                                                        <th>관리</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {(() => {
                                                        const startIndex = (currentPage - 1) * itemsPerPage;
                                                        const endIndex = startIndex + itemsPerPage;
                                                        const currentItems = leaveUsage.slice(startIndex, endIndex);
                                                        return currentItems.map(usage => {
                                                            const isEditRecord = usage.type === '총연차 수정' || usage.type === '사용연차 수정';
                                                            return (
                                                            <tr key={usage.id}>
                                                                <td>
                                                                    {usage.isGrouped && usage.startDate !== usage.endDate
                                                                        ? `${usage.startDate} ~ ${usage.endDate}`
                                                                        : (usage.startDate || usage.date)}
                                                                </td>
                                                                <td>{usage.type}</td>
                                                                <td>
                                                                    {usage.isGrouped && usage.totalDays > 1
                                                                        ? `${usage.totalDays}일`
                                                                        : (usage.amount > 0 ? `${usage.amount}일` : '-')}
                                                                </td>
                                                                <td>{usage.note || '-'}</td>
                                                                <td>
                                                                    {usage.approvalStatus === '-' || isEditRecord ? (
                                                                        <span style={{
                                                                            padding: '4px 8px',
                                                                            fontSize: '12px',
                                                                            color: '#999'
                                                                        }}>
                                                                            -
                                                                        </span>
                                                                    ) : (
                                                                        <span style={{
                                                                            padding: '4px 8px',
                                                                            borderRadius: '4px',
                                                                            fontSize: '12px',
                                                                            background: usage.approvalStatus === 'approved' ? '#4CAF50' :
                                                                                       usage.approvalStatus === 'rejected' ? '#ff4444' :
                                                                                       usage.approvalStatus === 'deletion-pending' ? '#9c27b0' :
                                                                                       usage.approvalStatus === 'cancelled' ? '#999' : '#ff9800',
                                                                            color: 'white'
                                                                        }}>
                                                                            {usage.approvalStatus === 'approved' ? '승인완료' :
                                                                             usage.approvalStatus === 'rejected' ? '반려' :
                                                                             usage.approvalStatus === 'deletion-pending' ? '취소대기' :
                                                                             usage.approvalStatus === 'cancelled' ? '취소됨' : '승인대기'}
                                                                        </span>
                                                                    )}
                                                                </td>
                                                                <td>
                                                                    <button
                                                                        className="delete-btn"
                                                                        onClick={() => handleDeleteUsedLeave(
                                                                            usage.isGrouped ? usage : usage.id,
                                                                            usage.date,
                                                                            usage.type,
                                                                            usage.groupId
                                                                        )}
                                                                        style={{fontSize: '12px', padding: '4px 8px'}}
                                                                    >
                                                                        {isEditRecord ? '삭제' : '취소'}
                                                                    </button>
                                                                </td>
                                                            </tr>
                                                        )});
                                                    })()}
                                                </tbody>
                                            </table>
                                            {leaveUsage.length > itemsPerPage && (
                                                <Pagination
                                                    currentPage={currentPage}
                                                    totalPages={Math.ceil(leaveUsage.length / itemsPerPage)}
                                                    onPageChange={setCurrentPage}
                                                />
                                            )}
                                            </>
                                        ) : (
                                            <div style={{padding: '20px', textAlign: 'center', color: '#666'}}>
                                                연차 사용 내역이 없습니다.
                                            </div>
                                        )}
                                    </div>
                                </>
                            ) : (
                                <div style={{
                                    padding: '60px',
                                    textAlign: 'center',
                                    color: '#999',
                                    fontSize: '16px'
                                }}>
                                    사원을 선택해주세요
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        // 메인 앱 컴포넌트
        function App() {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [employees, setEmployees] = useState([]);
            const [isAdmin, setIsAdmin] = useState(false);
            const [isSubAdmin, setIsSubAdmin] = useState(false);
            const [isApprover, setIsApprover] = useState(false);
            const [isPTScheduleEditor, setIsPTScheduleEditor] = useState(false);
            const [pendingCount, setPendingCount] = useState(0);
            const [userName, setUserName] = useState('');
            const [showNotifications, setShowNotifications] = useState(false);
            const [notificationCount, setNotificationCount] = useState(0);

            useEffect(() => {
                let notificationInterval = null;
                
                const unsubscribe = auth.onAuthStateChanged(async (user) => {
                    setUser(user);
                    if (user) {
                        // 관리자 및 승인자 권한 확인
                        const employeeDoc = await db.collection('employees').doc(user.uid).get();
                        if (employeeDoc.exists) {
                            const isAdminUser = employeeDoc.data().isAdmin || false;
                            const isSubAdminUser = employeeDoc.data().isSubAdmin || false;
                            const isApproverUser = employeeDoc.data().isApprover || false;
                            const isPTScheduleEditorUser = employeeDoc.data().isPTScheduleEditor || false;
                            const name = employeeDoc.data().name || user.email;
                            setIsAdmin(isAdminUser);
                            setIsSubAdmin(isSubAdminUser);
                            setIsApprover(isApproverUser);
                            setIsPTScheduleEditor(isPTScheduleEditorUser);
                            setUserName(name);

                            // 승인자라면 대기 건수 바로 로드 (관리자 제외, 부관리자는 포함)
                            if (isApproverUser && !isAdminUser) {
                                loadInitialPendingCount(user.uid);
                            }
                        }
                        loadEmployees();
                        loadUnreadNotificationCount(user.uid);
                        
                        // 10초마다 읽지 않은 알림 수 업데이트
                        notificationInterval = setInterval(() => {
                            loadUnreadNotificationCount(user.uid);
                        }, 10000);
                    }
                    setLoading(false);
                });

                return () => {
                    unsubscribe();
                    if (notificationInterval) {
                        clearInterval(notificationInterval);
                    }
                };
            }, []);

            const loadUnreadNotificationCount = async (userId) => {
                try {
                    const snapshot = await db.collection('notifications')
                        .where('userId', '==', userId)
                        .limit(100)
                        .get();
                    
                    // 클라이언트 측에서 read: false 필터링
                    let unreadCount = 0;
                    snapshot.forEach(doc => {
                        if (doc.data().read === false || doc.data().read === undefined) {
                            unreadCount++;
                        }
                    });
                    
                    setNotificationCount(unreadCount);
                } catch (error) {
                    console.error('읽지 않은 알림 카운트 로드 실패:', error);
                    setNotificationCount(0); // 오류 시 0으로 설정
                }
            };

            const loadInitialPendingCount = async (userId) => {
                try {
                    // 담당 사원 목록 조회
                    const snapshot = await db.collection('employees')
                        .where('approver', '==', userId)
                        .get();

                    const employeeIds = [];
                    snapshot.forEach(doc => {
                        employeeIds.push(doc.id);
                    });

                    if (employeeIds.length > 0) {
                        // pending과 deletion-pending 건수 조회
                        const pendingSnapshot = await db.collection('leaveUsage')
                            .where('approvalStatus', '==', 'pending')
                            .get();

                        const deletionSnapshot = await db.collection('leaveUsage')
                            .where('approvalStatus', '==', 'deletion-pending')
                            .get();

                        let count = 0;

                        // pending 건수 계산
                        pendingSnapshot.forEach(doc => {
                            if (employeeIds.includes(doc.data().userId)) {
                                count++;
                            }
                        });

                        // deletion-pending 건수 계산
                        deletionSnapshot.forEach(doc => {
                            if (employeeIds.includes(doc.data().userId)) {
                                count++;
                            }
                        });

                        setPendingCount(count);
                    }
                } catch (error) {
                    console.error('대기 건수 로드 실패:', error);
                }
            };

            const loadEmployees = async () => {
                const snapshot = await db.collection('employees').get();
                const employeeList = [];
                snapshot.forEach(doc => {
                    employeeList.push({ id: doc.id, ...doc.data() });
                });
                setEmployees(employeeList);
            };

            const handleLogout = async () => {
                await auth.signOut();
                setActiveTab('dashboard');
                setUserName('');
                setIsSubAdmin(false);
            };

            if (loading) {
                return <div style={{textAlign: 'center', padding: '50px'}}>로딩중...</div>;
            }

            if (!user) {
                return <Login onLogin={setUser} />;
            }

            return (
                <div className="app-container">
                    <div className="header">
                        <h1>스케쥴 및 연차 관리</h1>
                        <div className="user-info">
                            <button
                                className="notification-bell"
                                onClick={() => setShowNotifications(!showNotifications)}
                                title="알림"
                            >
                                <svg 
                                    width="20" 
                                    height="20" 
                                    viewBox="0 0 24 24" 
                                    fill="none" 
                                    stroke="currentColor" 
                                    strokeWidth="2" 
                                    strokeLinecap="round" 
                                    strokeLinejoin="round"
                                    style={{display: 'block'}}
                                >
                                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                                    <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                                </svg>
                                {notificationCount > 0 && (
                                    <span className="notification-badge"></span>
                                )}
                            </button>
                            <span>{userName || user.email}</span>
                            {isAdmin && <span style={{
                                background: '#4CAF50',
                                color: 'white',
                                padding: '4px 8px',
                                borderRadius: '4px',
                                fontSize: '12px',
                                marginLeft: '10px'
                            }}>관리자</span>}
                            {isSubAdmin && !isAdmin && <span style={{
                                background: '#009688',
                                color: 'white',
                                padding: '4px 8px',
                                borderRadius: '4px',
                                fontSize: '12px',
                                marginLeft: '10px'
                            }}>부관리자</span>}
                            {isApprover && !isAdmin && <span style={{
                                background: '#2196F3',
                                color: 'white',
                                padding: '4px 8px',
                                borderRadius: '4px',
                                fontSize: '12px',
                                marginLeft: '10px'
                            }}>승인자</span>}
                            {isPTScheduleEditor && <span style={{
                                background: '#FF9800',
                                color: 'white',
                                padding: '4px 8px',
                                borderRadius: '4px',
                                fontSize: '12px',
                                marginLeft: '10px'
                            }}>PT편집자</span>}
                            <button className="logout-btn" onClick={handleLogout}>로그아웃</button>
                        </div>
                    </div>

                    <div className="tabs">
                        <button
                            className={`tab ${activeTab === 'dashboard' ? 'active' : ''}`}
                            onClick={() => setActiveTab('dashboard')}
                        >
                            대시보드
                        </button>
                        <button
                            className={`tab ${activeTab === 'calendar' ? 'active' : ''}`}
                            onClick={() => setActiveTab('calendar')}
                        >
                            일정 캘린더
                        </button>
                        {!isAdmin && (
                            <button
                                className={`tab ${activeTab === 'leave' ? 'active' : ''}`}
                                onClick={() => setActiveTab('leave')}
                            >
                                연차 관리
                            </button>
                        )}
                        <button
                            className={`tab ${activeTab === 'pt-schedule' ? 'active' : ''}`}
                            onClick={() => setActiveTab('pt-schedule')}
                        >
                            PT 스케줄
                        </button>
                        {isApprover && !isAdmin && (
                            <button
                                className={`tab ${activeTab === 'approval' ? 'active' : ''}`}
                                onClick={() => setActiveTab('approval')}
                                style={{position: 'relative'}}
                            >
                                연차 승인
                                {pendingCount > 0 && (
                                    <span style={{
                                        position: 'absolute',
                                        top: '5px',
                                        right: '5px',
                                        background: '#ff4444',
                                        color: 'white',
                                        borderRadius: '50%',
                                        minWidth: '20px',
                                        height: '20px',
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        fontSize: '11px',
                                        fontWeight: 'bold',
                                        padding: '0 5px'
                                    }}>
                                        {pendingCount}
                                    </span>
                                )}
                            </button>
                        )}
                        <button
                            className={`tab ${activeTab === 'department' ? 'active' : ''}`}
                            onClick={() => setActiveTab('department')}
                        >
                            조직 구성
                        </button>
                        {(isAdmin || isSubAdmin) && (
                            <>
                                <button
                                    className={`tab ${activeTab === 'admin-leave' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('admin-leave')}
                                >
                                    사원연차 관리
                                </button>
                                <button
                                    className={`tab ${activeTab === 'approval-line' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('approval-line')}
                                >
                                    결재선 관리
                                </button>
                                <button
                                    className={`tab ${activeTab === 'admin' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('admin')}
                                >
                                    사원 관리
                                </button>
                                <button
                                    className={`tab ${activeTab === 'slack-settings' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('slack-settings')}
                                >
                                    Slack 설정
                                </button>
                            </>
                        )}
                    </div>

                    <NotificationCenter
                        user={user}
                        isOpen={showNotifications}
                        onClose={() => {
                            setShowNotifications(false);
                            loadUnreadNotificationCount(user.uid);
                        }}
                    />

                    {activeTab === 'dashboard' && <Dashboard user={user} isAdmin={isAdmin} isSubAdmin={isSubAdmin} />}
                    {activeTab === 'calendar' && <Calendar user={user} employees={employees} />}
                    {activeTab === 'leave' && <AnnualLeave user={user} />}
                    {activeTab === 'pt-schedule' && <PTSchedule user={user} isPTScheduleEditor={isPTScheduleEditor || isAdmin || isSubAdmin} />}
                    {activeTab === 'approval' && isApprover && <ApprovalManagement user={user} setPendingCount={setPendingCount} />}
                    {activeTab === 'admin-leave' && (isAdmin || isSubAdmin) && <AdminLeaveManagement />}
                    {activeTab === 'approval-line' && (isAdmin || isSubAdmin) && <ApprovalLineManagement />}
                    {activeTab === 'admin' && (isAdmin || isSubAdmin) && <AdminPage />}
                    {activeTab === 'department' && <DepartmentManagement isAdmin={isAdmin} isSubAdmin={isSubAdmin} />}
                    {activeTab === 'slack-settings' && (isAdmin || isSubAdmin) && <SlackSettings />}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>

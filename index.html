<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ïä§ÏºÄÏ•¥ Î∞è Ïó∞Ï∞® Í¥ÄÎ¶¨</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #f5f5f5;
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 24px;
            color: #333;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logout-btn {
            padding: 8px 16px;
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .logout-btn:hover {
            background: #cc0000;
        }

        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .login-container h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #666;
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .btn-primary {
            width: 100%;
            padding: 12px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }

        .btn-primary:hover {
            background: #45a049;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 24px;
            background: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .tab.active {
            background: #4CAF50;
            color: white;
        }

        .tab:hover {
            background: #e8e8e8;
        }

        .tab.active:hover {
            background: #45a049;
        }

        .content-card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .calendar-header h2 {
            font-size: 24px;
            color: #333;
        }

        .calendar-nav {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .nav-btn {
            padding: 8px 16px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .nav-btn:hover {
            background: #45a049;
        }

        .calendar {
            width: 100%;
            border-collapse: collapse;
        }

        .calendar th {
            padding: 15px;
            background: #f5f5f5;
            border: 1px solid #ddd;
            font-weight: 600;
            color: #666;
        }

        .calendar td {
            padding: 10px;
            width: 170px;
            border: 1px solid #ddd;
            vertical-align: top;
            height: 120px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .calendar td:hover {
            background: #f9f9f9;
        }

        .calendar td.other-month {
            background: #fafafa;
            color: #ccc;
        }

        .calendar td.today {
            background: #e8f5e9;
        }

        .calendar td.holiday {
            background: #ffebee;
        }

        .calendar td.holiday .date-number {
            color: #d32f2f;
            font-weight: 700;
        }

        .holiday-name {
            font-size: 10px;
            color: #d32f2f;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .date-number {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .calendar td.sunday .date-number {
            color: #d32f2f;
        }

        .calendar td.saturday .date-number {
            color: #1976d2;
        }

        .schedule-item {
            font-size: 11px;
            padding: 3px 6px;
            margin: 2px 0;
            max-width: 170px;
            border-radius: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .schedule-item .delete-schedule-btn {
            background: rgba(255, 255, 255, 0.8);
            border: none;
            border-radius: 3px;
            cursor: pointer;
            padding: 2px 5px;
            font-size: 10px;
            color: #ff4444;
            font-weight: bold;
            margin-left: 5px;
            flex-shrink: 0;
        }

        .schedule-item .delete-schedule-btn:hover {
            background: rgba(255, 255, 255, 1);
        }

        .schedule-Ï∂úÍ∑º { background: #e3f2fd; color: #1976d2; }
        .schedule-Ïû¨ÌÉù { background: #fff3e0; color: #f57c00; }
        .schedule-Ïó∞Ï∞® { background: #fce4ec; color: #c2185b; }
        .schedule-Î∞òÏ∞®Ïò§Ï†Ñ { background: #f3e5f5; color: #7b1fa2; }
        .schedule-Î∞òÏ∞®Ïò§ÌõÑ { background: #e1f5fe; color: #0277bd; }
        .schedule-Ïó¨Î¶ÑÌú¥Í∞Ä { background: #e0f2f1; color: #00796b; }
        .schedule-Í≤®Ïö∏Ìú¥Í∞Ä { background: #e8eaf6; color: #3f51b5; }

        .daily-schedules {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #eee;
        }

        .daily-schedules h3 {
            margin-bottom: 20px;
            color: #333;
        }

        .daily-schedule-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .daily-schedule-card {
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid;
        }

        .daily-schedule-card.Ï∂úÍ∑º { background: #e3f2fd; border-color: #1976d2; }
        .daily-schedule-card.Ïû¨ÌÉù { background: #fff3e0; border-color: #f57c00; }
        .daily-schedule-card.Ïó∞Ï∞® { background: #fce4ec; border-color: #c2185b; }
        .daily-schedule-card.Î∞òÏ∞®Ïò§Ï†Ñ { background: #f3e5f5; border-color: #7b1fa2; }
        .daily-schedule-card.Î∞òÏ∞®Ïò§ÌõÑ { background: #e1f5fe; border-color: #0277bd; }
        .daily-schedule-card.Ïó¨Î¶ÑÌú¥Í∞Ä { background: #e0f2f1; border-color: #00796b; }
        .daily-schedule-card.Í≤®Ïö∏Ìú¥Í∞Ä { background: #e8eaf6; border-color: #3f51b5; }

        .daily-schedule-card .name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .daily-schedule-card .type {
            font-size: 14px;
            color: #666;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
        }

        .modal-content h3 {
            margin-bottom: 20px;
            color: #333;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-secondary {
            flex: 0 0 auto;
            min-width: 80px;
            padding: 0 20px;
            background: #666;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
        }

        .btn-secondary:hover {
            background: #555;
        }

        .modal-buttons .btn-primary {
            flex: 1;
            padding: 0 30px;
            font-size: 15px;
            font-weight: 600;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
            margin: 0;
        }

        .annual-leave-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .info-card {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
        }

        .info-card h4 {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .info-card .value {
            font-size: 24px;
            font-weight: 600;
            color: #333;
        }

        .register-btn {
            padding: 12px 24px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 30px;
        }

        .register-btn:hover {
            background: #45a049;
        }

        .leave-history {
            margin-top: 20px;
        }

        .leave-history table {
            width: 100%;
            border-collapse: collapse;
        }

        .leave-history th,
        .leave-history td {
            padding: 12px;
            border: 1px solid #ddd;
            text-align: left;
        }

        .leave-history th {
            background: #f5f5f5;
            font-weight: 600;
        }

        .admin-section {
            margin-bottom: 40px;
        }

        .admin-section h3 {
            margin-bottom: 20px;
            color: #333;
        }

        .employee-list {
            margin-top: 20px;
        }

        .employee-list table {
            width: 100%;
            border-collapse: collapse;
        }

        .employee-list th,
        .employee-list td {
            padding: 12px;
            border: 1px solid #ddd;
            text-align: left;
        }

        .employee-list th {
            background: #f5f5f5;
            font-weight: 600;
        }

        .delete-btn {
            padding: 6px 12px;
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .delete-btn:hover {
            background: #cc0000;
        }

        .error-message {
            color: #ff4444;
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Firebase ÏÑ§Ï†ï
        const firebaseConfig = {
            apiKey: "AIzaSyC_hwBHgdLWmI6z920PNgmWTKYSl_TZ4I0",
            authDomain: "work-calendar-839f2.firebaseapp.com",
            projectId: "work-calendar-839f2",
            storageBucket: "work-calendar-839f2.firebasestorage.app",
            messagingSenderId: "823701886482",
            appId: "1:823701886482:web:4a368e517a6d158ea12acb"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        const { useState, useEffect } = React;

        // ÎåÄÌïúÎØºÍµ≠ Í≥µÌú¥Ïùº Îç∞Ïù¥ÌÑ∞
        // Í≥†Ï†ï Í≥µÌú¥Ïùº + 2024-2030ÎÖÑ ÏùåÎ†• Í≥µÌú¥Ïùº
        const holidays = {
            // 2024ÎÖÑ
            '2024-01-01': 'Ïã†Ï†ï',
            '2024-02-09': 'ÏÑ§ÎÇ† Ïó∞Ìú¥',
            '2024-02-10': 'ÏÑ§ÎÇ†',
            '2024-02-11': 'ÏÑ§ÎÇ† Ïó∞Ìú¥',
            '2024-02-12': 'ÎåÄÏ≤¥Í≥µÌú¥Ïùº',
            '2024-03-01': 'ÏÇºÏùºÏ†à',
            '2024-04-10': 'Ï†ú22ÎåÄ Íµ≠ÌöåÏùòÏõê ÏÑ†Í±∞',
            '2024-05-05': 'Ïñ¥Î¶∞Ïù¥ÎÇ†',
            '2024-05-06': 'ÎåÄÏ≤¥Í≥µÌú¥Ïùº',
            '2024-05-15': 'ÏÑùÍ∞ÄÌÉÑÏã†Ïùº',
            '2024-06-06': 'ÌòÑÏ∂©Ïùº',
            '2024-08-15': 'Í¥ëÎ≥µÏ†à',
            '2024-09-16': 'Ï∂îÏÑù Ïó∞Ìú¥',
            '2024-09-17': 'Ï∂îÏÑù',
            '2024-09-18': 'Ï∂îÏÑù Ïó∞Ìú¥',
            '2024-10-03': 'Í∞úÏ≤úÏ†à',
            '2024-10-09': 'ÌïúÍ∏ÄÎÇ†',
            '2024-12-25': 'ÏÑ±ÌÉÑÏ†à',
            
            // 2025ÎÖÑ
            '2025-01-01': 'Ïã†Ï†ï',
            '2025-01-28': 'ÏÑ§ÎÇ† Ïó∞Ìú¥',
            '2025-01-29': 'ÏÑ§ÎÇ†',
            '2025-01-30': 'ÏÑ§ÎÇ† Ïó∞Ìú¥',
            '2025-03-01': 'ÏÇºÏùºÏ†à',
            '2025-03-03': 'ÎåÄÏ≤¥Í≥µÌú¥Ïùº',
            '2025-05-05': 'Ïñ¥Î¶∞Ïù¥ÎÇ†',
            '2025-05-06': 'ÏÑùÍ∞ÄÌÉÑÏã†Ïùº',
            '2025-06-06': 'ÌòÑÏ∂©Ïùº',
            '2025-08-15': 'Í¥ëÎ≥µÏ†à',
            '2025-10-03': 'Í∞úÏ≤úÏ†à',
            '2025-10-05': 'Ï∂îÏÑù Ïó∞Ìú¥',
            '2025-10-06': 'Ï∂îÏÑù',
            '2025-10-07': 'Ï∂îÏÑù Ïó∞Ìú¥',
            '2025-10-08': 'ÎåÄÏ≤¥Í≥µÌú¥Ïùº',
            '2025-10-09': 'ÌïúÍ∏ÄÎÇ†',
            '2025-12-25': 'ÏÑ±ÌÉÑÏ†à',
            
            // 2026ÎÖÑ
            '2026-01-01': 'Ïã†Ï†ï',
            '2026-02-16': 'ÏÑ§ÎÇ† Ïó∞Ìú¥',
            '2026-02-17': 'ÏÑ§ÎÇ†',
            '2026-02-18': 'ÏÑ§ÎÇ† Ïó∞Ìú¥',
            '2026-03-01': 'ÏÇºÏùºÏ†à',
            '2026-03-02': 'ÎåÄÏ≤¥Í≥µÌú¥Ïùº',
            '2026-05-05': 'Ïñ¥Î¶∞Ïù¥ÎÇ†',
            '2026-05-24': 'ÏÑùÍ∞ÄÌÉÑÏã†Ïùº',
            '2026-05-25': 'ÎåÄÏ≤¥Í≥µÌú¥Ïùº',
            '2026-06-06': 'ÌòÑÏ∂©Ïùº',
            '2026-08-15': 'Í¥ëÎ≥µÏ†à',
            '2026-09-24': 'Ï∂îÏÑù Ïó∞Ìú¥',
            '2026-09-25': 'Ï∂îÏÑù',
            '2026-09-26': 'Ï∂îÏÑù Ïó∞Ìú¥',
            '2026-10-03': 'Í∞úÏ≤úÏ†à',
            '2026-10-05': 'ÎåÄÏ≤¥Í≥µÌú¥Ïùº',
            '2026-10-09': 'ÌïúÍ∏ÄÎÇ†',
            '2026-12-25': 'ÏÑ±ÌÉÑÏ†à',
            
            // 2027ÎÖÑ
            '2027-01-01': 'Ïã†Ï†ï',
            '2027-02-06': 'ÏÑ§ÎÇ† Ïó∞Ìú¥',
            '2027-02-07': 'ÏÑ§ÎÇ†',
            '2027-02-08': 'ÏÑ§ÎÇ† Ïó∞Ìú¥',
            '2027-03-01': 'ÏÇºÏùºÏ†à',
            '2027-05-05': 'Ïñ¥Î¶∞Ïù¥ÎÇ†',
            '2027-05-13': 'ÏÑùÍ∞ÄÌÉÑÏã†Ïùº',
            '2027-06-06': 'ÌòÑÏ∂©Ïùº',
            '2027-06-07': 'ÎåÄÏ≤¥Í≥µÌú¥Ïùº',
            '2027-08-15': 'Í¥ëÎ≥µÏ†à',
            '2027-08-16': 'ÎåÄÏ≤¥Í≥µÌú¥Ïùº',
            '2027-09-14': 'Ï∂îÏÑù Ïó∞Ìú¥',
            '2027-09-15': 'Ï∂îÏÑù',
            '2027-09-16': 'Ï∂îÏÑù Ïó∞Ìú¥',
            '2027-10-03': 'Í∞úÏ≤úÏ†à',
            '2027-10-04': 'ÎåÄÏ≤¥Í≥µÌú¥Ïùº',
            '2027-10-09': 'ÌïúÍ∏ÄÎÇ†',
            '2027-10-11': 'ÎåÄÏ≤¥Í≥µÌú¥Ïùº',
            '2027-12-25': 'ÏÑ±ÌÉÑÏ†à',
            
            // 2028ÎÖÑ
            '2028-01-01': 'Ïã†Ï†ï',
            '2028-01-26': 'ÏÑ§ÎÇ† Ïó∞Ìú¥',
            '2028-01-27': 'ÏÑ§ÎÇ†',
            '2028-01-28': 'ÏÑ§ÎÇ† Ïó∞Ìú¥',
            '2028-03-01': 'ÏÇºÏùºÏ†à',
            '2028-05-02': 'ÏÑùÍ∞ÄÌÉÑÏã†Ïùº',
            '2028-05-05': 'Ïñ¥Î¶∞Ïù¥ÎÇ†',
            '2028-06-06': 'ÌòÑÏ∂©Ïùº',
            '2028-08-15': 'Í¥ëÎ≥µÏ†à',
            '2028-10-02': 'Ï∂îÏÑù Ïó∞Ìú¥',
            '2028-10-03': 'Ï∂îÏÑù',
            '2028-10-04': 'Ï∂îÏÑù Ïó∞Ìú¥',
            '2028-10-09': 'ÌïúÍ∏ÄÎÇ†',
            '2028-12-25': 'ÏÑ±ÌÉÑÏ†à',
            
            // 2029ÎÖÑ
            '2029-01-01': 'Ïã†Ï†ï',
            '2029-02-12': 'ÏÑ§ÎÇ† Ïó∞Ìú¥',
            '2029-02-13': 'ÏÑ§ÎÇ†',
            '2029-02-14': 'ÏÑ§ÎÇ† Ïó∞Ìú¥',
            '2029-03-01': 'ÏÇºÏùºÏ†à',
            '2029-05-05': 'Ïñ¥Î¶∞Ïù¥ÎÇ†',
            '2029-05-20': 'ÏÑùÍ∞ÄÌÉÑÏã†Ïùº',
            '2029-05-21': 'ÎåÄÏ≤¥Í≥µÌú¥Ïùº',
            '2029-06-06': 'ÌòÑÏ∂©Ïùº',
            '2029-08-15': 'Í¥ëÎ≥µÏ†à',
            '2029-09-21': 'Ï∂îÏÑù Ïó∞Ìú¥',
            '2029-09-22': 'Ï∂îÏÑù',
            '2029-09-23': 'Ï∂îÏÑù Ïó∞Ìú¥',
            '2029-09-24': 'ÎåÄÏ≤¥Í≥µÌú¥Ïùº',
            '2029-10-03': 'Í∞úÏ≤úÏ†à',
            '2029-10-09': 'ÌïúÍ∏ÄÎÇ†',
            '2029-12-25': 'ÏÑ±ÌÉÑÏ†à',
            
            // 2030ÎÖÑ
            '2030-01-01': 'Ïã†Ï†ï',
            '2030-02-02': 'ÏÑ§ÎÇ† Ïó∞Ìú¥',
            '2030-02-03': 'ÏÑ§ÎÇ†',
            '2030-02-04': 'ÏÑ§ÎÇ† Ïó∞Ìú¥',
            '2030-03-01': 'ÏÇºÏùºÏ†à',
            '2030-05-05': 'Ïñ¥Î¶∞Ïù¥ÎÇ†',
            '2030-05-06': 'ÎåÄÏ≤¥Í≥µÌú¥Ïùº',
            '2030-05-09': 'ÏÑùÍ∞ÄÌÉÑÏã†Ïùº',
            '2030-06-06': 'ÌòÑÏ∂©Ïùº',
            '2030-08-15': 'Í¥ëÎ≥µÏ†à',
            '2030-09-11': 'Ï∂îÏÑù Ïó∞Ìú¥',
            '2030-09-12': 'Ï∂îÏÑù',
            '2030-09-13': 'Ï∂îÏÑù Ïó∞Ìú¥',
            '2030-10-03': 'Í∞úÏ≤úÏ†à',
            '2030-10-09': 'ÌïúÍ∏ÄÎÇ†',
            '2030-12-25': 'ÏÑ±ÌÉÑÏ†à'
        };

        // ÎÇ†Ïßú Ïú†Ìã∏Î¶¨Ìã∞ Ìï®Ïàò
        const getDaysInMonth = (year, month) => {
            return new Date(year, month + 1, 0).getDate();
        };

        const getFirstDayOfMonth = (year, month) => {
            return new Date(year, month, 1).getDay();
        };

        const formatDate = (year, month, day) => {
            const m = String(month + 1).padStart(2, '0');
            const d = String(day).padStart(2, '0');
            return `${year}-${m}-${d}`;
        };

        // Slack ÏïåÎ¶º Ï†ÑÏÜ° Ìï®Ïàò
        const sendSlackNotification = async (approverUserId, message, type = 'approval') => {
            try {
                // FirestoreÏóêÏÑú Slack Webhook URL Í∞ÄÏ†∏Ïò§Í∏∞
                const settingsDoc = await db.collection('settings').doc('slack').get();
                if (!settingsDoc.exists || !settingsDoc.data().webhookUrl) {
                    console.log('Slack Webhook URLÏù¥ ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                    return;
                }

                const webhookUrl = settingsDoc.data().webhookUrl;

                // ÏäπÏù∏Ïûê Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞
                const approverDoc = await db.collection('employees').doc(approverUserId).get();
                if (!approverDoc.exists) {
                    console.log('ÏäπÏù∏Ïûê Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    return;
                }

                const approverData = approverDoc.data();
                const slackUserId = approverData.slackUserId;

                // Î©îÏãúÏßÄ Íµ¨ÏÑ±
                let slackMessage = '';
                if (slackUserId) {
                    slackMessage = `<@${slackUserId}> ${message}`;
                } else {
                    slackMessage = `${approverData.name}Îãò, ${message}`;
                }

                // SlackÏóê Î©îÏãúÏßÄ Ï†ÑÏÜ°
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        text: slackMessage,
                        username: 'Ïó∞Ï∞®Í¥ÄÎ¶¨ÏãúÏä§ÌÖú',
                        icon_emoji: type === 'approval' ? ':memo:' : ':x:'
                    })
                });

                if (!response.ok) {
                    console.error('Slack ÏïåÎ¶º Ï†ÑÏÜ° Ïã§Ìå®:', response.statusText);
                }
            } catch (error) {
                console.error('Slack ÏïåÎ¶º Ï†ÑÏÜ° Ï§ë Ïò§Î•ò:', error);
            }
        };

        // PT Ïä§ÏºÄÏ§Ñ Í¥ÄÎ¶¨ Ïª¥Ìè¨ÎÑåÌä∏
        function PTSchedule({ user, isPTScheduleEditor }) {
            const [currentDate, setCurrentDate] = useState(new Date());
            const [weekSchedules, setWeekSchedules] = useState([]);
            const [loading, setLoading] = useState(false);
            const [editingWeek, setEditingWeek] = useState(null);
            const [tempSlots, setTempSlots] = useState({});
            const [tempTimeSlots, setTempTimeSlots] = useState([]);
            const [employees, setEmployees] = useState([]);

            const defaultTimeSlots = ['12:00', '13:00', '14:00', '15:00', '16:00'];
            const weekDays = ['Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à'];

            useEffect(() => {
                loadEmployees();
                loadMonthSchedules();
            }, [currentDate]);

            const loadEmployees = async () => {
                try {
                    const snapshot = await db.collection('employees').get();
                    const employeeList = [];
                    snapshot.forEach(doc => {
                        employeeList.push({ id: doc.id, ...doc.data() });
                    });
                    setEmployees(employeeList);
                } catch (error) {
                    console.error('ÏÇ¨Ïõê Î™©Î°ù Î°úÎìú Ïã§Ìå®:', error);
                }
            };

            // Ìï¥Îãπ ÏõîÏùò Ï£ºÏ∞®Î≥Ñ ÎÇ†Ïßú Í≥ÑÏÇ∞ (ÏõîÏ¥à/ÏõîÎßê ÎÇ†Ïßú Î™®Îëê Ìè¨Ìï®)
            const getWeeksInMonth = (year, month) => {
                const weeks = [];
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                
                // ÏõîÏùò Ï≤´ ÎÇ†Ïù¥ ÏÜçÌïú Ï£ºÏùò ÏõîÏöîÏùº Ï∞æÍ∏∞ (Ïù¥Ï†Ñ ÏõîÏùº Ïàò ÏûàÏùå)
                let weekStart = new Date(firstDay);
                const firstDayOfWeek = firstDay.getDay(); // 0(Ïùº) ~ 6(ÌÜ†)
                
                // ÏõîÏöîÏùº(1)Î°ú Ï°∞Ï†ï
                if (firstDayOfWeek === 0) {
                    // ÏùºÏöîÏùºÏù¥Î©¥ Ï†ÑÏ£º ÏõîÏöîÏùº
                    weekStart.setDate(weekStart.getDate() - 6);
                } else if (firstDayOfWeek !== 1) {
                    // ÏõîÏöîÏùºÏù¥ ÏïÑÎãàÎ©¥ Í∑∏ Ï£ºÏùò ÏõîÏöîÏùºÎ°ú
                    weekStart.setDate(weekStart.getDate() - (firstDayOfWeek - 1));
                }

                let weekNumber = 1;
                let currentWeekStart = new Date(weekStart);

                // ÎßàÏßÄÎßâ ÎÇ†Ïù¥ ÏÜçÌïú Ï£ºÍπåÏßÄ Î∞òÎ≥µ
                while (currentWeekStart <= lastDay) {
                    const dates = [];
                    
                    // Ïõî~Í∏à 5ÏùºÍ∞ÑÏùò ÎÇ†Ïßú ÏàòÏßë
                    for (let i = 0; i < 5; i++) {
                        const date = new Date(currentWeekStart);
                        date.setDate(currentWeekStart.getDate() + i);
                        dates.push({
                            date: new Date(date),
                            isCurrentMonth: date.getMonth() === month
                        });
                    }

                    // Ìï¥Îãπ Ï£ºÏóê ÌòÑÏû¨ ÏõîÏùò ÎÇ†ÏßúÍ∞Ä ÌïòÎÇòÎùºÎèÑ ÏûàÏúºÎ©¥ Ï£ºÏ∞® Ï∂îÍ∞Ä
                    const hasCurrentMonthDate = dates.some(d => d.isCurrentMonth);
                    
                    if (hasCurrentMonthDate) {
                        // Ïã§Ï†ú ÏãúÏûëÏùºÍ≥º Ï¢ÖÎ£åÏùº Í≥ÑÏÇ∞ (ÌòÑÏû¨ Ïõî Í∏∞Ï§Ä)
                        const currentMonthDates = dates.filter(d => d.isCurrentMonth).map(d => d.date);
                        const weekStartDate = currentMonthDates[0];
                        const weekEndDate = currentMonthDates[currentMonthDates.length - 1];
                        
                        weeks.push({
                            weekNumber: weekNumber,
                            startDate: new Date(weekStartDate),
                            endDate: new Date(weekEndDate),
                            dates: dates
                        });
                        weekNumber++;
                    }

                    // Îã§Ïùå Ï£º ÏõîÏöîÏùºÎ°ú Ïù¥Îèô
                    currentWeekStart.setDate(currentWeekStart.getDate() + 7);
                }

                return weeks;
            };

            const formatDate = (date) => {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            };

            const loadMonthSchedules = async () => {
                setLoading(true);
                try {
                    const year = currentDate.getFullYear();
                    const month = currentDate.getMonth();
                    const weeks = getWeeksInMonth(year, month);

                    const yearMonth = `${year}-${String(month + 1).padStart(2, '0')}`;
                    
                    // Ìï¥Îãπ ÏõîÏùò Î™®Îì† Ïä§ÏºÄÏ§Ñ Î°úÎìú
                    const snapshot = await db.collection('ptSchedules').doc(yearMonth).get();
                    const scheduleData = snapshot.exists ? snapshot.data() : {};

                    const schedulesWithData = weeks.map(week => {
                        const weekKey = `week${week.weekNumber}`;
                        const weekData = scheduleData[weekKey] || {};
                        
                        // Ìï¥Îãπ Ï£ºÏ∞®Ïùò ÏãúÍ∞Ñ Ïä¨Î°Ø Ï∂îÏ∂ú
                        const timeSlots = weekData.timeSlots || defaultTimeSlots;
                        const slots = weekData.slots || {};
                        
                        return {
                            ...week,
                            timeSlots: timeSlots,
                            slots: slots
                        };
                    });

                    setWeekSchedules(schedulesWithData);
                } catch (error) {
                    console.error('Ïä§ÏºÄÏ§Ñ Î°úÎìú Ïã§Ìå®:', error);
                }
                setLoading(false);
            };

            const handleStartEdit = (weekNumber) => {
                const week = weekSchedules.find(w => w.weekNumber === weekNumber);
                if (week) {
                    setEditingWeek(weekNumber);
                    // Ïä¨Î°Ø Îç∞Ïù¥ÌÑ∞Î•º Í∞ùÏ≤¥ ÌòïÌÉúÎ°ú Î≥ÄÌôò (Í∏∞Ï°¥ Ïù¥Î¶ÑÎßå ÏûàÏúºÎ©¥ { name: Ïù¥Î¶Ñ, cancelled: false })
                    const slotsWithStatus = {};
                    Object.keys(week.slots).forEach(key => {
                        const value = week.slots[key];
                        if (typeof value === 'string') {
                            slotsWithStatus[key] = { name: value, cancelled: false };
                        } else {
                            slotsWithStatus[key] = value;
                        }
                    });
                    setTempSlots(slotsWithStatus);
                    setTempTimeSlots([...week.timeSlots]);
                }
            };

            const handleCancelEdit = () => {
                setEditingWeek(null);
                setTempSlots({});
                setTempTimeSlots([]);
            };

            const handleSaveEdit = async (weekNumber) => {
                try {
                    const year = currentDate.getFullYear();
                    const month = currentDate.getMonth();
                    const yearMonth = `${year}-${String(month + 1).padStart(2, '0')}`;
                    const weekKey = `week${weekNumber}`;

                    // Ï†ÄÏû• ÏãúÏóêÎäî Í∞ùÏ≤¥ ÌòïÌÉú Í∑∏ÎåÄÎ°ú Ïú†ÏßÄ (Ï∑®ÏÜå Ï†ïÎ≥¥ Ìè¨Ìï®)
                    const slotsToSave = {};
                    Object.keys(tempSlots).forEach(key => {
                        const slot = tempSlots[key];
                        // Í∞ùÏ≤¥ ÌòïÌÉúÎ°ú Ï†ÄÏû•ÌïòÏó¨ Ï∑®ÏÜå Ï†ïÎ≥¥ Ïú†ÏßÄ
                        slotsToSave[key] = {
                            name: slot.name || '',
                            cancelled: slot.cancelled || false
                        };
                    });

                    await db.collection('ptSchedules').doc(yearMonth).set({
                        [weekKey]: {
                            timeSlots: tempTimeSlots,
                            slots: slotsToSave
                        }
                    }, { merge: true });

                    alert('Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.');
                    setEditingWeek(null);
                    setTempSlots({});
                    setTempTimeSlots([]);
                    loadMonthSchedules();
                } catch (error) {
                    console.error('Ï†ÄÏû• Ïã§Ìå®:', error);
                    alert('Ï†ÄÏû• Ïã§Ìå®: ' + error.message);
                }
            };

            const handleSlotChange = (slotKey, value) => {
                setTempSlots(prev => ({
                    ...prev,
                    [slotKey]: { name: value, cancelled: false }
                }));
            };

            const handleCancelSlot = (slotKey) => {
                setTempSlots(prev => {
                    const current = prev[slotKey] || { name: '', cancelled: false };
                    return {
                        ...prev,
                        [slotKey]: { ...current, cancelled: true }
                    };
                });
            };

            const handleReactivateSlot = (slotKey, value) => {
                // Ï∑®ÏÜåÏÑ† ÏÉÅÌÉúÏóêÏÑú ÏÉà Ïù∏Ïõê ÏÑ†ÌÉù Ïãú Ï∑®ÏÜå Ìï¥Ï†úÌïòÍ≥† ÏÉà Ïù∏ÏõêÏúºÎ°ú ÍµêÏ≤¥
                setTempSlots(prev => ({
                    ...prev,
                    [slotKey]: { name: value, cancelled: false }
                }));
            };

            const handleAddTimeSlot = () => {
                const newTime = prompt('Ï∂îÍ∞ÄÌï† ÏãúÍ∞ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî (Ïòà: 17:00, 09:30)');
                if (!newTime) return;
                
                // ÏãúÍ∞Ñ ÌòïÏãù Í≤ÄÏ¶ù
                if (!/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(newTime)) {
                    alert('Ïò¨Î∞îÎ•∏ ÏãúÍ∞Ñ ÌòïÏãùÏù¥ ÏïÑÎãôÎãàÎã§.\nÏòàÏãú: 17:00, 09:30, 14:15');
                    return;
                }
                
                // Ï§ëÎ≥µ Ï≤¥ÌÅ¨
                if (tempTimeSlots.includes(newTime)) {
                    alert('Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÎäî ÏãúÍ∞ÑÏûÖÎãàÎã§.');
                    return;
                }
                
                setTempTimeSlots(prev => [...prev, newTime].sort());
            };

            const handleRemoveTimeSlot = (timeToRemove) => {
                if (!confirm(`${timeToRemove} ÏãúÍ∞ÑÎåÄÎ•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\nÌï¥Îãπ ÏãúÍ∞ÑÏùò Î™®Îì† Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÇ≠Ï†úÎê©ÎãàÎã§.`)) return;
                
                // ÏãúÍ∞Ñ Ïä¨Î°ØÏóêÏÑú Ï†úÍ±∞
                setTempTimeSlots(prev => prev.filter(t => t !== timeToRemove));
                
                // Ìï¥Îãπ ÏãúÍ∞ÑÏùò Î™®Îì† Ïä¨Î°Ø Îç∞Ïù¥ÌÑ∞ Ï†úÍ±∞
                const newSlots = { ...tempSlots };
                weekDays.forEach(day => {
                    delete newSlots[`${day}-${timeToRemove}`];
                });
                setTempSlots(newSlots);
            };

            const handleTimeSlotChange = (oldTime, newTime) => {
                if (!newTime) {
                    return;
                }
                
                if (!/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(newTime)) {
                    alert('Ïò¨Î∞îÎ•∏ ÏãúÍ∞Ñ ÌòïÏãùÏù¥ ÏïÑÎãôÎãàÎã§ (Ïòà: 17:00)');
                    return;
                }

                // ÏãúÍ∞Ñ Ïä¨Î°Ø ÏóÖÎç∞Ïù¥Ìä∏
                setTempTimeSlots(prev => prev.map(t => t === oldTime ? newTime : t));

                // Ïä¨Î°Ø Îç∞Ïù¥ÌÑ∞Ïùò ÌÇ§ ÏóÖÎç∞Ïù¥Ìä∏
                const newSlots = { ...tempSlots };
                weekDays.forEach(day => {
                    const oldKey = `${day}-${oldTime}`;
                    const newKey = `${day}-${newTime}`;
                    if (newSlots[oldKey]) {
                        newSlots[newKey] = newSlots[oldKey];
                        delete newSlots[oldKey];
                    }
                });
                setTempSlots(newSlots);
            };

            const handlePrevMonth = () => {
                setCurrentDate(prev => {
                    const newDate = new Date(prev);
                    newDate.setMonth(prev.getMonth() - 1);
                    return newDate;
                });
                setEditingWeek(null);
                setTempSlots({});
                setTempTimeSlots([]);
            };

            const handleNextMonth = () => {
                setCurrentDate(prev => {
                    const newDate = new Date(prev);
                    newDate.setMonth(prev.getMonth() + 1);
                    return newDate;
                });
                setEditingWeek(null);
                setTempSlots({});
                setTempTimeSlots([]);
            };

            const handleToday = () => {
                setCurrentDate(new Date());
                setEditingWeek(null);
                setTempSlots({});
                setTempTimeSlots([]);
            };

            return (
                <div className="content-card">
                    <div style={{
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center',
                        marginBottom: '20px'
                    }}>
                        <h2>PT Ïä§ÏºÄÏ§Ñ</h2>
                        <div className="calendar-nav">
                            <button className="nav-btn" onClick={handlePrevMonth}>‚óÄ Ïù¥Ï†ÑÎã¨</button>
                            <button className="nav-btn" onClick={handleToday}>Ïò§Îäò</button>
                            <button className="nav-btn" onClick={handleNextMonth}>Îã§ÏùåÎã¨ ‚ñ∂</button>
                        </div>
                    </div>

                    <div style={{
                        textAlign: 'center',
                        fontSize: '24px',
                        fontWeight: 'bold',
                        marginBottom: '30px',
                        color: '#333'
                    }}>
                        {currentDate.getFullYear()}ÎÖÑ {currentDate.getMonth() + 1}Ïõî PT Ïä§ÏºÄÏ§Ñ
                    </div>

                    {loading ? (
                        <div style={{ textAlign: 'center', padding: '60px', color: '#999' }}>
                            Î°úÎî©Ï§ë...
                        </div>
                    ) : weekSchedules.length === 0 ? (
                        <div style={{
                            padding: '60px',
                            textAlign: 'center',
                            color: '#999',
                            background: '#f9f9f9',
                            borderRadius: '8px'
                        }}>
                            Ïù¥Î≤à Îã¨ÏùÄ ÌëúÏãúÌï† Ï£ºÏ∞®Í∞Ä ÏóÜÏäµÎãàÎã§.
                        </div>
                    ) : (
                        <div style={{ display: 'grid', gap: '30px' }}>
                            {weekSchedules.map(week => {
                                const isEditing = editingWeek === week.weekNumber;
                                const displaySlots = isEditing ? tempSlots : week.slots;
                                const displayTimeSlots = isEditing ? tempTimeSlots : week.timeSlots;

                                return (
                                    <div key={week.weekNumber} style={{
                                        border: '1px solid #ddd',
                                        borderRadius: '8px',
                                        padding: '20px',
                                        background: 'white'
                                    }}>
                                        <div style={{
                                            display: 'flex',
                                            justifyContent: 'space-between',
                                            alignItems: 'center',
                                            marginBottom: '15px'
                                        }}>
                                            <div>
                                                <h3 style={{ fontSize: '18px', marginBottom: '5px' }}>
                                                    üí™ {week.weekNumber}Ï£ºÏ∞®
                                                </h3>
                                                <p style={{ fontSize: '14px', color: '#666' }}>
                                                    {formatDate(week.startDate)} ~ {formatDate(week.endDate)}
                                                </p>
                                            </div>
                                            {isPTScheduleEditor && (
                                                <div style={{ display: 'flex', gap: '8px' }}>
                                                    {isEditing ? (
                                                        <>
                                                            <button
                                                                onClick={handleAddTimeSlot}
                                                                style={{
                                                                    padding: '8px 16px',
                                                                    background: '#FF9800',
                                                                    color: 'white',
                                                                    border: 'none',
                                                                    borderRadius: '6px',
                                                                    cursor: 'pointer',
                                                                    fontSize: '14px'
                                                                }}
                                                            >
                                                                + ÏãúÍ∞Ñ Ï∂îÍ∞Ä
                                                            </button>
                                                            <button
                                                                onClick={() => handleSaveEdit(week.weekNumber)}
                                                                style={{
                                                                    padding: '8px 16px',
                                                                    background: '#4CAF50',
                                                                    color: 'white',
                                                                    border: 'none',
                                                                    borderRadius: '6px',
                                                                    cursor: 'pointer',
                                                                    fontSize: '14px'
                                                                }}
                                                            >
                                                                Ï†ÄÏû•
                                                            </button>
                                                            <button
                                                                onClick={handleCancelEdit}
                                                                style={{
                                                                    padding: '8px 16px',
                                                                    background: '#999',
                                                                    color: 'white',
                                                                    border: 'none',
                                                                    borderRadius: '6px',
                                                                    cursor: 'pointer',
                                                                    fontSize: '14px'
                                                                }}
                                                            >
                                                                Ï∑®ÏÜå
                                                            </button>
                                                        </>
                                                    ) : (
                                                        <button
                                                            onClick={() => handleStartEdit(week.weekNumber)}
                                                            style={{
                                                                padding: '8px 16px',
                                                                background: '#2196F3',
                                                                color: 'white',
                                                                border: 'none',
                                                                borderRadius: '6px',
                                                                cursor: 'pointer',
                                                                fontSize: '14px'
                                                            }}
                                                        >
                                                            ÏàòÏ†ï
                                                        </button>
                                                    )}
                                                </div>
                                            )}
                                        </div>

                                        <div style={{ overflowX: 'auto' }}>
                                            <table style={{
                                                width: '100%',
                                                borderCollapse: 'collapse',
                                                minWidth: '700px'
                                            }}>
                                                <thead>
                                                    <tr>
                                                        <th style={{
                                                            padding: '12px',
                                                            background: '#f5f5f5',
                                                            border: '1px solid #ddd',
                                                            fontWeight: '600',
                                                            width: '100px'
                                                        }}>Time</th>
                                                        {weekDays.map((day, idx) => {
                                                            const dateInfo = week.dates[idx];
                                                            return (
                                                                <th key={day} style={{
                                                                    padding: '12px',
                                                                    background: '#f5f5f5',
                                                                    border: '1px solid #ddd',
                                                                    fontWeight: '600'
                                                                }}>
                                                                    <div>{day}</div>
                                                                    {dateInfo && (
                                                                        <div style={{ 
                                                                            fontSize: '12px', 
                                                                            color: dateInfo.isCurrentMonth ? '#999' : '#ccc',
                                                                            fontWeight: 'normal' 
                                                                        }}>
                                                                            {dateInfo.date.getDate()}Ïùº
                                                                        </div>
                                                                    )}
                                                                </th>
                                                            );
                                                        })}
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {displayTimeSlots.map(time => (
                                                        <tr key={time}>
                                                            <td style={{
                                                                padding: '10px',
                                                                border: '1px solid #ddd',
                                                                fontWeight: '500',
                                                                background: '#fafafa',
                                                                textAlign: 'center'
                                                            }}>
                                                                {isEditing ? (
                                                                    <div style={{ display: 'flex', alignItems: 'center', gap: '5px', justifyContent: 'center' }}>
                                                                        <input
                                                                            type="text"
                                                                            defaultValue={time}
                                                                            onBlur={(e) => {
                                                                                if (e.target.value && e.target.value !== time) {
                                                                                    handleTimeSlotChange(time, e.target.value);
                                                                                }
                                                                            }}
                                                                            placeholder="HH:MM"
                                                                            style={{
                                                                                width: '70px',
                                                                                padding: '4px',
                                                                                border: '1px solid #ddd',
                                                                                borderRadius: '4px',
                                                                                fontSize: '13px',
                                                                                textAlign: 'center'
                                                                            }}
                                                                        />
                                                                        <button
                                                                            onClick={() => handleRemoveTimeSlot(time)}
                                                                            style={{
                                                                                padding: '2px 6px',
                                                                                background: '#ff4444',
                                                                                color: 'white',
                                                                                border: 'none',
                                                                                borderRadius: '4px',
                                                                                cursor: 'pointer',
                                                                                fontSize: '11px'
                                                                            }}
                                                                        >
                                                                            ‚úï
                                                                        </button>
                                                                    </div>
                                                                ) : time}
                                                            </td>
                                                            {weekDays.map((day, idx) => {
                                                                const slotKey = `${day}-${time}`;
                                                                const slotData = displaySlots?.[slotKey];
                                                                const slotValue = typeof slotData === 'string' ? slotData : (slotData?.name || '');
                                                                const isCancelled = slotData?.cancelled || false;
                                                                const dateInfo = week.dates[idx];
                                                                const isCurrentMonth = dateInfo && dateInfo.isCurrentMonth;
                                                                
                                                                return (
                                                                    <td key={slotKey} style={{
                                                                        padding: '8px',
                                                                        border: '1px solid #ddd',
                                                                        textAlign: 'center',
                                                                        minHeight: '50px',
                                                                        background: !isCurrentMonth ? '#f5f5f5' : 'white'
                                                                    }}>
                                                                        {!isCurrentMonth ? (
                                                                            <span style={{ color: '#ccc' }}>-</span>
                                                                        ) : isEditing ? (
                                                                            isCancelled ? (
                                                                                // Ï∑®ÏÜåÎêú ÏÉÅÌÉú: Ï∑®ÏÜåÏÑ† + ÎìúÎ°≠Îã§Ïö¥
                                                                                <div style={{ display: 'flex', flexDirection: 'column', gap: '4px' }}>
                                                                                    <span style={{
                                                                                        fontSize: '14px',
                                                                                        textDecoration: 'line-through',
                                                                                        color: '#999'
                                                                                    }}>
                                                                                        {slotValue}
                                                                                    </span>
                                                                                    <select
                                                                                        value=""
                                                                                        onChange={(e) => handleReactivateSlot(slotKey, e.target.value)}
                                                                                        style={{
                                                                                            width: '100%',
                                                                                            padding: '4px',
                                                                                            border: '1px solid #ddd',
                                                                                            borderRadius: '4px',
                                                                                            fontSize: '12px',
                                                                                            textAlign: 'center'
                                                                                        }}
                                                                                    >
                                                                                        <option value="">Î≥ÄÍ≤Ω</option>
                                                                                        {employees.map(emp => (
                                                                                            <option key={emp.id} value={emp.name}>
                                                                                                {emp.name}
                                                                                            </option>
                                                                                        ))}
                                                                                    </select>
                                                                                </div>
                                                                            ) : slotValue ? (
                                                                                // Îì±Î°ùÎêú ÏÉÅÌÉú: Ïù¥Î¶Ñ + X Î≤ÑÌäº
                                                                                <div style={{
                                                                                    display: 'flex',
                                                                                    alignItems: 'center',
                                                                                    justifyContent: 'center',
                                                                                    gap: '5px'
                                                                                }}>
                                                                                    <span style={{ fontSize: '14px' }}>{slotValue}</span>
                                                                                    <button
                                                                                        onClick={() => handleCancelSlot(slotKey)}
                                                                                        style={{
                                                                                            padding: '2px 5px',
                                                                                            background: '#ff4444',
                                                                                            color: 'white',
                                                                                            border: 'none',
                                                                                            borderRadius: '3px',
                                                                                            cursor: 'pointer',
                                                                                            fontSize: '10px'
                                                                                        }}
                                                                                    >
                                                                                        ‚úï
                                                                                    </button>
                                                                                </div>
                                                                            ) : (
                                                                                // Îπà ÏÉÅÌÉú: ÎìúÎ°≠Îã§Ïö¥
                                                                                <select
                                                                                    value=""
                                                                                    onChange={(e) => handleSlotChange(slotKey, e.target.value)}
                                                                                    style={{
                                                                                        width: '100%',
                                                                                        padding: '6px',
                                                                                        border: '1px solid #ddd',
                                                                                        borderRadius: '4px',
                                                                                        fontSize: '14px',
                                                                                        textAlign: 'center'
                                                                                    }}
                                                                                >
                                                                                    <option value="">ÏÑ†ÌÉù</option>
                                                                                    {employees.map(emp => (
                                                                                        <option key={emp.id} value={emp.name}>
                                                                                            {emp.name}
                                                                                        </option>
                                                                                    ))}
                                                                                </select>
                                                                            )
                                                                        ) : (
                                                                            <span style={{
                                                                                fontSize: '14px',
                                                                                color: slotValue ? (isCancelled ? '#999' : '#333') : '#999',
                                                                                textDecoration: isCancelled ? 'line-through' : 'none'
                                                                            }}>
                                                                                {slotValue || '-'}
                                                                            </span>
                                                                        )}
                                                                    </td>
                                                                );
                                                            })}
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    )}
                </div>
            );
        }

        // Slack ÏÑ§Ï†ï Ïª¥Ìè¨ÎÑåÌä∏
        function SlackSettings() {
            const [webhookUrl, setWebhookUrl] = useState('');
            const [loading, setLoading] = useState(true);
            const [saving, setSaving] = useState(false);

            useEffect(() => {
                loadSettings();
            }, []);

            const loadSettings = async () => {
                try {
                    const settingsDoc = await db.collection('settings').doc('slack').get();
                    if (settingsDoc.exists) {
                        setWebhookUrl(settingsDoc.data().webhookUrl || '');
                    }
                    setLoading(false);
                } catch (error) {
                    console.error('ÏÑ§Ï†ï Î°úÎìú Ïã§Ìå®:', error);
                    setLoading(false);
                }
            };

            const handleSaveSettings = async () => {
                if (!webhookUrl) {
                    alert('Webhook URLÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                setSaving(true);
                try {
                    await db.collection('settings').doc('slack').set({
                        webhookUrl: webhookUrl,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    alert('Slack ÏÑ§Ï†ïÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.');
                } catch (error) {
                    alert('Ï†ÄÏû• Ïã§Ìå®: ' + error.message);
                } finally {
                    setSaving(false);
                }
            };

            const handleTestNotification = async () => {
                if (!webhookUrl) {
                    alert('Î®ºÏ†Ä Webhook URLÏùÑ Ï†ÄÏû•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                try {
                    const response = await fetch(webhookUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            text: '‚úÖ ÌÖåÏä§Ìä∏ Î©îÏãúÏßÄÏûÖÎãàÎã§. Slack Ïó∞ÎèôÏù¥ Ï†ïÏÉÅÏ†ÅÏúºÎ°ú ÏûëÎèôÌï©ÎãàÎã§!',
                            username: 'Ïó∞Ï∞®Í¥ÄÎ¶¨ÏãúÏä§ÌÖú',
                            icon_emoji: ':white_check_mark:'
                        })
                    });

                    if (response.ok) {
                        alert('ÌÖåÏä§Ìä∏ Î©îÏãúÏßÄÍ∞Ä Ï†ÑÏÜ°ÎêòÏóàÏäµÎãàÎã§. SlackÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
                    } else {
                        alert('ÌÖåÏä§Ìä∏ Î©îÏãúÏßÄ Ï†ÑÏÜ° Ïã§Ìå®. Webhook URLÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
                    }
                } catch (error) {
                    alert('Ï†ÑÏÜ° Ïã§Ìå®: ' + error.message);
                }
            };

            if (loading) {
                return <div className="content-card">Î°úÎî©Ï§ë...</div>;
            }

            return (
                <div className="content-card">
                    <h2 style={{marginBottom: '20px'}}>Slack Ïó∞Îèô ÏÑ§Ï†ï</h2>
                    
                    <div style={{maxWidth: '800px'}}>
                        <div style={{
                            background: '#e8f5e9',
                            padding: '20px',
                            borderRadius: '8px',
                            marginBottom: '30px',
                            border: '1px solid #4CAF50'
                        }}>
                            <h3 style={{fontSize: '16px', marginBottom: '15px', color: '#2e7d32'}}>üìã Slack ÏÑ§Ï†ï Í∞ÄÏù¥Îìú</h3>
                            <ol style={{fontSize: '14px', lineHeight: '1.8', color: '#333', paddingLeft: '20px'}}>
                                <li><a href="https://api.slack.com/apps" target="_blank" style={{color: '#1976d2'}}>https://api.slack.com/apps</a> Ï†ëÏÜç</li>
                                <li>"Create New App" ‚Üí "From scratch" ÏÑ†ÌÉù</li>
                                <li>App Ïù¥Î¶Ñ ÏûÖÎ†• (Ïòà: Ïó∞Ï∞®Í¥ÄÎ¶¨ÏãúÏä§ÌÖú)</li>
                                <li>Ï¢åÏ∏° "Incoming Webhooks" ÌÅ¥Î¶≠ ‚Üí "Activate Incoming Webhooks" ON</li>
                                <li>"Add New Webhook to Workspace" ÌÅ¥Î¶≠</li>
                                <li>ÏïåÎ¶ºÏùÑ Î∞õÏùÑ Ï±ÑÎÑê ÏÑ†ÌÉù (Ïòà: #Ïó∞Ï∞®-ÏïåÎ¶º)</li>
                                <li>ÏÉùÏÑ±Îêú Webhook URLÏùÑ ÏïÑÎûòÏóê ÏûÖÎ†•</li>
                            </ol>
                        </div>

                        <div className="form-group">
                            <label style={{fontSize: '16px', fontWeight: '600', marginBottom: '10px', display: 'block'}}>
                                Slack Webhook URL
                            </label>
                            <input
                                type="text"
                                value={webhookUrl}
                                onChange={(e) => setWebhookUrl(e.target.value)}
                                placeholder="https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXX"
                                style={{
                                    width: '100%',
                                    padding: '12px',
                                    fontSize: '14px',
                                    border: '1px solid #ddd',
                                    borderRadius: '6px',
                                    fontFamily: 'monospace'
                                }}
                            />
                        </div>

                        <div style={{display: 'flex', gap: '10px', marginTop: '20px'}}>
                            <button
                                onClick={handleSaveSettings}
                                disabled={saving}
                                style={{
                                    padding: '12px 24px',
                                    background: '#4CAF50',
                                    color: 'white',
                                    border: 'none',
                                    borderRadius: '6px',
                                    cursor: saving ? 'not-allowed' : 'pointer',
                                    fontSize: '14px',
                                    fontWeight: '600',
                                    opacity: saving ? 0.6 : 1
                                }}
                            >
                                {saving ? 'Ï†ÄÏû•Ï§ë...' : 'Ï†ÄÏû•'}
                            </button>
                            <button
                                onClick={handleTestNotification}
                                style={{
                                    padding: '12px 24px',
                                    background: '#2196F3',
                                    color: 'white',
                                    border: 'none',
                                    borderRadius: '6px',
                                    cursor: 'pointer',
                                    fontSize: '14px',
                                    fontWeight: '600'
                                }}
                            >
                                ÌÖåÏä§Ìä∏ Î©îÏãúÏßÄ Î≥¥ÎÇ¥Í∏∞
                            </button>
                        </div>

                        <div style={{
                            marginTop: '30px',
                            padding: '15px',
                            background: '#fff3e0',
                            borderRadius: '8px',
                            border: '1px solid #ff9800'
                        }}>
                            <h4 style={{fontSize: '14px', marginBottom: '10px', color: '#e65100'}}>üí° Î©òÏÖò Í∏∞Îä• ÏÇ¨Ïö©ÌïòÍ∏∞</h4>
                            <p style={{fontSize: '13px', color: '#666', lineHeight: '1.6', margin: 0}}>
                                ÏÇ¨Ïõê Í¥ÄÎ¶¨ÏóêÏÑú Í∞Å ÏÇ¨ÏõêÏùò Slack ÏÇ¨Ïö©Ïûê IDÎ•º Îì±Î°ùÌïòÎ©¥, ÏïåÎ¶º Ïãú Ìï¥Îãπ ÏÇ¨ÏõêÏóêÍ≤å Î©òÏÖò(@)Ïù¥ Ìè¨Ìï®Îê©ÎãàÎã§.
                                <br />
                                Slack ÏÇ¨Ïö©Ïûê IDÎäî SlackÏóêÏÑú ÏÇ¨Ïö©Ïûê ÌîÑÎ°úÌïÑ ‚Üí ‚ãØ (ÎçîÎ≥¥Í∏∞) ‚Üí "Copy member ID"Î°ú ÌôïÏù∏Ìï† Ïàò ÏûàÏäµÎãàÎã§.
                            </p>
                        </div>
                    </div>
                </div>
            );
        }

        // Î°úÍ∑∏Ïù∏ Ïª¥Ìè¨ÎÑåÌä∏
        function Login({ onLogin }) {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [success, setSuccess] = useState('');
            const [showResetPassword, setShowResetPassword] = useState(false);
            const [resetEmail, setResetEmail] = useState('');
            const [rememberEmail, setRememberEmail] = useState(false);

            // Ïª¥Ìè¨ÎÑåÌä∏ ÎßàÏö¥Ìä∏ Ïãú Ï†ÄÏû•Îêú Ïù¥Î©îÏùº Î∂àÎü¨Ïò§Í∏∞
            useEffect(() => {
                const savedEmail = localStorage.getItem('savedEmail');
                if (savedEmail) {
                    setEmail(savedEmail);
                    setRememberEmail(true);
                }
            }, []);

            const handleLogin = async (e) => {
                e.preventDefault();
                setError('');
                try {
                    // ÏïÑÏù¥Îîî Ï†ÄÏû• Ï≤¥ÌÅ¨ Ïãú localStorageÏóê Ï†ÄÏû•
                    if (rememberEmail) {
                        localStorage.setItem('savedEmail', email);
                    } else {
                        localStorage.removeItem('savedEmail');
                    }
                    
                    await auth.signInWithEmailAndPassword(email, password);
                } catch (err) {
                    setError('Î°úÍ∑∏Ïù∏ Ïã§Ìå®: ' + err.message);
                }
            };

            const handleResetPassword = async (e) => {
                e.preventDefault();
                setError('');
                setSuccess('');
                
                if (!resetEmail) {
                    setError('Ïù¥Î©îÏùºÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                try {
                    await auth.sendPasswordResetEmail(resetEmail);
                    setSuccess('ÎπÑÎ∞ÄÎ≤àÌò∏ Ïû¨ÏÑ§Ï†ï Ïù¥Î©îÏùºÏù¥ Î∞úÏÜ°ÎêòÏóàÏäµÎãàÎã§. Ïù¥Î©îÏùºÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
                    setResetEmail('');
                    setTimeout(() => {
                        setShowResetPassword(false);
                        setSuccess('');
                    }, 3000);
                } catch (err) {
                    if (err.code === 'auth/user-not-found') {
                        setError('Îì±Î°ùÎêòÏßÄ ÏïäÏùÄ Ïù¥Î©îÏùºÏûÖÎãàÎã§.');
                    } else if (err.code === 'auth/invalid-email') {
                        setError('Ïú†Ìö®ÌïòÏßÄ ÏïäÏùÄ Ïù¥Î©îÏùº ÌòïÏãùÏûÖÎãàÎã§.');
                    } else {
                        setError('ÎπÑÎ∞ÄÎ≤àÌò∏ Ïû¨ÏÑ§Ï†ï Ïã§Ìå®: ' + err.message);
                    }
                }
            };

            if (showResetPassword) {
                return (
                    <div className="login-container">
                        <h2>ÎπÑÎ∞ÄÎ≤àÌò∏ Ïû¨ÏÑ§Ï†ï</h2>
                        <form onSubmit={handleResetPassword}>
                            <div className="form-group">
                                <label>Ïù¥Î©îÏùº</label>
                                <input
                                    type="email"
                                    value={resetEmail}
                                    onChange={(e) => setResetEmail(e.target.value)}
                                    placeholder="Í∞ÄÏûÖÌïú Ïù¥Î©îÏùºÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                                    required
                                />
                            </div>
                            <button type="submit" className="btn-primary">Ïû¨ÏÑ§Ï†ï Ïù¥Î©îÏùº Î≥¥ÎÇ¥Í∏∞</button>
                            <button 
                                type="button" 
                                className="btn-primary" 
                                onClick={() => {
                                    setShowResetPassword(false);
                                    setError('');
                                    setSuccess('');
                                }}
                                style={{
                                    background: '#666',
                                    marginTop: '10px'
                                }}
                            >
                                Î°úÍ∑∏Ïù∏ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                            </button>
                            {error && <div className="error-message">{error}</div>}
                            {success && <div style={{color: '#4CAF50', fontSize: '14px', marginTop: '10px', textAlign: 'center'}}>{success}</div>}
                        </form>
                    </div>
                );
            }

            return (
                <div className="login-container">
                    <h2>Ïä§ÏºÄÏ•¥ Î∞è Ïó∞Ï∞® Í¥ÄÎ¶¨</h2>
                    <form onSubmit={handleLogin}>
                        <div className="form-group">
                            <label>Ïù¥Î©îÏùº</label>
                            <input
                                type="email"
                                value={email}
                                onChange={(e) => setEmail(e.target.value)}
                                required
                            />
                        </div>
                        <div className="form-group">
                            <label>ÎπÑÎ∞ÄÎ≤àÌò∏</label>
                            <input
                                type="password"
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                                required
                            />
                        </div>
                        <div className="form-group" style={{marginBottom: '10px'}}>
                            <label style={{
                                display: 'flex',
                                alignItems: 'center',
                                cursor: 'pointer',
                                fontSize: '14px',
                                fontWeight: 'normal'
                            }}>
                                <input
                                    type="checkbox"
                                    checked={rememberEmail}
                                    onChange={(e) => setRememberEmail(e.target.checked)}
                                    style={{
                                        marginRight: '8px',
                                        cursor: 'pointer',
                                        width: '16px',
                                        height: '16px'
                                    }}
                                />
                                ÏïÑÏù¥Îîî Ï†ÄÏû•
                            </label>
                        </div>
                        <button type="submit" className="btn-primary">Î°úÍ∑∏Ïù∏</button>
                        {error && <div className="error-message">{error}</div>}
                        <div style={{
                            textAlign: 'center',
                            marginTop: '15px'
                        }}>
                            <button
                                type="button"
                                onClick={() => {
                                    setShowResetPassword(true);
                                    setError('');
                                }}
                                style={{
                                    background: 'none',
                                    border: 'none',
                                    color: '#4CAF50',
                                    cursor: 'pointer',
                                    fontSize: '14px',
                                    textDecoration: 'underline'
                                }}
                            >
                                ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûäÏúºÏÖ®ÎÇòÏöî?
                            </button>
                        </div>
                    </form>
                </div>
            );
        }

        // Ïä§ÏºÄÏ§Ñ ÏÑ†ÌÉù Î™®Îã¨
        function ScheduleModal({ date, currentSchedule, onSave, onClose, userName }) {
            const [scheduleType, setScheduleType] = useState(currentSchedule || 'Ï∂úÍ∑º');

            const handleSave = () => {
                onSave(date, scheduleType);
            };

            return (
                <div className="modal" onClick={onClose}>
                    <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                        <h3>{date} ÏùºÏ†ï Îì±Î°ù</h3>
                        <div className="form-group">
                            <label>ÏùºÏ†ï Ïú†Ìòï</label>
                            <select
                                value={scheduleType}
                                onChange={(e) => setScheduleType(e.target.value)}
                                style={{
                                    width: '100%',
                                    padding: '12px',
                                    border: '1px solid #ddd',
                                    borderRadius: '6px',
                                    fontSize: '14px'
                                }}
                            >
                                <option value="Ï∂úÍ∑º">Ï∂úÍ∑º</option>
                                <option value="Ïû¨ÌÉù">Ïû¨ÌÉù</option>
                                <option value="Ïó∞Ï∞®">Ïó∞Ï∞®</option>
                                <option value="Î∞òÏ∞®(Ïò§Ï†Ñ)">Î∞òÏ∞®(Ïò§Ï†Ñ)</option>
                                <option value="Î∞òÏ∞®(Ïò§ÌõÑ)">Î∞òÏ∞®(Ïò§ÌõÑ)</option>
                                <option value="Ïó¨Î¶ÑÌú¥Í∞Ä">Ïó¨Î¶ÑÌú¥Í∞Ä</option>
                                <option value="Í≤®Ïö∏Ìú¥Í∞Ä">Í≤®Ïö∏Ìú¥Í∞Ä</option>
                            </select>
                        </div>
                        <div className="modal-buttons">
                            <button className="btn-secondary" onClick={onClose}>Ï∑®ÏÜå</button>
                            <button className="btn-primary" onClick={handleSave}>Ï†ÄÏû•</button>
                        </div>
                    </div>
                </div>
            );
        }

        // Ï∫òÎ¶∞Îçî Ïª¥Ìè¨ÎÑåÌä∏
        function Calendar({ user, employees }) {
            const [currentDate, setCurrentDate] = useState(new Date());
            const [schedules, setSchedules] = useState({});
            const [selectedDate, setSelectedDate] = useState(null);
            const [selectedDaySchedules, setSelectedDaySchedules] = useState([]);
            const [showScheduleModal, setShowScheduleModal] = useState(false);
            const [employeeInfo, setEmployeeInfo] = useState(null);

            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();

            useEffect(() => {
                loadEmployeeInfo();
                loadSchedules();
            }, [year, month]);

            const loadEmployeeInfo = async () => {
                const doc = await db.collection('employees').doc(user.uid).get();
                if (doc.exists) {
                    setEmployeeInfo(doc.data());
                }
            };

            useEffect(() => {
                // Ïò§Îäò ÎÇ†ÏßúÏùò ÏùºÏ†ïÏùÑ ÏûêÎèôÏúºÎ°ú ÌëúÏãú
                const today = new Date();
                const todayStr = formatDate(today.getFullYear(), today.getMonth(), today.getDate());
                setSelectedDate(todayStr);
            }, [schedules]);

            useEffect(() => {
                // selectedDateÍ∞Ä Î≥ÄÍ≤ΩÎê† ÎïåÎßàÎã§ Ìï¥Îãπ ÎÇ†ÏßúÏùò ÏùºÏ†ï ÌëúÏãú
                if (selectedDate && schedules[selectedDate]) {
                    const rawDaySchedules = schedules[selectedDate];
                    const filteredDaySchedules = rawDaySchedules.filter(s => s.approvalStatus !== 'cancelled' && s.approvalStatus !== 'deletion-pending');
                    setSelectedDaySchedules(filteredDaySchedules);
                } else if (selectedDate) {
                    setSelectedDaySchedules([]);
                }
            }, [selectedDate, schedules]);

            const loadSchedules = async () => {
                const startDate = formatDate(year, month, 1);
                const endDate = formatDate(year, month, getDaysInMonth(year, month));

                const snapshot = await db.collection('schedules')
                    .where('date', '>=', startDate)
                    .where('date', '<=', endDate)
                    .get();

                const scheduleData = {};
                snapshot.forEach(doc => {
                    const data = doc.data();
                    if (!scheduleData[data.date]) {
                        scheduleData[data.date] = [];
                    }
                    scheduleData[data.date].push({
                        id: doc.id,
                        ...data
                    });
                });

                setSchedules(scheduleData);
            };

            const handlePrevMonth = () => {
                setCurrentDate(new Date(year, month - 1));
            };

            const handleNextMonth = () => {
                setCurrentDate(new Date(year, month + 1));
            };

            const handleDateClick = (day) => {
                const dateStr = formatDate(year, month, day);
                setSelectedDate(dateStr);
                setShowScheduleModal(true);
            };

                        const handleSaveSchedule = async (date, type) => {
                const scheduleRef = db.collection('schedules');
                
                // Í∏∞Ï°¥ Ïä§ÏºÄÏ§Ñ ÌôïÏù∏
                const existingSchedule = await scheduleRef
                    .where('userId', '==', user.uid)
                    .where('date', '==', date)
                    .get();

                // Ïó∞Ï∞® Í¥ÄÎ†® ÌÉÄÏûÖÏù∏ÏßÄ ÌôïÏù∏
                const isLeaveType = ['Ïó∞Ï∞®', 'Î∞òÏ∞®(Ïò§Ï†Ñ)', 'Î∞òÏ∞®(Ïò§ÌõÑ)', 'Ïó¨Î¶ÑÌú¥Í∞Ä', 'Í≤®Ïö∏Ìú¥Í∞Ä'].includes(type);
                // ÏäπÏù∏ÏûêÎäî ÏûêÎèô ÏäπÏù∏, ÏùºÎ∞ò ÏÇ¨ÏõêÏùÄ ÏäπÏù∏ ÎåÄÍ∏∞
                const approvalStatus = isLeaveType ? (employeeInfo?.isApprover ? 'approved' : 'pending') : null;

                let oldType = null;
                if (!existingSchedule.empty) {
                    oldType = existingSchedule.docs[0].data().type;
                    // ÏóÖÎç∞Ïù¥Ìä∏
                    const docId = existingSchedule.docs[0].id;
                    const updateData = {
                        type: type,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    if (isLeaveType) {
                        // Ïó∞Ï∞®/Î∞òÏ∞®/Ìú¥Í∞Ä ÌÉÄÏûÖÏù∏ Í≤ΩÏö∞ ÏäπÏù∏ ÏÉÅÌÉú ÏÑ§Ï†ï
                        updateData.approvalStatus = approvalStatus;
                    } else {
                        // ÏùºÎ∞ò Ïä§ÏºÄÏ§Ñ(Ï∂úÍ∑º/Ïû¨ÌÉù Îì±)Î°ú Îã§Ïãú Îì±Î°ùÌïòÎäî Í≤ΩÏö∞
                        // Ïù¥Ï†ÑÏóê ÎÇ®ÏïÑÏûàÎçò cancelled / deletion-pending ÏÉÅÌÉúÎ•º Ï¥àÍ∏∞Ìôî
                        updateData.approvalStatus = null;
                    }
                    await scheduleRef.doc(docId).update(updateData);
                } else {
                    // ÏÉàÎ°ú ÏÉùÏÑ±
                    const newScheduleData = {
                        userId: user.uid,
                        userName: user.displayName || user.email,
                        date: date,
                        type: type,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    if (isLeaveType) {
                        newScheduleData.approvalStatus = approvalStatus;
                    }
                    await scheduleRef.add(newScheduleData);
                }

                // Í∏∞Ï°¥ Ïó∞Ï∞® ÎÇ¥Ïó≠Ïù¥ ÏûàÏóàÎã§Î©¥ ÏÇ≠Ï†ú
                if (oldType && (oldType === 'Ïó∞Ï∞®' || oldType === 'Î∞òÏ∞®(Ïò§Ï†Ñ)' || oldType === 'Î∞òÏ∞®(Ïò§ÌõÑ)' || oldType === 'Ïó¨Î¶ÑÌú¥Í∞Ä' || oldType === 'Í≤®Ïö∏Ìú¥Í∞Ä')) {
                    const oldLeaveUsage = await db.collection('leaveUsage')
                        .where('userId', '==', user.uid)
                        .where('date', '==', date)
                        .where('type', '==', oldType)
                        .get();
                    
                    oldLeaveUsage.forEach(async (doc) => {
                        await doc.ref.update({
                            approvalStatus: 'cancelled',
                            cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    });
                }

                // ÏÉàÎ°úÏö¥ ÌÉÄÏûÖÏù¥ Ïó∞Ï∞®Ïù∏ Í≤ΩÏö∞ Ïó∞Ï∞® ÏÇ¨Ïö© Í∏∞Î°ù Ï∂îÍ∞Ä
                if (type === 'Ïó∞Ï∞®' || type === 'Î∞òÏ∞®(Ïò§Ï†Ñ)' || type === 'Î∞òÏ∞®(Ïò§ÌõÑ)' || type === 'Ïó¨Î¶ÑÌú¥Í∞Ä' || type === 'Í≤®Ïö∏Ìú¥Í∞Ä') {
                    let leaveAmount = 0;
                    if (type === 'Ïó∞Ï∞®') {
                        leaveAmount = 1;
                    } else if (type === 'Î∞òÏ∞®(Ïò§Ï†Ñ)' || type === 'Î∞òÏ∞®(Ïò§ÌõÑ)') {
                        leaveAmount = 0.5;
                    } else if (type === 'Ïó¨Î¶ÑÌú¥Í∞Ä' || type === 'Í≤®Ïö∏Ìú¥Í∞Ä') {
                        leaveAmount = 0;
                    }
                    
                    await db.collection('leaveUsage').add({
                        userId: user.uid,
                        date: date,
                        type: type,
                        amount: leaveAmount,
                        approvalStatus: approvalStatus,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }

                setShowScheduleModal(false);
                loadSchedules();
            };

            const handleDeleteSchedule = async (scheduleId, scheduleDate, scheduleType) => {
                try {
                    // Ïä§ÏºÄÏ§Ñ Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞
                    const scheduleDoc = await db.collection('schedules').doc(scheduleId).get();
                    const scheduleData = scheduleDoc.data();
                    const groupId = scheduleData.groupId;
                    
                    // groupIdÍ∞Ä ÏûàÏúºÎ©¥ Ïó∞Í≤∞Îêú Î™®Îì† ÏùºÏ†ï Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞
                    let groupInfo = null;
                    if (groupId) {
                        const leaveUsageSnapshot = await db.collection('leaveUsage')
                            .where('userId', '==', user.uid)
                            .where('groupId', '==', groupId)
                            .get();
                        
                        if (!leaveUsageSnapshot.empty) {
                            const firstDoc = leaveUsageSnapshot.docs[0].data();
                            groupInfo = {
                                startDate: firstDoc.startDate,
                                endDate: firstDoc.endDate,
                                totalDays: firstDoc.totalDays
                            };
                        }
                    }
                    
                    // Ïó∞Ï∞® Í¥ÄÎ†® ÏùºÏ†ïÏù∏ÏßÄ ÌôïÏù∏
                    const isLeaveType = ['Ïó∞Ï∞®', 'Î∞òÏ∞®(Ïò§Ï†Ñ)', 'Î∞òÏ∞®(Ïò§ÌõÑ)', 'Ïó¨Î¶ÑÌú¥Í∞Ä', 'Í≤®Ïö∏Ìú¥Í∞Ä'].includes(scheduleType);
                    
                    if (isLeaveType) {
                        const isApprover = employeeInfo?.isApprover;
                        
                        if (scheduleData.approvalStatus === 'approved') {
                            if (isApprover) {
                                // ÏäπÏù∏ÏûêÎäî Ï¶âÏãú Ï∑®ÏÜå
                                const confirmMsg = groupInfo 
                                    ? `${groupInfo.startDate} ~ ${groupInfo.endDate} (${groupInfo.totalDays}Ïùº) Ïó∞Ï∞®Î•º Î™®Îëê Ï∑®ÏÜåÌïòÏãúÍ≤†ÏäµÎãàÍπå?`
                                    : 'Ïù¥ Ïó∞Ï∞®Î•º Ï∑®ÏÜåÌïòÏãúÍ≤†ÏäµÎãàÍπå?';
                                if (!confirm(confirmMsg)) return;
                                
                                // groupIdÍ∞Ä ÏûàÏúºÎ©¥ Í∑∏Î£π Ï†ÑÏ≤¥ Ï∑®ÏÜå, ÏóÜÏúºÎ©¥ Îã®Ïùº ÏùºÏ†ïÎßå Ï∑®ÏÜå
                                if (groupId) {
                                    // Í∞ôÏùÄ Í∑∏Î£πÏùò Î™®Îì† Ïä§ÏºÄÏ§Ñ Ï∑®ÏÜå
                                    const groupSchedulesSnapshot = await db.collection('schedules')
                                        .where('userId', '==', user.uid)
                                        .where('groupId', '==', groupId)
                                        .get();

                                    groupSchedulesSnapshot.forEach(async (doc) => {
                                        await doc.ref.update({
                                            approvalStatus: 'cancelled',
                                            cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                        });
                                    });

                                    // Í∞ôÏùÄ Í∑∏Î£πÏùò Î™®Îì† leaveUsage Ï∑®ÏÜå
                                    const leaveUsageSnapshot = await db.collection('leaveUsage')
                                        .where('userId', '==', user.uid)
                                        .where('groupId', '==', groupId)
                                        .get();

                                    leaveUsageSnapshot.forEach(async (doc) => {
                                        await doc.ref.update({
                                            approvalStatus: 'cancelled',
                                            cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                        });
                                    });
                                } else {
                                    // Îã®Ïùº ÏùºÏ†ïÎßå Ï∑®ÏÜå
                                    await db.collection('schedules').doc(scheduleId).update({
                                        approvalStatus: 'cancelled',
                                        cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                    });

                                    const leaveUsageSnapshot = await db.collection('leaveUsage')
                                        .where('userId', '==', user.uid)
                                        .where('date', '==', scheduleDate)
                                        .where('type', '==', scheduleType)
                                        .get();

                                    leaveUsageSnapshot.forEach(async (doc) => {
                                        await doc.ref.update({
                                            approvalStatus: 'cancelled',
                                            cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                        });
                                    });
                                }
                                
                                alert('Ïó∞Ï∞®Í∞Ä Ï∑®ÏÜåÎêòÏóàÏäµÎãàÎã§.');
                            } else {
                                // ÏùºÎ∞ò ÏÇ¨ÏõêÏùÄ Ï∑®ÏÜå ÏäπÏù∏ ÏöîÏ≤≠
                                const confirmMsg = groupInfo 
                                    ? `ÏäπÏù∏ ÏôÑÎ£åÎêú Ïó∞Ï∞®ÏûÖÎãàÎã§. ${groupInfo.startDate} ~ ${groupInfo.endDate} (${groupInfo.totalDays}Ïùº) Ïó∞Ï∞®Ïùò Ï∑®ÏÜå ÏäπÏù∏ÏùÑ ÏöîÏ≤≠ÌïòÏãúÍ≤†ÏäµÎãàÍπå?`
                                    : 'ÏäπÏù∏ ÏôÑÎ£åÎêú Ïó∞Ï∞®ÏûÖÎãàÎã§. Ï∑®ÏÜå ÏäπÏù∏ÏùÑ ÏöîÏ≤≠ÌïòÏãúÍ≤†ÏäµÎãàÍπå?';
                                if (!confirm(confirmMsg)) return;
                                
                                if (groupId) {
                                    // Í∞ôÏùÄ Í∑∏Î£πÏùò Î™®Îì† Ïä§ÏºÄÏ§Ñ Ï∑®ÏÜå ÎåÄÍ∏∞
                                    const groupSchedulesSnapshot = await db.collection('schedules')
                                        .where('userId', '==', user.uid)
                                        .where('groupId', '==', groupId)
                                        .get();

                                    groupSchedulesSnapshot.forEach(async (doc) => {
                                        await doc.ref.update({
                                            approvalStatus: 'deletion-pending',
                                            deletionRequestedAt: firebase.firestore.FieldValue.serverTimestamp()
                                        });
                                    });

                                    // Í∞ôÏùÄ Í∑∏Î£πÏùò Î™®Îì† leaveUsage Ï∑®ÏÜå ÎåÄÍ∏∞
                                    const leaveUsageSnapshot = await db.collection('leaveUsage')
                                        .where('userId', '==', user.uid)
                                        .where('groupId', '==', groupId)
                                        .get();

                                    leaveUsageSnapshot.forEach(async (doc) => {
                                        await doc.ref.update({
                                            approvalStatus: 'deletion-pending',
                                            deletionRequestedAt: firebase.firestore.FieldValue.serverTimestamp()
                                        });
                                    });
                                    
                                    // ÏäπÏù∏ÏûêÏóêÍ≤å Slack ÏïåÎ¶º
                                    if (employeeInfo?.approver) {
                                        const slackMessage = `${employeeInfo.name}ÎãòÏù¥ Ïó∞Ï∞® Ï∑®ÏÜå ÏäπÏù∏ ÏöîÏ≤≠ÏùÑ Î≥¥ÎÉàÏäµÎãàÎã§.\nÎÇ†Ïßú: ${groupInfo.startDate} ~ ${groupInfo.endDate} (${groupInfo.totalDays}Ïùº)\nÏú†Ìòï: ${scheduleType}`;
                                        await sendSlackNotification(employeeInfo.approver, slackMessage, 'cancellation');
                                    }
                                } else {
                                    // Îã®Ïùº ÏùºÏ†ïÎßå Ï∑®ÏÜå ÎåÄÍ∏∞
                                    await db.collection('schedules').doc(scheduleId).update({
                                        approvalStatus: 'deletion-pending',
                                        deletionRequestedAt: firebase.firestore.FieldValue.serverTimestamp()
                                    });

                                    const leaveUsageSnapshot = await db.collection('leaveUsage')
                                        .where('userId', '==', user.uid)
                                        .where('date', '==', scheduleDate)
                                        .where('type', '==', scheduleType)
                                        .get();

                                    leaveUsageSnapshot.forEach(async (doc) => {
                                        await doc.ref.update({
                                            approvalStatus: 'deletion-pending',
                                            deletionRequestedAt: firebase.firestore.FieldValue.serverTimestamp()
                                        });
                                    });
                                    
                                    // ÏäπÏù∏ÏûêÏóêÍ≤å Slack ÏïåÎ¶º
                                    if (employeeInfo?.approver) {
                                        const slackMessage = `${employeeInfo.name}ÎãòÏù¥ Ïó∞Ï∞® Ï∑®ÏÜå ÏäπÏù∏ ÏöîÏ≤≠ÏùÑ Î≥¥ÎÉàÏäµÎãàÎã§.\nÎÇ†Ïßú: ${scheduleDate}\nÏú†Ìòï: ${scheduleType}`;
                                        await sendSlackNotification(employeeInfo.approver, slackMessage, 'cancellation');
                                    }
                                }
                                
                                alert('Ï∑®ÏÜå ÏäπÏù∏ ÏöîÏ≤≠Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§.');
                            }
                        } else {
                            // ÏäπÏù∏ÎåÄÍ∏∞ ÎòêÎäî Í∏∞ÌÉÄ ÏÉÅÌÉúÎäî Ï¶âÏãú Ï∑®ÏÜå
                            const confirmMsg = groupInfo 
                                ? `${groupInfo.startDate} ~ ${groupInfo.endDate} (${groupInfo.totalDays}Ïùº) ÏùºÏ†ïÏùÑ Î™®Îëê Ï∑®ÏÜåÌïòÏãúÍ≤†ÏäµÎãàÍπå?`
                                : 'Ïù¥ ÏùºÏ†ïÏùÑ Ï∑®ÏÜåÌïòÏãúÍ≤†ÏäµÎãàÍπå?';
                            if (!confirm(confirmMsg)) return;
                            
                            if (groupId) {
                                // Í∞ôÏùÄ Í∑∏Î£πÏùò Î™®Îì† Ïä§ÏºÄÏ§Ñ Ï∑®ÏÜå
                                const groupSchedulesSnapshot = await db.collection('schedules')
                                    .where('userId', '==', user.uid)
                                    .where('groupId', '==', groupId)
                                    .get();

                                groupSchedulesSnapshot.forEach(async (doc) => {
                                    await doc.ref.update({
                                        approvalStatus: 'cancelled',
                                        cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                    });
                                });

                                // Í∞ôÏùÄ Í∑∏Î£πÏùò Î™®Îì† leaveUsage Ï∑®ÏÜå
                                const leaveUsageSnapshot = await db.collection('leaveUsage')
                                    .where('userId', '==', user.uid)
                                    .where('groupId', '==', groupId)
                                    .get();

                                leaveUsageSnapshot.forEach(async (doc) => {
                                    await doc.ref.update({
                                        approvalStatus: 'cancelled',
                                        cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                    });
                                });
                            } else {
                                // Îã®Ïùº ÏùºÏ†ïÎßå Ï∑®ÏÜå
                                await db.collection('schedules').doc(scheduleId).update({
                                    approvalStatus: 'cancelled',
                                    cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                });

                                const leaveUsageSnapshot = await db.collection('leaveUsage')
                                    .where('userId', '==', user.uid)
                                    .where('date', '==', scheduleDate)
                                    .where('type', '==', scheduleType)
                                    .get();

                                leaveUsageSnapshot.forEach(async (doc) => {
                                    await doc.ref.update({
                                        approvalStatus: 'cancelled',
                                        cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                    });
                                });
                            }
                            
                            alert('ÏùºÏ†ïÏù¥ Ï∑®ÏÜåÎêòÏóàÏäµÎãàÎã§.');
                        }
                    } else {
                        // ÏùºÎ∞ò ÏùºÏ†ïÏùÄ Î∞îÎ°ú Ï∑®ÏÜå
                        if (!confirm('Ïù¥ ÏùºÏ†ïÏùÑ Ï∑®ÏÜåÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
                        
                        await db.collection('schedules').doc(scheduleId).update({
                            approvalStatus: 'cancelled',
                            cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }

                    loadSchedules();
                } catch (error) {
                    alert('Ï∑®ÏÜå Ïã§Ìå®: ' + error.message);
                }
            };

            const renderCalendar = () => {
                const daysInMonth = getDaysInMonth(year, month);
                const firstDay = getFirstDayOfMonth(year, month);
                const weeks = [];
                let days = [];

                // Ïù¥Ï†Ñ Îã¨Ïùò Îπà Ïπ∏
                for (let i = 0; i < firstDay; i++) {
                    days.push(<td key={`empty-${i}`} className="other-month"></td>);
                }

                // ÌòÑÏû¨ Îã¨Ïùò ÎÇ†Ïßú
                const today = new Date();
                const isCurrentMonth = today.getFullYear() === year && today.getMonth() === month;

                for (let day = 1; day <= daysInMonth; day++) {
                    const dateStr = formatDate(year, month, day);
                    const rawDaySchedules = schedules[dateStr] || [];
                    const daySchedules = rawDaySchedules.filter(s => s.approvalStatus !== 'cancelled' && s.approvalStatus !== 'deletion-pending');
                    const isToday = isCurrentMonth && today.getDate() === day;
                    const isHoliday = holidays[dateStr];
                    
                    // ÏöîÏùº Í≥ÑÏÇ∞ (0: ÏùºÏöîÏùº, 6: ÌÜ†ÏöîÏùº)
                    const dayOfWeek = new Date(year, month, day).getDay();
                    const isSunday = dayOfWeek === 0;
                    const isSaturday = dayOfWeek === 6;

                    days.push(
                        <td
                            key={day}
                            className={`${isToday ? 'today' : ''} ${isHoliday ? 'holiday' : ''} ${isSunday ? 'sunday' : ''} ${isSaturday ? 'saturday' : ''}`}
                            onClick={() => handleDateClick(day)}
                        >
                            <div className="date-number">{day}</div>
                            {isHoliday && <div className="holiday-name">{isHoliday}</div>}
                            {daySchedules.map((schedule, idx) => {
                                // Ïó∞Ï∞® Í¥ÄÎ†® ÏùºÏ†ïÏù∏ÏßÄ ÌôïÏù∏
                                const isLeaveType = ['Ïó∞Ï∞®', 'Î∞òÏ∞®(Ïò§Ï†Ñ)', 'Î∞òÏ∞®(Ïò§ÌõÑ)', 'Ïó¨Î¶ÑÌú¥Í∞Ä', 'Í≤®Ïö∏Ìú¥Í∞Ä'].includes(schedule.type);
                                const statusText = schedule.approvalStatus === 'approved' ? ' (ÏäπÏù∏ÏôÑÎ£å)' : 
                                                  schedule.approvalStatus === 'rejected' ? ' (Î∞òÎ†§)' :
                                                  schedule.approvalStatus === 'pending' ? ' (ÏäπÏù∏ÎåÄÍ∏∞)' :
                                                  schedule.approvalStatus === 'deletion-pending' ? ' (Ï∑®ÏÜåÎåÄÍ∏∞)' :
                                                  schedule.approvalStatus === 'cancelled' ? ' (Ï∑®ÏÜåÎê®)' : '';
                                
                                return (
                                    <div
                                        key={idx}
                                        className={`schedule-item schedule-${schedule.type.replace(/[()]/g, '')}`}
                                        onClick={(e) => e.stopPropagation()}
                                    >
                                        <span>{schedule.userName.split('@')[0]} - {schedule.type}{isLeaveType ? statusText : ''}</span>
                                        {schedule.userId === user.uid && (
                                            <button
                                                className="delete-schedule-btn"
                                                onClick={(e) => {
                                                    e.stopPropagation();
                                                    handleDeleteSchedule(schedule.id, schedule.date, schedule.type);
                                                }}
                                            >
                                                ‚úï
                                            </button>
                                        )}
                                    </div>
                                );
                            })}
                        </td>
                    );

                    if (days.length === 7) {
                        weeks.push(<tr key={weeks.length}>{days}</tr>);
                        days = [];
                    }
                }

                // ÎÇ®ÏùÄ Îπà Ïπ∏
                if (days.length > 0) {
                    while (days.length < 7) {
                        days.push(<td key={`empty-end-${days.length}`} className="other-month"></td>);
                    }
                    weeks.push(<tr key={weeks.length}>{days}</tr>);
                }

                return weeks;
            };

            const monthNames = ['1Ïõî', '2Ïõî', '3Ïõî', '4Ïõî', '5Ïõî', '6Ïõî', '7Ïõî', '8Ïõî', '9Ïõî', '10Ïõî', '11Ïõî', '12Ïõî'];

            return (
                <div className="content-card">
                    <div className="calendar-header">
                        <h2>{year}ÎÖÑ {monthNames[month]}</h2>
                        <div className="calendar-nav">
                            <button className="nav-btn" onClick={handlePrevMonth}>Ïù¥Ï†Ñ</button>
                            <button className="nav-btn" onClick={handleNextMonth}>Îã§Ïùå</button>
                        </div>
                    </div>

                    <table className="calendar">
                        <thead>
                            <tr>
                                <th>Ïùº</th>
                                <th>Ïõî</th>
                                <th>Ìôî</th>
                                <th>Ïàò</th>
                                <th>Î™©</th>
                                <th>Í∏à</th>
                                <th>ÌÜ†</th>
                            </tr>
                        </thead>
                        <tbody>
                            {renderCalendar()}
                        </tbody>
                    </table>

                    {selectedDate && selectedDaySchedules.length > 0 && (
                        <div className="daily-schedules">
                            <h3>{selectedDate} ÏùºÏ†ï</h3>
                            <div className="daily-schedule-list">
                                {selectedDaySchedules.map((schedule, idx) => (
                                    <div key={idx} className={`daily-schedule-card ${schedule.type.replace(/[()]/g, '')}`}>
                                        <div className="name">{schedule.userName.split('@')[0]}</div>
                                        <div className="type">{schedule.type}</div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {showScheduleModal && selectedDate && (
                        <ScheduleModal
                            date={selectedDate}
                            currentSchedule={
                                selectedDaySchedules.find(s => s.userId === user.uid)?.type
                            }
                            onSave={handleSaveSchedule}
                            onClose={() => setShowScheduleModal(false)}
                            userName={user.displayName || user.email}
                        />
                    )}
                </div>
            );
        }

        // ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Ïª¥Ìè¨ÎÑåÌä∏
        function Pagination({ currentPage, totalPages, onPageChange }) {
            const pages = [];
            const maxVisible = 5;
            
            let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
            let endPage = Math.min(totalPages, startPage + maxVisible - 1);
            
            if (endPage - startPage < maxVisible - 1) {
                startPage = Math.max(1, endPage - maxVisible + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                pages.push(i);
            }
            
            return (
                <div style={{
                    display: 'flex',
                    justifyContent: 'center',
                    alignItems: 'center',
                    gap: '8px',
                    marginTop: '20px'
                }}>
                    <button
                        onClick={() => onPageChange(currentPage - 1)}
                        disabled={currentPage === 1}
                        style={{
                            padding: '8px 12px',
                            border: '1px solid #ddd',
                            borderRadius: '4px',
                            background: currentPage === 1 ? '#f5f5f5' : 'white',
                            cursor: currentPage === 1 ? 'not-allowed' : 'pointer'
                        }}
                    >
                        Ïù¥Ï†Ñ
                    </button>
                    
                    {startPage > 1 && (
                        <>
                            <button
                                onClick={() => onPageChange(1)}
                                style={{
                                    padding: '8px 12px',
                                    border: '1px solid #ddd',
                                    borderRadius: '4px',
                                    background: 'white',
                                    cursor: 'pointer'
                                }}
                            >
                                1
                            </button>
                            {startPage > 2 && <span>...</span>}
                        </>
                    )}
                    
                    {pages.map(page => (
                        <button
                            key={page}
                            onClick={() => onPageChange(page)}
                            style={{
                                padding: '8px 12px',
                                border: '1px solid #ddd',
                                borderRadius: '4px',
                                background: currentPage === page ? '#4CAF50' : 'white',
                                color: currentPage === page ? 'white' : 'black',
                                cursor: 'pointer',
                                fontWeight: currentPage === page ? '600' : 'normal'
                            }}
                        >
                            {page}
                        </button>
                    ))}
                    
                    {endPage < totalPages && (
                        <>
                            {endPage < totalPages - 1 && <span>...</span>}
                            <button
                                onClick={() => onPageChange(totalPages)}
                                style={{
                                    padding: '8px 12px',
                                    border: '1px solid #ddd',
                                    borderRadius: '4px',
                                    background: 'white',
                                    cursor: 'pointer'
                                }}
                            >
                                {totalPages}
                            </button>
                        </>
                    )}
                    
                    <button
                        onClick={() => onPageChange(currentPage + 1)}
                        disabled={currentPage === totalPages}
                        style={{
                            padding: '8px 12px',
                            border: '1px solid #ddd',
                            borderRadius: '4px',
                            background: currentPage === totalPages ? '#f5f5f5' : 'white',
                            cursor: currentPage === totalPages ? 'not-allowed' : 'pointer'
                        }}
                    >
                        Îã§Ïùå
                    </button>
                </div>
            );
        }

        // Ïó∞Ï∞® Í¥ÄÎ¶¨ Ïª¥Ìè¨ÎÑåÌä∏
        function AnnualLeave({ user }) {
            const [employeeInfo, setEmployeeInfo] = useState(null);
            const [leaveUsage, setLeaveUsage] = useState([]);
            const [showRegisterModal, setShowRegisterModal] = useState(false);
            const [leaveStartDate, setLeaveStartDate] = useState('');
            const [leaveEndDate, setLeaveEndDate] = useState('');
            const [leaveType, setLeaveType] = useState('Ïó∞Ï∞®');
            const [currentPage, setCurrentPage] = useState(1);
            const itemsPerPage = 10;

            useEffect(() => {
                loadEmployeeInfo();
                loadLeaveUsage();
            }, []);

            const loadEmployeeInfo = async () => {
                const doc = await db.collection('employees').doc(user.uid).get();
                if (doc.exists) {
                    setEmployeeInfo(doc.data());
                }
            };

            const loadLeaveUsage = async () => {
                try {
                    const snapshot = await db.collection('leaveUsage')
                        .where('userId', '==', user.uid)
                        .get();

                    const allUsage = [];
                    snapshot.forEach(doc => {
                        allUsage.push({ id: doc.id, ...doc.data() });
                    });
                    
                    // groupIdÎ°ú Í∑∏Î£πÌïë
                    const groupedUsage = {};
                    const ungroupedUsage = [];
                    
                    allUsage.forEach(item => {
                        if (item.groupId) {
                            if (!groupedUsage[item.groupId]) {
                                groupedUsage[item.groupId] = {
                                    id: item.groupId,
                                    ids: [item.id],
                                    userId: item.userId,
                                    startDate: item.startDate || item.date,
                                    endDate: item.endDate || item.date,
                                    date: item.startDate || item.date,
                                    type: item.type,
                                    amount: item.amount,
                                    totalDays: item.totalDays || 1,
                                    note: item.note,
                                    approvalStatus: item.approvalStatus,
                                    createdAt: item.createdAt,
                                    groupId: item.groupId,
                                    isGrouped: true
                                };
                            } else {
                                groupedUsage[item.groupId].ids.push(item.id);
                            }
                        } else {
                            // groupIdÍ∞Ä ÏóÜÎäî Í≤ΩÏö∞ (Ïù¥Ï†Ñ Îç∞Ïù¥ÌÑ∞)
                            ungroupedUsage.push(item);
                        }
                    });
                    
                    // Í∑∏Î£πÌôîÎêú Îç∞Ïù¥ÌÑ∞ÏôÄ Í∑∏Î£πÌôîÎêòÏßÄ ÏïäÏùÄ Îç∞Ïù¥ÌÑ∞ Ìï©ÏπòÍ∏∞
                    const usage = [...Object.values(groupedUsage), ...ungroupedUsage];
                    
                    // ÎÇ†Ïßú Í∏∞Ï§ÄÏúºÎ°ú ÎÇ¥Î¶ºÏ∞®Ïàú Ï†ïÎ†¨
                    usage.sort((a, b) => (b.startDate || b.date).localeCompare(a.startDate || a.date));
                    
                    setLeaveUsage(usage);
                } catch (error) {
                    console.error('Ïó∞Ï∞® ÎÇ¥Ïó≠ Î°úÎìú Ïã§Ìå®:', error);
                }
            };

            const calculateTotalLeave = (joinDate) => {
                if (!joinDate) return 0;
                const join = new Date(joinDate);
                const now = new Date();
                const years = now.getFullYear() - join.getFullYear();
                
                // 1ÎÖÑ ÎØ∏Îßå
                if (years < 1) {
                    const months = (now.getFullYear() - join.getFullYear()) * 12 + (now.getMonth() - join.getMonth());
                    return Math.floor(months);
                }
                
                // 1ÎÖÑ Ïù¥ÏÉÅ: Í∏∞Î≥∏ 15Ïùº + Í∑ºÏÜçÏó∞ÏàòÎãπ 1Ïùº
                return 15 + Math.min(years - 1, 10);
            };

            const calculateUsedLeave = () => {
                // ÏäπÏù∏ÏôÑÎ£åÏôÄ ÏäπÏù∏ÎåÄÍ∏∞(pending) Î™®Îëê Ïπ¥Ïö¥Ìä∏
                return leaveUsage
                    .filter(usage => usage.approvalStatus === 'approved' || usage.approvalStatus === 'pending')
                    .reduce((sum, usage) => sum + usage.amount, 0);
            };

            const handleDeleteLeave = async (usageIdOrGroup, usageDate, usageType, approvalStatus, groupId) => {
                try {
                    const isApprover = employeeInfo?.isApprover;
                    
                    // groupIdÍ∞Ä ÏûàÏúºÎ©¥ Í∑∏Î£π Ï†ÑÏ≤¥ ÏÇ≠Ï†ú, ÏóÜÏúºÎ©¥ Îã®Ïùº Ìï≠Î™© ÏÇ≠Ï†ú
                    const usageIds = groupId ? usageIdOrGroup.ids : [usageIdOrGroup];
                    const isGrouped = !!groupId;

                    if (approvalStatus === 'approved') {
                        // ÏäπÏù∏ÏôÑÎ£åÎêú Ïó∞Ï∞® Ï∑®ÏÜå
                        if (isApprover) {
                            // ÏäπÏù∏ÏûêÎäî Ï¶âÏãú Ï∑®ÏÜå Ï≤òÎ¶¨
                            const confirmMsg = isGrouped 
                                ? `${usageIdOrGroup.startDate} ~ ${usageIdOrGroup.endDate} (${usageIdOrGroup.totalDays}Ïùº) Ïó∞Ï∞®Î•º Î™®Îëê Ï∑®ÏÜåÌïòÏãúÍ≤†ÏäµÎãàÍπå?`
                                : 'Ïù¥ Ïó∞Ï∞®Î•º Ï∑®ÏÜåÌïòÏãúÍ≤†ÏäµÎãàÍπå?';
                            if (!confirm(confirmMsg)) return;
                            
                            // Î™®Îì† Ïó∞Ï∞® Í∏∞Î°ù Ï∑®ÏÜå
                            for (const id of usageIds) {
                                await db.collection('leaveUsage').doc(id).update({
                                    approvalStatus: 'cancelled',
                                    cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                });
                            }

                            // Ïä§ÏºÄÏ§ÑÎèÑ Ï∑®ÏÜå ÏÉÅÌÉúÎ°ú Î≥ÄÍ≤Ω
                            if (groupId) {
                                const scheduleSnapshot = await db.collection('schedules')
                                    .where('userId', '==', user.uid)
                                    .where('groupId', '==', groupId)
                                    .get();

                                scheduleSnapshot.forEach(async (doc) => {
                                    await doc.ref.update({
                                        approvalStatus: 'cancelled',
                                        cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                    });
                                });
                            } else {
                                const scheduleSnapshot = await db.collection('schedules')
                                    .where('userId', '==', user.uid)
                                    .where('date', '==', usageDate)
                                    .where('type', '==', usageType)
                                    .get();

                                scheduleSnapshot.forEach(async (doc) => {
                                    await doc.ref.update({
                                        approvalStatus: 'cancelled',
                                        cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                    });
                                });
                            }
                            
                            alert('Ïó∞Ï∞®Í∞Ä Ï∑®ÏÜåÎêòÏóàÏäµÎãàÎã§.');
                        } else {
                            // ÏùºÎ∞ò ÏÇ¨ÏõêÏùÄ Ï∑®ÏÜå ÏäπÏù∏ ÏöîÏ≤≠
                            const confirmMsg = isGrouped 
                                ? `ÏäπÏù∏ ÏôÑÎ£åÎêú Ïó∞Ï∞®ÏûÖÎãàÎã§. ${usageIdOrGroup.startDate} ~ ${usageIdOrGroup.endDate} (${usageIdOrGroup.totalDays}Ïùº) Ïó∞Ï∞®Ïùò Ï∑®ÏÜå ÏäπÏù∏ÏùÑ ÏöîÏ≤≠ÌïòÏãúÍ≤†ÏäµÎãàÍπå?`
                                : 'ÏäπÏù∏ ÏôÑÎ£åÎêú Ïó∞Ï∞®ÏûÖÎãàÎã§. Ï∑®ÏÜå ÏäπÏù∏ÏùÑ ÏöîÏ≤≠ÌïòÏãúÍ≤†ÏäµÎãàÍπå?';
                            if (!confirm(confirmMsg)) return;
                            
                            for (const id of usageIds) {
                                await db.collection('leaveUsage').doc(id).update({
                                    approvalStatus: 'deletion-pending',
                                    deletionRequestedAt: firebase.firestore.FieldValue.serverTimestamp()
                                });
                            }

                            // Ïä§ÏºÄÏ§ÑÎèÑ Ï∑®ÏÜå ÎåÄÍ∏∞Î°ú Î≥ÄÍ≤Ω
                            if (groupId) {
                                const scheduleSnapshot = await db.collection('schedules')
                                    .where('userId', '==', user.uid)
                                    .where('groupId', '==', groupId)
                                    .get();

                                scheduleSnapshot.forEach(async (doc) => {
                                    await doc.ref.update({
                                        approvalStatus: 'deletion-pending',
                                        deletionRequestedAt: firebase.firestore.FieldValue.serverTimestamp()
                                    });
                                });
                            } else {
                                const scheduleSnapshot = await db.collection('schedules')
                                    .where('userId', '==', user.uid)
                                    .where('date', '==', usageDate)
                                    .where('type', '==', usageType)
                                    .get();

                                scheduleSnapshot.forEach(async (doc) => {
                                    await doc.ref.update({
                                        approvalStatus: 'deletion-pending',
                                        deletionRequestedAt: firebase.firestore.FieldValue.serverTimestamp()
                                    });
                                });
                            }
                            
                            // ÏäπÏù∏ÏûêÏóêÍ≤å Slack ÏïåÎ¶º
                            if (employeeInfo?.approver) {
                                const dateStr = isGrouped 
                                    ? `${usageIdOrGroup.startDate} ~ ${usageIdOrGroup.endDate} (${usageIdOrGroup.totalDays}Ïùº)`
                                    : usageDate;
                                const slackMessage = `${employeeInfo.name}ÎãòÏù¥ Ïó∞Ï∞® Ï∑®ÏÜå ÏäπÏù∏ ÏöîÏ≤≠ÏùÑ Î≥¥ÎÉàÏäµÎãàÎã§.\nÎÇ†Ïßú: ${dateStr}\nÏú†Ìòï: ${usageType}`;
                                await sendSlackNotification(employeeInfo.approver, slackMessage, 'cancellation');
                            }
                            
                            alert('Ï∑®ÏÜå ÏäπÏù∏ ÏöîÏ≤≠Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§.');
                        }
                    } else if (approvalStatus === 'pending') {
                        // ÏäπÏù∏ÎåÄÍ∏∞ Ïó∞Ï∞®Îäî Ï¶âÏãú Ï∑®ÏÜå
                        const confirmMsg = isGrouped 
                            ? `${usageIdOrGroup.startDate} ~ ${usageIdOrGroup.endDate} (${usageIdOrGroup.totalDays}Ïùº) Ïó∞Ï∞® Ïã†Ï≤≠ÏùÑ Î™®Îëê Ï∑®ÏÜåÌïòÏãúÍ≤†ÏäµÎãàÍπå?`
                            : 'Ïù¥ Ïó∞Ï∞® Ïã†Ï≤≠ÏùÑ Ï∑®ÏÜåÌïòÏãúÍ≤†ÏäµÎãàÍπå?';
                        if (!confirm(confirmMsg)) return;
                        
                        for (const id of usageIds) {
                            await db.collection('leaveUsage').doc(id).update({
                                approvalStatus: 'cancelled',
                                cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        }

                        // Ïä§ÏºÄÏ§ÑÎèÑ Ï∑®ÏÜå ÏÉÅÌÉúÎ°ú Î≥ÄÍ≤Ω
                        if (groupId) {
                            const scheduleSnapshot = await db.collection('schedules')
                                .where('userId', '==', user.uid)
                                .where('groupId', '==', groupId)
                                .get();

                            scheduleSnapshot.forEach(async (doc) => {
                                await doc.ref.update({
                                    approvalStatus: 'cancelled',
                                    cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                });
                            });
                        } else {
                            const scheduleSnapshot = await db.collection('schedules')
                                .where('userId', '==', user.uid)
                                .where('date', '==', usageDate)
                                .where('type', '==', usageType)
                                .get();

                            scheduleSnapshot.forEach(async (doc) => {
                                await doc.ref.update({
                                    approvalStatus: 'cancelled',
                                    cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                });
                            });
                        }
                        
                        alert('Ïó∞Ï∞® Ïã†Ï≤≠Ïù¥ Ï∑®ÏÜåÎêòÏóàÏäµÎãàÎã§.');
                    } else {
                        // Î∞òÎ†§ÎêòÍ±∞ÎÇò Ï∑®ÏÜåÎåÄÍ∏∞ ÏÉÅÌÉúÎäî Ï¶âÏãú Ï∑®ÏÜå
                        const confirmMsg = isGrouped 
                            ? `${usageIdOrGroup.startDate} ~ ${usageIdOrGroup.endDate} (${usageIdOrGroup.totalDays}Ïùº) Ïó∞Ï∞® ÎÇ¥Ïó≠ÏùÑ Ï∑®ÏÜåÌïòÏãúÍ≤†ÏäµÎãàÍπå?`
                            : 'Ïù¥ Ïó∞Ï∞® ÎÇ¥Ïó≠ÏùÑ Ï∑®ÏÜåÌïòÏãúÍ≤†ÏäµÎãàÍπå?';
                        if (!confirm(confirmMsg)) return;
                        
                        for (const id of usageIds) {
                            await db.collection('leaveUsage').doc(id).update({
                                approvalStatus: 'cancelled',
                                cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        }

                        if (groupId) {
                            const scheduleSnapshot = await db.collection('schedules')
                                .where('userId', '==', user.uid)
                                .where('groupId', '==', groupId)
                                .get();

                            scheduleSnapshot.forEach(async (doc) => {
                                await doc.ref.update({
                                    approvalStatus: 'cancelled',
                                    cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                });
                            });
                        } else {
                            const scheduleSnapshot = await db.collection('schedules')
                                .where('userId', '==', user.uid)
                                .where('date', '==', usageDate)
                                .where('type', '==', usageType)
                                .get();

                            scheduleSnapshot.forEach(async (doc) => {
                                await doc.ref.update({
                                    approvalStatus: 'cancelled',
                                    cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                });
                            });
                        }
                        
                        alert('Ï∑®ÏÜåÎêòÏóàÏäµÎãàÎã§.');
                    }

                    loadLeaveUsage();
                    loadEmployeeInfo();
                } catch (error) {
                    alert('Ï≤òÎ¶¨ Ïã§Ìå®: ' + error.message);
                }
            };

            const handleRegisterLeave = async () => {
                if (!leaveStartDate || !leaveEndDate) {
                    alert('ÏãúÏûëÏùºÍ≥º Ï¢ÖÎ£åÏùºÏùÑ Î™®Îëê ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                const startDate = new Date(leaveStartDate);
                const endDate = new Date(leaveEndDate);

                if (startDate > endDate) {
                    alert('Ï¢ÖÎ£åÏùºÏùÄ ÏãúÏûëÏùºÎ≥¥Îã§ Îä¶Ïñ¥Ïïº Ìï©ÎãàÎã§.');
                    return;
                }

                // ÏäπÏù∏ÏûêÎäî ÏûêÎèô ÏäπÏù∏, ÏùºÎ∞ò ÏÇ¨ÏõêÏùÄ ÏäπÏù∏ ÎåÄÍ∏∞
                const approvalStatus = employeeInfo?.isApprover ? 'approved' : 'pending';

                // Ìú¥Í∞Ä Ïú†ÌòïÏóê Îî∞Î•∏ Ïó∞Ï∞® ÏàòÎüâ Í≥ÑÏÇ∞
                let leaveAmount = 0;
                if (leaveType === 'Ïó∞Ï∞®') {
                    leaveAmount = 1;
                } else if (leaveType === 'Î∞òÏ∞®(Ïò§Ï†Ñ)' || leaveType === 'Î∞òÏ∞®(Ïò§ÌõÑ)') {
                    leaveAmount = 0.5;
                } else if (leaveType === 'Ïó¨Î¶ÑÌú¥Í∞Ä' || leaveType === 'Í≤®Ïö∏Ìú¥Í∞Ä') {
                    leaveAmount = 0; // Ïó∞Ï∞® ÏàòÎüâÏóê Ïπ¥Ïö¥Ìä∏ÌïòÏßÄ ÏïäÏùå
                }
                
                // Ïó¨Î¶ÑÌú¥Í∞Ä, Í≤®Ïö∏Ìú¥Í∞ÄÍ∞Ä ÏïÑÎãå Í≤ΩÏö∞ÏóêÎßå Ïó∞Ï∞® ÏàòÎüâ Ï≤¥ÌÅ¨
                if (leaveType !== 'Ïó¨Î¶ÑÌú¥Í∞Ä' && leaveType !== 'Í≤®Ïö∏Ìú¥Í∞Ä') {
                    // Îì±Î°ùÌïòÎ†§Îäî Ïã§Ï†ú Í∑ºÎ¨¥Ïùº Ïàò Í≥ÑÏÇ∞ (Ï£ºÎßê Ï†úÏô∏)
                    let requestedDays = 0;
                    const tempDate = new Date(startDate);
                    while (tempDate <= endDate) {
                        const dayOfWeek = tempDate.getDay();
                        if (dayOfWeek !== 0 && dayOfWeek !== 6) {
                            requestedDays += leaveAmount;
                        }
                        tempDate.setDate(tempDate.getDate() + 1);
                    }

                    // ÌòÑÏû¨ ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Ïó∞Ï∞® ÏàòÎüâ Í≥ÑÏÇ∞
                    const totalLeave = calculateTotalLeave(employeeInfo?.joinDate);
                    const usedLeave = calculateUsedLeave();
                    const remainingLeave = totalLeave - usedLeave;

                    // ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Ïó∞Ï∞® ÏàòÎüâ Ï≤¥ÌÅ¨
                    if (remainingLeave <= 0) {
                        alert(`ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Ïó∞Ï∞®Í∞Ä ÏóÜÏäµÎãàÎã§.\n\nÏ¥ù Ïó∞Ï∞®: ${totalLeave}Ïùº\nÏÇ¨Ïö©Ìïú Ïó∞Ï∞®: ${usedLeave}Ïùº\nÎÇ®ÏùÄ Ïó∞Ï∞®: ${remainingLeave}Ïùº`);
                        return;
                    }

                    if (requestedDays > remainingLeave) {
                        alert(`ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Ïó∞Ï∞®Î•º Ï¥àÍ≥ºÌñàÏäµÎãàÎã§.\n\nÏöîÏ≤≠Ìïú Ïó∞Ï∞®: ${requestedDays}Ïùº\nÏÇ¨Ïö© Í∞ÄÎä•Ìïú Ïó∞Ï∞®: ${remainingLeave}Ïùº\n\n${remainingLeave}Ïùº Ïù¥ÌïòÎ°ú Ïã†Ï≤≠Ìï¥Ï£ºÏÑ∏Ïöî.`);
                        return;
                    }
                }
                
                // Ïó∞ÏÜçÎêú Ïó∞Ï∞®Î•º Î¨∂Í∏∞ ÏúÑÌïú groupId ÏÉùÏÑ±
                const groupId = `${user.uid}_${Date.now()}`;
                
                // Ïã§Ï†ú Í∑ºÎ¨¥Ïùº Ïàò Í≥ÑÏÇ∞ (Ï£ºÎßê Ï†úÏô∏)
                let workDayCount = 0;
                const tempDate = new Date(startDate);
                while (tempDate <= endDate) {
                    const dayOfWeek = tempDate.getDay();
                    if (dayOfWeek !== 0 && dayOfWeek !== 6) {
                        workDayCount++;
                    }
                    tempDate.setDate(tempDate.getDate() + 1);
                }
                
                // ÏãúÏûëÏùºÎ∂ÄÌÑ∞ Ï¢ÖÎ£åÏùºÍπåÏßÄ ÏàúÌöå
                const currentDate = new Date(startDate);
                while (currentDate <= endDate) {
                    const dateStr = currentDate.toISOString().split('T')[0];
                    
                    // Ï£ºÎßê Ï†úÏô∏ (ÌÜ†ÏöîÏùº=6, ÏùºÏöîÏùº=0)
                    const dayOfWeek = currentDate.getDay();
                    if (dayOfWeek !== 0 && dayOfWeek !== 6) {
                        // Ïó∞Ï∞® ÏÇ¨Ïö© Í∏∞Î°ù
                        await db.collection('leaveUsage').add({
                            userId: user.uid,
                            date: dateStr,
                            startDate: leaveStartDate,
                            endDate: leaveEndDate,
                            type: leaveType,
                            amount: leaveAmount,
                            totalDays: workDayCount,
                            groupId: groupId,
                            approvalStatus: approvalStatus,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });

                        // Ïä§ÏºÄÏ§ÑÏóê Îì±Î°ù
                        const scheduleRef = db.collection('schedules');
                        const existingSchedule = await scheduleRef
                            .where('userId', '==', user.uid)
                            .where('date', '==', dateStr)
                            .get();

                        if (!existingSchedule.empty) {
                            const docId = existingSchedule.docs[0].id;
                            await scheduleRef.doc(docId).update({
                                type: leaveType,
                                groupId: groupId,
                                approvalStatus: approvalStatus,
                                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        } else {
                            await scheduleRef.add({
                                userId: user.uid,
                                userName: user.displayName || user.email,
                                date: dateStr,
                                type: leaveType,
                                groupId: groupId,
                                approvalStatus: approvalStatus,
                                createdAt: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        }
                    }
                    
                    // Îã§Ïùå ÎÇ†Î°ú Ïù¥Îèô
                    currentDate.setDate(currentDate.getDate() + 1);
                }

                const message = employeeInfo?.isApprover 
                    ? 'Ïó∞Ï∞® Îì±Î°ùÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§.' 
                    : 'Ïó∞Ï∞® Ïã†Ï≤≠Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§. ÏäπÏù∏ÏùÑ Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî.';
                alert(message);
                
                // ÏùºÎ∞ò ÏÇ¨ÏõêÏù¥ Ïó∞Ï∞® Ïã†Ï≤≠Ìïú Í≤ΩÏö∞ ÏäπÏù∏ÏûêÏóêÍ≤å Slack ÏïåÎ¶º
                if (!employeeInfo?.isApprover && employeeInfo?.approver) {
                    const days = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
                    const slackMessage = `${employeeInfo.name}ÎãòÏù¥ Ïó∞Ï∞® ÏäπÏù∏ ÏöîÏ≤≠ÏùÑ Î≥¥ÎÉàÏäµÎãàÎã§.\nÍ∏∞Í∞Ñ: ${leaveStartDate} ~ ${leaveEndDate} (${days}Ïùº)\nÏú†Ìòï: ${leaveType}`;
                    await sendSlackNotification(employeeInfo.approver, slackMessage, 'approval');
                }
                
                setShowRegisterModal(false);
                setLeaveStartDate('');
                setLeaveEndDate('');
                loadLeaveUsage();
            };

            if (!employeeInfo) {
                return <div className="content-card">ÏÇ¨Ïõê Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...</div>;
            }

            const totalLeave = employeeInfo.customTotalLeave || calculateTotalLeave(employeeInfo.joinDate);
            const usedLeave = calculateUsedLeave();
            const remainingLeave = totalLeave - usedLeave;

            return (
                <div className="content-card">
                    <button className="register-btn" onClick={() => setShowRegisterModal(true)}>
                        Ïó∞Ï∞® Îì±Î°ù
                    </button>

                    <div className="annual-leave-info">
                        <div className="info-card">
                            <h4>ÏûÖÏÇ¨Ïùº</h4>
                            <div className="value">{employeeInfo.joinDate}</div>
                        </div>
                        <div className="info-card">
                            <h4>Ï¥ù Ïó∞Ï∞®</h4>
                            <div className="value">{totalLeave}Ïùº</div>
                        </div>
                        <div className="info-card">
                            <h4>ÏÇ¨Ïö© Ïó∞Ï∞®</h4>
                            <div className="value">{usedLeave}Ïùº</div>
                        </div>
                        <div className="info-card">
                            <h4>ÎÇ®ÏùÄ Ïó∞Ï∞®</h4>
                            <div className="value" style={{color: '#4CAF50'}}>{remainingLeave}Ïùº</div>
                        </div>
                    </div>

                    <div className="leave-history">
                        <h3>Ïó∞Ï∞® ÏÇ¨Ïö© ÎÇ¥Ïó≠</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>ÎÇ†Ïßú</th>
                                    <th>Ïú†Ìòï</th>
                                    <th>ÏÇ¨Ïö©ÏùºÏàò</th>
                                    <th>ÏäπÏù∏ ÏÉÅÌÉú</th>
                                    <th>Í¥ÄÎ¶¨</th>
                                </tr>
                            </thead>
                            <tbody>
                                {(() => {
                                    const startIndex = (currentPage - 1) * itemsPerPage;
                                    const endIndex = startIndex + itemsPerPage;
                                    const currentItems = leaveUsage.slice(startIndex, endIndex);
                                    return currentItems.map(usage => (
                                        <tr key={usage.id}>
                                            <td>
                                                {usage.isGrouped && usage.startDate !== usage.endDate 
                                                    ? `${usage.startDate} ~ ${usage.endDate}`
                                                    : (usage.startDate || usage.date)}
                                            </td>
                                            <td>{usage.type}</td>
                                            <td>
                                                {usage.isGrouped && usage.totalDays > 1
                                                    ? `${usage.totalDays}Ïùº`
                                                    : (usage.amount > 0 ? `${usage.amount}Ïùº` : '-')}
                                            </td>
                                            <td>
                                                <span style={{
                                                    padding: '4px 8px',
                                                    borderRadius: '4px',
                                                    fontSize: '12px',
                                                    background: usage.approvalStatus === 'approved' ? '#4CAF50' : 
                                                               usage.approvalStatus === 'rejected' ? '#ff4444' :
                                                               usage.approvalStatus === 'deletion-pending' ? '#9c27b0' :
                                                               usage.approvalStatus === 'cancelled' ? '#999' : '#ff9800',
                                                    color: 'white'
                                                }}>
                                                    {usage.approvalStatus === 'approved' ? 'ÏäπÏù∏ÏôÑÎ£å' : 
                                                     usage.approvalStatus === 'rejected' ? 'Î∞òÎ†§' :
                                                     usage.approvalStatus === 'deletion-pending' ? 'Ï∑®ÏÜåÎåÄÍ∏∞' :
                                                     usage.approvalStatus === 'cancelled' ? 'Ï∑®ÏÜåÎê®' : 'ÏäπÏù∏ÎåÄÍ∏∞'}
                                                </span>
                                            </td>
                                            <td>
                                                {(usage.approvalStatus !== 'deletion-pending' && usage.approvalStatus !== 'cancelled') && (
                                                    <button
                                                        onClick={() => handleDeleteLeave(
                                                            usage.isGrouped ? usage : usage.id,
                                                            usage.date,
                                                            usage.type,
                                                            usage.approvalStatus,
                                                            usage.groupId
                                                        )}
                                                        style={{
                                                            padding: '4px 8px',
                                                            background: '#ff4444',
                                                            color: 'white',
                                                            border: 'none',
                                                            borderRadius: '4px',
                                                            cursor: 'pointer',
                                                            fontSize: '12px'
                                                        }}
                                                    >
                                                        Ï∑®ÏÜå
                                                    </button>
                                                )}
                                            </td>
                                        </tr>
                                    ));
                                })()}
                            </tbody>
                        </table>
                        {leaveUsage.length > itemsPerPage && (
                            <Pagination
                                currentPage={currentPage}
                                totalPages={Math.ceil(leaveUsage.length / itemsPerPage)}
                                onPageChange={setCurrentPage}
                            />
                        )}
                    </div>

                    {showRegisterModal && (
                        <div className="modal" onClick={() => setShowRegisterModal(false)}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                                <h3>Ïó∞Ï∞® Îì±Î°ù</h3>
                                <div className="form-group">
                                    <label>ÏãúÏûëÏùº</label>
                                    <input
                                        type="date"
                                        value={leaveStartDate}
                                        onChange={(e) => setLeaveStartDate(e.target.value)}
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Ï¢ÖÎ£åÏùº</label>
                                    <input
                                        type="date"
                                        value={leaveEndDate}
                                        onChange={(e) => setLeaveEndDate(e.target.value)}
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Ïú†Ìòï</label>
                                    <select
                                        value={leaveType}
                                        onChange={(e) => setLeaveType(e.target.value)}
                                        style={{
                                            width: '100%',
                                            padding: '12px',
                                            border: '1px solid #ddd',
                                            borderRadius: '6px',
                                            fontSize: '14px'
                                        }}
                                    >
                                        <option value="Ïó∞Ï∞®">Ïó∞Ï∞®</option>
                                        <option value="Î∞òÏ∞®(Ïò§Ï†Ñ)">Î∞òÏ∞®(Ïò§Ï†Ñ)</option>
                                        <option value="Î∞òÏ∞®(Ïò§ÌõÑ)">Î∞òÏ∞®(Ïò§ÌõÑ)</option>
                                        <option value="Ïó¨Î¶ÑÌú¥Í∞Ä">Ïó¨Î¶ÑÌú¥Í∞Ä</option>
                                        <option value="Í≤®Ïö∏Ìú¥Í∞Ä">Í≤®Ïö∏Ìú¥Í∞Ä</option>
                                    </select>
                                </div>
                                <div style={{fontSize: '12px', color: '#666', marginTop: '10px'}}>
                                    * Ï£ºÎßê(ÌÜ†,Ïùº)ÏùÄ ÏûêÎèôÏúºÎ°ú Ï†úÏô∏Îê©ÎãàÎã§.
                                </div>
                                <div className="modal-buttons">
                                    <button className="btn-secondary" onClick={() => setShowRegisterModal(false)}>
                                        Ï∑®ÏÜå
                                    </button>
                                    <button className="btn-primary" onClick={handleRegisterLeave}>
                                        Îì±Î°ù
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ
        function AdminPage() {
            const [employees, setEmployees] = useState([]);
            const [approvalLines, setApprovalLines] = useState([]);
            const [showAddModal, setShowAddModal] = useState(false);
            const [editingEmployeeId, setEditingEmployeeId] = useState(null);
            const [newEmployee, setNewEmployee] = useState({
                email: '',
                name: '',
                phone: '',
                joinDate: '',
                password: '',
                slackUserId: ''
            });

            useEffect(() => {
                loadEmployees();
                loadApprovalLines();
            }, []);

            const loadApprovalLines = async () => {
                const snapshot = await db.collection('approvalLines').get();
                const lines = [];
                snapshot.forEach(doc => {
                    lines.push({ id: doc.id, ...doc.data() });
                });
                setApprovalLines(lines);
            };

            const formatPhoneNumber = (value) => {
                // Ïà´ÏûêÎßå Ï∂îÏ∂ú
                const numbers = value.replace(/[^\d]/g, '');
                
                // Í∏∏Ïù¥Ïóê Îî∞Îùº Ìè¨Îß∑ÌåÖ
                if (numbers.length <= 3) {
                    return numbers;
                } else if (numbers.length <= 7) {
                    return `${numbers.slice(0, 3)}-${numbers.slice(3)}`;
                } else if (numbers.length <= 11) {
                    return `${numbers.slice(0, 3)}-${numbers.slice(3, 7)}-${numbers.slice(7)}`;
                } else {
                    return `${numbers.slice(0, 3)}-${numbers.slice(3, 7)}-${numbers.slice(7, 11)}`;
                }
            };

            const loadEmployees = async () => {
                const snapshot = await db.collection('employees').get();
                const employeeList = [];
                snapshot.forEach(doc => {
                    employeeList.push({ id: doc.id, ...doc.data() });
                });
                setEmployees(employeeList);
            };

            const handleAddEmployee = async () => {
                if (!newEmployee.email || !newEmployee.name || !newEmployee.joinDate || !newEmployee.password) {
                    alert('ÌïÑÏàò ÌïÑÎìúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                try {
                    // ÌòÑÏû¨ Î°úÍ∑∏Ïù∏Îêú Í¥ÄÎ¶¨Ïûê Ï†ïÎ≥¥ Ï†ÄÏû•
                    const currentUser = auth.currentUser;
                    const currentEmail = currentUser.email;
                    const currentPassword = prompt('Í¥ÄÎ¶¨Ïûê ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî (Í≥ÑÏ†ï Ïú†ÏßÄÎ•º ÏúÑÌï¥ ÌïÑÏöîÌï©ÎãàÎã§):');
                    
                    if (!currentPassword) {
                        alert('ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÌïÑÏöîÌï©ÎãàÎã§.');
                        return;
                    }

                    // Firebase AuthÏóê ÏÇ¨Ïö©Ïûê ÏÉùÏÑ±
                    const userCredential = await auth.createUserWithEmailAndPassword(
                        newEmployee.email,
                        newEmployee.password
                    );

                    // FirestoreÏóê ÏÇ¨Ïõê Ï†ïÎ≥¥ Ï†ÄÏû•
                    await db.collection('employees').doc(userCredential.user.uid).set({
                        email: newEmployee.email,
                        name: newEmployee.name,
                        phone: newEmployee.phone,
                        joinDate: newEmployee.joinDate,
                        slackUserId: newEmployee.slackUserId || '',
                        isApprover: false,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    // ÏÇ¨Ïö©Ïûê Ïù¥Î¶Ñ ÏÑ§Ï†ï
                    await userCredential.user.updateProfile({
                        displayName: newEmployee.name
                    });

                    // Í¥ÄÎ¶¨Ïûê Í≥ÑÏ†ïÏúºÎ°ú Îã§Ïãú Î°úÍ∑∏Ïù∏
                    await auth.signInWithEmailAndPassword(currentEmail, currentPassword);

                    alert('ÏÇ¨ÏõêÏù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.');
                    setShowAddModal(false);
                    setNewEmployee({ email: '', name: '', phone: '', joinDate: '', password: '', slackUserId: '' });
                    loadEmployees();
                } catch (error) {
                    alert('ÏÇ¨Ïõê Ï∂îÍ∞Ä Ïã§Ìå®: ' + error.message);
                }
            };

            const handleToggleApprover = async (employeeId, currentStatus) => {
                try {
                    await db.collection('employees').doc(employeeId).update({
                        isApprover: !currentStatus
                    });
                    alert('ÏäπÏù∏Ïûê Í∂åÌïúÏù¥ ' + (!currentStatus ? 'Î∂ÄÏó¨' : 'Ìï¥Ï†ú') + 'ÎêòÏóàÏäµÎãàÎã§.');
                    loadEmployees();
                } catch (error) {
                    alert('Í∂åÌïú Î≥ÄÍ≤Ω Ïã§Ìå®: ' + error.message);
                }
            };

            const handleTogglePTScheduleEditor = async (employeeId, currentStatus) => {
                try {
                    await db.collection('employees').doc(employeeId).update({
                        isPTScheduleEditor: !currentStatus
                    });
                    alert('PT Ïä§ÏºÄÏ§Ñ Ìé∏Ïßë Í∂åÌïúÏù¥ ' + (!currentStatus ? 'Î∂ÄÏó¨' : 'Ìï¥Ï†ú') + 'ÎêòÏóàÏäµÎãàÎã§.');
                    loadEmployees();
                } catch (error) {
                    alert('Í∂åÌïú Î≥ÄÍ≤Ω Ïã§Ìå®: ' + error.message);
                }
            };

            const handleDeleteEmployee = async (employeeId) => {
                if (!confirm('Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;

                try {
                    await db.collection('employees').doc(employeeId).delete();
                    // Note: Firebase AuthÏùò ÏÇ¨Ïö©Ïûê ÏÇ≠Ï†úÎäî Admin SDKÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§
                    alert('ÏÇ¨ÏõêÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
                    loadEmployees();
                } catch (error) {
                    alert('ÏÇ≠Ï†ú Ïã§Ìå®: ' + error.message);
                }
            };

            const handleEditEmployee = (employeeId) => {
                setEditingEmployeeId(employeeId);
            };

            const handleSaveEmployee = async (employeeId, updatedData) => {
                try {
                    await db.collection('employees').doc(employeeId).update({
                        name: updatedData.name,
                        email: updatedData.email,
                        phone: updatedData.phone,
                        joinDate: updatedData.joinDate,
                        slackUserId: updatedData.slackUserId || ''
                    });
                    alert('ÏÇ¨Ïõê Ï†ïÎ≥¥Í∞Ä ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§.');
                    setEditingEmployeeId(null);
                    loadEmployees();
                } catch (error) {
                    alert('ÏàòÏ†ï Ïã§Ìå®: ' + error.message);
                }
            };

            const handleCancelEdit = () => {
                setEditingEmployeeId(null);
            };

            const handleResetPassword = async (employeeId, employeeEmail) => {
                if (!confirm('ÏÑ†ÌÉùÌïú ÏÇ¨ÏõêÏùò ÎπÑÎ∞ÄÎ≤àÌò∏Î•º Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?\nÏ¥àÍ∏∞Ìôî ÎπÑÎ∞ÄÎ≤àÌò∏: 1q2w3e4r%T')) return;

                try {
                    // ÌòÑÏû¨ Î°úÍ∑∏Ïù∏Îêú Í¥ÄÎ¶¨Ïûê Ï†ïÎ≥¥ Ï†ÄÏû•
                    const currentUser = auth.currentUser;
                    const currentEmail = currentUser.email;
                    const currentPassword = prompt('Í¥ÄÎ¶¨Ïûê ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî (Í≥ÑÏ†ï Ïú†ÏßÄÎ•º ÏúÑÌï¥ ÌïÑÏöîÌï©ÎãàÎã§):');
                    
                    if (!currentPassword) {
                        alert('ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÌïÑÏöîÌï©ÎãàÎã§.');
                        return;
                    }

                    // Ìï¥Îãπ ÏÇ¨ÏõêÏúºÎ°ú Î°úÍ∑∏Ïù∏
                    const tempPassword = prompt('Ìï¥Îãπ ÏÇ¨ÏõêÏùò ÌòÑÏû¨ ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî:');
                    if (!tempPassword) {
                        alert('ÌòÑÏû¨ ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÌïÑÏöîÌï©ÎãàÎã§.');
                        return;
                    }

                    await auth.signInWithEmailAndPassword(employeeEmail, tempPassword);
                    
                    // ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω
                    const user = auth.currentUser;
                    await user.updatePassword('1q2w3e4r%T');
                    
                    // Í¥ÄÎ¶¨Ïûê Í≥ÑÏ†ïÏúºÎ°ú Îã§Ïãú Î°úÍ∑∏Ïù∏
                    await auth.signInWithEmailAndPassword(currentEmail, currentPassword);

                    alert('ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§.\nÏÉà ÎπÑÎ∞ÄÎ≤àÌò∏: 1q2w3e4r%T');
                } catch (error) {
                    // Ïò§Î•ò Î∞úÏÉù Ïãú Í¥ÄÎ¶¨ÏûêÎ°ú Ïû¨Î°úÍ∑∏Ïù∏ ÏãúÎèÑ
                    try {
                        const currentEmail = auth.currentUser?.email;
                        if (!currentEmail) {
                            const adminEmail = prompt('Í¥ÄÎ¶¨Ïûê Ïù¥Î©îÏùºÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:');
                            const adminPassword = prompt('Í¥ÄÎ¶¨Ïûê ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî:');
                            await auth.signInWithEmailAndPassword(adminEmail, adminPassword);
                        }
                    } catch (reLoginError) {
                        console.error('Ïû¨Î°úÍ∑∏Ïù∏ Ïã§Ìå®:', reLoginError);
                    }
                    alert('ÎπÑÎ∞ÄÎ≤àÌò∏ Ï¥àÍ∏∞Ìôî Ïã§Ìå®: ' + error.message);
                }
            };

            const handleAssignApprovalLine = async (employeeId, approvalLineId) => {
                try {
                    // Í≤∞Ïû¨ÏÑ† Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞
                    let approverId = null;
                    if (approvalLineId) {
                        const lineDoc = await db.collection('approvalLines').doc(approvalLineId).get();
                        if (lineDoc.exists) {
                            approverId = lineDoc.data().approverId;
                        }
                    }

                    await db.collection('employees').doc(employeeId).update({
                        approvalLine: approvalLineId || null,
                        approver: approverId
                    });
                    alert('Í≤∞Ïû¨ÏÑ†Ïù¥ Ìï†ÎãπÎêòÏóàÏäµÎãàÎã§.');
                    loadEmployees();
                } catch (error) {
                    alert('Ìï†Îãπ Ïã§Ìå®: ' + error.message);
                }
            };

            const approvers = employees.filter(emp => emp.isApprover);

            return (
                <div className="content-card">
                    <div className="admin-section">
                        <h3>ÏÇ¨Ïõê Í¥ÄÎ¶¨</h3>
                        <button className="register-btn" onClick={() => setShowAddModal(true)}>
                            ÏÇ¨Ïõê Ï∂îÍ∞Ä
                        </button>

                        <div className="employee-list">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Ïù¥Î¶Ñ</th>
                                        <th>Ïù¥Î©îÏùº</th>
                                        <th>Ïó∞ÎùΩÏ≤ò</th>
                                        <th>ÏûÖÏÇ¨Ïùº</th>
                                        <th>Slack ID</th>
                                        <th>ÏäπÏù∏Ïûê Í∂åÌïú</th>
                                        <th>PT Ìé∏Ïßë Í∂åÌïú</th>
                                        <th>Í≤∞Ïû¨ÏÑ† ÏÑ†ÌÉù</th>
                                        <th>Í¥ÄÎ¶¨</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {employees.map(emp => (
                                        <tr key={emp.id}>
                                            <td>
                                                {editingEmployeeId === emp.id ? (
                                                    <input
                                                        type="text"
                                                        defaultValue={emp.name}
                                                        id={`name-${emp.id}`}
                                                        style={{width: '100%', padding: '4px'}}
                                                    />
                                                ) : emp.name}
                                            </td>
                                            <td>
                                                {editingEmployeeId === emp.id ? (
                                                    <input
                                                        type="email"
                                                        defaultValue={emp.email}
                                                        id={`email-${emp.id}`}
                                                        style={{width: '100%', padding: '4px'}}
                                                    />
                                                ) : emp.email}
                                            </td>
                                            <td>
                                                {editingEmployeeId === emp.id ? (
                                                    <input
                                                        type="text"
                                                        defaultValue={emp.phone}
                                                        id={`phone-${emp.id}`}
                                                        style={{width: '100%', padding: '4px'}}
                                                        maxLength="13"
                                                        onInput={(e) => {
                                                            e.target.value = formatPhoneNumber(e.target.value);
                                                        }}
                                                    />
                                                ) : (emp.phone || '-')}
                                            </td>
                                            <td>
                                                {editingEmployeeId === emp.id ? (
                                                    <input
                                                        type="date"
                                                        defaultValue={emp.joinDate}
                                                        id={`joinDate-${emp.id}`}
                                                        style={{width: '100%', padding: '4px'}}
                                                    />
                                                ) : emp.joinDate}
                                            </td>
                                            <td>
                                                {editingEmployeeId === emp.id ? (
                                                    <input
                                                        type="text"
                                                        defaultValue={emp.slackUserId || ''}
                                                        id={`slackUserId-${emp.id}`}
                                                        placeholder="U01234ABCDE"
                                                        style={{width: '100%', padding: '4px', fontSize: '12px'}}
                                                    />
                                                ) : (emp.slackUserId || '-')}
                                            </td>
                                            <td>
                                                <label style={{
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    justifyContent: 'center',
                                                    cursor: 'pointer'
                                                }}>
                                                    <input
                                                        type="checkbox"
                                                        checked={emp.isApprover || false}
                                                        onChange={() => handleToggleApprover(emp.id, emp.isApprover)}
                                                        style={{
                                                            cursor: 'pointer',
                                                            width: '18px',
                                                            height: '18px'
                                                        }}
                                                    />
                                                </label>
                                            </td>
                                            <td>
                                                <label style={{
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    justifyContent: 'center',
                                                    cursor: 'pointer'
                                                }}>
                                                    <input
                                                        type="checkbox"
                                                        checked={emp.isPTScheduleEditor || false}
                                                        onChange={() => handleTogglePTScheduleEditor(emp.id, emp.isPTScheduleEditor)}
                                                        style={{
                                                            cursor: 'pointer',
                                                            width: '18px',
                                                            height: '18px'
                                                        }}
                                                    />
                                                </label>
                                            </td>
                                            <td>
                                                {!emp.isApprover ? (
                                                    <select
                                                        value={emp.approvalLine || ''}
                                                        onChange={(e) => handleAssignApprovalLine(emp.id, e.target.value)}
                                                        style={{
                                                            width: '100%',
                                                            padding: '6px',
                                                            border: '1px solid #ddd',
                                                            borderRadius: '4px',
                                                            fontSize: '13px'
                                                        }}
                                                    >
                                                        <option value="">ÏÑ†ÌÉù ÏïàÌï®</option>
                                                        {approvalLines.map(line => (
                                                            <option key={line.id} value={line.id}>
                                                                {line.name}
                                                            </option>
                                                        ))}
                                                    </select>
                                                ) : (
                                                    <span style={{color: '#999', fontSize: '13px'}}>-</span>
                                                )}
                                            </td>
                                            <td>
                                                {editingEmployeeId === emp.id ? (
                                                    <div style={{display: 'flex', gap: '5px'}}>
                                                        <button
                                                            onClick={() => {
                                                                const name = document.getElementById(`name-${emp.id}`).value;
                                                                const email = document.getElementById(`email-${emp.id}`).value;
                                                                const phone = document.getElementById(`phone-${emp.id}`).value;
                                                                const joinDate = document.getElementById(`joinDate-${emp.id}`).value;
                                                                const slackUserId = document.getElementById(`slackUserId-${emp.id}`).value;
                                                                handleSaveEmployee(emp.id, {name, email, phone, joinDate, slackUserId});
                                                            }}
                                                            style={{
                                                                padding: '6px 12px',
                                                                background: '#4CAF50',
                                                                color: 'white',
                                                                border: 'none',
                                                                borderRadius: '4px',
                                                                cursor: 'pointer',
                                                                fontSize: '12px'
                                                            }}
                                                        >
                                                            Ï†ÄÏû•
                                                        </button>
                                                        <button
                                                            onClick={handleCancelEdit}
                                                            style={{
                                                                padding: '6px 12px',
                                                                background: '#999',
                                                                color: 'white',
                                                                border: 'none',
                                                                borderRadius: '4px',
                                                                cursor: 'pointer',
                                                                fontSize: '12px'
                                                            }}
                                                        >
                                                            Ï∑®ÏÜå
                                                        </button>
                                                    </div>
                                                ) : (
                                                    <div style={{display: 'flex', gap: '5px', flexWrap: 'wrap'}}>
                                                        <button
                                                            onClick={() => handleEditEmployee(emp.id)}
                                                            style={{
                                                                padding: '6px 12px',
                                                                background: '#2196F3',
                                                                color: 'white',
                                                                border: 'none',
                                                                borderRadius: '4px',
                                                                cursor: 'pointer',
                                                                fontSize: '12px'
                                                            }}
                                                        >
                                                            ÏàòÏ†ï
                                                        </button>
                                                        <button
                                                            onClick={() => handleResetPassword(emp.id, emp.email)}
                                                            style={{
                                                                padding: '6px 12px',
                                                                background: '#FF9800',
                                                                color: 'white',
                                                                border: 'none',
                                                                borderRadius: '4px',
                                                                cursor: 'pointer',
                                                                fontSize: '12px'
                                                            }}
                                                        >
                                                            PWÏ¥àÍ∏∞Ìôî
                                                        </button>
                                                        <button
                                                            className="delete-btn"
                                                            onClick={() => handleDeleteEmployee(emp.id)}
                                                        >
                                                            ÏÇ≠Ï†ú
                                                        </button>
                                                    </div>
                                                )}
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    {showAddModal && (
                        <div className="modal" onClick={() => setShowAddModal(false)}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                                <h3>ÏÇ¨Ïõê Ï∂îÍ∞Ä</h3>
                                <div className="form-group">
                                    <label>Ïù¥Î¶Ñ</label>
                                    <input
                                        type="text"
                                        value={newEmployee.name}
                                        onChange={(e) => setNewEmployee({...newEmployee, name: e.target.value})}
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Ïù¥Î©îÏùº</label>
                                    <input
                                        type="email"
                                        value={newEmployee.email}
                                        onChange={(e) => setNewEmployee({...newEmployee, email: e.target.value})}
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Ïó∞ÎùΩÏ≤ò (ÏÑ†ÌÉù)</label>
                                    <input
                                        type="text"
                                        value={newEmployee.phone}
                                        onChange={(e) => setNewEmployee({...newEmployee, phone: formatPhoneNumber(e.target.value)})}
                                        placeholder="010-1234-5678"
                                        maxLength="13"
                                    />
                                </div>
                                <div className="form-group">
                                    <label>ÎπÑÎ∞ÄÎ≤àÌò∏</label>
                                    <input
                                        type="password"
                                        value={newEmployee.password}
                                        onChange={(e) => setNewEmployee({...newEmployee, password: e.target.value})}
                                    />
                                </div>
                                <div className="form-group">
                                    <label>ÏûÖÏÇ¨Ïùº</label>
                                    <input
                                        type="date"
                                        value={newEmployee.joinDate}
                                        onChange={(e) => setNewEmployee({...newEmployee, joinDate: e.target.value})}
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Slack ÏÇ¨Ïö©Ïûê ID (ÏÑ†ÌÉù)</label>
                                    <input
                                        type="text"
                                        value={newEmployee.slackUserId}
                                        onChange={(e) => setNewEmployee({...newEmployee, slackUserId: e.target.value})}
                                        placeholder="Ïòà: U01234ABCDE"
                                    />
                                    <small style={{fontSize: '12px', color: '#666', display: 'block', marginTop: '5px'}}>
                                        SlackÏóêÏÑú ÏÇ¨Ïö©Ïûê ÌîÑÎ°úÌïÑ ‚Üí ‚ãØ ‚Üí "Copy member ID"
                                    </small>
                                </div>
                                <div className="modal-buttons">
                                    <button className="btn-secondary" onClick={() => setShowAddModal(false)}>
                                        Ï∑®ÏÜå
                                    </button>
                                    <button className="btn-primary" onClick={handleAddEmployee}>
                                        Ï∂îÍ∞Ä
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Í≤∞Ïû¨ÏÑ† Í¥ÄÎ¶¨ Ïª¥Ìè¨ÎÑåÌä∏
        function ApprovalLineManagement() {
            const [approvalLines, setApprovalLines] = useState([]);
            const [employees, setEmployees] = useState([]);
            const [showAddModal, setShowAddModal] = useState(false);
            const [editingLineId, setEditingLineId] = useState(null);
            const [newLine, setNewLine] = useState({
                name: '',
                approverId: '',
                memberIds: []
            });

            useEffect(() => {
                loadApprovalLines();
                loadEmployees();
            }, []);

            const loadEmployees = async () => {
                const snapshot = await db.collection('employees').get();
                const employeeList = [];
                snapshot.forEach(doc => {
                    employeeList.push({ id: doc.id, ...doc.data() });
                });
                setEmployees(employeeList);
            };

            const loadApprovalLines = async () => {
                const snapshot = await db.collection('approvalLines').get();
                const lines = [];
                snapshot.forEach(doc => {
                    lines.push({ id: doc.id, ...doc.data() });
                });
                setApprovalLines(lines);
            };

            const handleAddApprovalLine = async () => {
                if (!newLine.name || !newLine.approverId) {
                    alert('Í≤∞Ïû¨ÏÑ† Ïù¥Î¶ÑÍ≥º ÏäπÏù∏ÏûêÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                try {
                    await db.collection('approvalLines').add({
                        name: newLine.name,
                        approverId: newLine.approverId,
                        memberIds: newLine.memberIds,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    alert('Í≤∞Ïû¨ÏÑ†Ïù¥ Îì±Î°ùÎêòÏóàÏäµÎãàÎã§.');
                    setShowAddModal(false);
                    setNewLine({ name: '', approverId: '', memberIds: [] });
                    loadApprovalLines();
                } catch (error) {
                    alert('Í≤∞Ïû¨ÏÑ† Îì±Î°ù Ïã§Ìå®: ' + error.message);
                }
            };

            const handleDeleteApprovalLine = async (lineId) => {
                if (!confirm('Ïù¥ Í≤∞Ïû¨ÏÑ†ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;

                try {
                    await db.collection('approvalLines').doc(lineId).delete();
                    alert('Í≤∞Ïû¨ÏÑ†Ïù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
                    loadApprovalLines();
                } catch (error) {
                    alert('ÏÇ≠Ï†ú Ïã§Ìå®: ' + error.message);
                }
            };

            const handleEditApprovalLine = (line) => {
                setEditingLineId(line.id);
                setNewLine({
                    name: line.name,
                    approverId: line.approverId,
                    memberIds: line.memberIds || []
                });
                setShowAddModal(true);
            };

            const handleUpdateApprovalLine = async () => {
                if (!newLine.name || !newLine.approverId) {
                    alert('Í≤∞Ïû¨ÏÑ† Ïù¥Î¶ÑÍ≥º ÏäπÏù∏ÏûêÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                try {
                    await db.collection('approvalLines').doc(editingLineId).update({
                        name: newLine.name,
                        approverId: newLine.approverId,
                        memberIds: newLine.memberIds,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    alert('Í≤∞Ïû¨ÏÑ†Ïù¥ ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§.');
                    setShowAddModal(false);
                    setEditingLineId(null);
                    setNewLine({ name: '', approverId: '', memberIds: [] });
                    loadApprovalLines();
                } catch (error) {
                    alert('ÏàòÏ†ï Ïã§Ìå®: ' + error.message);
                }
            };

            const handleMemberToggle = (memberId) => {
                setNewLine(prev => {
                    const memberIds = [...prev.memberIds];
                    const index = memberIds.indexOf(memberId);
                    if (index > -1) {
                        memberIds.splice(index, 1);
                    } else {
                        memberIds.push(memberId);
                    }
                    return { ...prev, memberIds };
                });
            };

            const approvers = employees.filter(emp => emp.isApprover);
            const nonApprovers = employees.filter(emp => !emp.isApprover);

            const getEmployeeName = (employeeId) => {
                const employee = employees.find(emp => emp.id === employeeId);
                return employee ? employee.name : 'Ïïå Ïàò ÏóÜÏùå';
            };

            const getMembers = (memberIds) => {
                if (!memberIds || memberIds.length === 0) return '-';
                return memberIds.map(id => getEmployeeName(id)).join(', ');
            };

            return (
                <div className="content-card">
                    <div className="admin-section">
                        <h3>Í≤∞Ïû¨ÏÑ† Í¥ÄÎ¶¨</h3>
                        <button className="register-btn" onClick={() => {
                            setEditingLineId(null);
                            setNewLine({ name: '', approverId: '', memberIds: [] });
                            setShowAddModal(true);
                        }}>
                            Í≤∞Ïû¨ÏÑ† Îì±Î°ù
                        </button>

                        <div className="employee-list">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Í≤∞Ïû¨ÏÑ† Ïù¥Î¶Ñ</th>
                                        <th>ÏäπÏù∏Ïûê</th>
                                        <th>Ìè¨Ìï® Ïù∏Ïõê</th>
                                        <th>Í¥ÄÎ¶¨</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {approvalLines.map(line => (
                                        <tr key={line.id}>
                                            <td>{line.name}</td>
                                            <td>{getEmployeeName(line.approverId)}</td>
                                            <td style={{fontSize: '13px'}}>{getMembers(line.memberIds)}</td>
                                            <td>
                                                <div style={{display: 'flex', gap: '5px'}}>
                                                    <button
                                                        onClick={() => handleEditApprovalLine(line)}
                                                        style={{
                                                            padding: '6px 12px',
                                                            background: '#2196F3',
                                                            color: 'white',
                                                            border: 'none',
                                                            borderRadius: '4px',
                                                            cursor: 'pointer',
                                                            fontSize: '12px'
                                                        }}
                                                    >
                                                        ÏàòÏ†ï
                                                    </button>
                                                    <button
                                                        className="delete-btn"
                                                        onClick={() => handleDeleteApprovalLine(line.id)}
                                                    >
                                                        ÏÇ≠Ï†ú
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    ))}
                                    {approvalLines.length === 0 && (
                                        <tr>
                                            <td colSpan="4" style={{textAlign: 'center', color: '#999', padding: '30px'}}>
                                                Îì±Î°ùÎêú Í≤∞Ïû¨ÏÑ†Ïù¥ ÏóÜÏäµÎãàÎã§.
                                            </td>
                                        </tr>
                                    )}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    {showAddModal && (
                        <div className="modal" onClick={() => setShowAddModal(false)}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()} style={{maxWidth: '500px'}}>
                                <h3>{editingLineId ? 'Í≤∞Ïû¨ÏÑ† ÏàòÏ†ï' : 'Í≤∞Ïû¨ÏÑ† Îì±Î°ù'}</h3>
                                <div className="form-group">
                                    <label>Í≤∞Ïû¨ÏÑ† Ïù¥Î¶Ñ</label>
                                    <input
                                        type="text"
                                        value={newLine.name}
                                        onChange={(e) => setNewLine({...newLine, name: e.target.value})}
                                        placeholder="Ïòà: Í∞úÎ∞úÌåÄ Í≤∞Ïû¨ÏÑ†"
                                    />
                                </div>
                                <div className="form-group">
                                    <label>ÏäπÏù∏Ïûê ÏÑ†ÌÉù</label>
                                    <select
                                        value={newLine.approverId}
                                        onChange={(e) => setNewLine({...newLine, approverId: e.target.value})}
                                        style={{
                                            width: '100%',
                                            padding: '12px',
                                            border: '1px solid #ddd',
                                            borderRadius: '6px',
                                            fontSize: '14px'
                                        }}
                                    >
                                        <option value="">ÏäπÏù∏Ïûê ÏÑ†ÌÉù</option>
                                        {approvers.map(approver => (
                                            <option key={approver.id} value={approver.id}>
                                                {approver.name}
                                            </option>
                                        ))}
                                    </select>
                                </div>
                                <div className="form-group">
                                    <label>Ìè¨Ìï® Ïù∏Ïõê ÏÑ†ÌÉù (Îã§Ï§ë ÏÑ†ÌÉù Í∞ÄÎä•)</label>
                                    <div style={{
                                        border: '1px solid #ddd',
                                        borderRadius: '6px',
                                        padding: '10px',
                                        maxHeight: '200px',
                                        overflowY: 'auto'
                                    }}>
                                        {nonApprovers.length === 0 ? (
                                            <div style={{color: '#999', padding: '10px', textAlign: 'center'}}>
                                                ÏÑ†ÌÉù Í∞ÄÎä•Ìïú ÏÇ¨ÏõêÏù¥ ÏóÜÏäµÎãàÎã§.
                                            </div>
                                        ) : (
                                            nonApprovers.map(emp => (
                                                <label key={emp.id} style={{
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    padding: '8px',
                                                    cursor: 'pointer',
                                                    borderRadius: '4px',
                                                    transition: 'background 0.2s'
                                                }}
                                                onMouseEnter={(e) => e.target.style.background = '#f5f5f5'}
                                                onMouseLeave={(e) => e.target.style.background = 'transparent'}
                                                >
                                                    <input
                                                        type="checkbox"
                                                        checked={newLine.memberIds.includes(emp.id)}
                                                        onChange={() => handleMemberToggle(emp.id)}
                                                        style={{
                                                            marginRight: '10px',
                                                            cursor: 'pointer',
                                                            width: '16px',
                                                            height: '16px'
                                                        }}
                                                    />
                                                    {emp.name} ({emp.email})
                                                </label>
                                            ))
                                        )}
                                    </div>
                                </div>
                                <div className="modal-buttons">
                                    <button className="btn-secondary" onClick={() => {
                                        setShowAddModal(false);
                                        setEditingLineId(null);
                                        setNewLine({ name: '', approverId: '', memberIds: [] });
                                    }}>
                                        Ï∑®ÏÜå
                                    </button>
                                    <button className="btn-primary" onClick={editingLineId ? handleUpdateApprovalLine : handleAddApprovalLine}>
                                        {editingLineId ? 'ÏàòÏ†ï' : 'Îì±Î°ù'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Ïó∞Ï∞® ÏäπÏù∏ Í¥ÄÎ¶¨ Ïª¥Ìè¨ÎÑåÌä∏
        function ApprovalManagement({ user, setPendingCount }) {
            const [pendingRequests, setPendingRequests] = useState([]);
            const [myEmployees, setMyEmployees] = useState([]);

            useEffect(() => {
                loadMyEmployees();
            }, []);

            const loadMyEmployees = async () => {
                try {
                    const snapshot = await db.collection('employees')
                        .where('approver', '==', user.uid)
                        .get();

                    const employees = [];
                    snapshot.forEach(doc => {
                        employees.push({ id: doc.id, ...doc.data() });
                    });
                    
                    setMyEmployees(employees);
                    
                    if (employees.length > 0) {
                        loadPendingRequests(employees.map(emp => emp.id));
                    }
                } catch (error) {
                    console.error('Îã¥Îãπ ÏÇ¨Ïõê Î™©Î°ù Î°úÎìú Ïã§Ìå®:', error);
                }
            };

            const loadPendingRequests = async (employeeIds) => {
                try {
                    // pendingÍ≥º deletion-pending Î™®Îëê Ï°∞Ìöå
                    const pendingSnapshot = await db.collection('leaveUsage')
                        .where('approvalStatus', '==', 'pending')
                        .get();
                    
                    const deletionSnapshot = await db.collection('leaveUsage')
                        .where('approvalStatus', '==', 'deletion-pending')
                        .get();

                    const requests = [];
                    
                    // pending Ï≤òÎ¶¨
                    for (const doc of pendingSnapshot.docs) {
                        const data = doc.data();
                        if (employeeIds.includes(data.userId)) {
                            const userDoc = await db.collection('employees').doc(data.userId).get();
                            requests.push({
                                id: doc.id,
                                ...data,
                                userName: userDoc.exists ? userDoc.data().name : data.userId,
                                requestType: 'approval'
                            });
                        }
                    }
                    
                    // deletion-pending Ï≤òÎ¶¨
                    for (const doc of deletionSnapshot.docs) {
                        const data = doc.data();
                        if (employeeIds.includes(data.userId)) {
                            const userDoc = await db.collection('employees').doc(data.userId).get();
                            requests.push({
                                id: doc.id,
                                ...data,
                                userName: userDoc.exists ? userDoc.data().name : data.userId,
                                requestType: 'deletion'
                            });
                        }
                    }
                    
                    requests.sort((a, b) => b.date.localeCompare(a.date));
                    setPendingRequests(requests);
                    if (setPendingCount) {
                        setPendingCount(requests.length);
                    }
                } catch (error) {
                    console.error('ÏäπÏù∏ ÎåÄÍ∏∞ Î™©Î°ù Î°úÎìú Ïã§Ìå®:', error);
                }
            };

            const handleApproval = async (requestId, userId, date, status) => {
                try {
                    await db.collection('leaveUsage').doc(requestId).update({
                        approvalStatus: status,
                        approvedBy: user.uid,
                        approvedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    const scheduleSnapshot = await db.collection('schedules')
                        .where('userId', '==', userId)
                        .where('date', '==', date)
                        .get();

                    scheduleSnapshot.forEach(async (doc) => {
                        await doc.ref.update({
                            approvalStatus: status,
                            approvedBy: user.uid,
                            approvedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    });

                    alert(status === 'approved' ? 'ÏäπÏù∏ÎêòÏóàÏäµÎãàÎã§.' : 'Î∞òÎ†§ÎêòÏóàÏäµÎãàÎã§.');
                    loadMyEmployees();
                } catch (error) {
                    alert('Ï≤òÎ¶¨ Ïã§Ìå®: ' + error.message);
                }
            };

            const handleDeletionApproval = async (requestId, userId, date) => {
                try {
                    // Ï∑®ÏÜå ÏäπÏù∏ - cancelled ÏÉÅÌÉúÎ°ú Î≥ÄÍ≤Ω
                    await db.collection('leaveUsage').doc(requestId).update({
                        approvalStatus: 'cancelled',
                        cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    const scheduleSnapshot = await db.collection('schedules')
                        .where('userId', '==', userId)
                        .where('date', '==', date)
                        .get();

                    scheduleSnapshot.forEach(async (doc) => {
                        await doc.ref.update({
                            approvalStatus: 'cancelled',
                            cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    });

                    alert('Ï∑®ÏÜåÍ∞Ä ÏäπÏù∏ÎêòÏóàÏäµÎãàÎã§.');
                    loadMyEmployees();
                    loadPendingRequests();
                } catch (error) {
                    alert('Ï≤òÎ¶¨ Ïã§Ìå®: ' + error.message);
                }
            };

            const handleDeletionRejection = async (requestId, userId, date) => {
                try {
                    // Ï∑®ÏÜå Î∞òÎ†§ - ÏõêÎûò ÏäπÏù∏ÏôÑÎ£å ÏÉÅÌÉúÎ°ú Î≥µÍµ¨
                    await db.collection('leaveUsage').doc(requestId).update({
                        approvalStatus: 'approved'
                    });

                    const scheduleSnapshot = await db.collection('schedules')
                        .where('userId', '==', userId)
                        .where('date', '==', date)
                        .get();

                    scheduleSnapshot.forEach(async (doc) => {
                        await doc.ref.update({
                            approvalStatus: 'approved'
                        });
                    });

                    alert('Ï∑®ÏÜåÍ∞Ä Î∞òÎ†§ÎêòÏóàÏäµÎãàÎã§.');
                    loadMyEmployees();
                    loadPendingRequests();
                } catch (error) {
                    alert('Ï≤òÎ¶¨ Ïã§Ìå®: ' + error.message);
                }
            };

            return (
                <div className="content-card">
                    <h2 style={{marginBottom: '20px'}}>Ïó∞Ï∞® ÏäπÏù∏ Í¥ÄÎ¶¨</h2>
                    
                    <div style={{
                        background: '#f5f5f5',
                        padding: '15px',
                        borderRadius: '8px',
                        marginBottom: '20px'
                    }}>
                        <h3 style={{fontSize: '16px', marginBottom: '10px'}}>Îã¥Îãπ ÏÇ¨Ïõê Î™©Î°ù</h3>
                        {myEmployees.length > 0 ? (
                            <div style={{display: 'flex', gap: '10px', flexWrap: 'wrap'}}>
                                {myEmployees.map(emp => (
                                    <span key={emp.id} style={{
                                        background: 'white',
                                        padding: '6px 12px',
                                        borderRadius: '4px',
                                        fontSize: '14px',
                                        border: '1px solid #ddd'
                                    }}>
                                        {emp.name}
                                    </span>
                                ))}
                            </div>
                        ) : (
                            <p style={{color: '#666', fontSize: '14px'}}>Îã¥Îãπ ÏÇ¨ÏõêÏù¥ ÏóÜÏäµÎãàÎã§. Í¥ÄÎ¶¨ÏûêÏóêÍ≤å Î¨∏ÏùòÌïòÏÑ∏Ïöî.</p>
                        )}
                    </div>
                    
                    <h3 style={{fontSize: '16px', marginBottom: '15px'}}>ÏäπÏù∏ ÎåÄÍ∏∞ Î™©Î°ù</h3>
                    {pendingRequests.length > 0 ? (
                        <div style={{display: 'grid', gap: '15px'}}>
                            {pendingRequests.map(request => (
                                <div key={request.id} style={{
                                    background: 'white',
                                    border: '1px solid #e0e0e0',
                                    borderRadius: '12px',
                                    padding: '20px',
                                    boxShadow: '0 2px 4px rgba(0,0,0,0.05)',
                                    transition: 'all 0.2s',
                                    ':hover': {
                                        boxShadow: '0 4px 8px rgba(0,0,0,0.1)'
                                    }
                                }}>
                                    <div style={{
                                        display: 'grid',
                                        gridTemplateColumns: '1fr 1fr 1fr auto',
                                        gap: '20px',
                                        alignItems: 'center'
                                    }}>
                                        {/* ÏÇ¨Ïõê Ï†ïÎ≥¥ */}
                                        <div>
                                            <div style={{
                                                fontSize: '12px',
                                                color: '#999',
                                                marginBottom: '4px'
                                            }}>ÏÇ¨ÏõêÎ™Ö</div>
                                            <div style={{
                                                fontSize: '18px',
                                                fontWeight: '600',
                                                color: '#333'
                                            }}>{request.userName}</div>
                                        </div>

                                        {/* Ïó∞Ï∞® Ï†ïÎ≥¥ */}
                                        <div>
                                            <div style={{
                                                fontSize: '12px',
                                                color: '#999',
                                                marginBottom: '4px'
                                            }}>
                                                {request.requestType === 'deletion' ? 'üóëÔ∏è ÏÇ≠Ï†ú ÏöîÏ≤≠' : 'Ïó∞Ï∞® ÎÇ¥Ïö©'}
                                            </div>
                                            <div style={{
                                                fontSize: '16px',
                                                fontWeight: '500',
                                                color: '#333'
                                            }}>
                                                {request.requestType === 'deletion' && (
                                                    <span style={{
                                                        background: '#ff4444',
                                                        color: 'white',
                                                        padding: '2px 8px',
                                                        borderRadius: '4px',
                                                        fontSize: '12px',
                                                        marginRight: '8px'
                                                    }}>Ï∑®ÏÜå ÏöîÏ≤≠</span>
                                                )}
                                                {request.type}
                                                <span style={{
                                                    marginLeft: '8px',
                                                    color: '#666',
                                                    fontSize: '14px'
                                                }}>
                                                    ({request.amount > 0 ? `${request.amount}Ïùº` : 'Î¨¥Í∏â'})
                                                </span>
                                            </div>
                                            <div style={{
                                                fontSize: '14px',
                                                color: '#666',
                                                marginTop: '4px'
                                            }}>
                                                üìÖ {request.date}
                                            </div>
                                        </div>

                                        {/* Ïã†Ï≤≠Ïùº */}
                                        <div>
                                            <div style={{
                                                fontSize: '12px',
                                                color: '#999',
                                                marginBottom: '4px'
                                            }}>Ïã†Ï≤≠Ïùº</div>
                                            <div style={{
                                                fontSize: '14px',
                                                color: '#666'
                                            }}>
                                                {request.createdAt ? new Date(request.createdAt.toDate()).toLocaleDateString('ko-KR', {
                                                    year: 'numeric',
                                                    month: 'long',
                                                    day: 'numeric'
                                                }) : '-'}
                                            </div>
                                        </div>

                                        {/* ÏäπÏù∏/Î∞òÎ†§ Î≤ÑÌäº */}
                                        <div style={{display: 'flex', gap: '8px'}}>
                                            {request.requestType === 'deletion' ? (
                                                <>
                                                    <button
                                                        onClick={() => handleDeletionApproval(request.id, request.userId, request.date)}
                                                        style={{
                                                            padding: '10px 20px',
                                                            background: '#4CAF50',
                                                            color: 'white',
                                                            border: 'none',
                                                            borderRadius: '8px',
                                                            cursor: 'pointer',
                                                            fontSize: '14px',
                                                            fontWeight: '600',
                                                            transition: 'all 0.2s',
                                                            minWidth: '100px'
                                                        }}
                                                        onMouseOver={(e) => e.target.style.background = '#45a049'}
                                                        onMouseOut={(e) => e.target.style.background = '#4CAF50'}
                                                    >
                                                        ‚úì ÏÇ≠Ï†ú ÏäπÏù∏
                                                    </button>
                                                    <button
                                                        onClick={() => handleDeletionRejection(request.id, request.userId, request.date)}
                                                        style={{
                                                            padding: '10px 20px',
                                                            background: '#ff4444',
                                                            color: 'white',
                                                            border: 'none',
                                                            borderRadius: '8px',
                                                            cursor: 'pointer',
                                                            fontSize: '14px',
                                                            fontWeight: '600',
                                                            transition: 'all 0.2s',
                                                            minWidth: '100px'
                                                        }}
                                                        onMouseOver={(e) => e.target.style.background = '#cc0000'}
                                                        onMouseOut={(e) => e.target.style.background = '#ff4444'}
                                                    >
                                                        ‚úï ÏÇ≠Ï†ú Î∞òÎ†§
                                                    </button>
                                                </>
                                            ) : (
                                                <>
                                                    <button
                                                        onClick={() => handleApproval(request.id, request.userId, request.date, 'approved')}
                                                        style={{
                                                            padding: '10px 20px',
                                                            background: '#4CAF50',
                                                            color: 'white',
                                                            border: 'none',
                                                            borderRadius: '8px',
                                                            cursor: 'pointer',
                                                            fontSize: '14px',
                                                            fontWeight: '600',
                                                            transition: 'all 0.2s',
                                                            minWidth: '80px'
                                                        }}
                                                        onMouseOver={(e) => e.target.style.background = '#45a049'}
                                                        onMouseOut={(e) => e.target.style.background = '#4CAF50'}
                                                    >
                                                        ‚úì ÏäπÏù∏
                                                    </button>
                                                    <button
                                                        onClick={() => handleApproval(request.id, request.userId, request.date, 'rejected')}
                                                        style={{
                                                            padding: '10px 20px',
                                                            background: '#ff4444',
                                                            color: 'white',
                                                            border: 'none',
                                                            borderRadius: '8px',
                                                            cursor: 'pointer',
                                                            fontSize: '14px',
                                                            fontWeight: '600',
                                                            transition: 'all 0.2s',
                                                            minWidth: '80px'
                                                        }}
                                                        onMouseOver={(e) => e.target.style.background = '#cc0000'}
                                                        onMouseOut={(e) => e.target.style.background = '#ff4444'}
                                                    >
                                                        ‚úï Î∞òÎ†§
                                                    </button>
                                                </>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    ) : (
                        <div style={{
                            padding: '80px 20px',
                            textAlign: 'center',
                            background: 'white',
                            borderRadius: '12px',
                            border: '2px dashed #e0e0e0'
                        }}>
                            <div style={{
                                fontSize: '48px',
                                marginBottom: '16px'
                            }}>üìã</div>
                            <div style={{
                                color: '#999',
                                fontSize: '16px',
                                fontWeight: '500'
                            }}>
                                ÏäπÏù∏ ÎåÄÍ∏∞Ï§ëÏù∏ Ïó∞Ï∞® Ïã†Ï≤≠Ïù¥ ÏóÜÏäµÎãàÎã§.
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Í¥ÄÎ¶¨ÏûêÏö© ÏÇ¨Ïõê Ïó∞Ï∞® Í¥ÄÎ¶¨ Ïª¥Ìè¨ÎÑåÌä∏
        function AdminLeaveManagement() {
            const [employees, setEmployees] = useState([]);
            const [selectedEmployee, setSelectedEmployee] = useState(null);
            const [leaveUsage, setLeaveUsage] = useState([]);
            const [currentPage, setCurrentPage] = useState(1);
            const itemsPerPage = 10;
            const [editingTotalLeave, setEditingTotalLeave] = useState(false);
            const [tempTotalLeave, setTempTotalLeave] = useState(0);
            const [totalLeaveNote, setTotalLeaveNote] = useState('');
            const [editingUsedLeave, setEditingUsedLeave] = useState(false);
            const [tempUsedLeave, setTempUsedLeave] = useState(0);
            const [usedLeaveNote, setUsedLeaveNote] = useState('');

            useEffect(() => {
                loadEmployees();
            }, []);

            const loadEmployees = async () => {
                const snapshot = await db.collection('employees').get();
                const employeeList = [];
                snapshot.forEach(doc => {
                    employeeList.push({ id: doc.id, ...doc.data() });
                });
                setEmployees(employeeList);
            };

            const loadEmployeeLeaveUsage = async (employeeId) => {
                try {
                    const snapshot = await db.collection('leaveUsage')
                        .where('userId', '==', employeeId)
                        .get();

                    const allUsage = [];
                    snapshot.forEach(doc => {
                        allUsage.push({ id: doc.id, ...doc.data() });
                    });
                    
                    // groupIdÎ°ú Í∑∏Î£πÌïë
                    const groupedUsage = {};
                    const ungroupedUsage = [];
                    
                    allUsage.forEach(item => {
                        if (item.groupId) {
                            if (!groupedUsage[item.groupId]) {
                                groupedUsage[item.groupId] = {
                                    id: item.groupId,
                                    ids: [item.id],
                                    userId: item.userId,
                                    startDate: item.startDate || item.date,
                                    endDate: item.endDate || item.date,
                                    date: item.startDate || item.date,
                                    type: item.type,
                                    amount: item.amount,
                                    totalDays: item.totalDays || 1,
                                    note: item.note,
                                    approvalStatus: item.approvalStatus,
                                    createdAt: item.createdAt,
                                    groupId: item.groupId,
                                    isGrouped: true
                                };
                            } else {
                                groupedUsage[item.groupId].ids.push(item.id);
                            }
                        } else {
                            ungroupedUsage.push(item);
                        }
                    });
                    
                    const usage = [...Object.values(groupedUsage), ...ungroupedUsage];
                    usage.sort((a, b) => (b.startDate || b.date).localeCompare(a.startDate || a.date));
                    setLeaveUsage(usage);
                } catch (error) {
                    console.error('Ïó∞Ï∞® ÎÇ¥Ïó≠ Î°úÎìú Ïã§Ìå®:', error);
                }
            };

            const handleSelectEmployee = (employee) => {
                setSelectedEmployee(employee);
                loadEmployeeLeaveUsage(employee.id);
            };

            const calculateTotalLeave = (joinDate) => {
                if (!joinDate) return 0;
                const join = new Date(joinDate);
                const now = new Date();
                const years = now.getFullYear() - join.getFullYear();
                
                if (years < 1) {
                    const months = (now.getFullYear() - join.getFullYear()) * 12 + (now.getMonth() - join.getMonth());
                    return Math.floor(months);
                }
                
                return 15 + Math.min(years - 1, 10);
            };

            const calculateUsedLeave = () => {
                // customUsedLeaveÍ∞Ä ÏÑ§Ï†ïÎêòÏñ¥ ÏûàÏúºÎ©¥ Í∑∏ Í∞í ÏÇ¨Ïö©
                if (selectedEmployee?.customUsedLeave !== undefined && selectedEmployee?.customUsedLeave !== null) {
                    return selectedEmployee.customUsedLeave;
                }
                // ÏäπÏù∏Îêú Ïó∞Ï∞®Îßå Ïπ¥Ïö¥Ìä∏
                return leaveUsage
                    .filter(usage => usage.approvalStatus === 'approved')
                    .reduce((sum, usage) => sum + usage.amount, 0);
            };

            const handleDeleteUsedLeave = async (usageIdOrGroup, usageDate, usageType, groupId) => {
                // ÏàòÏ†ï Í±¥Ïù∏ÏßÄ ÌôïÏù∏ (Ï¥ùÏó∞Ï∞® ÏàòÏ†ï, ÏÇ¨Ïö©Ïó∞Ï∞® ÏàòÏ†ï)
                const isEditRecord = usageType === 'Ï¥ùÏó∞Ï∞® ÏàòÏ†ï' || usageType === 'ÏÇ¨Ïö©Ïó∞Ï∞® ÏàòÏ†ï';
                const isGrouped = !!groupId;
                const usageIds = isGrouped ? usageIdOrGroup.ids : [usageIdOrGroup];
                
                let confirmMsg;
                if (isEditRecord) {
                    confirmMsg = 'Ïù¥ ÏàòÏ†ï ÎÇ¥Ïó≠ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?';
                } else if (isGrouped) {
                    confirmMsg = `${usageIdOrGroup.startDate} ~ ${usageIdOrGroup.endDate} (${usageIdOrGroup.totalDays}Ïùº) Ïó∞Ï∞® ÎÇ¥Ïó≠ÏùÑ Î™®Îëê Ï∑®ÏÜåÌïòÏãúÍ≤†ÏäµÎãàÍπå?`;
                } else {
                    confirmMsg = 'Ïù¥ Ïó∞Ï∞® ÎÇ¥Ïó≠ÏùÑ Ï∑®ÏÜåÌïòÏãúÍ≤†ÏäµÎãàÍπå?';
                }
                
                if (!confirm(confirmMsg)) return;

                try {
                    if (isEditRecord) {
                        // ÏàòÏ†ï Í±¥ÏùÄ Î∞îÎ°ú ÏÇ≠Ï†ú
                        await db.collection('leaveUsage').doc(usageIdOrGroup).delete();
                        
                        // customUsedLeave ÎòêÎäî customTotalLeave Ï¥àÍ∏∞Ìôî
                        if (usageType === 'ÏÇ¨Ïö©Ïó∞Ï∞® ÏàòÏ†ï') {
                            await db.collection('employees').doc(selectedEmployee.id).update({
                                customUsedLeave: firebase.firestore.FieldValue.delete()
                            });
                            // selectedEmployee ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                            const updatedEmployee = { ...selectedEmployee };
                            delete updatedEmployee.customUsedLeave;
                            setSelectedEmployee(updatedEmployee);
                        } else if (usageType === 'Ï¥ùÏó∞Ï∞® ÏàòÏ†ï') {
                            await db.collection('employees').doc(selectedEmployee.id).update({
                                customTotalLeave: firebase.firestore.FieldValue.delete()
                            });
                            // selectedEmployee ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                            const updatedEmployee = { ...selectedEmployee };
                            delete updatedEmployee.customTotalLeave;
                            setSelectedEmployee(updatedEmployee);
                        }
                        
                        alert('ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
                        // ÏÇ¨Ïõê Î™©Î°ùÎèÑ ÏÉàÎ°úÍ≥†Ïπ®
                        loadEmployees();
                    } else {
                        // ÏùºÎ∞ò Ïó∞Ï∞®Îäî Ï∑®ÏÜå ÏÉÅÌÉúÎ°ú Î≥ÄÍ≤Ω
                        for (const id of usageIds) {
                            await db.collection('leaveUsage').doc(id).update({
                                approvalStatus: 'cancelled',
                                cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        }

                        // Ìï¥Îãπ ÎÇ†ÏßúÏùò Ïä§ÏºÄÏ§ÑÎèÑ Ï∑®ÏÜå ÏÉÅÌÉúÎ°ú Î≥ÄÍ≤Ω
                        if (groupId) {
                            const scheduleSnapshot = await db.collection('schedules')
                                .where('userId', '==', selectedEmployee.id)
                                .where('groupId', '==', groupId)
                                .get();

                            scheduleSnapshot.forEach(async (doc) => {
                                await doc.ref.update({
                                    approvalStatus: 'cancelled',
                                    cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                });
                            });
                        } else {
                            const scheduleSnapshot = await db.collection('schedules')
                                .where('userId', '==', selectedEmployee.id)
                                .where('date', '==', usageDate)
                                .where('type', '==', usageType)
                                .get();

                            scheduleSnapshot.forEach(async (doc) => {
                                await doc.ref.update({
                                    approvalStatus: 'cancelled',
                                    cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                                });
                            });
                        }

                        alert('Ï∑®ÏÜåÎêòÏóàÏäµÎãàÎã§.');
                    }
                    
                    loadEmployeeLeaveUsage(selectedEmployee.id);
                } catch (error) {
                    alert('Ï≤òÎ¶¨ Ïã§Ìå®: ' + error.message);
                }
            };

            const handleStartEditTotalLeave = () => {
                setTempTotalLeave(selectedEmployee.customTotalLeave || calculateTotalLeave(selectedEmployee.joinDate));
                setTotalLeaveNote('');
                setEditingTotalLeave(true);
            };

            const handleSaveTotalLeave = async () => {
                if (!selectedEmployee) return;

                try {
                    const oldValue = selectedEmployee.customTotalLeave || calculateTotalLeave(selectedEmployee.joinDate);
                    const newValue = parseFloat(tempTotalLeave);
                    
                    // employees Ïª¨Î†âÏÖò ÏóÖÎç∞Ïù¥Ìä∏
                    await db.collection('employees').doc(selectedEmployee.id).update({
                        customTotalLeave: newValue
                    });

                    // leaveUsageÏóê ÏàòÏ†ï Ïù¥Î†• Ï∂îÍ∞Ä
                    const today = new Date();
                    const dateStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
                    
                    await db.collection('leaveUsage').add({
                        userId: selectedEmployee.id,
                        date: dateStr,
                        type: 'Ï¥ùÏó∞Ï∞® ÏàòÏ†ï',
                        amount: newValue,
                        note: totalLeaveNote || `${oldValue}Ïùº ‚Üí ${newValue}Ïùº`,
                        approvalStatus: '-',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    alert('Ïó∞Ï∞® ÏàòÎüâÏù¥ ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§.');
                    setEditingTotalLeave(false);
                    setTotalLeaveNote('');
                    loadEmployees();
                    
                    // ÏÑ†ÌÉùÎêú ÏÇ¨Ïõê Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ Î∞è Ïó∞Ï∞® ÎÇ¥Ïó≠ ÏÉàÎ°úÍ≥†Ïπ®
                    const updatedEmployee = { ...selectedEmployee, customTotalLeave: newValue };
                    setSelectedEmployee(updatedEmployee);
                    loadEmployeeLeaveUsage(selectedEmployee.id);
                } catch (error) {
                    alert('ÏàòÏ†ï Ïã§Ìå®: ' + error.message);
                }
            };

            const handleCancelEditTotalLeave = () => {
                setEditingTotalLeave(false);
                setTotalLeaveNote('');
            };

            const handleStartEditUsedLeave = () => {
                setTempUsedLeave(calculateUsedLeave());
                setUsedLeaveNote('');
                setEditingUsedLeave(true);
            };

            const handleSaveUsedLeave = async () => {
                if (!selectedEmployee) return;

                try {
                    const oldValue = calculateUsedLeave();
                    const newValue = parseFloat(tempUsedLeave);
                    
                    // employees Ïª¨Î†âÏÖò ÏóÖÎç∞Ïù¥Ìä∏
                    await db.collection('employees').doc(selectedEmployee.id).update({
                        customUsedLeave: newValue
                    });

                    // leaveUsageÏóê ÏàòÏ†ï Ïù¥Î†• Ï∂îÍ∞Ä
                    const today = new Date();
                    const dateStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
                    
                    await db.collection('leaveUsage').add({
                        userId: selectedEmployee.id,
                        date: dateStr,
                        type: 'ÏÇ¨Ïö©Ïó∞Ï∞® ÏàòÏ†ï',
                        amount: newValue,
                        note: usedLeaveNote || `${oldValue}Ïùº ‚Üí ${newValue}Ïùº`,
                        approvalStatus: '-',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    alert('ÏÇ¨Ïö© Ïó∞Ï∞®Í∞Ä ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§.');
                    setEditingUsedLeave(false);
                    setUsedLeaveNote('');
                    loadEmployees();
                    
                    // ÏÑ†ÌÉùÎêú ÏÇ¨Ïõê Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ Î∞è Ïó∞Ï∞® ÎÇ¥Ïó≠ ÏÉàÎ°úÍ≥†Ïπ®
                    const updatedEmployee = { ...selectedEmployee, customUsedLeave: newValue };
                    setSelectedEmployee(updatedEmployee);
                    loadEmployeeLeaveUsage(selectedEmployee.id);
                } catch (error) {
                    alert('ÏàòÏ†ï Ïã§Ìå®: ' + error.message);
                }
            };

            const handleCancelEditUsedLeave = () => {
                setEditingUsedLeave(false);
                setUsedLeaveNote('');
            };

            return (
                <div className="content-card">
                    <h2 style={{marginBottom: '20px'}}>ÏÇ¨Ïõê Ïó∞Ï∞® Í¥ÄÎ¶¨</h2>
                    
                    <div style={{display: 'grid', gridTemplateColumns: '300px 1fr', gap: '30px'}}>
                        {/* ÏÇ¨Ïõê Î™©Î°ù */}
                        <div>
                            <h3 style={{marginBottom: '15px', fontSize: '16px'}}>ÏÇ¨Ïõê Î™©Î°ù</h3>
                            <div style={{
                                border: '1px solid #ddd',
                                borderRadius: '8px',
                                maxHeight: '600px',
                                overflowY: 'auto'
                            }}>
                                {employees.map(emp => (
                                    <div
                                        key={emp.id}
                                        onClick={() => handleSelectEmployee(emp)}
                                        style={{
                                            padding: '15px',
                                            borderBottom: '1px solid #eee',
                                            cursor: 'pointer',
                                            background: selectedEmployee?.id === emp.id ? '#e8f5e9' : 'white',
                                            transition: 'background 0.2s'
                                        }}
                                        onMouseEnter={(e) => {
                                            if (selectedEmployee?.id !== emp.id) {
                                                e.target.style.background = '#f5f5f5';
                                            }
                                        }}
                                        onMouseLeave={(e) => {
                                            if (selectedEmployee?.id !== emp.id) {
                                                e.target.style.background = 'white';
                                            }
                                        }}
                                    >
                                        <div style={{fontWeight: '600', marginBottom: '5px'}}>{emp.name}</div>
                                        <div style={{fontSize: '13px', color: '#666'}}>{emp.email}</div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* ÏÑ†ÌÉùÎêú ÏÇ¨ÏõêÏùò Ïó∞Ï∞® Ï†ïÎ≥¥ */}
                        <div>
                            {selectedEmployee ? (
                                <>
                                    <div style={{
                                        display: 'flex',
                                        justifyContent: 'space-between',
                                        alignItems: 'center',
                                        marginBottom: '20px'
                                    }}>
                                        <h3 style={{fontSize: '18px'}}>{selectedEmployee.name}ÎãòÏùò Ïó∞Ï∞® ÌòÑÌô©</h3>
                                    </div>

                                    <div className="annual-leave-info">
                                        <div className="info-card">
                                            <h4>ÏûÖÏÇ¨Ïùº</h4>
                                            <div className="value">{selectedEmployee.joinDate}</div>
                                        </div>
                                        <div className="info-card">
                                            <h4>Ï¥ù Ïó∞Ï∞®</h4>
                                            <div className="value" style={{display: 'flex', alignItems: 'center', gap: '10px', flexWrap: 'wrap'}}>
                                                {editingTotalLeave ? (
                                                    <div style={{width: '100%'}}>
                                                        <div style={{display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '10px'}}>
                                                            <input
                                                                type="number"
                                                                value={tempTotalLeave}
                                                                onChange={(e) => setTempTotalLeave(e.target.value)}
                                                                style={{
                                                                    width: '80px',
                                                                    padding: '5px',
                                                                    fontSize: '16px',
                                                                    border: '2px solid #4CAF50',
                                                                    borderRadius: '4px'
                                                                }}
                                                                autoFocus
                                                            />
                                                            <button
                                                                onClick={handleSaveTotalLeave}
                                                                style={{
                                                                    padding: '5px 10px',
                                                                    background: '#4CAF50',
                                                                    color: 'white',
                                                                    border: 'none',
                                                                    borderRadius: '4px',
                                                                    cursor: 'pointer',
                                                                    fontSize: '12px'
                                                                }}
                                                            >
                                                                Ï†ÄÏû•
                                                            </button>
                                                            <button
                                                                onClick={handleCancelEditTotalLeave}
                                                                style={{
                                                                    padding: '5px 10px',
                                                                    background: '#999',
                                                                    color: 'white',
                                                                    border: 'none',
                                                                    borderRadius: '4px',
                                                                    cursor: 'pointer',
                                                                    fontSize: '12px'
                                                                }}
                                                            >
                                                                Ï∑®ÏÜå
                                                            </button>
                                                        </div>
                                                        <input
                                                            type="text"
                                                            value={totalLeaveNote}
                                                            onChange={(e) => setTotalLeaveNote(e.target.value)}
                                                            placeholder="ÏàòÏ†ï ÏÇ¨Ïú†Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                                                            style={{
                                                                width: '100%',
                                                                padding: '8px',
                                                                fontSize: '13px',
                                                                border: '1px solid #ddd',
                                                                borderRadius: '4px'
                                                            }}
                                                        />
                                                    </div>
                                                ) : (
                                                    <>
                                                        {selectedEmployee.customTotalLeave || calculateTotalLeave(selectedEmployee.joinDate)}Ïùº
                                                        <button
                                                            onClick={handleStartEditTotalLeave}
                                                            style={{
                                                                padding: '4px 10px',
                                                                background: '#2196F3',
                                                                color: 'white',
                                                                border: 'none',
                                                                borderRadius: '4px',
                                                                cursor: 'pointer',
                                                                fontSize: '12px',
                                                                marginLeft: '10px'
                                                            }}
                                                        >
                                                            ÏàòÏ†ï
                                                        </button>
                                                    </>
                                                )}
                                            </div>
                                        </div>
                                        <div className="info-card">
                                            <h4>ÏÇ¨Ïö© Ïó∞Ï∞®</h4>
                                            <div className="value" style={{display: 'flex', alignItems: 'center', gap: '10px', flexWrap: 'wrap'}}>
                                                {editingUsedLeave ? (
                                                    <div style={{width: '100%'}}>
                                                        <div style={{display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '10px'}}>
                                                            <input
                                                                type="number"
                                                                value={tempUsedLeave}
                                                                onChange={(e) => setTempUsedLeave(e.target.value)}
                                                                style={{
                                                                    width: '80px',
                                                                    padding: '5px',
                                                                    fontSize: '16px',
                                                                    border: '2px solid #FF9800',
                                                                    borderRadius: '4px'
                                                                }}
                                                                autoFocus
                                                            />
                                                            <button
                                                                onClick={handleSaveUsedLeave}
                                                                style={{
                                                                    padding: '5px 10px',
                                                                    background: '#4CAF50',
                                                                    color: 'white',
                                                                    border: 'none',
                                                                    borderRadius: '4px',
                                                                    cursor: 'pointer',
                                                                    fontSize: '12px'
                                                                }}
                                                            >
                                                                Ï†ÄÏû•
                                                            </button>
                                                            <button
                                                                onClick={handleCancelEditUsedLeave}
                                                                style={{
                                                                    padding: '5px 10px',
                                                                    background: '#999',
                                                                    color: 'white',
                                                                    border: 'none',
                                                                    borderRadius: '4px',
                                                                    cursor: 'pointer',
                                                                    fontSize: '12px'
                                                                }}
                                                            >
                                                                Ï∑®ÏÜå
                                                            </button>
                                                        </div>
                                                        <input
                                                            type="text"
                                                            value={usedLeaveNote}
                                                            onChange={(e) => setUsedLeaveNote(e.target.value)}
                                                            placeholder="ÏàòÏ†ï ÏÇ¨Ïú†Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                                                            style={{
                                                                width: '100%',
                                                                padding: '8px',
                                                                fontSize: '13px',
                                                                border: '1px solid #ddd',
                                                                borderRadius: '4px'
                                                            }}
                                                        />
                                                    </div>
                                                ) : (
                                                    <>
                                                        {calculateUsedLeave()}Ïùº
                                                        <button
                                                            onClick={handleStartEditUsedLeave}
                                                            style={{
                                                                padding: '4px 10px',
                                                                background: '#FF9800',
                                                                color: 'white',
                                                                border: 'none',
                                                                borderRadius: '4px',
                                                                cursor: 'pointer',
                                                                fontSize: '12px',
                                                                marginLeft: '10px'
                                                            }}
                                                        >
                                                            ÏàòÏ†ï
                                                        </button>
                                                    </>
                                                )}
                                            </div>
                                        </div>
                                        <div className="info-card">
                                            <h4>ÎÇ®ÏùÄ Ïó∞Ï∞®</h4>
                                            <div className="value" style={{color: '#4CAF50'}}>
                                                {(selectedEmployee.customTotalLeave || calculateTotalLeave(selectedEmployee.joinDate)) - calculateUsedLeave()}Ïùº
                                            </div>
                                        </div>
                                    </div>

                                    <div className="leave-history" style={{marginTop: '30px'}}>
                                        <h3>Ïó∞Ï∞® ÏÇ¨Ïö© ÎÇ¥Ïó≠</h3>
                                        {leaveUsage.length > 0 ? (
                                            <>
                                            <table>
                                                <thead>
                                                    <tr>
                                                        <th>ÎÇ†Ïßú</th>
                                                        <th>Ïú†Ìòï</th>
                                                        <th>ÏÇ¨Ïö©ÏùºÏàò</th>
                                                        <th>ÎπÑÍ≥†</th>
                                                        <th>ÏäπÏù∏ ÏÉÅÌÉú</th>
                                                        <th>Í¥ÄÎ¶¨</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {(() => {
                                                        const startIndex = (currentPage - 1) * itemsPerPage;
                                                        const endIndex = startIndex + itemsPerPage;
                                                        const currentItems = leaveUsage.slice(startIndex, endIndex);
                                                        return currentItems.map(usage => {
                                                            const isEditRecord = usage.type === 'Ï¥ùÏó∞Ï∞® ÏàòÏ†ï' || usage.type === 'ÏÇ¨Ïö©Ïó∞Ï∞® ÏàòÏ†ï';
                                                            return (
                                                            <tr key={usage.id}>
                                                                <td>
                                                                    {usage.isGrouped && usage.startDate !== usage.endDate 
                                                                        ? `${usage.startDate} ~ ${usage.endDate}`
                                                                        : (usage.startDate || usage.date)}
                                                                </td>
                                                                <td>{usage.type}</td>
                                                                <td>
                                                                    {usage.isGrouped && usage.totalDays > 1
                                                                        ? `${usage.totalDays}Ïùº`
                                                                        : (usage.amount > 0 ? `${usage.amount}Ïùº` : '-')}
                                                                </td>
                                                                <td>{usage.note || '-'}</td>
                                                                <td>
                                                                    {usage.approvalStatus === '-' || isEditRecord ? (
                                                                        <span style={{
                                                                            padding: '4px 8px',
                                                                            fontSize: '12px',
                                                                            color: '#999'
                                                                        }}>
                                                                            -
                                                                        </span>
                                                                    ) : (
                                                                        <span style={{
                                                                            padding: '4px 8px',
                                                                            borderRadius: '4px',
                                                                            fontSize: '12px',
                                                                            background: usage.approvalStatus === 'approved' ? '#4CAF50' : 
                                                                                       usage.approvalStatus === 'rejected' ? '#ff4444' :
                                                                                       usage.approvalStatus === 'deletion-pending' ? '#9c27b0' :
                                                                                       usage.approvalStatus === 'cancelled' ? '#999' : '#ff9800',
                                                                            color: 'white'
                                                                        }}>
                                                                            {usage.approvalStatus === 'approved' ? 'ÏäπÏù∏ÏôÑÎ£å' : 
                                                                             usage.approvalStatus === 'rejected' ? 'Î∞òÎ†§' :
                                                                             usage.approvalStatus === 'deletion-pending' ? 'Ï∑®ÏÜåÎåÄÍ∏∞' :
                                                                             usage.approvalStatus === 'cancelled' ? 'Ï∑®ÏÜåÎê®' : 'ÏäπÏù∏ÎåÄÍ∏∞'}
                                                                        </span>
                                                                    )}
                                                                </td>
                                                                <td>
                                                                    <button
                                                                        className="delete-btn"
                                                                        onClick={() => handleDeleteUsedLeave(
                                                                            usage.isGrouped ? usage : usage.id,
                                                                            usage.date,
                                                                            usage.type,
                                                                            usage.groupId
                                                                        )}
                                                                        style={{fontSize: '12px', padding: '4px 8px'}}
                                                                    >
                                                                        {isEditRecord ? 'ÏÇ≠Ï†ú' : 'Ï∑®ÏÜå'}
                                                                    </button>
                                                                </td>
                                                            </tr>
                                                        )});
                                                    })()}
                                                </tbody>
                                            </table>
                                            {leaveUsage.length > itemsPerPage && (
                                                <Pagination
                                                    currentPage={currentPage}
                                                    totalPages={Math.ceil(leaveUsage.length / itemsPerPage)}
                                                    onPageChange={setCurrentPage}
                                                />
                                            )}
                                            </>
                                        ) : (
                                            <div style={{padding: '20px', textAlign: 'center', color: '#666'}}>
                                                Ïó∞Ï∞® ÏÇ¨Ïö© ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.
                                            </div>
                                        )}
                                    </div>
                                </>
                            ) : (
                                <div style={{
                                    padding: '60px',
                                    textAlign: 'center',
                                    color: '#999',
                                    fontSize: '16px'
                                }}>
                                    ÏÇ¨ÏõêÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        // Î©îÏù∏ Ïï± Ïª¥Ìè¨ÎÑåÌä∏
        function App() {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [activeTab, setActiveTab] = useState('calendar');
            const [employees, setEmployees] = useState([]);
            const [isAdmin, setIsAdmin] = useState(false);
            const [isApprover, setIsApprover] = useState(false);
            const [isPTScheduleEditor, setIsPTScheduleEditor] = useState(false);
            const [pendingCount, setPendingCount] = useState(0);

            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged(async (user) => {
                    setUser(user);
                    if (user) {
                        // Í¥ÄÎ¶¨Ïûê Î∞è ÏäπÏù∏Ïûê Í∂åÌïú ÌôïÏù∏
                        const employeeDoc = await db.collection('employees').doc(user.uid).get();
                        if (employeeDoc.exists) {
                            const isAdminUser = employeeDoc.data().isAdmin || false;
                            const isApproverUser = employeeDoc.data().isApprover || false;
                            const isPTScheduleEditorUser = employeeDoc.data().isPTScheduleEditor || false;
                            setIsAdmin(isAdminUser);
                            setIsApprover(isApproverUser);
                            setIsPTScheduleEditor(isPTScheduleEditorUser);
                            
                            // ÏäπÏù∏ÏûêÎùºÎ©¥ ÎåÄÍ∏∞ Í±¥Ïàò Î∞îÎ°ú Î°úÎìú
                            if (isApproverUser && !isAdminUser) {
                                loadInitialPendingCount(user.uid);
                            }
                        }
                        loadEmployees();
                    }
                    setLoading(false);
                });

                return () => unsubscribe();
            }, []);

            const loadInitialPendingCount = async (userId) => {
                try {
                    // Îã¥Îãπ ÏÇ¨Ïõê Î™©Î°ù Ï°∞Ìöå
                    const snapshot = await db.collection('employees')
                        .where('approver', '==', userId)
                        .get();

                    const employeeIds = [];
                    snapshot.forEach(doc => {
                        employeeIds.push(doc.id);
                    });
                    
                    if (employeeIds.length > 0) {
                        // pendingÍ≥º deletion-pending Í±¥Ïàò Ï°∞Ìöå
                        const pendingSnapshot = await db.collection('leaveUsage')
                            .where('approvalStatus', '==', 'pending')
                            .get();
                        
                        const deletionSnapshot = await db.collection('leaveUsage')
                            .where('approvalStatus', '==', 'deletion-pending')
                            .get();

                        let count = 0;
                        
                        // pending Í±¥Ïàò Í≥ÑÏÇ∞
                        pendingSnapshot.forEach(doc => {
                            if (employeeIds.includes(doc.data().userId)) {
                                count++;
                            }
                        });
                        
                        // deletion-pending Í±¥Ïàò Í≥ÑÏÇ∞
                        deletionSnapshot.forEach(doc => {
                            if (employeeIds.includes(doc.data().userId)) {
                                count++;
                            }
                        });
                        
                        setPendingCount(count);
                    }
                } catch (error) {
                    console.error('ÎåÄÍ∏∞ Í±¥Ïàò Î°úÎìú Ïã§Ìå®:', error);
                }
            };

            const loadEmployees = async () => {
                const snapshot = await db.collection('employees').get();
                const employeeList = [];
                snapshot.forEach(doc => {
                    employeeList.push({ id: doc.id, ...doc.data() });
                });
                setEmployees(employeeList);
            };

            const handleLogout = async () => {
                await auth.signOut();
                setActiveTab('calendar');
            };

            if (loading) {
                return <div style={{textAlign: 'center', padding: '50px'}}>Î°úÎî©Ï§ë...</div>;
            }

            if (!user) {
                return <Login onLogin={setUser} />;
            }

            return (
                <div className="app-container">
                    <div className="header">
                        <h1>Ïä§ÏºÄÏ•¥ Î∞è Ïó∞Ï∞® Í¥ÄÎ¶¨</h1>
                        <div className="user-info">
                            <span>{user.email}</span>
                            {isAdmin && <span style={{
                                background: '#4CAF50',
                                color: 'white',
                                padding: '4px 8px',
                                borderRadius: '4px',
                                fontSize: '12px',
                                marginLeft: '10px'
                            }}>Í¥ÄÎ¶¨Ïûê</span>}
                            {isApprover && <span style={{
                                background: '#2196F3',
                                color: 'white',
                                padding: '4px 8px',
                                borderRadius: '4px',
                                fontSize: '12px',
                                marginLeft: '10px'
                            }}>ÏäπÏù∏Ïûê</span>}
                            {isPTScheduleEditor && <span style={{
                                background: '#FF9800',
                                color: 'white',
                                padding: '4px 8px',
                                borderRadius: '4px',
                                fontSize: '12px',
                                marginLeft: '10px'
                            }}>PTÌé∏ÏßëÏûê</span>}
                            <button className="logout-btn" onClick={handleLogout}>Î°úÍ∑∏ÏïÑÏõÉ</button>
                        </div>
                    </div>

                    <div className="tabs">
                        <button
                            className={`tab ${activeTab === 'calendar' ? 'active' : ''}`}
                            onClick={() => setActiveTab('calendar')}
                        >
                            ÏùºÏ†ï Ï∫òÎ¶∞Îçî
                        </button>
                        {!isAdmin && (
                            <button
                                className={`tab ${activeTab === 'leave' ? 'active' : ''}`}
                                onClick={() => setActiveTab('leave')}
                            >
                                Ïó∞Ï∞® Í¥ÄÎ¶¨
                            </button>
                        )}
                        <button
                            className={`tab ${activeTab === 'pt-schedule' ? 'active' : ''}`}
                            onClick={() => setActiveTab('pt-schedule')}
                        >
                            PT Ïä§ÏºÄÏ§Ñ
                        </button>
                        {isApprover && !isAdmin && (
                            <button
                                className={`tab ${activeTab === 'approval' ? 'active' : ''}`}
                                onClick={() => setActiveTab('approval')}
                                style={{position: 'relative'}}
                            >
                                Ïó∞Ï∞® ÏäπÏù∏
                                {pendingCount > 0 && (
                                    <span style={{
                                        position: 'absolute',
                                        top: '5px',
                                        right: '5px',
                                        background: '#ff4444',
                                        color: 'white',
                                        borderRadius: '50%',
                                        minWidth: '20px',
                                        height: '20px',
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        fontSize: '11px',
                                        fontWeight: 'bold',
                                        padding: '0 5px'
                                    }}>
                                        {pendingCount}
                                    </span>
                                )}
                            </button>
                        )}
                        {isAdmin && (
                            <>
                                <button
                                    className={`tab ${activeTab === 'admin-leave' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('admin-leave')}
                                >
                                    ÏÇ¨ÏõêÏó∞Ï∞® Í¥ÄÎ¶¨
                                </button>
                                <button
                                    className={`tab ${activeTab === 'approval-line' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('approval-line')}
                                >
                                    Í≤∞Ïû¨ÏÑ† Í¥ÄÎ¶¨
                                </button>
                                <button
                                    className={`tab ${activeTab === 'admin' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('admin')}
                                >
                                    ÏÇ¨Ïõê Í¥ÄÎ¶¨
                                </button>
                                <button
                                    className={`tab ${activeTab === 'slack-settings' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('slack-settings')}
                                >
                                    Slack ÏÑ§Ï†ï
                                </button>
                            </>
                        )}
                    </div>

                    {activeTab === 'calendar' && <Calendar user={user} employees={employees} />}
                    {activeTab === 'leave' && <AnnualLeave user={user} />}
                    {activeTab === 'pt-schedule' && <PTSchedule user={user} isPTScheduleEditor={isPTScheduleEditor || isAdmin} />}
                    {activeTab === 'approval' && isApprover && <ApprovalManagement user={user} setPendingCount={setPendingCount} />}
                    {activeTab === 'admin-leave' && isAdmin && <AdminLeaveManagement />}
                    {activeTab === 'approval-line' && isAdmin && <ApprovalLineManagement />}
                    {activeTab === 'admin' && isAdmin && <AdminPage />}
                    {activeTab === 'slack-settings' && isAdmin && <SlackSettings />}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
